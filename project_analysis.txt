================================================================================
                   PHÃ‚N TÃCH Cáº¤U TRÃšC Dá»° ÃN VÃ€ Ná»˜I DUNG CODE
================================================================================

1. Cáº¤U TRÃšC THÆ¯ Má»¤C:
----------------------------------------
hr-management-system/
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ cookies.txt
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Getcode.ipynb
â”œâ”€â”€ index.html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ project_analysis.txt
â”œâ”€â”€ Readme.md
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ server.js
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.js
â”‚   â”‚   â””â”€â”€ lark-config.js
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ attendanceController.js
â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â”œâ”€â”€ dashboardController.js
â”‚   â”‚   â”œâ”€â”€ employeeController.js
â”‚   â”‚   â”œâ”€â”€ positionController.js
â”‚   â”‚   â”œâ”€â”€ recruitmentController.js
â”‚   â”‚   â””â”€â”€ storeController.js
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â””â”€â”€ validation.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ attendance.js
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ dashboard.js
â”‚   â”‚   â”œâ”€â”€ employees.js
â”‚   â”‚   â”œâ”€â”€ masterData.js
â”‚   â”‚   â””â”€â”€ recruitment.js
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ index.js
â”‚       â”œâ”€â”€ lark-service-manager.js
â”‚       â”œâ”€â”€ attendance/
â”‚       â”‚   â”œâ”€â”€ attendance-service.js
â”‚       â”‚   â”œâ”€â”€ attendance-validator.js
â”‚       â”‚   â””â”€â”€ index.js
â”‚       â”œâ”€â”€ auth/
â”‚       â”‚   â”œâ”€â”€ auth-service.js
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â””â”€â”€ session-service.js
â”‚       â”œâ”€â”€ core/
â”‚       â”‚   â”œâ”€â”€ base-service.js
â”‚       â”‚   â”œâ”€â”€ cache-service.js
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â””â”€â”€ lark-client.js
â”‚       â”œâ”€â”€ employees/
â”‚       â”‚   â”œâ”€â”€ employee-service.js
â”‚       â”‚   â”œâ”€â”€ employee-validator.js
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â””â”€â”€ work-history-service.js
â”‚       â”œâ”€â”€ master-data/
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â”œâ”€â”€ master-data-validator.js
â”‚       â”‚   â”œâ”€â”€ position-service.js
â”‚       â”‚   â””â”€â”€ store-service.js
â”‚       â”œâ”€â”€ recruitment/
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â”œâ”€â”€ recruitment-service.js
â”‚       â”‚   â””â”€â”€ recruitment-validator.js
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ error-handler.js
â”‚           â”œâ”€â”€ index.js
â”‚           â”œâ”€â”€ response-formatter.js
â”‚           â””â”€â”€ service-factory.js
â””â”€â”€ src/
    â”œâ”€â”€ App.jsx
    â”œâ”€â”€ main.jsx
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ attendance/
    â”‚   â”‚   â”œâ”€â”€ AttendanceFilters.jsx
    â”‚   â”‚   â”œâ”€â”€ AttendanceLogs.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeHours.jsx
    â”‚   â”‚   â””â”€â”€ LarkAttendanceEmbed.jsx
    â”‚   â”œâ”€â”€ auth/
    â”‚   â”‚   â”œâ”€â”€ LoginForm.jsx
    â”‚   â”‚   â””â”€â”€ ProtectedRoute.jsx
    â”‚   â”œâ”€â”€ common/
    â”‚   â”‚   â”œâ”€â”€ Alert.jsx
    â”‚   â”‚   â”œâ”€â”€ Loading.jsx
    â”‚   â”‚   â”œâ”€â”€ Modal.jsx
    â”‚   â”‚   â””â”€â”€ Table.jsx
    â”‚   â”œâ”€â”€ dashboard/
    â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx
    â”‚   â”‚   â”œâ”€â”€ HRDashboard.jsx
    â”‚   â”‚   â””â”€â”€ StatsCard.jsx
    â”‚   â”œâ”€â”€ employee/
    â”‚   â”‚   â”œâ”€â”€ AddWorkHistoryModal.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeAddForm.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeEditModal.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeForm.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeList.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeTable.jsx
    â”‚   â”‚   â”œâ”€â”€ RecruitmentModal.jsx
    â”‚   â”‚   â””â”€â”€ WorkHistoryModal.jsx
    â”‚   â”œâ”€â”€ layout/
    â”‚   â”‚   â”œâ”€â”€ Layout.jsx
    â”‚   â”‚   â””â”€â”€ ResponsiveNavigation.jsx
    â”‚   â””â”€â”€ masterdata/
    â”‚       â”œâ”€â”€ PositionManager.jsx
    â”‚       â””â”€â”€ StoreManager.jsx
    â”œâ”€â”€ contexts/
    â”‚   â”œâ”€â”€ AppContext.jsx
    â”‚   â”œâ”€â”€ AuthContext.jsx
    â”‚   â””â”€â”€ NotificationContext.jsx
    â”œâ”€â”€ hooks/
    â”‚   â”œâ”€â”€ useApi.js
    â”‚   â”œâ”€â”€ useAttendance.js
    â”‚   â”œâ”€â”€ useAuth.js
    â”‚   â”œâ”€â”€ useEmployees.js
    â”‚   â””â”€â”€ useNotification.js
    â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ AttendanceLogsPage.jsx
    â”‚   â”œâ”€â”€ EmployeeManagementPage.jsx
    â”‚   â”œâ”€â”€ HRDashboardPage.jsx
    â”‚   â””â”€â”€ LoginPage.jsx
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ api.js
    â”‚   â”œâ”€â”€ auth.js
    â”‚   â””â”€â”€ employee.js
    â”œâ”€â”€ styles/
    â”‚   â”œâ”€â”€ components.css
    â”‚   â”œâ”€â”€ globals.css
    â”‚   â””â”€â”€ notifications.css
    â””â”€â”€ utils/
        â””â”€â”€ dateUtils.js

2. Ná»˜I DUNG CHI TIáº¾T CÃC FILE:
----------------------------------------


==================== File: .\cookies.txt ====================

# Netscape HTTP Cookie File
# https://curl.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.


```


==================== File: .\index.html ====================

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HR Management System - React</title>
</head>
<body>
  <div id="root"></div>
  <div id="alert-container"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>
</html>

```


==================== File: .\package.json ====================

{
  "name": "hr-management-system-react",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "server": "node server/server.js"
  },
  "dependencies": {
    "@fortawesome/fontawesome-free": "^6.7.2",
    "axios": "^1.10.0",
    "bootstrap": "^5.3.7",
    "cors": "^2.8.5",
    "dotenv": "^16.6.1",
    "express": "^4.21.2",
    "express-session": "^1.18.2",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.30.1"
  },
  "devDependencies": {
    "@types/react": "^18.0.28",
    "@types/react-dom": "^18.0.11",
    "@vitejs/plugin-react": "^3.1.0",
    "eslint": "^8.38.0",
    "eslint-plugin-react": "^7.32.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.3.4",
    "vite": "^4.5.14"
  }
}

```


==================== File: .\project_analysis.txt ====================


```


==================== File: .\Readme.md ====================

Backend (Node.js/Express)
Kiáº¿n trÃºc khuyáº¿n nghá»‹:
Layered Architecture (Service - Controller - Route - Middleware)
Routes: Äá»‹nh nghÄ©a cÃ¡c endpoint, phÃ¢n chia rÃµ theo module (vd: /employees, /attendance).
Controllers: Xá»­ lÃ½ request/response, gá»i sang service. KhÃ´ng chá»©a logic nghiá»‡p vá»¥ sÃ¢u.
Services: Chá»©a logic nghiá»‡p vá»¥ (business logic) vÃ  thao tÃ¡c dá»¯ liá»‡u (gá»i API, DB, Lark).
Utils & Validators: Kiá»ƒm tra, format, handler lá»—i, validation input.
Models: (Náº¿u xÃ i ORM/database thá»±c), mÃ´ táº£ cáº¥u trÃºc dá»¯ liá»‡u.
(Báº¡n Ä‘Ã£ cÃ³ phÃ¢n chia khÃ¡ chuáº©n, chá»‰ cáº§n dá»n láº¡i cÃ¡c chá»— cÃ²n láº«n lá»™n, loáº¡i bá» code cÅ©).
CÃ¡c Ä‘iá»ƒm cáº§n lÆ°u Ã½:
KhÃ´ng gá»i trá»±c tiáº¿p tá»« route xuá»‘ng service, luÃ´n qua controller.
Chá»‰ Ä‘á»ƒ má»™t nÆ¡i chá»‹u trÃ¡ch nhiá»‡m chÃ­nh vá» validate (thÆ°á»ng lÃ  middleware hoáº·c náº±m trong services/utils).
KhÃ´ng Ä‘á»ƒ controllers vá»«a thao tÃ¡c dá»¯ liá»‡u, vá»«a gá»i nhiá»u táº§ng - 1 controller = 1 use-case nghiá»‡p vá»¥.
Frontend (React + Context + Service Layer)
Kiáº¿n trÃºc khuyáº¿n nghá»‹:
Component-based (Atomic/Domain)
Pages: Trang tÆ°Æ¡ng á»©ng route (/dashboard, /employee-management...)
Components: ThÃ nh pháº§n tÃ¡i sá»­ dá»¥ng (Form, Table, Modal, Cards...)
Hooks: Quáº£n lÃ½ logic dÃ¹ng chung (fetch data, validate, notification...)
Contexts: Chá»©a state global (Auth, Notification).
Services layer: File JS quáº£n lÃ½ toÃ n bá»™ gá»i API, cÃ¡c hÃ m CRUD tráº£ ra Ä‘Ãºng format.
Styles: Äá»ƒ riÃªng, trÃ¡nh style inline nhiá»u.
NgoÃ i ra:
Háº¡n cháº¿ Ä‘á»ƒ logic xá»­ lÃ½ data trá»±c tiáº¿p trong component, hÃ£y Ä‘áº©y tá»‘i Ä‘a sang service/hook.
TÃ¡ch biá»‡t rÃµ cÃ¡c táº§ng: Page â†’ Hook â†’ Service â†’ API (vÃ  Context náº¿u cáº§n).
Kiá»ƒm tra toÃ n bá»™ cÃ¡c API báº¡n gá»i tráº£ Ä‘Ãºng structure JSON (success, data, message...), Ä‘á»«ng xá»­ lÃ½ dá»¯ liá»‡u tháº³ng tá»« response chÆ°a kiá»ƒm soÃ¡t.
```


==================== File: .\vite.config.js ====================

// vite.config.js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    host: '0.0.0.0',
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
      }
    }
  }
})

```


==================== File: .\server\server.js ====================

// server/server.js
import dotenv from 'dotenv';

// Configure dotenv FIRST
dotenv.config();

// Import cÃ¡c modules AFTER Ä‘Ã£ config dotenv
import express from 'express';
import cors from 'cors';
import session from 'express-session';
import path from 'path';
import { fileURLToPath } from 'url';

// ES6 module equivalent of __dirname
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Import service manager AFTER dotenv config
import larkServiceManager from './services/lark-service-manager.js';

// Import routes
import authRoutes from './routes/auth.js';
import employeeRoutes from './routes/employees.js';
import attendanceRoutes from './routes/attendance.js';
import recruitmentRoutes from './routes/recruitment.js';
import masterDataRoutes from './routes/masterData.js';
import dashboardRoutes from './routes/dashboard.js';

const app = express();
const PORT = process.env.PORT || 8080;

// Middleware
// Trong mÃ´i trÆ°á»ng container, server vÃ  client sáº½ cÃ¹ng má»™t nguá»“n gá»‘c,
// nhÆ°ng cáº¥u hÃ¬nh CORS nÃ y váº«n tá»‘t cho mÃ´i trÆ°á»ng phÃ¡t triá»ƒn local.
app.use(cors({
    origin: 'http://localhost:3000',
    credentials: true
}));

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Session configuration
app.use(session({
    secret: process.env.SESSION_SECRET || 'your-secret-key',
    resave: false,
    saveUninitialized: false,
    cookie: { secure: false, maxAge: 24 * 60 * 60 * 1000 } // Trong production nÃªn set secure: true náº¿u dÃ¹ng HTTPS
}));

// API Routes - Táº¥t cáº£ cÃ¡c route API cá»§a báº¡n váº«n giá»¯ nguyÃªn
app.use('/api/auth', authRoutes);
app.use('/api/employees', employeeRoutes);
app.use('/api/attendance', attendanceRoutes);
app.use('/api/recruitment', recruitmentRoutes);
app.use('/api/master-data', masterDataRoutes);
app.use('/api/dashboard', dashboardRoutes);

// Health check endpoint
app.get('/api/health', (req, res) => {
    res.json({
        status: 'OK',
        timestamp: new Date().toISOString(),
        services: {
            larkServiceManager: larkServiceManager.initialized
        }
    });
});

// ==============================================================================
// --- Báº®T Äáº¦U PHáº¦N THÃŠM Má»šI Äá»‚ PHá»¤C Vá»¤ GIAO DIá»†N REACT ---
// ==============================================================================

// 1. Phá»¥c vá»¥ cÃ¡c file tÄ©nh (static files) tá»« thÆ° má»¥c build cá»§a React.
//    Dockerfile sáº½ táº¡o thÆ° má»¥c 'dist' á»Ÿ thÆ° má»¥c gá»‘c cá»§a dá»± Ã¡n.
const buildPath = path.join(__dirname, '..', 'dist');
app.use(express.static(buildPath));

// 2. Xá»­ lÃ½ táº¥t cáº£ cÃ¡c request GET khÃ´ng pháº£i lÃ  API.
//    NÃ³ sáº½ tráº£ vá» file index.html cá»§a React.
//    Äiá»u nÃ y ráº¥t quan trá»ng Ä‘á»ƒ React Router cÃ³ thá»ƒ xá»­ lÃ½ routing á»Ÿ phÃ­a client.
//    VÃ­ dá»¥: khi báº¡n truy cáº­p /employee-management, server sáº½ tráº£ vá» index.html,
//    sau Ä‘Ã³ React Router sáº½ Ä‘á»c URL vÃ  hiá»ƒn thá»‹ Ä‘Ãºng component.
app.get(/^(?!\/api).*/, (req, res) => {
    res.sendFile(path.join(buildPath, 'index.html'));
});

// Äoáº¡n code nÃ y sáº½ thay tháº¿ cho endpoint app.get('/') cÅ© cá»§a báº¡n.

// ==============================================================================
// --- Káº¾T THÃšC PHáº¦N THÃŠM Má»šI ---
// ==============================================================================


// Start server with proper initialization
app.listen(PORT, '::', async () => {
    console.log(`Server running on http://localhost:${PORT}`);
    
    try {
        await larkServiceManager.init();
        console.log('Server fully initialized and ready');
    } catch (error) {
        console.error('Service initialization failed:', error.message);
        console.log('Server running but services unavailable');
    }
});

```


==================== File: .\server\config\database.js ====================

// Demo users data (in production, use real database)
const users = {
    admin: {
        id: 'admin',
        username: 'admin',
        password: 'atino2025',
        role: 'admin',
        fullName: 'System Admin'
    },
    hr: {
        id: 'hr',
        username: 'hr',
        password: 'hr123',
        role: 'hr',
        fullName: 'HR Manager'
    },
    sales: {
        id: 'sales',
        username: 'sales',
        password: 'sales123',
        role: 'sales_manager',
        fullName: 'Sales Manager'
    },
    finance: {
        id: 'finance',
        username: 'finance',
        password: 'finance123',
        role: 'finance_manager',
        fullName: 'Finance Manager'
    },
    director: {
        id: 'director',
        username: 'director',
        password: 'director123',
        role: 'director',
        fullName: 'Director'
    }
};

const roles = {
    admin: 'Admin',
    hr: 'HR',
    sales_manager: 'TrÆ°á»Ÿng phÃ²ng kinh doanh',
    finance_manager: 'TrÆ°á»Ÿng phÃ²ng tÃ i chÃ­nh káº¿ toÃ¡n',
    director: 'Tá»•ng giÃ¡m Ä‘á»‘c'
};

export {
    users,
    roles
};

```


==================== File: .\server\config\lark-config.js ====================

// server/config/lark-config.js
export const validateLarkConfig = () => {
    const requiredVars = [
        'LARK_APP_ID',
        'LARK_APP_SECRET', 
        'LARK_BASE_ID',
        'LARK_EMPLOYEE_TABLE_ID',
        'LARK_ATTENDANCE_TABLE_ID',
        'LARK_RECRUITMENT_TABLE_ID',
        'LARK_STORE_TABLE_ID',
        'LARK_POSITION_TABLE_ID',
        'LARK_WORK_HISTORY_TABLE_ID',
        'LARK_HOURS_SUMMARY_TABLE_ID'
    ];

    const missing = requiredVars.filter(key => !process.env[key]);
    
    if (missing.length > 0) {
        throw new Error(`âŒ Missing Lark configuration: ${missing.join(', ')}`);
    }
    
    console.log('âœ… Lark configuration validated');
};

export const larkConfig = {
    appId: process.env.LARK_APP_ID,
    appSecret: process.env.LARK_APP_SECRET,
    baseId: process.env.LARK_BASE_ID,
    tables: {
        employee: process.env.LARK_EMPLOYEE_TABLE_ID,
        attendance: process.env.LARK_ATTENDANCE_TABLE_ID,
        recruitment: process.env.LARK_RECRUITMENT_TABLE_ID,
        store: process.env.LARK_STORE_TABLE_ID,
        position: process.env.LARK_POSITION_TABLE_ID,
        workHistory: process.env.LARK_WORK_HISTORY_TABLE_ID,
        hoursSummary: process.env.LARK_HOURS_SUMMARY_TABLE_ID
    }
};

```


==================== File: .\server\controllers\attendanceController.js ====================

// server/controllers/attendanceController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';


/* ======================= REGION: Láº¥y danh sÃ¡ch báº£n ghi cháº¥m cÃ´ng ======================= */
/**
 * GET: Láº¥y danh sÃ¡ch cÃ¡c báº£n ghi cháº¥m cÃ´ng (attendance logs) dá»±a trÃªn filter tá»« query parameters.
 * - Tráº£ vá» data báº£n ghi cháº¥m cÃ´ng dáº¡ng list.
 * - Xá»­ lÃ½ lá»—i vÃ  gá»­i error message náº¿u cÃ³ váº¥n Ä‘á».
 */
export const getAttendanceLogs = async (req, res) => {
    try {
        const filters = req.query;
        const attendanceService = larkServiceManager.getService('attendance');
        const logs = await attendanceService.getAttendanceLogs(filters);
        
        res.json(formatResponse(true, 'Láº¥y báº£n ghi cháº¥m cÃ´ng thÃ nh cÃ´ng', logs));
    } catch (error) {
        console.error('âŒ Controller: getAttendanceLogs failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y báº£n ghi cháº¥m cÃ´ng: ${error.message}`, 
            null, 
            'ATTENDANCE_LOAD_FAILED'
        ));
    }
};



/* ======================= REGION: ThÃªm báº£n ghi cháº¥m cÃ´ng má»›i ======================= */
/**
 * POST: ThÃªm má»™t báº£n ghi cháº¥m cÃ´ng má»›i cho nhÃ¢n viÃªn.
 * - Nháº­n attendanceData tá»« body request (employeeId, type, position).
 * - Validate dá»¯ liá»‡u (Ä‘áº§y Ä‘á»§, há»£p lá»‡).
 * - Gá»i service Ä‘á»ƒ lÆ°u báº£n ghi má»›i vÃ o há»‡ thá»‘ng.
 * - Tráº£ káº¿t quáº£ thÃ nh cÃ´ng/tháº¥t báº¡i cho client.
 */
export const addAttendanceLog = async (req, res) => {
    try {
        const attendanceData = req.body;
        
        // Validate required fields
        if (!attendanceData.employeeId || !attendanceData.type || !attendanceData.position) {
            return res.status(400).json(formatResponse(
                false, 
                'Thiáº¿u thÃ´ng tin báº¯t buá»™c: employeeId, type (Checkin/Checkout), position', 
                null, 
                'VALIDATION_ERROR'
            ));
        }

        // Validate position values
        const validPositions = ['NhÃ¢n viÃªn BÃ¡n hÃ ng', 'NhÃ¢n viÃªn Thu ngÃ¢n', 'NhÃ¢n viÃªn Tiáº¿p Ä‘Ã³n', 'NhÃ¢n viÃªn Mascot'];
        if (!validPositions.includes(attendanceData.position)) {
            return res.status(400).json(formatResponse(
                false, 
                `Vá»‹ trÃ­ khÃ´ng há»£p lá»‡. Pháº£i lÃ  má»™t trong: ${validPositions.join(', ')}`, 
                null, 
                'INVALID_POSITION'
            ));
        }

        // Validate type values
        if (!['Checkin', 'Checkout'].includes(attendanceData.type)) {
            return res.status(400).json(formatResponse(
                false, 
                'PhÃ¢n loáº¡i pháº£i lÃ  "Checkin" hoáº·c "Checkout"', 
                null, 
                'INVALID_TYPE'
            ));
        }

        const attendanceService = larkServiceManager.getService('attendance');
        const result = await attendanceService.addAttendanceLog(attendanceData);
        
        res.json(formatResponse(true, 'ThÃªm báº£n ghi cháº¥m cÃ´ng thÃ nh cÃ´ng', result));
    } catch (error) {
        console.error('âŒ Controller: addAttendanceLog failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi thÃªm báº£n ghi cháº¥m cÃ´ng: ${error.message}`, 
            null, 
            'ATTENDANCE_ADD_FAILED'
        ));
    }
};


/* ======================= REGION: TÃ­nh tá»•ng giá» cÃ´ng táº¥t cáº£ nhÃ¢n viÃªn ======================= */
/**
 * GET: Láº¥y tá»•ng há»£p giá» cÃ´ng cho táº¥t cáº£ nhÃ¢n viÃªn (theo tá»«ng ngÃ y).
 * - Láº¥y dá»¯ liá»‡u giá» cÃ´ng tá»« service.
 * - Gáº¯n thÃªm thÃ´ng tin nhÃ¢n viÃªn (tÃªn, position, ...) vÃ o má»—i record.
 * - Tráº£ vá» list tá»•ng há»£p theo ngÃ y + má»™t sá»‘ summary.
 */


export const getEmployeeHours = async (req, res) => {
    try {
        console.log('ğŸ“Š Controller: Getting employee hours...');
        
        const attendanceService = larkServiceManager.getService('attendance');
        const employeeService = larkServiceManager.getService('employee');
        
        // Láº¥y dá»¯ liá»‡u giá» cÃ´ng tá»« service
        const employeeHours = await attendanceService.getEmployeeHours();
        
        // Láº¥y thÃ´ng tin chi tiáº¿t nhÃ¢n viÃªn Ä‘á»ƒ hiá»ƒn thá»‹ tÃªn
        const employees = await employeeService.getAllEmployees();
        const employeeMap = new Map(employees.map(emp => [emp.employeeId, emp]));
        
        // Transform data Ä‘á»ƒ phÃ¹ há»£p vá»›i frontend
        const transformedData = [];
        
        for (const [employeeId, dailyHours] of Object.entries(employeeHours)) {
            const employee = employeeMap.get(employeeId);
            
            if (!employee) {
                console.warn(`âš ï¸ Employee not found: ${employeeId}`);
                continue;
            }
            
            // ThÃªm thÃ´ng tin nhÃ¢n viÃªn vÃ o tá»«ng ngÃ y
            dailyHours.forEach(dayData => {
                transformedData.push({
                    employeeId: employeeId,
                    fullName: employee.fullName,
                    date: dayData.date,
                    position: dayData.position,
                    totalHours: dayData.totalHours,
                    warnings: dayData.warnings || [],
                    hasError: false
                });
            });
        }
        
        // Sáº¯p xáº¿p theo tÃªn nhÃ¢n viÃªn vÃ  ngÃ y
        transformedData.sort((a, b) => {
            if (a.fullName !== b.fullName) {
                return a.fullName.localeCompare(b.fullName);
            }
            return new Date(b.date) - new Date(a.date); // NgÃ y má»›i nháº¥t trÆ°á»›c
        });
        
        console.log(`âœ… Controller: Processed ${transformedData.length} employee hour records`);
        
        res.json(formatResponse(true, 'Láº¥y tá»•ng giá» cÃ´ng thÃ nh cÃ´ng', {
            employeeHours: transformedData,
            summary: {
                totalEmployees: new Set(transformedData.map(d => d.employeeId)).size,
                totalRecords: transformedData.length,
                recordsWithErrors: transformedData.filter(d => d.hasError).length,
                recordsWithWarnings: transformedData.filter(d => d.warnings.length > 0).length
            }
        }));
        
    } catch (error) {
        console.error('âŒ Controller: getEmployeeHours failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y tá»•ng giá» cÃ´ng: ${error.message}`, 
            null, 
            'EMPLOYEE_HOURS_LOAD_FAILED'
        ));
    }
};


/* ======================= REGION: Thá»‘ng kÃª tá»•ng há»£p cháº¥m cÃ´ng ======================= */
/**
 * GET: Láº¥y thá»‘ng kÃª tá»•ng há»£p cháº¥m cÃ´ng trong khoáº£ng thá»i gian (ngÃ y báº¯t Ä‘áº§u/káº¿t thÃºc).
 * - Tá»•ng sá»‘ lÆ°á»£t cháº¥m cÃ´ng (totalLogs).
 * - Sá»‘ nhÃ¢n viÃªn duy nháº¥t (uniqueEmployees).
 * - Thá»‘ng kÃª theo loáº¡i (Checkin/Checkout) vÃ  theo vá»‹ trÃ­.
 */
export const getAttendanceStats = async (req, res) => {
    try {
        const { dateFrom, dateTo } = req.query;
        
        const attendanceService = larkServiceManager.getService('attendance');
        const filters = {};
        
        if (dateFrom) filters.dateFrom = dateFrom;
        if (dateTo) filters.dateTo = dateTo;
        
        const logs = await attendanceService.getAttendanceLogs(filters);
        
        // TÃ­nh toÃ¡n thá»‘ng kÃª
        const stats = {
            totalLogs: logs.length,
            uniqueEmployees: new Set(logs.map(log => log.employeeId)).size,
            logsByType: {
                checkin: logs.filter(log => log.type === 'Checkin').length,
                checkout: logs.filter(log => log.type === 'Checkout').length
            },
            logsByPosition: {}
        };
        
        // Äáº¿m theo vá»‹ trÃ­
        logs.forEach(log => {
            if (log.position) {
                stats.logsByPosition[log.position] = (stats.logsByPosition[log.position] || 0) + 1;
            }
        });
        
        res.json(formatResponse(true, 'Láº¥y thá»‘ng kÃª cháº¥m cÃ´ng thÃ nh cÃ´ng', stats));
        
    } catch (error) {
        console.error('âŒ Controller: getAttendanceStats failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y thá»‘ng kÃª cháº¥m cÃ´ng: ${error.message}`, 
            null, 
            'ATTENDANCE_STATS_FAILED'
        ));
    }
};




/* ======================= REGION: Giá» cÃ´ng chi tiáº¿t 1 nhÃ¢n viÃªn ======================= */
/**
 * GET: Láº¥y chi tiáº¿t giá» cÃ´ng cá»§a má»™t nhÃ¢n viÃªn (theo employeeId vÃ  khoáº£ng ngÃ y).
 * - list báº£n ghi raw (logs).
 * - báº£ng tá»•ng há»£p giá» cÃ´ng tá»«ng ngÃ y (dailyHours).
 * - tá»•ng káº¿t sá»‘ ngÃ y vÃ  tá»•ng sá»‘ giá» thá»±c táº¿.
 */
export const getEmployeeDetailedHours = async (req, res) => {
    try {
        const { employeeId } = req.params;
        const { dateFrom, dateTo } = req.query;
        
        if (!employeeId) {
            return res.status(400).json(formatResponse(
                false, 
                'Employee ID lÃ  báº¯t buá»™c', 
                null, 
                'MISSING_EMPLOYEE_ID'
            ));
        }
        
        const attendanceService = larkServiceManager.getService('attendance');
        const filters = { employeeId };
        
        if (dateFrom) filters.dateFrom = dateFrom;
        if (dateTo) filters.dateTo = dateTo;
        
        const logs = await attendanceService.getAttendanceLogs(filters);
        const employeeHours = await attendanceService.getEmployeeHours();
        
        const employeeData = employeeHours[employeeId] || [];
        
        res.json(formatResponse(true, 'Láº¥y giá» cÃ´ng chi tiáº¿t thÃ nh cÃ´ng', {
            employeeId,
            logs,
            dailyHours: employeeData,
            summary: {
                totalDays: employeeData.length,
                totalHours: employeeData.reduce((sum, day) => {
                    // Extract numeric hours from formatted string like "8 giá» 30 phÃºt"
                    const match = day.totalHours.match(/(\d+)\s*giá»(?:\s*(\d+)\s*phÃºt)?/);
                    if (match) {
                        const hours = parseInt(match[1]) || 0;
                        const minutes = parseInt(match[2]) || 0;
                        return sum + hours + (minutes / 60);
                    }
                    return sum;
                }, 0)
            }
        }));
        
    } catch (error) {
        console.error('âŒ Controller: getEmployeeDetailedHours failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y giá» cÃ´ng chi tiáº¿t: ${error.message}`, 
            null, 
            'EMPLOYEE_DETAILED_HOURS_FAILED'
        ));
    }
};

```


==================== File: .\server\controllers\authController.js ====================

// server/controllers/authController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

/**
 * Xá»­ lÃ½ Ä‘Äƒng nháº­p ngÆ°á»i dÃ¹ng.
 * Controller gá»i Ä‘áº¿n AuthService Ä‘á»ƒ xÃ¡c thá»±c.
 * @route POST /api/auth/login
 */
const login = async (req, res) => {
    try {
        const { username, password } = req.body;
        const authService = larkServiceManager.getService('auth');

        // Gá»i service Ä‘á»ƒ xá»­ lÃ½ logic Ä‘Äƒng nháº­p
        const result = await authService.login({ username, password });

        // Náº¿u service tráº£ vá» thÃ nh cÃ´ng, táº¡o session
        if (result.success) {
            req.session.user = {
                id: result.user.id,
                username: result.user.username,
                role: result.user.role,
                fullName: result.user.fullName
            };
            
            // Tráº£ vá» response thÃ nh cÃ´ng vá»›i thÃ´ng tin user
            res.json(formatResponse(true, result.message, { user: req.session.user }));
        } else {
            // TrÆ°á»ng há»£p service xá»­ lÃ½ nhÆ°ng khÃ´ng thÃ nh cÃ´ng (Ã­t xáº£y ra vá»›i logic hiá»‡n táº¡i)
             res.status(401).json(formatResponse(false, result.message, null, 'LOGIN_FAILED'));
        }

    } catch (error) {
        // Báº¯t lá»—i do service throw (vÃ­ dá»¥: sai credentials)
        console.error('âŒ Controller: login failed:', error.message);
        res.status(401).json(formatResponse(false, 'TÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng.', null, 'INVALID_CREDENTIALS'));
    }
};

/**
 * Xá»­ lÃ½ Ä‘Äƒng xuáº¥t ngÆ°á»i dÃ¹ng.
 * @route POST /api/auth/logout
 */
const logout = (req, res) => {
    req.session.destroy((err) => {
        if (err) {
            console.error('âŒ Controller: logout failed:', err);
            return res.status(500).json(formatResponse(false, 'KhÃ´ng thá»ƒ Ä‘Äƒng xuáº¥t', null, 'LOGOUT_ERROR'));
        }
        res.clearCookie('connect.sid'); // XÃ³a cookie session phÃ­a client
        res.json(formatResponse(true, 'ÄÄƒng xuáº¥t thÃ nh cÃ´ng'));
    });
};

/**
 * Láº¥y thÃ´ng tin profile cá»§a user Ä‘ang Ä‘Äƒng nháº­p.
 * @route GET /api/auth/profile
 */
const getProfile = (req, res) => {
    // req.user Ä‘Æ°á»£c gÃ¡n tá»« middleware `authenticateUser`
    if (req.user) {
        res.json(formatResponse(true, 'Láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng thÃ nh cÃ´ng', { user: req.user }));
    } else {
        res.status(401).json(formatResponse(false, 'NgÆ°á»i dÃ¹ng chÆ°a Ä‘Æ°á»£c xÃ¡c thá»±c', null, 'UNAUTHENTICATED'));
    }
};

export {
    login,
    logout,
    getProfile
};

```


==================== File: .\server\controllers\dashboardController.js ====================

// server/controllers/dashboardController.js (Má»šI)
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

export const getDashboardStats = async (req, res) => {
    try {
        console.log('ğŸ“Š GETTING DASHBOARD STATS...');
        
        const employeeService = larkServiceManager.getService('employee');
        const attendanceService = larkServiceManager.getService('attendance');
        
        // âœ… TÃ¡ch riÃªng, handle error Ä‘á»™c láº­p
        let employeeStats = {
            totalEmployees: 0,
            activeEmployees: 0,
            error: null
        };
        
        let attendanceStats = {
            totalAttendanceLogs: 0,
            todayLogs: 0,
            error: null
        };
        
        // Get employee stats
        try {
            const employees = await employeeService.getAllEmployees();
            employeeStats = {
                totalEmployees: employees.length,
                activeEmployees: employees.filter(emp => emp.status === 'active').length,
                error: null
            };
        } catch (error) {
            console.error('âŒ Employee stats error:', error);
            employeeStats.error = 'KhÃ´ng thá»ƒ táº£i thá»‘ng kÃª nhÃ¢n viÃªn';
        }
        
        // Get attendance stats
        try {
            const logs = await attendanceService.getAttendanceLogs();
            const today = new Date().toISOString().split('T')[0];
            attendanceStats = {
                totalAttendanceLogs: logs.length,
                todayLogs: logs.filter(log => log.date === today).length,
                error: null
            };
        } catch (error) {
            console.error('âŒ Attendance stats error:', error);
            attendanceStats.error = 'KhÃ´ng thá»ƒ táº£i thá»‘ng kÃª cháº¥m cÃ´ng';
        }
        
        const dashboardData = {
            employee: employeeStats,
            attendance: attendanceStats,
            timestamp: new Date().toISOString()
        };
        
        res.json(formatResponse(true, 'Láº¥y thá»‘ng kÃª dashboard thÃ nh cÃ´ng', dashboardData));
        
    } catch (error) {
        console.error('âŒ Dashboard stats error:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i há»‡ thá»‘ng: ${error.message}`, 
            null, 
            'DASHBOARD_STATS_ERROR'
        ));
    }
};

```


==================== File: .\server\controllers\employeeController.js ====================

// server/controllers/employeeController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';
import CacheService from '../services/core/cache-service.js';
class EmployeeController {


    /* ======================= REGION: Quáº£n lÃ½ danh sÃ¡ch nhÃ¢n viÃªn ======================= */
    /**
     * GET: Láº¥y danh sÃ¡ch táº¥t cáº£ nhÃ¢n viÃªn trong há»‡ thá»‘ng.
     * - Tráº£ vá» array chá»©a thÃ´ng tin cÆ¡ báº£n cá»§a táº¥t cáº£ nhÃ¢n viÃªn.
     * - KhÃ´ng cÃ³ filter, pagination (láº¥y táº¥t cáº£).
     * @route GET /api/employees
     */
    async getAllEmployees(req, res) {
        try {
            console.log('CONTROLLER: YÃªu cáº§u láº¥y danh sÃ¡ch nhÃ¢n viÃªn...');
            const employeeService = larkServiceManager.getService('employee');
            const employees = await employeeService.getAllEmployees();

            res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch nhÃ¢n viÃªn thÃ nh cÃ´ng', employees));
        } catch (error) {
            console.error('âŒ CONTROLLER: Lá»—i khi láº¥y danh sÃ¡ch nhÃ¢n viÃªn:', error);
            res.status(500).json(formatResponse(
                false, 
                `KhÃ´ng thá»ƒ táº£i danh sÃ¡ch nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_LOAD_FAILED'
            ));
        }
    }

    /* ======================= REGION: ThÃªm nhÃ¢n viÃªn má»›i ======================= */
    /**
     * POST: ThÃªm nhÃ¢n viÃªn má»›i kÃ¨m theo work history.
     * - Tá»± Ä‘á»™ng generate employeeId tá»« tÃªn + SÄT.
     * - Validate duplicate employeeId trÆ°á»›c khi táº¡o.
     * - Validate work history data (ngÃ y thÃ¡ng, overlap, Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng).
     * - Rollback toÃ n bá»™ náº¿u cÃ³ lá»—i trong quÃ¡ trÃ¬nh táº¡o.
     * - Transaction-like behavior: táº¡o employee trÆ°á»›c, sau Ä‘Ã³ táº¡o work histories.
     * @route POST /api/employees
     */

    async addEmployee(req, res) {
        let createdEmployee = null;
        let createdWorkHistories = [];
        
        try {
            const { fullName, phoneNumber, gender, bankAccount, bankName, workHistoryData } = req.body;
            const employeeId = larkServiceManager.getService('employee').generateEmployeeId(fullName, phoneNumber);
            
            // âœ… STEP 1: Kiá»ƒm tra duplicate trÆ°á»›c khi táº¡o báº¥t ká»³ record nÃ o
            const isDuplicate = await larkServiceManager.getService('employee').checkEmployeeIdExists(employeeId);
            if (isDuplicate) {
                return res.status(409).json(formatResponse(
                    false, 
                    'MÃ£ nhÃ¢n viÃªn Ä‘Ã£ tá»“n táº¡i trong há»‡ thá»‘ng', 
                    null, 
                    'DUPLICATE_EMPLOYEE_ID'
                ));
            }

            // âœ… STEP 2: Validate work history TRÆ¯á»šC KHI táº¡o employee
            const recruitmentService = larkServiceManager.getService('recruitment');
            const workHistoryService = larkServiceManager.getService('workHistory');
            
            for (const historyEntry of workHistoryData) {
                // Validate work history trÆ°á»›c
                const recruitmentDetails = await recruitmentService.getRequestByNo(historyEntry.requestNo);
                if (!recruitmentDetails) {
                    throw new Error(`KhÃ´ng tÃ¬m tháº¥y Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng vá»›i mÃ£: ${historyEntry.requestNo}`);
                }
                
                // Validate ngÃ y thÃ¡ng
                workHistoryService.validateWorkHistoryFields({
                    fromDate: historyEntry.fromDate,
                    toDate: historyEntry.toDate,
                    hourlyRate: historyEntry.hourlyRate
                }, recruitmentDetails);
                
                // Validate date overlap
                await workHistoryService.validateWorkHistoryDateOverlap(
                    employeeId, 
                    historyEntry.requestNo, 
                    recruitmentService
                );
            }

            // âœ… STEP 3: Náº¿u validation pass, má»›i táº¡o employee
            const employeeData = {
                employeeId,
                fullName,
                phoneNumber,
                gender,
                bankAccount,
                bankName,
                recruitmentLink: workHistoryData.map(item => item.requestNo).join(', '),
                status: 'active',
                createdAt: new Date().toISOString()
            };

            console.log('âœ… All validations passed, creating employee...');
            createdEmployee = await larkServiceManager.addEmployee(employeeData);
            
            // âœ… STEP 4: Táº¡o work history
            console.log('âœ… Employee created, creating work histories...');
            const workHistoryResults = [];
            
            for (const historyEntry of workHistoryData) {
                try {
                    const workHistory = await larkServiceManager.addWorkHistory({
                        employeeId,
                        requestNo: historyEntry.requestNo,
                        fromDate: historyEntry.fromDate,
                        toDate: historyEntry.toDate,
                        hourlyRate: historyEntry.hourlyRate
                    });
                    workHistoryResults.push(workHistory);
                    createdWorkHistories.push(workHistory); // Track for rollback
                } catch (workHistoryError) {
                    console.error('âŒ Work history creation failed:', workHistoryError);
                    
                    // âœ… ROLLBACK: XÃ³a employee vÃ  work histories Ä‘Ã£ táº¡o
                    await this.rollbackEmployeeCreation(createdEmployee.employee, createdWorkHistories);
                    
                    throw new Error(`Lá»—i khi táº¡o work history: ${workHistoryError.message}`);
                }
            }

            console.log('âœ… All work histories created successfully');

            res.json(formatResponse(true, 'ThÃªm nhÃ¢n viÃªn thÃ nh cÃ´ng', {
                employee: createdEmployee,
                workHistory: workHistoryResults
            }));
            
        } catch (error) {
            console.error('âŒ Employee creation failed:', error);
            
            // âœ… ROLLBACK náº¿u cÃ³ lá»—i
            if (createdEmployee) {
                await this.rollbackEmployeeCreation(createdEmployee.employee, createdWorkHistories);
            }
            
            // Tráº£ vá» lá»—i cá»¥ thá»ƒ cho frontend
            res.status(500).json(formatResponse(
                false, 
                error.message || 'Lá»—i há»‡ thá»‘ng khi thÃªm nhÃ¢n viÃªn', 
                null, 
                'EMPLOYEE_ADD_FAILED'
            ));
        }
    }



    /**
     * UTILITY: Rollback khi táº¡o nhÃ¢n viÃªn tháº¥t báº¡i.
     * - XÃ³a cÃ¡c work history records Ä‘Ã£ táº¡o thÃ nh cÃ´ng.
     * - XÃ³a employee record náº¿u Ä‘Ã£ táº¡o.
     * - Äáº£m báº£o data consistency khi cÃ³ lá»—i xáº£y ra.
     */
    async rollbackEmployeeCreation(employee, createdWorkHistories) {
        console.log('ğŸ”„ ROLLBACK: Starting cleanup...');
        
        try {
            // XÃ³a work histories Ä‘Ã£ táº¡o
            for (const workHistory of createdWorkHistories) {
                if (workHistory && workHistory.larkResponse && workHistory.larkResponse.data) {
                    try {
                        await larkServiceManager.getService('workHistory').deleteWorkHistory(
                            workHistory.larkResponse.data.record.record_id
                        );
                        console.log('âœ… ROLLBACK: Deleted work history', workHistory.larkResponse.data.record.record_id);
                    } catch (whDeleteError) {
                        console.error('âŒ ROLLBACK: Failed to delete work history', whDeleteError);
                    }
                }
            }
            
            // XÃ³a employee
            if (employee && employee.larkResponse && employee.larkResponse.data) {
                try {
                    await larkServiceManager.getService('employee').deleteEmployee(
                        employee.larkResponse.data.record_id
                    );
                    console.log('âœ… ROLLBACK: Deleted employee', employee.larkResponse.data.record_id);
                } catch (empDeleteError) {
                    console.error('âŒ ROLLBACK: Failed to delete employee', empDeleteError);
                }
            }
            
            console.log('âœ… ROLLBACK: Cleanup completed');
        } catch (rollbackError) {
            console.error('âŒ ROLLBACK: Critical error during cleanup:', rollbackError);
        }
    }




    /* ======================= REGION: Cáº­p nháº­t thÃ´ng tin nhÃ¢n viÃªn ======================= */
    /**
     * PUT: Cáº­p nháº­t thÃ´ng tin nhÃ¢n viÃªn.
     * - Tá»± Ä‘á»™ng táº¡o láº¡i employeeId náº¿u tÃªn/SÄT thay Ä‘á»•i.
     * - Náº¿u employeeId thay Ä‘á»•i, tá»± Ä‘á»™ng cáº­p nháº­t táº¥t cáº£ work history liÃªn quan.
     * - Validate employee tá»“n táº¡i trÆ°á»›c khi update.
     * @route PUT /api/employees/:id
     */

    async updateEmployee(req, res) {
        try {
            const { id } = req.params;
            const { fullName, phoneNumber, gender, bankAccount, bankName, recruitmentLink, status } = req.body;
            
            // âœ… STEP 1: Láº¥y thÃ´ng tin employee cÅ© trÆ°á»›c khi update
            console.log('ğŸ“‹ Getting old employee data for comparison...');
            const oldEmployee = await larkServiceManager.getService('employee').getEmployeeById(id);
            if (!oldEmployee) {
                return res.status(404).json(formatResponse(
                    false, 
                    'KhÃ´ng tÃ¬m tháº¥y nhÃ¢n viÃªn cáº§n cáº­p nháº­t', 
                    null, 
                    'EMPLOYEE_NOT_FOUND'
                ));
            }
            
            const oldEmployeeId = oldEmployee.employeeId;
            
            // âœ… STEP 2: Táº¡o mÃ£ nhÃ¢n viÃªn má»›i
            const newEmployeeId = larkServiceManager.getService('employee').generateEmployeeId(fullName, phoneNumber);
            
            console.log('ğŸ” Comparing employee IDs:', {
                old: oldEmployeeId,
                new: newEmployeeId,
                changed: oldEmployeeId !== newEmployeeId
            });
            
            // âœ… STEP 3: Update employee data
            const updatedData = {
                employeeId: newEmployeeId,
                fullName,
                phoneNumber,
                gender,
                bankAccount,
                bankName,
                recruitmentLink: recruitmentLink || '',
                status,
                updatedAt: new Date().toISOString()
            };
            
            const employee = await larkServiceManager.updateEmployee(id, updatedData);
            
            // âœ… STEP 4: Náº¿u mÃ£ nhÃ¢n viÃªn thay Ä‘á»•i, cáº­p nháº­t work history
            if (oldEmployeeId !== newEmployeeId) {
                console.log('ğŸ”„ Employee ID changed, updating work history records...');
                await this.updateWorkHistoryEmployeeId(oldEmployeeId, newEmployeeId);
            }
            
            console.log('âœ… Employee updated successfully, clearing cache...');
            
            res.json(formatResponse(true, 'Cáº­p nháº­t nhÃ¢n viÃªn thÃ nh cÃ´ng', { employee }));
            
        } catch (error) {
            console.error('âŒ Controller: updateEmployee failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi cáº­p nháº­t nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_UPDATE_FAILED'
            ));
        }
    }



    /**
     * UTILITY: Cáº­p nháº­t employeeId trong cÃ¡c work history records.
     * - ÄÆ°á»£c gá»i khi employeeId thay Ä‘á»•i sau khi update employee.
     * - TÃ¬m táº¥t cáº£ work history cá»§a employee cÅ© vÃ  cáº­p nháº­t sang ID má»›i.
     * - Log káº¿t quáº£ nhÆ°ng khÃ´ng fail náº¿u má»™t sá»‘ records update lá»—i.
     */

    async updateWorkHistoryEmployeeId(oldEmployeeId, newEmployeeId) {
        try {
            console.log(`ğŸ”„ Updating work history: ${oldEmployeeId} -> ${newEmployeeId}`);
            
            const workHistoryService = larkServiceManager.getService('workHistory');
            
            // Láº¥y táº¥t cáº£ work history cá»§a employee cÅ©
            const workHistories = await workHistoryService.getWorkHistoryByEmployee(oldEmployeeId);
            
            if (workHistories.length === 0) {
                console.log('â„¹ï¸ No work history records to update');
                return;
            }
            
            console.log(`ğŸ“‹ Found ${workHistories.length} work history records to update`);
            
            // Cáº­p nháº­t tá»«ng record
            const updatePromises = workHistories.map(async (workHistory) => {
                try {
                    await workHistoryService.updateWorkHistory(workHistory.id, {
                        employeeId: newEmployeeId,
                        requestNo: workHistory.requestNo,
                        fromDate: workHistory.fromDate,
                        toDate: workHistory.toDate,
                        hourlyRate: workHistory.hourlyRate
                    });
                    
                    console.log(`âœ… Updated work history record: ${workHistory.id}`);
                    return { success: true, id: workHistory.id };
                } catch (updateError) {
                    console.error(`âŒ Failed to update work history ${workHistory.id}:`, updateError);
                    return { success: false, id: workHistory.id, error: updateError.message };
                }
            });
            
            const results = await Promise.all(updatePromises);
            
            const successCount = results.filter(r => r.success).length;
            const failedCount = results.length - successCount;
            
            console.log(`ğŸ“Š Work history update results: ${successCount} success, ${failedCount} failed`);
            
            if (failedCount > 0) {
                const failedIds = results.filter(r => !r.success).map(r => r.id);
                console.warn('âš ï¸ Some work history records failed to update:', failedIds);
                // CÃ³ thá»ƒ log warning nhÆ°ng khÃ´ng throw error Ä‘á»ƒ khÃ´ng lÃ m fail employee update
            }
            
        } catch (error) {
            console.error('âŒ Critical error updating work history employee IDs:', error);
            // Log error nhÆ°ng khÃ´ng throw Ä‘á»ƒ khÃ´ng lÃ m fail employee update
        }
    }


    /* ======================= REGION: XÃ³a nhÃ¢n viÃªn ======================= */
    /**
     * DELETE: XÃ³a nhÃ¢n viÃªn vÃ  táº¥t cáº£ work history liÃªn quan.
     * - Validate employee tá»“n táº¡i trÆ°á»›c khi xÃ³a.
     * - XÃ³a táº¥t cáº£ work history records trÆ°á»›c.
     * - Chá»‰ xÃ³a employee sau khi Ä‘Ã£ xÃ³a háº¿t work history thÃ nh cÃ´ng.
     * - Fail náº¿u khÃ´ng thá»ƒ xÃ³a háº¿t work history (Ä‘á»ƒ Ä‘áº£m báº£o data consistency).
     * @route DELETE /api/employees/:id
     */

    async deleteEmployee(req, res) {
        try {
            const { id } = req.params;
            
            // STEP 1: Láº¥y thÃ´ng tin employee trÆ°á»›c khi xÃ³a
            console.log(`ğŸ” Getting employee info before deletion: ${id}`);
            const employee = await larkServiceManager.getService('employee').getEmployeeById(id);
            
            if (!employee) {
                return res.status(404).json(formatResponse(
                    false, 
                    'KhÃ´ng tÃ¬m tháº¥y nhÃ¢n viÃªn cáº§n xÃ³a', 
                    null, 
                    'EMPLOYEE_NOT_FOUND'
                ));
            }
            
            const employeeId = employee.employeeId;
            console.log(`ğŸ‘¤ Employee to delete: ${employee.fullName} (${employeeId})`);
            
            // STEP 2: Láº¥y danh sÃ¡ch work history cáº§n xÃ³a
            const workHistoryService = larkServiceManager.getService('workHistory');
            const workHistories = await workHistoryService.getWorkHistoryByEmployee(employeeId);
            
            console.log(`ğŸ“‹ Found ${workHistories.length} work history records to delete`);
            
            // STEP 3: XÃ³a táº¥t cáº£ work history trÆ°á»›c
            const deleteWorkHistoryPromises = workHistories.map(async (wh) => {
                try {
                    await workHistoryService.deleteWorkHistory(wh.id);
                    console.log(`âœ… Deleted work history: ${wh.id} (${wh.requestNo})`);
                    return { success: true, id: wh.id };
                } catch (error) {
                    console.error(`âŒ Failed to delete work history ${wh.id}:`, error);
                    return { success: false, id: wh.id, error: error.message };
                }
            });
            
            const workHistoryResults = await Promise.all(deleteWorkHistoryPromises);
            const failedDeletions = workHistoryResults.filter(r => !r.success);
            
            if (failedDeletions.length > 0) {
                console.error(`âŒ Failed to delete ${failedDeletions.length} work history records`);
                return res.status(500).json(formatResponse(
                    false,
                    `KhÃ´ng thá»ƒ xÃ³a hoÃ n toÃ n dá»¯ liá»‡u. ${failedDeletions.length} work history records failed to delete.`,
                    { failedDeletions },
                    'WORK_HISTORY_DELETE_FAILED'
                ));
            }
            
            // STEP 4: XÃ³a employee sau khi Ä‘Ã£ xÃ³a háº¿t work history
            console.log(`ğŸ—‘ï¸ All work histories deleted successfully. Now deleting employee...`);
            await larkServiceManager.deleteEmployee(id);
            
            console.log(`âœ… Successfully deleted employee ${employee.fullName} and ${workHistories.length} work history records`);
            
            res.json(formatResponse(
                true, 
                `XÃ³a nhÃ¢n viÃªn "${employee.fullName}" vÃ  ${workHistories.length} báº£n ghi lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng`,
                {
                    deletedEmployee: employee.fullName,
                    deletedWorkHistories: workHistories.length
                }
            ));
            
        } catch (error) {
            console.error('âŒ Controller: deleteEmployee failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi xÃ³a nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_DELETE_FAILED'
            ));
        }
    }



    /**
     * Search employees
     * @route GET /api/employees/search
     */
    async searchEmployees(req, res) {
        try {
            const { q } = req.query;
            const employees = await larkServiceManager.searchEmployees(q);
            res.json(formatResponse(true, 'TÃ¬m kiáº¿m thÃ nh cÃ´ng', employees));
        } catch (error) {
            console.error('âŒ Controller: searchEmployees failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi tÃ¬m kiáº¿m nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_SEARCH_FAILED'
            ));
        }
    }

    /**
     * Get employee work history
     * @route GET /api/employees/:employeeId/work-history
     */
    async getEmployeeWorkHistory(req, res) {
        try {
            const { employeeId } = req.params;
            const workHistory = await larkServiceManager.getWorkHistoryByEmployee(employeeId);
            res.json(formatResponse(true, 'Láº¥y lá»‹ch sá»­ lÃ m viá»‡c thÃ nh cÃ´ng', workHistory));
        } catch (error) {
            console.error('âŒ Controller: getEmployeeWorkHistory failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi láº¥y lá»‹ch sá»­ lÃ m viá»‡c: ${error.message}`, 
                null, 
                'WORK_HISTORY_LOAD_FAILED'
            ));
        }
    }

    /**
     * Add work history for employee
     * @route POST /api/employees/work-history
     */
    async addWorkHistory(req, res) {
        try {
            
            // âœ… Cáº¬P NHáº¬T: Nháº­n thÃªm cÃ¡c trÆ°á»ng má»›i tá»« request body
            const { employeeId, requestNo, fromDate, toDate, hourlyRate } = req.body;

            CacheService.clear();

            if (!employeeId || !requestNo) {
                return res.status(400).json(formatResponse(
                    false, 
                    'Thiáº¿u thÃ´ng tin báº¯t buá»™c: employeeId vÃ  requestNo', 
                    null, 
                    'VALIDATION_ERROR'
                ));
            }
            
            // âœ… Cáº¬P NHáº¬T: Truyá»n táº¥t cáº£ cÃ¡c trÆ°á»ng vÃ o addWorkHistory
            const workHistory = await larkServiceManager.addWorkHistory({
                employeeId,
                requestNo,
                fromDate,      // âœ… THÃŠM
                toDate,        // âœ… THÃŠM
                hourlyRate     // âœ… THÃŠM
            });
            
            res.json(formatResponse(true, 'ThÃªm work history thÃ nh cÃ´ng', { workHistory }));
            
        } catch (error) {
            console.error('âŒ Controller: addWorkHistory failed:', error);

            // âœ… Cáº¬P NHáº¬T: Xá»­ lÃ½ cÃ¡c loáº¡i lá»—i cá»¥ thá»ƒ tá»« validation má»›i
            if (error.message.includes('bá»‹ trÃ¹ng vá»›i lá»‹ch sá»­ lÃ m viá»‡c cÅ©')) {
                return res.status(409).json(formatResponse(
                    false,
                    error.message,
                    null,
                    'DATE_OVERLAP_CONFLICT'
                ));
            }

            if (error.message.includes('pháº£i náº±m trong khoáº£ng ngÃ y cá»§a Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng')) {
                return res.status(400).json(formatResponse(
                    false,
                    error.message,
                    null,
                    'INVALID_DATE_RANGE'
                ));
            }

            if (error.message.includes('Tá»« ngÃ y vÃ  Äáº¿n ngÃ y lÃ  báº¯t buá»™c') || 
                error.message.includes('Äáº¿n ngÃ y pháº£i lá»›n hÆ¡n hoáº·c báº±ng Tá»« ngÃ y')) {
                return res.status(400).json(formatResponse(
                    false,
                    error.message,
                    null,
                    'VALIDATION_ERROR'
                ));
            }

            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi thÃªm work history: ${error.message}`, 
                null, 
                'WORK_HISTORY_ADD_FAILED'
            ));
        }
    }

    // âœ… THÃŠM Má»šI: Update work history
    /**
     * Update work history entry
     * @route PUT /api/employees/work-history/:id
     */
    async updateWorkHistory(req, res) {
        try {
            const { id } = req.params;
            const { employeeId, requestNo, fromDate, toDate, hourlyRate } = req.body;
            
            if (!employeeId || !requestNo) {
                return res.status(400).json(formatResponse(
                    false, 
                    'Thiáº¿u thÃ´ng tin báº¯t buá»™c: employeeId vÃ  requestNo', 
                    null, 
                    'VALIDATION_ERROR'
                ));
            }
            
            console.log(`ğŸ“ CONTROLLER: Updating work history ID: ${id}...`);
            
            const workHistoryService = larkServiceManager.getService('workHistory');
            const updatedWorkHistory = await workHistoryService.updateWorkHistory(id, {
                employeeId,
                requestNo,
                fromDate,
                toDate,
                hourlyRate
            });
            
            console.log('âœ… CONTROLLER: Work history updated successfully');
            
            res.json(formatResponse(true, 'Cáº­p nháº­t lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng', { workHistory: updatedWorkHistory }));
            
        } catch (error) {
            console.error('âŒ Controller: updateWorkHistory failed:', error);

            // Xá»­ lÃ½ cÃ¡c loáº¡i lá»—i cá»¥ thá»ƒ
            if (error.message.includes('bá»‹ trÃ¹ng vá»›i lá»‹ch sá»­ lÃ m viá»‡c cÅ©')) {
                return res.status(409).json(formatResponse(
                    false,
                    error.message,
                    null,
                    'DATE_OVERLAP_CONFLICT'
                ));
            }

            if (error.message.includes('pháº£i náº±m trong khoáº£ng ngÃ y cá»§a Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng')) {
                return res.status(400).json(formatResponse(
                    false,
                    error.message,
                    null,
                    'INVALID_DATE_RANGE'
                ));
            }

            if (error.message.includes('Tá»« ngÃ y vÃ  Äáº¿n ngÃ y lÃ  báº¯t buá»™c') || 
                error.message.includes('Äáº¿n ngÃ y pháº£i lá»›n hÆ¡n hoáº·c báº±ng Tá»« ngÃ y')) {
                return res.status(400).json(formatResponse(
                    false,
                    error.message,
                    null,
                    'VALIDATION_ERROR'
                ));
            }

            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi cáº­p nháº­t work history: ${error.message}`, 
                null, 
                'WORK_HISTORY_UPDATE_FAILED'
            ));
        }
    }

    // âœ… THÃŠM Má»šI: Delete work history
    /**
     * Delete work history entry
     * @route DELETE /api/employees/work-history/:id
     */
    async deleteWorkHistory(req, res) {
        try {
            const { id } = req.params;
            
            console.log(`ğŸ—‘ï¸ CONTROLLER: Deleting work history ID: ${id}...`);
            
            const workHistoryService = larkServiceManager.getService('workHistory');
            await workHistoryService.deleteWorkHistory(id);
            
            console.log('âœ… CONTROLLER: Work history deleted successfully');
            
            res.json(formatResponse(true, 'XÃ³a lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng'));
            
        } catch (error) {
            console.error('âŒ Controller: deleteWorkHistory failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi xÃ³a work history: ${error.message}`, 
                null, 
                'WORK_HISTORY_DELETE_FAILED'
            ));
        }
    }
}

// Export instance methods
const employeeController = new EmployeeController();

export const getAllEmployees = employeeController.getAllEmployees.bind(employeeController);
export const addEmployee = employeeController.addEmployee.bind(employeeController);
export const updateEmployee = employeeController.updateEmployee.bind(employeeController);
export const deleteEmployee = employeeController.deleteEmployee.bind(employeeController);
export const searchEmployees = employeeController.searchEmployees.bind(employeeController);
export const getEmployeeWorkHistory = employeeController.getEmployeeWorkHistory.bind(employeeController);
export const addWorkHistory = employeeController.addWorkHistory.bind(employeeController);
// âœ… THÃŠM Má»šI: Export 2 methods má»›i
export const updateWorkHistory = employeeController.updateWorkHistory.bind(employeeController);
export const deleteWorkHistory = employeeController.deleteWorkHistory.bind(employeeController);

```


==================== File: .\server\controllers\positionController.js ====================

// server/controllers/positionController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

// ==================== POSITION MANAGEMENT ====================
export const getPositions = async (req, res) => {
    try {
        const positions = await larkServiceManager.getAllPositions();
        res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch vá»‹ trÃ­ thÃ nh cÃ´ng', positions));
    } catch (error) {
        console.error('âŒ Controller: getPositions failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi táº£i danh sÃ¡ch vá»‹ trÃ­: ${error.message}`, null, 'POSITION_LOAD_FAILED'));
    }
};

export const addPosition = async (req, res) => {
    try {
        const { positionName, description } = req.body;
        // (Validation sáº½ Ä‘Æ°á»£c thÃªm vÃ o á»Ÿ bÆ°á»›c sau)
        const position = {
            positionName,
            description: description || '',
            status: 'active',
            createdAt: new Date().toISOString()
        };
        const result = await larkServiceManager.addPosition(position);
        res.json(formatResponse(true, 'ThÃªm vá»‹ trÃ­ thÃ nh cÃ´ng', { position: result }));
    } catch (error) {
        console.error('âŒ Controller: addPosition failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi thÃªm vá»‹ trÃ­: ${error.message}`, null, 'POSITION_ADD_FAILED'));
    }
};

export const updatePosition = async (req, res) => {
    try {
        const { id } = req.params;
        const updatedData = { ...req.body, updatedAt: new Date().toISOString() };
        const result = await larkServiceManager.updatePosition(id, updatedData);
        res.json(formatResponse(true, 'Cáº­p nháº­t vá»‹ trÃ­ thÃ nh cÃ´ng', { position: result }));
    } catch (error) {
        console.error('âŒ Controller: updatePosition failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi cáº­p nháº­t vá»‹ trÃ­: ${error.message}`, null, 'POSITION_UPDATE_FAILED'));
    }
};

export const deletePosition = async (req, res) => {
    try {
        const { id } = req.params;
        await larkServiceManager.deletePosition(id);
        res.json(formatResponse(true, 'XÃ³a vá»‹ trÃ­ thÃ nh cÃ´ng'));
    } catch (error) {
        console.error('âŒ Controller: deletePosition failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi xÃ³a vá»‹ trÃ­: ${error.message}`, null, 'POSITION_DELETE_FAILED'));
    }
};

```


==================== File: .\server\controllers\recruitmentController.js ====================

import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';
import CacheService from '../services/core/cache-service.js';


export const getRecruitmentRequests = async (req, res) => {
    try {
        const filters = req.query;
        const recruitmentService = larkServiceManager.getService('recruitment');
        const requests = await recruitmentService.getRecruitmentRequests(filters);

        res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch Ä‘á» xuáº¥t thÃ nh cÃ´ng', requests));
    } catch (error) {
        console.error('âŒ Controller: getRecruitmentRequests failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y danh sÃ¡ch Ä‘á» xuáº¥t: ${error.message}`, 
            null, 
            'RECRUITMENT_LOAD_FAILED'
        ));
    }
};

export const getRecruitmentHoursSummary = async (req, res) => {
    try {
        console.log('ğŸ“Š Controller: Getting recruitment hours summary...');
        
        // âœ… Sá»¬A: LuÃ´n clear cache Ä‘á»ƒ Ä‘áº£m báº£o realtime data
        console.log('ğŸ§¹ Clearing cache for realtime data...');
        CacheService.delete('hours_summary_table_data');
        CacheService.delete('work_history_all');
        CacheService.delete('recruitment_requests_{}'); // Clear recruitment cache náº¿u cÃ³
        
        const recruitmentService = larkServiceManager.getService('recruitment');
        const hoursSummary = await recruitmentService.getRecruitmentHoursSummary();

        // âœ… THÃŠM: Log Ä‘á»ƒ debug
        console.log(`âœ… Controller: Retrieved ${hoursSummary.length} recruitment hour summaries`);

        res.json(formatResponse(true, 'Láº¥y tá»•ng há»£p giá» cÃ´ng theo tuyá»ƒn dá»¥ng thÃ nh cÃ´ng', {
            summary: hoursSummary,
            totalRequests: hoursSummary.length,
            totalEmployees: hoursSummary.reduce((sum, req) => sum + req.totalEmployees, 0),
            totalHours: hoursSummary.reduce((sum, req) => sum + req.totalHoursNumeric, 0),
            timestamp: new Date().toISOString() // âœ… THÃŠM: Timestamp Ä‘á»ƒ track khi nÃ o data Ä‘Æ°á»£c load
        }));
    } catch (error) {
        console.error('âŒ Controller: getRecruitmentHoursSummary failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y tá»•ng há»£p giá» cÃ´ng: ${error.message}`, 
            null, 
            'RECRUITMENT_HOURS_LOAD_FAILED'
        ));
    }
};



export const getDetailedHoursForRequest = async (req, res) => {
    try {
        const { requestNo } = req.params;
        
        console.log(`ğŸ“Š Getting detailed hours for request: ${requestNo}`);
        
        const recruitmentService = larkServiceManager.getService('recruitment');
        
        // âœ… THÃŠM: Láº¥y cáº£ thÃ´ng tin lÆ°Æ¡ng
        const detailedRecords = await recruitmentService.getDetailedHoursForRequest(requestNo);
        
        // âœ… THÃŠM: Láº¥y thÃ´ng tin lÆ°Æ¡ng tá»« salary map
        const mapsResult = await recruitmentService.getEmployeeHoursFromSummaryTable();
        const employeeSalaryMap = mapsResult.salaryMap;
        const employeeHourlyRateMap = mapsResult.hourlyRateMap;
        
        // âœ… THÃŠM: Enriched data vá»›i thÃ´ng tin lÆ°Æ¡ng
        const enrichedRecords = detailedRecords.map(record => ({
            ...record,
            hourlyRate: employeeHourlyRateMap.get(record.employeeId) || 0,
            totalSalary: (record.totalHours || 0) * (employeeHourlyRateMap.get(record.employeeId) || 0)
        }));
        
        res.json(formatResponse(true, 'Láº¥y chi tiáº¿t giá» cÃ´ng thÃ nh cÃ´ng', {
            requestNo,
            records: enrichedRecords, // âœ… Sá»¬A: Tráº£ vá» enriched data
            totalRecords: enrichedRecords.length
        }));
        
    } catch (error) {
        console.error('âŒ Controller: getDetailedHoursForRequest failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y chi tiáº¿t giá» cÃ´ng: ${error.message}`, 
            null, 
            'DETAILED_HOURS_LOAD_FAILED'
        ));
    }
};


```


==================== File: .\server\controllers\storeController.js ====================

// server/controllers/storeController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

// ==================== STORE MANAGEMENT ====================
export const getStores = async (req, res) => {
    try {
        const stores = await larkServiceManager.getAllStores();
        res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch cá»­a hÃ ng thÃ nh cÃ´ng', stores));
    } catch (error) {
        console.error('âŒ Controller: getStores failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi táº£i danh sÃ¡ch cá»­a hÃ ng: ${error.message}`, null, 'STORE_LOAD_FAILED'));
    }
};

export const addStore = async (req, res) => {
    try {
        const { storeName, address } = req.body;
        // (Validation sáº½ Ä‘Æ°á»£c thÃªm vÃ o á»Ÿ bÆ°á»›c sau)
        const store = {
            storeName,
            address,
            status: 'active',
            createdAt: new Date().toISOString()
        };
        const result = await larkServiceManager.addStore(store);
        res.json(formatResponse(true, 'ThÃªm cá»­a hÃ ng thÃ nh cÃ´ng', { store: result }));
    } catch (error) {
        console.error('âŒ Controller: addStore failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi thÃªm cá»­a hÃ ng: ${error.message}`, null, 'STORE_ADD_FAILED'));
    }
};

export const updateStore = async (req, res) => {
    try {
        const { id } = req.params;
        const updatedData = { ...req.body, updatedAt: new Date().toISOString() };
        const result = await larkServiceManager.updateStore(id, updatedData);
        res.json(formatResponse(true, 'Cáº­p nháº­t cá»­a hÃ ng thÃ nh cÃ´ng', { store: result }));
    } catch (error) {
        console.error('âŒ Controller: updateStore failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi cáº­p nháº­t cá»­a hÃ ng: ${error.message}`, null, 'STORE_UPDATE_FAILED'));
    }
};

export const deleteStore = async (req, res) => {
    try {
        const { id } = req.params;
        await larkServiceManager.deleteStore(id);
        res.json(formatResponse(true, 'XÃ³a cá»­a hÃ ng thÃ nh cÃ´ng'));
    } catch (error) {
        console.error('âŒ Controller: deleteStore failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi xÃ³a cá»­a hÃ ng: ${error.message}`, null, 'STORE_DELETE_FAILED'));
    }
};

```


==================== File: .\server\middleware\auth.js ====================

const authenticateUser = (req, res, next) => {
    if (!req.session || !req.session.user) {
        return res.status(401).json({ error: 'Unauthorized' });
    }
    req.user = req.session.user;
    next();
};

const authorizeRoles = (...roles) => {
    return (req, res, next) => {
        if (!req.user || !roles.includes(req.user.role)) {
            return res.status(403).json({ error: 'Forbidden' });
        }
        next();
    };
};

export {
    authenticateUser,
    authorizeRoles
};

```


==================== File: .\server\middleware\validation.js ====================

// server/middleware/validation.js
import { formatResponse } from '../services/utils/response-formatter.js';
import { EmployeeValidator } from '../services/employees/index.js';
import { MasterDataValidator } from '../services/master-data/index.js';

class ValidationMiddleware {
    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u nhÃ¢n viÃªn má»›i
    static validateAddEmployee(req, res, next) {
    // âœ… Táº¡o employeeData giá»‘ng logic trong controller
    const { fullName, phoneNumber, gender, bankAccount, bankName, workHistoryData } = req.body;
    const hourlyRate = (workHistoryData && workHistoryData[0]?.hourlyRate) || 0;
    
    const employeeDataForValidation = {
        fullName,
        phoneNumber, 
        gender,
        hourlyRate: parseFloat(hourlyRate),
        bankAccount,
        bankName
    };

    // Validate employee data vá»›i data Ä‘Ã£ xá»­ lÃ½
    const employeeErrors = EmployeeValidator.validateEmployeeData(employeeDataForValidation);
    if (employeeErrors.length > 0) {
        return res.status(400).json(formatResponse(false, employeeErrors.join(', '), null, 'VALIDATION_ERROR'));
    }

    // Validate work history
    const workHistoryErrors = EmployeeValidator.validateWorkHistoryData(req.body.workHistoryData || []);
    if (workHistoryErrors.length > 0) {
        return res.status(400).json(formatResponse(false, workHistoryErrors.join(', '), null, 'VALIDATION_ERROR'));
    }
    
    next();
    }


    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u khi cáº­p nháº­t nhÃ¢n viÃªn (cÃ³ thá»ƒ khÃ¡c vá»›i khi thÃªm má»›i)
    static validateUpdateEmployee(req, res, next) {
        const errors = EmployeeValidator.validateEmployeeData(req.body);
        if (errors.length > 0) {
            return res.status(400).json(formatResponse(false, errors.join(', '), null, 'VALIDATION_ERROR'));
        }
        next();
    }
    
    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u cá»­a hÃ ng
    static validateStore(req, res, next) {
        const errors = MasterDataValidator.validateStoreData(req.body);
         if (errors.length > 0) {
            return res.status(400).json(formatResponse(false, errors.join(', '), null, 'VALIDATION_ERROR'));
        }
        next();
    }
    
    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u vá»‹ trÃ­
    static validatePosition(req, res, next) {
        const errors = MasterDataValidator.validatePositionData(req.body);
         if (errors.length > 0) {
            return res.status(400).json(formatResponse(false, errors.join(', '), null, 'VALIDATION_ERROR'));
        }
        next();
    }
}

export default ValidationMiddleware;

```


==================== File: .\server\routes\attendance.js ====================

// server/routes/attendance.js
import express from 'express';
import { 
    getAttendanceLogs,
    addAttendanceLog,
    getEmployeeHours,
    getAttendanceStats,
    getEmployeeDetailedHours
} from '../controllers/attendanceController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

// âœ… CÃC ENDPOINT HIá»†N Táº I
router.get('/logs', authenticateUser, getAttendanceLogs);
router.post('/logs', authenticateUser, addAttendanceLog);
router.get('/employee-hours', authenticateUser, getEmployeeHours);

// âœ… CÃC ENDPOINT Má»šI
router.get('/stats', authenticateUser, getAttendanceStats);
router.get('/employee/:employeeId/detailed', authenticateUser, getEmployeeDetailedHours);

export default router;

```


==================== File: .\server\routes\auth.js ====================

import express from 'express';
import { login, logout, getProfile } from '../controllers/authController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.post('/login', login);
router.post('/logout', logout);
router.get('/profile', authenticateUser, getProfile);

export default router;

```


==================== File: .\server\routes\dashboard.js ====================

import express from 'express';
import { getDashboardStats } from '../controllers/dashboardController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.get('/stats', authenticateUser, getDashboardStats);

export default router;

```


==================== File: .\server\routes\employees.js ====================

// server/routes/employees.js
import express from 'express';
import { 
    getAllEmployees, 
    addEmployee, 
    updateEmployee, 
    deleteEmployee, 
    searchEmployees, 
    getEmployeeWorkHistory, 
    addWorkHistory,
    updateWorkHistory,
    deleteWorkHistory
} from '../controllers/employeeController.js';
import { authenticateUser, authorizeRoles } from '../middleware/auth.js';
import ValidationMiddleware from '../middleware/validation.js';

const router = express.Router();

// ==================== EMPLOYEE ROUTES ====================
// GET routes should come before parameterized routes
router.get('/search', authenticateUser, searchEmployees);
router.get('/', authenticateUser, getAllEmployees);

// Employee CRUD operations
router.post('/', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateAddEmployee, addEmployee);
router.put('/:id', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateUpdateEmployee, updateEmployee);
router.delete('/:id', authenticateUser, authorizeRoles('hr', 'admin'), deleteEmployee);

// ==================== WORK HISTORY ROUTES ====================
// Work history routes - Sá»¬A Äá»‚ TÆ¯Æ NG THÃCH Vá»šI CLIENT
router.get('/:employeeId/work-history', authenticateUser, getEmployeeWorkHistory);
router.post('/work-history', authenticateUser, authorizeRoles('hr', 'admin'), addWorkHistory);

// âœ… THÃŠM Má»šI: Routes cho sá»­a vÃ  xÃ³a work history
router.put('/work-history/:id', authenticateUser, authorizeRoles('hr', 'admin'), updateWorkHistory);
router.delete('/work-history/:id', authenticateUser, authorizeRoles('hr', 'admin'), deleteWorkHistory);

// ==================== ERROR HANDLING ====================
// Handle 404 for unmatched routes
router.use('*', (req, res) => {
    res.status(404).json({
        success: false,
        error: 'Route not found',
        path: req.originalUrl
    });
});

export default router;

```


==================== File: .\server\routes\masterData.js ====================

// server/routes/masterData.js
import express from 'express';
import { authenticateUser, authorizeRoles } from '../middleware/auth.js';
import { getStores, addStore, updateStore, deleteStore } from '../controllers/storeController.js';
import { getPositions, addPosition, updatePosition, deletePosition } from '../controllers/positionController.js';
import ValidationMiddleware from '../middleware/validation.js';

const router = express.Router();

// ==================== STORE ROUTES ====================
router.get('/stores', authenticateUser, getStores);
router.post('/stores', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateStore, addStore);
router.put('/stores/:id', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateStore, updateStore);
router.delete('/stores/:id', authenticateUser, authorizeRoles('hr', 'admin'), deleteStore);

// ==================== POSITION ROUTES ====================
router.get('/positions', authenticateUser, getPositions);
router.post('/positions', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validatePosition, addPosition);
router.put('/positions/:id', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validatePosition, updatePosition);
router.delete('/positions/:id', authenticateUser, authorizeRoles('hr', 'admin'), deletePosition);

export default router;

```


==================== File: .\server\routes\recruitment.js ====================

// server/routes/recruitment.js
import express from 'express';
import { 
    getRecruitmentRequests,
    getRecruitmentHoursSummary,
    getDetailedHoursForRequest  
} from '../controllers/recruitmentController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.get('/', authenticateUser, getRecruitmentRequests);
router.get('/hours-summary', authenticateUser, getRecruitmentHoursSummary);
router.get('/detailed-hours/:requestNo', authenticateUser, getDetailedHoursForRequest);

export default router;

```


==================== File: .\server\services\index.js ====================

// Main services export file
export * from './core/index.js';
export * from './auth/index.js';
export * from './employee/index.js';
export * from './attendance/index.js';
export * from './recruitment/index.js';
export * from './master-data/index.js';
export * from './utils/index.js';

// Export service factory for easy access
export { default as ServiceFactory } from './utils/service-factory.js';

```


==================== File: .\server\services\lark-service-manager.js ====================

// server/services/lark-service-manager.js
import { EmployeeService, WorkHistoryService } from './employees/index.js';
import { AttendanceService } from './attendance/index.js';
import { RecruitmentService } from './recruitment/index.js';
import { StoreService, PositionService } from './master-data/index.js';
import { AuthService, SessionService } from './auth/index.js';
import { validateLarkConfig } from '../config/lark-config.js';

class LarkServiceManager {
    constructor() {
        this.services = {};
        this.initialized = false;
    }

    async init() {
        if (this.initialized) return;

        try {
            console.log('ğŸš€ Initializing Lark Service Manager...');
            
            // Validate configuration first
            validateLarkConfig();
            
            // Initialize all services
            this.services.employee = new EmployeeService();
            this.services.workHistory = new WorkHistoryService();
            this.services.attendance = new AttendanceService();
            this.services.recruitment = new RecruitmentService();
            this.services.store = new StoreService();
            this.services.position = new PositionService();
            this.services.auth = new AuthService();
            this.services.session = new SessionService();

            // Initialize each service
            await Promise.all([
                this.services.employee.init(),
                this.services.workHistory.init(),
                this.services.attendance.init(),
                this.services.recruitment.init(),
                this.services.store.init(),
                this.services.position.init(),
                this.services.auth.init(),
                this.services.session.init()
            ]);

            this.initialized = true;
            console.log('âœ… All Lark services initialized successfully');
            
        } catch (error) {
            console.error('âŒ Lark Service Manager initialization failed:', error);
            throw new Error(`Service Manager initialization failed: ${error.message}`);
        }
    }

    async ensureInitialized() {
        if (!this.initialized) {
            await this.init();
        }
    }

    // Get specific service for advanced operations
    getService(serviceName) {
        if (!this.services[serviceName]) {
            throw new Error(`Service '${serviceName}' not found. Available services: ${Object.keys(this.services).join(', ')}`);
        }
        return this.services[serviceName];
    }

    // ==================== EMPLOYEE METHODS ====================
    async getAllEmployees() {
        await this.ensureInitialized();
        return await this.services.employee.getAllEmployees();
    }

    async addEmployee(employeeData) {
        await this.ensureInitialized();
        return await this.services.employee.addEmployee(employeeData);
    }

    async updateEmployee(id, employeeData) {
        await this.ensureInitialized();
        return await this.services.employee.updateEmployee(id, employeeData);
    }

    async deleteEmployee(id) {
        await this.ensureInitialized();
        return await this.services.employee.deleteEmployee(id);
    }

    //async checkEmployeeIdExists(employeeId) {
    //    await this.ensureInitialized();
    //    return await this.services.employee.checkEmployeeIdExists(employeeId);
    //}

    async searchEmployees(query) {
        await this.ensureInitialized();
        return await this.services.employee.searchEmployees(query);
    }

    // ==================== WORK HISTORY METHODS ====================
    async getWorkHistoryByEmployee(employeeId) {
        await this.ensureInitialized();
        return await this.services.workHistory.getWorkHistoryByEmployee(employeeId);
    }

    // async addWorkHistory(workHistoryData) {
    //     await this.ensureInitialized();
    //     return await this.services.workHistory.addWorkHistory(workHistoryData);
    // }

    async addWorkHistory(workHistoryData) {
        await this.ensureInitialized();
        // Láº¥y instance cá»§a recruitment service
        const recruitmentService = this.getService('recruitment');
        // Truyá»n nÃ³ vÃ o hÃ m cá»§a workHistory service
        return await this.services.workHistory.addWorkHistory(workHistoryData, recruitmentService);
    }

    async checkWorkHistoryExists(employeeId, requestNo) {
        await this.ensureInitialized();
        return await this.services.workHistory.checkWorkHistoryExists(employeeId, requestNo);
    }

    async checkWorkHistoryExists(employeeId, requestNo) {
        await this.ensureInitialized();
        return await this.services.workHistory.checkWorkHistoryExists(employeeId, requestNo);
    }
    
    // ==================== ATTENDANCE METHODS ====================
    async getAttendanceLogs(filters = {}) {
        await this.ensureInitialized();
        return await this.services.attendance.getAttendanceLogs(filters);
    }

    async addAttendanceLog(attendanceData) {
        await this.ensureInitialized();
        return await this.services.attendance.addAttendanceLog(attendanceData);
    }

    async getEmployeeHours() {
        await this.ensureInitialized();
        return await this.services.attendance.getEmployeeHours();
    }

    // ==================== STORE METHODS ====================
    async getAllStores() {
        await this.ensureInitialized();
        return await this.services.store.getAllStores();
    }

    async addStore(storeData) {
        await this.ensureInitialized();
        return await this.services.store.addStore(storeData);
    }

    async updateStore(id, storeData) {
        await this.ensureInitialized();
        return await this.services.store.updateStore(id, storeData);
    }

    async deleteStore(id) {
        await this.ensureInitialized();
        return await this.services.store.deleteStore(id);
    }

    // ==================== POSITION METHODS ====================
    async getAllPositions() {
        await this.ensureInitialized();
        return await this.services.position.getAllPositions();
    }

    async addPosition(positionData) {
        await this.ensureInitialized();
        return await this.services.position.addPosition(positionData);
    }

    async updatePosition(id, positionData) {
        await this.ensureInitialized();
        return await this.services.position.updatePosition(id, positionData);
    }

    async deletePosition(id) {
        await this.ensureInitialized();
        return await this.services.position.deletePosition(id);
    }
}

export default new LarkServiceManager();

```


==================== File: .\server\services\attendance\attendance-service.js ====================

// server/services/attendance/attendance-service.js
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class AttendanceService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_ATTENDANCE_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Attendance Service...');
    }

    async getAttendanceLogs(filters = {}) {
        const cacheKey = `attendance_logs_${JSON.stringify(filters)}`;
        let logs = CacheService.get(cacheKey);
        
        if (logs) {
            console.log(`âœ… ATTENDANCE: Loaded ${logs.length} records from cache.`);
            return logs;
        }

        try {
            console.log('ğŸ“¡ ATTENDANCE: Fetching all attendance logs from Lark...');
            
            // XÃ¢y dá»±ng cÃ¡c tham sá»‘ cho API
            const params = {};
            if (filters.employeeId) {
                // Lark filter syntax: CurrentValue.[TÃªn cá»™t] = "GiÃ¡ trá»‹"
                params.filter = `CurrentValue.[MÃ£ nhÃ¢n viÃªn] = "${filters.employeeId}"`;
            }
            
            // Gá»i phÆ°Æ¡ng thá»©c má»›i Ä‘á»ƒ láº¥y táº¥t cáº£ cÃ¡c trang dá»¯ liá»‡u
            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`,
                params
            );

            logs = this.transformAttendanceData(response.data?.items || []);
            console.log(`âœ… ATTENDANCE: Transformed ${logs.length} total records from Lark.`);
            
            // Lá»c theo ngÃ y (sau khi Ä‘Ã£ láº¥y háº¿t dá»¯ liá»‡u)
            if (filters.dateFrom || filters.dateTo) {
                logs = this.filterByDateRange(logs, filters.dateFrom, filters.dateTo);
                console.log(`âœ… ATTENDANCE: Filtered by date range, resulting in ${logs.length} records.`);
            }
            
            CacheService.set(cacheKey, logs, 300000); // Cache trong 5 phÃºt
            console.log(`âœ… ATTENDANCE: Cached ${logs.length} records.`);

        } catch (error) {
            console.error('âŒ Error fetching attendance logs:', error);
            logs = []; // Tráº£ vá» máº£ng rá»—ng náº¿u cÃ³ lá»—i
        }
        
        return logs;
    }

    async addAttendanceLog(attendanceData) {
        try {
            const transformedData = this.transformAttendanceForLark(attendanceData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.clear();
            
            return this.transformAttendanceData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'addAttendanceLog');
            throw error;
        }
    }

    // âœ… Cáº¬P NHáº¬T: getEmployeeHours Ä‘á»ƒ hiá»ƒn thá»‹ táº¥t cáº£ nhÃ¢n viÃªn
    async getEmployeeHours() {
        const logs = await this.getAttendanceLogs();
        console.log('ğŸ” Total attendance logs:', logs.length);

        const employeeHours = {};

        // Group logs by employee and date
        const groupedLogs = this.groupLogsByEmployeeAndDate(logs);

        // Láº¥y táº¥t cáº£ employeeId thá»±c táº¿ cÃ³ phÃ¡t sinh log
        const allEmployeeIds = [...new Set(logs.map(log => log.employeeId))].filter(id => id);
        console.log('ğŸ” All employee IDs found in logs:', allEmployeeIds);

        // Chá»‰ tá»•ng há»£p cÃ¡c ngÃ y nhÃ¢n viÃªn cÃ³ cháº¥m cÃ´ng
        for (const employeeId of allEmployeeIds) {
            if (!employeeId) continue;
            employeeHours[employeeId] = [];
            const employeeDateGroups = groupedLogs[employeeId] || {};

            // Chá»‰ láº·p qua cÃ¡c ngÃ y cÃ³ log
            for (const date in employeeDateGroups) {
                const dayLogs = employeeDateGroups[date];
                const dailyResult = this.calculateDailyHours(employeeId, date, dayLogs);
                employeeHours[employeeId].push({
                    date,
                    ...dailyResult
                });
            }
        }

        return employeeHours;
    }


    // âœ… Cáº¬P NHáº¬T: ThÃªm more detailed debugging
    groupLogsByEmployeeAndDate(logs) {
        console.log('ğŸ” DEBUG: Raw logs for grouping:', logs.map(log => ({
            employeeId: log.employeeId,
            date: log.date,
            type: log.type,
            timestamp: log.timestamp
        })));
        
        const grouped = {};
        
        logs.forEach(log => {
            if (!log.employeeId || !log.date) {
                console.warn('âš ï¸ Invalid log record:', log);
                return;
            }
            
            if (!grouped[log.employeeId]) {
                grouped[log.employeeId] = {};
            }
            
            if (!grouped[log.employeeId][log.date]) {
                grouped[log.employeeId][log.date] = [];
            }
            
            grouped[log.employeeId][log.date].push(log);
        });
        
        console.log('ğŸ” DEBUG: Grouped logs:', Object.keys(grouped).map(empId => ({
            employeeId: empId,
            dates: Object.keys(grouped[empId]),
            totalRecords: Object.values(grouped[empId]).flat().length
        })));
        
        return grouped;
    }

    // âœ… TÃNH GIá»œ CÃ”NG THEO NGÃ€Y VÃ€ CHá»¨C Vá»¤
    calculateDailyHours(employeeId, date, dayLogs) {
        if (dayLogs.length === 0) {
            return {
                totalHours: '0 giá» 0 phÃºt',
                warnings: ['KhÃ´ng cÃ³ dá»¯ liá»‡u cháº¥m cÃ´ng'],
                position: 'N/A'
            };
        }

        return this.calculateSimpleHours(dayLogs)
    }

    // âœ… THÃŠM: Logic Ä‘Æ¡n giáº£n cho táº¥t cáº£ nhÃ¢n viÃªn
    calculateSimpleHours(dayLogs) {
        const checkinLogs = dayLogs.filter(log => log.type === 'Checkin');
        const checkoutLogs = dayLogs.filter(log => log.type === 'Checkout');
        
        const warnings = [];
        
        if (checkinLogs.length === 0) {
            warnings.push('Thiáº¿u check in');
        }
        
        if (checkoutLogs.length === 0) {
            warnings.push('Thiáº¿u check out');
        }
        
        if (checkinLogs.length === 0 || checkoutLogs.length === 0) {
            return {
                totalHours: '0 giá» 0 phÃºt',
                warnings,
                position: dayLogs[0]?.position || 'N/A'
            };
        }
        
        // âœ… Láº¤Y CHECK IN Sá»šM NHáº¤T VÃ€ CHECK OUT MUá»˜N NHáº¤T
        const earliestCheckin = checkinLogs.reduce((earliest, current) => 
            new Date(current.timestamp) < new Date(earliest.timestamp) ? current : earliest
        );
        
        const latestCheckout = checkoutLogs.reduce((latest, current) => 
            new Date(current.timestamp) > new Date(latest.timestamp) ? current : latest
        );
        
        const checkinTime = new Date(earliestCheckin.timestamp);
        const checkoutTime = new Date(latestCheckout.timestamp);
        const diffHours = (checkoutTime - checkinTime) / (1000 * 60 * 60);
        
        // âœ… THÃŠM Cáº¢NH BÃO Náº¾U CÃ“ NHIá»€U LOGS
        if (dayLogs.length > 2) {
            warnings.push(`CÃ³ ${dayLogs.length} láº§n cháº¥m cÃ´ng trong ngÃ y`);
        }
        
        return {
            totalHours: this.formatHoursDisplay(Math.max(0, diffHours)),
            warnings,
            position: dayLogs[0]?.position || 'N/A'
        };
    }

    // âœ… TÃNH GIá»œ CHO MASCOT (4 láº§n cháº¥m cÃ´ng/ngÃ y)
    calculateMascotHours(dayLogs) {
        // Kiá»ƒm tra sá»‘ láº§n cháº¥m cÃ´ng
        if (dayLogs.length !== 4) {
            return {
                totalHours: '0 giá» 0 phÃºt',
                morningHours: '0 giá» 0 phÃºt',
                afternoonHours: '0 giá» 0 phÃºt',
                warnings: [`Mascot pháº£i cháº¥m cÃ´ng Ä‘Ãºng 4 láº§n/ngÃ y. Hiá»‡n táº¡i: ${dayLogs.length} láº§n`],
                position: 'NhÃ¢n viÃªn Mascot',
                error: true
            };
        }

        // Chia ca theo 13:00
        const morningLogs = dayLogs.filter(log => {
            const hour = new Date(log.timestamp).getHours();
            return hour < 13;
        });

        const afternoonLogs = dayLogs.filter(log => {
            const hour = new Date(log.timestamp).getHours();
            return hour >= 13;
        });

        const morningResult = this.calculateShiftHours(morningLogs);
        const afternoonResult = this.calculateShiftHours(afternoonLogs);

        const totalHours = morningResult.hours + afternoonResult.hours;

        return {
            morningHours: this.formatHoursDisplay(morningResult.hours),
            afternoonHours: this.formatHoursDisplay(afternoonResult.hours),
            totalHours: this.formatHoursDisplay(totalHours),
            warnings: [...morningResult.warnings, ...afternoonResult.warnings],
            position: 'NhÃ¢n viÃªn Mascot'
        };
    }

    // âœ… TÃNH GIá»œ CHO NHÃ‚N VIÃŠN THá»œI Vá»¤ (2 láº§n cháº¥m cÃ´ng/ngÃ y)
    calculateRegularHours(dayLogs) {
        const checkinLog = dayLogs.find(log => log.type === 'Checkin');
        const checkoutLog = dayLogs.find(log => log.type === 'Checkout');

        if (!checkinLog || !checkoutLog) {
            return {
                totalHours: '0 giá» 0 phÃºt',
                warnings: [
                    !checkinLog ? 'Thiáº¿u check in' : '',
                    !checkoutLog ? 'Thiáº¿u check out' : ''
                ].filter(Boolean),
                position: dayLogs[0]?.position || 'N/A'
            };
        }

        const checkinTime = new Date(checkinLog.timestamp);
        const checkoutTime = new Date(checkoutLog.timestamp);
        const diffHours = (checkoutTime - checkinTime) / (1000 * 60 * 60);

        return {
            totalHours: this.formatHoursDisplay(Math.max(0, diffHours)),
            warnings: [],
            position: dayLogs[0]?.position || 'N/A'
        };
    }

    // âœ… TÃNH GIá»œ CHO 1 CA (DÃ™NG CHO MASCOT)
    calculateShiftHours(shiftLogs) {
        const checkin = shiftLogs.find(log => log.type === 'Checkin');
        const checkout = shiftLogs.find(log => log.type === 'Checkout');

        if (!checkin || !checkout) {
            return {
                hours: 0,
                warnings: [
                    !checkin ? 'Thiáº¿u check in ca nÃ y' : '',
                    !checkout ? 'Thiáº¿u check out ca nÃ y' : ''
                ].filter(Boolean)
            };
        }

        const diffHours = (new Date(checkout.timestamp) - new Date(checkin.timestamp)) / (1000 * 60 * 60);
        return {
            hours: Math.max(0, diffHours),
            warnings: []
        };
    }

    // âœ… FORMAT HIá»‚N THá»Š GIá»œ: "8 giá» 30 phÃºt"
    formatHoursDisplay(totalHours) {
        if (!totalHours || totalHours === 0) return '0 giá» 0 phÃºt';
        
        const hours = Math.floor(totalHours);
        const minutes = Math.round((totalHours - hours) * 60);
        
        if (minutes === 0) {
            return `${hours} giá»`;
        } else if (hours === 0) {
            return `${minutes} phÃºt`;
        } else {
            return `${hours} giá» ${minutes} phÃºt`;
        }
    }

    // âœ… FILTER THEO KHOáº¢NG NGÃ€Y
    filterByDateRange(logs, dateFrom, dateTo) {
        return logs.filter(log => {
            const logDate = new Date(log.date);
            const fromDate = dateFrom ? new Date(dateFrom) : null;
            const toDate = dateTo ? new Date(dateTo) : null;
            
            if (fromDate && logDate < fromDate) return false;
            if (toDate && logDate > toDate) return false;
            
            return true;
        });
    }

    // âœ… Sá»¬A: HELPER FUNCTIONS vá»›i timestamp conversion Ä‘Ãºng
    convertUnixToDateTime(unixTimestamp) {
        if (!unixTimestamp) return '';
        
        console.log('ğŸ” Raw timestamp:', unixTimestamp, typeof unixTimestamp);
        
        // Náº¿u timestamp Ä‘Ã£ lÃ  ISO string
        if (typeof unixTimestamp === 'string' && unixTimestamp.includes('T')) {
            const date = new Date(unixTimestamp);
            if (date.getFullYear() > 2000 && date.getFullYear() < 2100) {
                return unixTimestamp;
            }
        }
        
        // âœ… QUAN TRá»ŒNG: Timestamp tá»« Lark Ä‘Ã£ lÃ  milliseconds, khÃ´ng nhÃ¢n 1000
        if (typeof unixTimestamp === 'number') {
            return new Date(unixTimestamp).toISOString();
        }
        
        console.warn('âš ï¸ Invalid timestamp format:', unixTimestamp);
        return new Date().toISOString();
    }

    // âœ… Sá»¬A: Sá»­ dá»¥ng trá»±c tiáº¿p timestamp tá»« convertUnixToDateTime
    transformAttendanceData(larkData) {
        
        return larkData.map(record => {
            let employeeId = '';
            const employeeIdField = record.fields['MÃ£ nhÃ¢n viÃªn'];
            
            if (Array.isArray(employeeIdField) && employeeIdField.length > 0) {
                employeeId = employeeIdField[0]?.text || '';
                console.log('ğŸ” EXTRACTED EMPLOYEE ID:', employeeId);
            } else if (typeof employeeIdField === 'string') {
                employeeId = employeeIdField;
            }

            // âœ… Sá»¬A: Sá»­ dá»¥ng timestamp Ä‘Ã£ convert Ä‘á»ƒ extract date vÃ  time
            const convertedTimestamp = this.convertUnixToDateTime(record.fields['Thá»i gian cháº¥m cÃ´ng']);
            const dateObj = new Date(convertedTimestamp);
            
            
            return {
                id: record.record_id,
                employeeId: employeeId,
                type: record.fields['PhÃ¢n loáº¡i'] || '',
                position: record.fields['Vá»‹ trÃ­'] || '',
                timestamp: convertedTimestamp,
                date: dateObj.toISOString().split('T')[0],
                time: dateObj.toTimeString().slice(0, 5),
                notes: record.fields['Ghi chÃº'] || '',
                createdAt: record.fields['Created At'] || new Date().toISOString()
            };
        });
    }

    // âœ… TRANSFORM Dá»® LIá»†U Äá»‚ Gá»¬I Vá»€ LARKBASE
    transformAttendanceForLark(attendanceData) {
        return {
            'MÃ£ nhÃ¢n viÃªn': attendanceData.employeeId,
            'PhÃ¢n loáº¡i': attendanceData.type,
            'Vá»‹ trÃ­': attendanceData.position,
            'Thá»i gian cháº¥m cÃ´ng': Math.floor(new Date(attendanceData.timestamp).getTime() / 1000),
            'Ghi chÃº': attendanceData.notes || '',
            'Created At': new Date().toISOString()
        };
    }

    // âœ… THÃŠM: Helper method Ä‘á»ƒ extract employeeId tá»« Lark field
    extractEmployeeId(employeeIdField) {
        if (!employeeIdField) return '';
        
        // Náº¿u lÃ  array (linked record tá»« Lark)
        if (Array.isArray(employeeIdField) && employeeIdField.length > 0) {
            const firstRecord = employeeIdField[0];
            return firstRecord?.text || firstRecord?.name || '';
        }
        
        // Náº¿u lÃ  string Ä‘Æ¡n giáº£n
        if (typeof employeeIdField === 'string') {
            return employeeIdField;
        }
        
        // Náº¿u lÃ  object
        if (typeof employeeIdField === 'object' && employeeIdField.text) {
            return employeeIdField.text;
        }
        
        console.warn('âš ï¸ Unknown employeeId format:', employeeIdField);
        return '';
    }
}

export default AttendanceService;

```


==================== File: .\server\services\attendance\attendance-validator.js ====================

// Attendance validation service
class AttendanceValidator {
    static validateAttendanceData(attendanceData) {
        const errors = [];

        // Required fields validation
        if (!attendanceData.employeeId) {
            errors.push('Employee ID lÃ  báº¯t buá»™c');
        }

        if (!attendanceData.date) {
            errors.push('NgÃ y lÃ  báº¯t buá»™c');
        } else if (!this.isValidDate(attendanceData.date)) {
            errors.push('NgÃ y khÃ´ng há»£p lá»‡');
        }

        if (!attendanceData.timeIn) {
            errors.push('Thá»i gian vÃ o lÃ  báº¯t buá»™c');
        } else if (!this.isValidTime(attendanceData.timeIn)) {
            errors.push('Thá»i gian vÃ o khÃ´ng há»£p lá»‡');
        }

        if (!attendanceData.timeOut) {
            errors.push('Thá»i gian ra lÃ  báº¯t buá»™c');
        } else if (!this.isValidTime(attendanceData.timeOut)) {
            errors.push('Thá»i gian ra khÃ´ng há»£p lá»‡');
        }

        // Check if time out is after time in
        if (attendanceData.timeIn && attendanceData.timeOut) {
            if (!this.isTimeOutAfterTimeIn(attendanceData.timeIn, attendanceData.timeOut)) {
                errors.push('Thá»i gian ra pháº£i sau thá»i gian vÃ o');
            }
        }

        return errors;
    }

    static isValidDate(dateString) {
        const date = new Date(dateString);
        return date instanceof Date && !isNaN(date);
    }

    static isValidTime(timeString) {
        const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
        return timeRegex.test(timeString);
    }

    static isTimeOutAfterTimeIn(timeIn, timeOut) {
        const inTime = new Date(`1970-01-01T${timeIn}`);
        const outTime = new Date(`1970-01-01T${timeOut}`);
        return outTime > inTime;
    }
}

export default AttendanceValidator;

```


==================== File: .\server\services\attendance\index.js ====================

// Attendance services exports
export { default as AttendanceService } from './attendance-service.js';
export { default as AttendanceValidator } from './attendance-validator.js';

```


==================== File: .\server\services\auth\auth-service.js ====================

// Authentication service
import BaseService from '../core/base-service.js';
import { users } from '../../config/database.js';

class AuthService extends BaseService {
    constructor() {
        super();
        this.activeSessions = new Map();
    }

    async validateCredentials(username, password) {
        const user = users[username];
        if (!user || user.password !== password) {
            throw new Error('Invalid credentials');
        }
        return user;
    }

    createSession(user) {
        const sessionData = {
            id: user.id,
            username: user.username,
            role: user.role,
            fullName: user.fullName,
            loginTime: new Date().toISOString()
        };
        
        this.activeSessions.set(user.id, sessionData);
        return sessionData;
    }

    validateSession(sessionId) {
        return this.activeSessions.get(sessionId);
    }

    destroySession(sessionId) {
        return this.activeSessions.delete(sessionId);
    }

    async login(credentials) {
        const { username, password } = credentials;
        
        const user = await this.validateCredentials(username, password);
        const sessionData = this.createSession(user);
        
        return {
            success: true,
            user: sessionData,
            message: 'Login successful'
        };
    }

    async logout(sessionId) {
        const destroyed = this.destroySession(sessionId);
        return {
            success: destroyed,
            message: destroyed ? 'Logout successful' : 'Session not found'
        };
    }

    getActiveUsers() {
        return Array.from(this.activeSessions.values());
    }
}

export default AuthService;

```


==================== File: .\server\services\auth\index.js ====================

// Auth services exports
export { default as AuthService } from './auth-service.js';
export { default as SessionService } from './session-service.js';

```


==================== File: .\server\services\auth\session-service.js ====================

// Session management service
import BaseService from '../core/base-service.js';

class SessionService extends BaseService {
    constructor() {
        super();
        this.sessions = new Map();
        this.sessionTimeout = 24 * 60 * 60 * 1000; // 24 hours
    }

    createSession(user, req) {
        const sessionId = this.generateId('sess_');
        const sessionData = {
            id: sessionId,
            userId: user.id,
            user: user,
            createdAt: new Date().toISOString(),
            lastAccessed: new Date().toISOString(),
            ipAddress: req.ip || req.connection.remoteAddress,
            userAgent: req.get('User-Agent')
        };

        this.sessions.set(sessionId, sessionData);
        return sessionData;
    }

    getSession(sessionId) {
        const session = this.sessions.get(sessionId);
        if (!session) return null;

        // Check if session is expired
        const now = Date.now();
        const lastAccessed = new Date(session.lastAccessed).getTime();
        if (now - lastAccessed > this.sessionTimeout) {
            this.destroySession(sessionId);
            return null;
        }

        // Update last accessed
        session.lastAccessed = new Date().toISOString();
        this.sessions.set(sessionId, session);
        
        return session;
    }

    destroySession(sessionId) {
        return this.sessions.delete(sessionId);
    }

    cleanupExpiredSessions() {
        const now = Date.now();
        for (const [sessionId, session] of this.sessions.entries()) {
            const lastAccessed = new Date(session.lastAccessed).getTime();
            if (now - lastAccessed > this.sessionTimeout) {
                this.destroySession(sessionId);
            }
        }
    }

    getActiveSessions() {
        return Array.from(this.sessions.values());
    }

    getUserSessions(userId) {
        return Array.from(this.sessions.values()).filter(session => session.userId === userId);
    }
}

export default SessionService;

```


==================== File: .\server\services\core\base-service.js ====================

// Abstract base class for all services
import { formatResponse } from '../utils/response-formatter.js';

export default class BaseService {
    constructor() {
        this.initialized = false;
        this.cache = new Map();
    }

    async init() {
        if (!this.initialized) {
            await this.initializeService();
            this.initialized = true;
        }
    }

    async initializeService() {
        // Override in subclasses
    }

    formatResponse(success, message, data = null, errorCode = null) {
        return formatResponse(success, message, data, errorCode);
    }

    validateRequired(data, fields) {
        const errors = [];
        fields.forEach(field => {
            if (!data[field]) {
                errors.push(`${field} lÃ  báº¯t buá»™c`);
            }
        });
        return errors;
    }

    generateId(prefix = '') {
        return `${prefix}${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    async handleError(error, operation) {
        console.error(`Error in ${operation}:`, error);
        throw error;
    }
}

```


==================== File: .\server\services\core\cache-service.js ====================

// server/services/core/cache-service.js
class CacheService {
    constructor() {
        this.cache = new Map();
        this.ttl = new Map();
    }

    set(key, value, ttlMs = 300000) { // 5 minutes default
        this.cache.set(key, value);
        this.ttl.set(key, Date.now() + ttlMs);
    }

    get(key) {
        const expiry = this.ttl.get(key);
        if (expiry && Date.now() > expiry) {
            this.delete(key);
            return null;
        }
        return this.cache.get(key);
    }

    delete(key) {
        this.cache.delete(key);
        this.ttl.delete(key);
    }

    clear() {
        this.cache.clear();
        this.ttl.clear();
    }

    has(key) {
        const expiry = this.ttl.get(key);
        if (expiry && Date.now() > expiry) {
            this.delete(key);
            return false;
        }
        return this.cache.has(key);
    }

    size() {
        return this.cache.size;
    }

    cleanup() {
        const now = Date.now();
        for (const [key, expiry] of this.ttl.entries()) {
            if (now > expiry) {
                this.delete(key);
            }
        }
    }
}

export default new CacheService();

```


==================== File: .\server\services\core\index.js ====================

// Core services exports
export { default as BaseService } from './base-service.js';
export { default as LarkClient } from './lark-client.js';
export { default as CacheService } from './cache-service.js';

```


==================== File: .\server\services\core\lark-client.js ====================

// server/services/core/lark-client.js
import axios from 'axios';

class LarkClient {
    constructor() {
        // KhÃ´ng load env vars táº¡i constructor
        this.baseURL = 'https://open.larksuite.com/open-apis';
        this.tenantAccessToken = null;
        this.tokenExpiry = null;
    }

    // Getter methods Ä‘á»ƒ load env vars khi cáº§n
    get appId() {
        return process.env.LARK_APP_ID;
    }

    get appSecret() {
        return process.env.LARK_APP_SECRET;
    }

    async getTenantAccessToken() {
        console.log('ğŸ”‘ Getting tenant access token...');
        
        if (!this.appId || !this.appSecret) {
            throw new Error('Lark credentials not configured properly');
        }
        
        if (this.tenantAccessToken && this.tokenExpiry > Date.now()) {
            console.log('âœ… Using cached access token');
            return this.tenantAccessToken;
        }

        try {
            console.log('ğŸ“¡ Requesting new access token from Lark...');
            const payload = {
                app_id: this.appId,
                app_secret: this.appSecret
            };
            
            console.log('ğŸš€ Sending request to:', `${this.baseURL}/auth/v3/tenant_access_token/internal`);
            console.log('ğŸ“¦ Payload keys:', Object.keys(payload));
            
            const response = await axios.post(`${this.baseURL}/auth/v3/tenant_access_token/internal`, payload);
            
            console.log('ğŸ“¨ Lark auth response:', {
                status: response.status,
                code: response.data.code,
                msg: response.data.msg
            });

            if (response.data.code === 0) {
                this.tenantAccessToken = response.data.tenant_access_token;
                this.tokenExpiry = Date.now() + (response.data.expire - 300) * 1000;
                console.log('âœ… Access token obtained successfully');
                console.log('Token expires in:', Math.floor((this.tokenExpiry - Date.now()) / 1000), 'seconds');
                return this.tenantAccessToken;
            } else {
                console.error('âŒ Lark auth error:', response.data);
                throw new Error(`Lark Auth Error: ${response.data.msg}`);
            }
        } catch (error) {
            console.error('âŒ Error getting tenant access token:', {
                message: error.message,
                response: error.response?.data,
                status: error.response?.status
            });
            throw error;
        }
    }

    async request(endpoint, options = {}) {
        console.log(`ğŸ“ Making Lark API request: ${options.method || 'GET'} ${endpoint}`);
        
        const token = await this.getTenantAccessToken();
        
        const config = {
            ...options,
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
                ...options.headers
            }
        };

        try {
            console.log('ğŸ”„ Sending request to:', `${this.baseURL}${endpoint}`);
            const response = await axios(`${this.baseURL}${endpoint}`, config);
            
            console.log('âœ… Lark API response:', {
                status: response.status,
                dataLength: response.data ? JSON.stringify(response.data).length : 0
            });
            
            return response.data;
        } catch (error) {
            console.error('âŒ Lark API Error:', {
                endpoint,
                status: error.response?.status,
                data: error.response?.data,
                message: error.message
            });
            throw error;
        }
    }
    
    async get(endpoint, params = {}) {
        console.log('ğŸ“¥ GET request:', endpoint, params);
        
        // âœ… Sá»¬A: Äá»•i tÃªn biáº¿n Ä‘á»ƒ trÃ¡nh conflict
        const queryParams = params;
        
        return this.request(endpoint, { 
            method: 'GET', 
            params: queryParams 
        });
    }

    // âœ… ================================================================
    // âœ… PHÆ¯Æ NG THá»¨C Má»šI Äá»‚ Láº¤Y TOÃ€N Bá»˜ Dá»® LIá»†U (CÃ“ PAGINATION)
    // âœ… ================================================================
    async getAllRecords(endpoint, pageSize = 100, filterParams = {}) {
        console.log(`ğŸ“š Getting ALL records from: ${endpoint}`);
        
        let allRecords = [];
        let hasMore = true;
        let pageToken = null;
        let pageCount = 0;
        
        while (hasMore) {
            pageCount++;
            console.log(`ğŸ“„ Fetching page ${pageCount}...`);
            
            const params = {
                page_size: pageSize
            };
            
            // âœ… Sá»¬A: ThÃªm filter params náº¿u cÃ³
            if (filterParams && Object.keys(filterParams).length > 0) {
                Object.assign(requestParams, filterParams);
            }


            if (pageToken) {
                params.page_token = pageToken;
            }
            
            // Sá»­ dá»¥ng method 'get' Ä‘Ã£ cÃ³ sáºµn cá»§a class
            const response = await this.get(endpoint, params);
            
            if (response.data?.items) {
                allRecords = [...allRecords, ...response.data.items];
                console.log(`âœ… Page ${pageCount}: ${response.data.items.length} records (Total: ${allRecords.length})`);
            }
            
            // Kiá»ƒm tra cÃ³ trang tiáº¿p theo khÃ´ng
            hasMore = response.data?.has_more || false;
            pageToken = response.data?.page_token || null;
            
            // Safety break Ä‘á»ƒ trÃ¡nh infinite loop
            if (pageCount > 200) { // Giá»›i háº¡n 200 trang (tá»‘i Ä‘a 20000 records)
                console.warn('âš ï¸ Reached maximum page limit (200 pages)');
                break;
            }
        }
        
        console.log(`ğŸ‰ COMPLETED: Retrieved ${allRecords.length} total records in ${pageCount} pages`);
        
        // Tráº£ vá» dá»¯ liá»‡u theo cáº¥u trÃºc chuáº©n {data: {items, total}}
        return {
            data: {
                items: allRecords,
                total: allRecords.length
            }
        };
    }

    async post(endpoint, data = {}) {
        console.log('ğŸ“¤ POST request:', endpoint, { dataKeys: Object.keys(data) });
        return this.request(endpoint, { method: 'POST', data });
    }

    async put(endpoint, data = {}) {
        console.log('ğŸ“ PUT request:', endpoint, { dataKeys: Object.keys(data) });
        return this.request(endpoint, { method: 'PUT', data });
    }

    async delete(endpoint) {
        console.log('ğŸ—‘ï¸ DELETE request:', endpoint);
        return this.request(endpoint, { method: 'DELETE' });
    }
}

export default new LarkClient();

```


==================== File: .\server\services\employees\employee-service.js ====================

// Employee management service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';
import WorkHistoryService from './work-history-service.js';

class EmployeeService extends BaseService {
    constructor() {
        super();
        this.tableName = 'employees';
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_EMPLOYEE_TABLE_ID;
        this.workHistoryService = new WorkHistoryService();
    }

    async initializeService() {
        // Initialize Lark Base connection
        console.log('Initializing Employee Service...');
        await this.workHistoryService.initializeService();
    }



    async getEmployeeById(id) {
        try {
            console.log(`ğŸ” Getting employee by ID: ${id}`);
            
            const response = await LarkClient.get(
                `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`
            );
            
            if (response.data && response.data.record) {
                const transformedEmployee = this.transformEmployeeData([response.data.record])[0];
                console.log('âœ… Employee found:', transformedEmployee.employeeId);
                return transformedEmployee;
            }
            
            console.log('âŒ Employee not found');
            return null;
            
        } catch (error) {
            console.error('âŒ Error getting employee by ID:', error);
            throw error;
        }
    }


    async getAllEmployees() {
        try {
            console.log('ğŸ“¡ EMPLOYEE: Fetching all employees from Lark API (Cache is disabled)...');

            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`
            );

            let employees = this.transformEmployeeData(response.data?.items || []);
            console.log(`âœ… EMPLOYEE: Transformed ${employees.length} employees from employee table.`);

            console.log(`âœ… EMPLOYEE: Completed supplementing data for ${employees.length} employees.`);
            return employees;
        } catch (error) {
            console.error('âŒ EMPLOYEE: Error fetching employees from Lark:', error.message);
            throw error;
        }
    }

    generateEmployeeId(fullName, phoneNumber) {
        return `${fullName} - ${phoneNumber}`;
    }

    async addEmployee(employeeData) {
        try {
            const transformedData = this.transformEmployeeForLark(employeeData);

            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('employees_all');
            
            return {
                success: true,
                employeeId: employeeData.employeeId,
                larkResponse: response 
            };
            
        } catch (error) {

            await this.handleError(error, 'addEmployee');
            throw error;
        }
    }

    async updateEmployee(id, employeeData) {
        try {
            const transformedData = this.transformEmployeeForLark(employeeData);

            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('employees_all');

            return this.transformEmployeeData([response.data.record])[0];
        } catch (error) {
            await this.handleError(error, 'updateEmployee');
            throw error;
        }
    }

    async deleteEmployee(id) {
        try {
            await LarkClient.delete(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`);

            // Clear cache
            CacheService.delete('employees_all');

            return true;
        } catch (error) {
            await this.handleError(error, 'deleteEmployee');
            throw error;
        }
    }

    async checkEmployeeIdExists(employeeId) {
        try {
            console.log(`ğŸ” EMPLOYEE: Checking for duplicate ID: ${employeeId}`);

            // âœ… Sá»­ dá»¥ng getAllRecords Ä‘á»ƒ Ä‘áº£m báº£o kiá»ƒm tra trÃªn toÃ n bá»™ nhÃ¢n viÃªn
            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`
            );
            const allEmployees = this.transformEmployeeData(response.data?.items || []);

            const exists = allEmployees.some(emp => emp.employeeId === employeeId);
            console.log(`âœ… EMPLOYEE: Duplicate check result: ${exists ? 'EXISTS' : 'NOT_EXISTS'}`);

            return exists;
        } catch (error) {
            console.error('âŒ EMPLOYEE: Error checking for duplicate employee ID:', error);
            // An toÃ n nháº¥t lÃ  tráº£ vá» false Ä‘á»ƒ khÃ´ng cháº·n viá»‡c thÃªm nhÃ¢n viÃªn náº¿u API lá»—i
            return false;
        }
    }

    async searchEmployees(query) {
        const employees = await this.getAllEmployees();

        if (!query) return employees;

        const searchTerm = query.toLowerCase();
        return employees.filter(emp =>
            emp.fullName.toLowerCase().includes(searchTerm) ||
            emp.employeeId.toLowerCase().includes(searchTerm) ||
            emp.phoneNumber.includes(searchTerm)
        );
    }

    transformEmployeeData(larkData) {

        if (!Array.isArray(larkData)) {
            console.warn('âš ï¸ SERVICE: larkData is not an array:', typeof larkData);
            return [];
        }

        const transformed = larkData.map((record, index) => {
            const result = {
                id: record.record_id,
                employeeId: record.fields['MÃ£ nhÃ¢n viÃªn'] || '',
                fullName: record.fields['Há» tÃªn'] || '',
                phoneNumber: record.fields['Sá»‘ Ä‘iá»‡n thoáº¡i'] || '',
                gender: record.fields['Giá»›i tÃ­nh'] || '',
                position: record.fields['Vá»‹ trÃ­'] || '',
                bankAccount: record.fields['Sá»‘ tÃ i khoáº£n'] || '',
                bankName: record.fields['NgÃ¢n hÃ ng'] || '',
                recruitmentLink: record.fields['Link Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng'] || '',
                status: record.fields['Tráº¡ng thÃ¡i'] || 'active',
                createdAt: record.fields['Created At'] || new Date().toISOString(),
                updatedAt: record.fields['Updated At'] || new Date().toISOString()
            };

            return result;
        });

        return transformed;
    }

    transformEmployeeForLark(employeeData) {
        return {
            'MÃ£ nhÃ¢n viÃªn': employeeData.employeeId,
            'Há» tÃªn': employeeData.fullName,
            'Sá»‘ Ä‘iá»‡n thoáº¡i': employeeData.phoneNumber,
            'Giá»›i tÃ­nh': employeeData.gender,
            'Vá»‹ trÃ­': employeeData.position || '',
            'Sá»‘ tÃ i khoáº£n': employeeData.bankAccount,
            'NgÃ¢n hÃ ng': employeeData.bankName,
            'Link Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng': employeeData.recruitmentLink || '',
            'Tráº¡ng thÃ¡i': employeeData.status || 'active'
        };
    }
}

export default EmployeeService;

```


==================== File: .\server\services\employees\employee-validator.js ====================

// Employee validation service
class EmployeeValidator {
    static validateEmployeeData(employeeData) {
        const errors = [];

        // Required fields validation
        if (!employeeData.fullName || employeeData.fullName.trim().length < 2) {
            errors.push('Há» tÃªn pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±');
        }

        if (!employeeData.phoneNumber || !this.isValidPhoneNumber(employeeData.phoneNumber)) {
            errors.push('Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng há»£p lá»‡');
        }

        if (!employeeData.gender || !['Nam', 'Ná»¯'].includes(employeeData.gender)) {
            errors.push('Giá»›i tÃ­nh pháº£i lÃ  Nam hoáº·c Ná»¯');
        }

        if (!employeeData.bankAccount || employeeData.bankAccount.trim().length < 6) {
            errors.push('Sá»‘ tÃ i khoáº£n pháº£i cÃ³ Ã­t nháº¥t 6 kÃ½ tá»±');
        }

        if (!employeeData.bankName || employeeData.bankName.trim().length < 2) {
            errors.push('TÃªn ngÃ¢n hÃ ng lÃ  báº¯t buá»™c');
        }

        return errors;
    }

    static isValidPhoneNumber(phoneNumber) {
        const phoneRegex = /^[0-9]{10,11}$/;
        return phoneRegex.test(phoneNumber);
    }

    static validateWorkHistoryData(workHistoryData) {
        const errors = [];

        if (!Array.isArray(workHistoryData) || workHistoryData.length === 0) {
            errors.push('Pháº£i cÃ³ Ã­t nháº¥t má»™t work history entry');
        }

        const requestNos = workHistoryData.map(item => item.requestNo);
        const uniqueRequestNos = [...new Set(requestNos)];
        
        if (requestNos.length !== uniqueRequestNos.length) {
            errors.push('KhÃ´ng Ä‘Æ°á»£c trÃ¹ng láº·p Request No');
        }

        workHistoryData.forEach((item, index) => {
            if (!item.requestNo || item.requestNo.trim().length === 0) {
                errors.push(`Work history entry ${index + 1}: Request No lÃ  báº¯t buá»™c`);
            }
        });

        return errors;
    }
}

export default EmployeeValidator;

```


==================== File: .\server\services\employees\index.js ====================

// Employee services exports
export { default as EmployeeService } from './employee-service.js';
export { default as WorkHistoryService } from './work-history-service.js';
export { default as EmployeeValidator } from './employee-validator.js';

```


==================== File: .\server\services\employees\work-history-service.js ====================

// server/services/employees/work-history-service.js
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';


// **HÃ€M TIá»†N ÃCH Äá»ŠNH Dáº NG NGÃ€Y**
const formatDate = (dateValue) => {
    if (!dateValue) return 'N/A';
    const date = new Date(dateValue);
    if (isNaN(date.getTime())) return 'NgÃ y khÃ´ng há»£p lá»‡';
    
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
};


// HÃ m tiá»‡n Ã­ch Ä‘á»ƒ kiá»ƒm tra hai khoáº£ng ngÃ y cÃ³ chá»“ng chÃ©o khÃ´ng
const dateRangesOverlap = (start1, end1, start2, end2) => {
    const s1 = new Date(start1);
    const e1 = new Date(end1);
    const s2 = new Date(start2);
    const e2 = new Date(end2);
    return s1 <= e2 && e1 >= s2;
};


class WorkHistoryService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_WORK_HISTORY_TABLE_ID;
        this.salaryTableId = process.env.LARK_SALARY_TABLE_ID || 'tblLdJp61bLeK3MG';
    }


    async initializeService() {
        console.log('Initializing Work History Service...');
    }


    async getSalaryData() {
        const cacheKey = 'salary_data_all';
        let salaryData = CacheService.get(cacheKey);


        if (salaryData) {
            console.log(`âœ… SALARY: Loaded ${salaryData.length} records from cache.`);
            return salaryData;
        }


        try {
            console.log('ğŸ“¡ SALARY: Fetching salary data from Lark...');
            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${this.baseId}/tables/${this.salaryTableId}/records`
            );


            salaryData = this.transformSalaryData(response.data?.items || []);
            console.log(`âœ… SALARY: Transformed ${salaryData.length} total records.`);


            CacheService.set(cacheKey, salaryData, 300000); // Cache 5 phÃºt
            return salaryData;
        } catch (error) {
            console.error('âŒ Error getting salary data:', error);
            return [];
        }
    }


    transformSalaryData(larkData) {
        return larkData.map(record => ({
            id: record.record_id,
            employeeId: this.extractEmployeeId(record.fields['MÃ£ nhÃ¢n viÃªn']),
            hourlyRate: record.fields['Má»©c lÆ°Æ¡ng/giá»'] || null,
        }));
    }


    extractEmployeeId(employeeIdField) {
        if (!employeeIdField) return '';
        
        if (Array.isArray(employeeIdField) && employeeIdField.length > 0) {
            const firstRecord = employeeIdField[0];
            return firstRecord?.text || firstRecord?.name || '';
        }
        
        if (typeof employeeIdField === 'string') {
            return employeeIdField;
        }
        
        if (typeof employeeIdField === 'object' && employeeIdField.text) {
            return employeeIdField.text;
        }
        
        return '';
    }


    async getWorkHistoryByEmployee(employeeId) {
        try {
            console.log(`ğŸ” Getting work history for employee: ${employeeId}`);
            
            const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                filter: `AND(CurrentValue.[MÃ£ nhÃ¢n viÃªn] = "${employeeId}")`
            });

            const workHistoryData = response.data?.items || [];
            console.log(`ğŸ“‹ Found ${workHistoryData.length} work history records`);

            const salaryData = await this.getSalaryData();
            console.log(`ğŸ’° Found ${salaryData.length} salary records`);

            return this.transformWorkHistoryDataWithSalary(workHistoryData, salaryData);
        } catch (error) {
            console.error('Error fetching work history:', error);
            return [];
        }
    }


    transformWorkHistoryDataWithSalary(workHistoryData, salaryData) {
        const salaryMap = new Map();
        salaryData.forEach(salary => {
            if (salary.employeeId) {
                salaryMap.set(salary.employeeId, salary.hourlyRate);
            }
        });

        console.log(`ğŸ—ºï¸ Created salary map with ${salaryMap.size} entries`);
        console.log(`ğŸ” Salary map keys:`, Array.from(salaryMap.keys()));

        return workHistoryData.map(record => {
            const employeeId = record.fields['MÃ£ nhÃ¢n viÃªn'] || '';
            const hourlyRateFromSalary = salaryMap.get(employeeId);
            
            console.log(`ğŸ’¡ Employee ${employeeId}: Work history hourlyRate = ${record.fields['Má»©c lÆ°Æ¡ng/giá»']}, Salary table hourlyRate = ${hourlyRateFromSalary}`);

            return {
                id: record.record_id,
                employeeId: employeeId,
                requestNo: record.fields['Request No.'] || '',
                fromDate: record.fields['Tá»« ngÃ y'] || null,
                toDate: record.fields['Äáº¿n ngÃ y'] || null,
                hourlyRate: record.fields['Má»©c lÆ°Æ¡ng/giá»'] || hourlyRateFromSalary || null,
                // Sá»¬A: Láº¥y giÃ¡ trá»‹ thá»±c tá»« Lark, khÃ´ng tá»± táº¡o má»›i
                createdAt: record.fields['Created At'] || null, 
                updatedAt: record.fields['Updated At'] || null
            };
        });
    }


    async checkWorkHistoryExists(employeeId, requestNo) {
        try {
            console.log(`ğŸ” WORK HISTORY: Checking duplicate (${employeeId}, ${requestNo})`);
            
            const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
            
            const records = response.data?.items || [];
            console.log(`ğŸ“‹ WORK HISTORY: Found ${records.length} total records`);
            
            const exists = records.some(record => {
                const fields = record.fields || {};
                const recordEmployeeId = fields['MÃ£ nhÃ¢n viÃªn'];
                const recordRequestNo = fields['Request No.'];
                
                const isMatch = recordEmployeeId === employeeId && recordRequestNo === requestNo;
                
                if (isMatch) {
                    console.log(`âŒ WORK HISTORY: Found duplicate - ${recordEmployeeId} / ${recordRequestNo}`);
                }
                
                return isMatch;
            });
            
            console.log(`âœ… WORK HISTORY: Duplicate check result: ${exists ? 'EXISTS' : 'NOT_EXISTS'}`);
            return exists;
            
        } catch (error) {
            console.error('âŒ Error checking work history exists:', error);
            return false;
        }
    }


    // async validateWorkHistoryDateOverlap(employeeId, newRequestNo, recruitmentService) {
    //     console.log(`ğŸ” VALIDATING DATE OVERLAP: Employee ${employeeId}, Request ${newRequestNo}`);

    //     const newRequestDetails = await recruitmentService.getRequestByNo(newRequestNo);
    //     if (!newRequestDetails.fromDate || !newRequestDetails.toDate) {
    //         console.warn(`âš ï¸ KhÃ´ng tÃ¬m tháº¥y ngÃ y cho Request No. ${newRequestNo}, bá» qua kiá»ƒm tra trÃ¹ng láº·p.`);
    //         return;
    //     }
    //     const newStartDate = newRequestDetails.fromDate;
    //     const newEndDate = newRequestDetails.toDate;

    //     const existingHistories = await this.getWorkHistoryByEmployee(employeeId);
    //     if (existingHistories.length === 0) {
    //         console.log('âœ… KhÃ´ng cÃ³ lá»‹ch sá»­ cÅ©, khÃ´ng cáº§n kiá»ƒm tra.');
    //         return;
    //     }

    //     for (const oldHistory of existingHistories) {
    //         const oldRequestDetails = await recruitmentService.getRequestByNo(oldHistory.requestNo);
    //         if (!oldRequestDetails || !oldRequestDetails.fromDate || !oldRequestDetails.toDate) {
    //             continue;
    //         }

    //         const oldStartDate = oldRequestDetails.fromDate;
    //         const oldEndDate = oldRequestDetails.toDate;

    //         if (dateRangesOverlap(newStartDate, newEndDate, oldStartDate, oldEndDate)) {
    //             const formattedNewStart = formatDate(newStartDate);
    //             const formattedNewEnd = formatDate(newEndDate);
    //             const formattedOldStart = formatDate(oldStartDate);
    //             const formattedOldEnd = formatDate(oldEndDate);

    //             const errorMessage = `Khoáº£ng thá»i gian tá»« ${formattedNewStart} Ä‘áº¿n ${formattedNewEnd} bá»‹ trÃ¹ng vá»›i lá»‹ch sá»­ lÃ m viá»‡c cÅ© (tá»« ${formattedOldStart} Ä‘áº¿n ${formattedOldEnd}, mÃ£ Ä‘á» xuáº¥t ${oldHistory.requestNo}).`;
    //             console.error(`âŒ DATE OVERLAP DETECTED: ${errorMessage}`);
    //             throw new Error(errorMessage);
    //         }
    //     }
        
    //     console.log('âœ… Kiá»ƒm tra trÃ¹ng láº·p ngÃ y thÃ nh cÃ´ng, khÃ´ng cÃ³ chá»“ng chÃ©o.');
    // }


    async validateWorkHistoryDateOverlap(employeeId, workHistoryData, recruitmentService) {
        console.log(`ğŸ” VALIDATING DATE OVERLAP: Employee ${employeeId}, New work period: ${workHistoryData.fromDate} - ${workHistoryData.toDate}`);

        // âœ… BÆ¯á»šC 1: Validate khoáº£ng ngÃ y cÃ³ náº±m trong Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng khÃ´ng
        const recruitmentDetails = await recruitmentService.getRequestByNo(workHistoryData.requestNo);
        if (recruitmentDetails && recruitmentDetails.fromDate && recruitmentDetails.toDate) {
            const workStart = new Date(workHistoryData.fromDate);
            const workEnd = new Date(workHistoryData.toDate);
            const recruitmentStart = new Date(recruitmentDetails.fromDate);
            const recruitmentEnd = new Date(recruitmentDetails.toDate);

            // Normalize vá» Ä‘áº§u ngÃ y Ä‘á»ƒ trÃ¡nh lá»—i precision
            workStart.setHours(0, 0, 0, 0);
            workEnd.setHours(23, 59, 59, 999);
            recruitmentStart.setHours(0, 0, 0, 0);
            recruitmentEnd.setHours(23, 59, 59, 999);

            if (workStart < recruitmentStart || workEnd > recruitmentEnd) {
                throw new Error(
                    `Khoáº£ng ngÃ y lÃ m viá»‡c (${formatDate(workHistoryData.fromDate)} - ${formatDate(workHistoryData.toDate)}) pháº£i náº±m trong khoáº£ng ngÃ y cá»§a Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng (${formatDate(recruitmentDetails.fromDate)} - ${formatDate(recruitmentDetails.toDate)}).`
                );
            }
        }

        // âœ… BÆ¯á»šC 2: Kiá»ƒm tra trÃ¹ng láº·p vá»›i work history cÅ© (ngÃ y thá»±c táº¿ lÃ m viá»‡c)
        const existingHistories = await this.getWorkHistoryByEmployee(employeeId);
        if (existingHistories.length === 0) {
            console.log('âœ… KhÃ´ng cÃ³ lá»‹ch sá»­ cÅ©, khÃ´ng cáº§n kiá»ƒm tra overlap.');
            return;
        }

        const newWorkStart = new Date(workHistoryData.fromDate);
        const newWorkEnd = new Date(workHistoryData.toDate);

        for (const oldHistory of existingHistories) {
            // âš ï¸ QUAN TRá»ŒNG: So sÃ¡nh vá»›i ngÃ y thá»±c táº¿ lÃ m viá»‡c, khÃ´ng pháº£i ngÃ y Ä‘á» xuáº¥t
            if (!oldHistory.fromDate || !oldHistory.toDate) {
                continue; // Skip náº¿u khÃ´ng cÃ³ thÃ´ng tin ngÃ y
            }

            const oldWorkStart = new Date(oldHistory.fromDate);
            const oldWorkEnd = new Date(oldHistory.toDate);

            // Kiá»ƒm tra overlap giá»¯a 2 khoáº£ng ngÃ y thá»±c táº¿ lÃ m viá»‡c
            if (dateRangesOverlap(newWorkStart, newWorkEnd, oldWorkStart, oldWorkEnd)) {
                const formattedNewStart = formatDate(workHistoryData.fromDate);
                const formattedNewEnd = formatDate(workHistoryData.toDate);
                const formattedOldStart = formatDate(oldHistory.fromDate);
                const formattedOldEnd = formatDate(oldHistory.toDate);

                throw new Error(`Khoáº£ng thá»i gian lÃ m viá»‡c tá»« ${formattedNewStart} Ä‘áº¿n ${formattedNewEnd} bá»‹ trÃ¹ng vá»›i lá»‹ch sá»­ lÃ m viá»‡c cÅ© (tá»« ${formattedOldStart} Ä‘áº¿n ${formattedOldEnd}, mÃ£ Ä‘á» xuáº¥t ${oldHistory.requestNo}).`);
            }
        }
        
        console.log('âœ… Kiá»ƒm tra trÃ¹ng láº·p ngÃ y thÃ nh cÃ´ng, khÃ´ng cÃ³ chá»“ng chÃ©o.');
    }




    // validateWorkHistoryFields(workHistoryData, recruitmentDetails) {
    //     const { fromDate, toDate, hourlyRate } = workHistoryData;
        
    //     if (!fromDate || !toDate) {
    //         throw new Error('Tá»« ngÃ y vÃ  Äáº¿n ngÃ y lÃ  báº¯t buá»™c.');
    //     }

    //     const fromDateObj = new Date(fromDate);
    //     const toDateObj = new Date(toDate);
        
    //     if (isNaN(fromDateObj.getTime()) || isNaN(toDateObj.getTime())) {
    //         throw new Error('Äá»‹nh dáº¡ng ngÃ y khÃ´ng há»£p lá»‡.');
    //     }

    //     if (toDateObj < fromDateObj) {
    //         throw new Error('Äáº¿n ngÃ y pháº£i lá»›n hÆ¡n hoáº·c báº±ng Tá»« ngÃ y.');
    //     }

    //     if (recruitmentDetails && recruitmentDetails.fromDate && recruitmentDetails.toDate) {
    //         const recruitmentStart = new Date(recruitmentDetails.fromDate);
    //         const recruitmentEnd = new Date(recruitmentDetails.toDate);

    //         if (fromDateObj < recruitmentStart || toDateObj > recruitmentEnd) {
    //             throw new Error(
    //                 `Khoáº£ng ngÃ y lÃ m viá»‡c (${formatDate(fromDate)} - ${formatDate(toDate)}) pháº£i náº±m trong khoáº£ng ngÃ y cá»§a Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng (${formatDate(recruitmentDetails.fromDate)} - ${formatDate(recruitmentDetails.toDate)}).`
    //             );
    //         }
    //     }

    //     if (hourlyRate !== undefined && (isNaN(hourlyRate) || hourlyRate < 0)) {
    //         throw new Error('Má»©c lÆ°Æ¡ng/giá» pháº£i lÃ  sá»‘ vÃ  khÃ´ng Ä‘Æ°á»£c Ã¢m.');
    //     }
    // }

    validateWorkHistoryFields(workHistoryData, recruitmentDetails) {
        const { fromDate, toDate, hourlyRate } = workHistoryData;
        
        if (!fromDate || !toDate) {
            throw new Error('Tá»« ngÃ y vÃ  Äáº¿n ngÃ y lÃ  báº¯t buá»™c.');
        }

        const fromDateObj = new Date(fromDate);
        const toDateObj = new Date(toDate);
        
        if (isNaN(fromDateObj.getTime()) || isNaN(toDateObj.getTime())) {
            throw new Error('Äá»‹nh dáº¡ng ngÃ y khÃ´ng há»£p lá»‡.');
        }

        if (toDateObj < fromDateObj) {
            throw new Error('Äáº¿n ngÃ y pháº£i lá»›n hÆ¡n hoáº·c báº±ng Tá»« ngÃ y.');
        }

        if (recruitmentDetails && recruitmentDetails.fromDate && recruitmentDetails.toDate) {
            const recruitmentStart = new Date(recruitmentDetails.fromDate);
            const recruitmentEnd = new Date(recruitmentDetails.toDate);

            // âœ… Sá»¬A: Normalize vá» Ä‘áº§u ngÃ y Ä‘á»ƒ trÃ¡nh lá»—i precision
            fromDateObj.setHours(0, 0, 0, 0);
            toDateObj.setHours(23, 59, 59, 999);  // Cuá»‘i ngÃ y Ä‘á»ƒ inclusive
            recruitmentStart.setHours(0, 0, 0, 0);
            recruitmentEnd.setHours(23, 59, 59, 999);

            if (fromDateObj < recruitmentStart || toDateObj > recruitmentEnd) {
                throw new Error(
                    `Khoáº£ng ngÃ y lÃ m viá»‡c (${formatDate(fromDate)} - ${formatDate(toDate)}) pháº£i náº±m trong khoáº£ng ngÃ y cá»§a Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng (${formatDate(recruitmentDetails.fromDate)} - ${formatDate(recruitmentDetails.toDate)}).`
                );
            }
        }

        if (hourlyRate !== undefined && (isNaN(hourlyRate) || hourlyRate < 0)) {
            throw new Error('Má»©c lÆ°Æ¡ng/giá» pháº£i lÃ  sá»‘ vÃ  khÃ´ng Ä‘Æ°á»£c Ã¢m.');
        }
    }




    async addWorkHistory(workHistoryData, recruitmentService) {
        try {
            const { employeeId, requestNo, fromDate, toDate, hourlyRate } = workHistoryData;

            console.log('ğŸ“¥ WORK HISTORY SERVICE: Processing new work history:', { employeeId, requestNo, fromDate, toDate, hourlyRate });

            const recruitmentDetails = await recruitmentService.getRequestByNo(requestNo);

            if (!recruitmentDetails) {
                throw new Error(`KhÃ´ng tÃ¬m tháº¥y Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng vá»›i mÃ£: ${requestNo}`);
            }

            this.validateWorkHistoryFields(workHistoryData, recruitmentDetails);
            //await this.validateWorkHistoryDateOverlap(employeeId, requestNo, recruitmentService);
            await this.validateWorkHistoryDateOverlap(employeeId, workHistoryData, recruitmentService);
            const transformedData = this.transformWorkHistoryForLark(workHistoryData);
            
            console.log('ğŸ“¤ WORK HISTORY SERVICE: Sending data to Lark:', transformedData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            console.log('ğŸ“¥ WORK HISTORY SERVICE: Raw Lark response:', response);

            // THÃŠM: Kiá»ƒm tra mÃ£ lá»—i tá»« Lark API
            if (response.code !== 0) {
                throw new Error(`Lá»—i tá»« Lark API khi thÃªm: ${response.msg} (code: ${response.code})`);
            }

            CacheService.delete('work_history_all');
            CacheService.delete('salary_data_all');

            return {
                success: true,
                ...workHistoryData,
                larkResponse: response
            };
            
        } catch (error) {
            console.error('âŒ WORK HISTORY SERVICE: Full error:', error);
            await this.handleError(error, 'addWorkHistory');
            throw error;
        }
    }


    async updateWorkHistory(id, workHistoryData) {
        try {
            const { employeeId, requestNo, fromDate, toDate, hourlyRate } = workHistoryData;

            console.log('ğŸ“ WORK HISTORY SERVICE: Updating work history:', { id, ...workHistoryData });

            const currentWorkHistory = await this.getWorkHistoryById(id);
            if (!currentWorkHistory) {
                throw new Error(`KhÃ´ng tÃ¬m tháº¥y lá»‹ch sá»­ cÃ´ng viá»‡c vá»›i ID: ${id}`);
            }

            if (!employeeId || !requestNo) {
                throw new Error('MÃ£ nhÃ¢n viÃªn vÃ  Request No. lÃ  báº¯t buá»™c');
            }

            // Sá»¬A: Loáº¡i bá» hoÃ n toÃ n viá»‡c ghi Ä‘Ã¨ vÃ o cÃ¡c trÆ°á»ng há»‡ thá»‘ng
            const transformedData = this.transformWorkHistoryForLark(workHistoryData);
            
            console.log('ğŸ“¤ WORK HISTORY SERVICE: Updating data in Lark:', transformedData);
            
            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`, {
                fields: transformedData
            });

            console.log('ğŸ“¥ WORK HISTORY SERVICE: Update response:', response);

            // THÃŠM: Kiá»ƒm tra mÃ£ lá»—i tá»« Lark API
            if (response.code !== 0) {
                throw new Error(`Lá»—i tá»« Lark API khi cáº­p nháº­t: ${response.msg} (code: ${response.code})`);
            }

            // XÃ³a cache Ä‘á»ƒ Ä‘áº£m báº£o dá»¯ liá»‡u Ä‘Æ°á»£c lÃ m má»›i
            CacheService.delete('work_history_all');
            CacheService.delete('salary_data_all');
            CacheService.clear(); // XÃ³a toÃ n bá»™ cache Ä‘á»ƒ an toÃ n

            return {
                success: true,
                id: id,
                ...workHistoryData,
                larkResponse: response
            };
            
        } catch (error) {
            console.error('âŒ WORK HISTORY SERVICE: Update error:', error);
            await this.handleError(error, 'updateWorkHistory');
            throw error;
        }
    }


    async deleteWorkHistory(id) {
        try {
            console.log('ğŸ—‘ï¸ WORK HISTORY SERVICE: Deleting work history:', id);

            const currentWorkHistory = await this.getWorkHistoryById(id);
            if (!currentWorkHistory) {
                throw new Error(`KhÃ´ng tÃ¬m tháº¥y lá»‹ch sá»­ cÃ´ng viá»‡c vá»›i ID: ${id}`);
            }

            const response = await LarkClient.delete(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`);
            
            // THÃŠM: Kiá»ƒm tra mÃ£ lá»—i tá»« Lark API
            if (response.code !== 0) {
                throw new Error(`Lá»—i tá»« Lark API khi xÃ³a: ${response.msg} (code: ${response.code})`);
            }

            console.log('âœ… WORK HISTORY SERVICE: Work history deleted successfully');

            CacheService.delete('work_history_all');
            CacheService.delete('salary_data_all');
            CacheService.clear();
            
            return {
                success: true,
                message: 'XÃ³a lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng'
            };
            
        } catch (error) {
            console.error('âŒ WORK HISTORY SERVICE: Delete error:', error);
            await this.handleError(error, 'deleteWorkHistory');
            throw error;
        }
    }

    // âœ… THÃŠM Má»šI: Method Ä‘á»ƒ xÃ³a táº¥t cáº£ work history cá»§a má»™t employee
    async deleteAllWorkHistoryByEmployee(employeeId) {
        try {
            console.log(`ğŸ—‘ï¸ Deleting all work history for employee: ${employeeId}`);
            
            // Láº¥y táº¥t cáº£ work history cá»§a employee
            const workHistories = await this.getWorkHistoryByEmployee(employeeId);
            
            if (workHistories.length === 0) {
                console.log('â„¹ï¸ No work history to delete for this employee');
                return { success: true, deletedCount: 0 };
            }
            
            // XÃ³a tá»«ng record
            const deletePromises = workHistories.map(wh => 
                this.deleteWorkHistory(wh.id)
            );
            
            const results = await Promise.allSettled(deletePromises);
            
            const successful = results.filter(r => r.status === 'fulfilled').length;
            const failed = results.filter(r => r.status === 'rejected').length;
            
            if (failed > 0) {
                throw new Error(`Failed to delete ${failed} out of ${workHistories.length} work history records`);
            }
            
            console.log(`âœ… Successfully deleted ${successful} work history records`);
            
            return {
                success: true,
                deletedCount: successful,
                originalCount: workHistories.length
            };
            
        } catch (error) {
            console.error('âŒ Error deleting work history by employee:', error);
            throw error;
        }
    }




    async getWorkHistoryById(id) {
        try {
            console.log('ğŸ” WORK HISTORY SERVICE: Getting work history by ID:', id);
            
            const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`);
            
            if (response.data && response.data.record) {
                const salaryData = await this.getSalaryData();
                return this.transformWorkHistoryDataWithSalary([response.data.record], salaryData)[0];
            }
            
            return null;
            
        } catch (error) {
            console.error('âŒ Error getting work history by ID:', error);
            return null;
        }
    }


    async getAllWorkHistory() {
        const cacheKey = 'work_history_all';
        let history = CacheService.get(cacheKey);

        if (history) {
            console.log(`âœ… WORK HISTORY: Loaded ${history.length} records from cache.`);
            return history;
        }

        try {
            console.log('ğŸ“¡ WORK HISTORY: Fetching all work history from Lark...');
            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`
            );

            const salaryData = await this.getSalaryData();
            history = this.transformWorkHistoryDataWithSalary(response.data?.items || [], salaryData);
            console.log(`âœ… WORK HISTORY: Transformed ${history.length} total records.`);

            CacheService.set(cacheKey, history, 300000);
            return history;
        } catch (error) {
            console.error('âŒ Error getting all work history:', error);
            return [];
        }
    }


    transformWorkHistoryData(larkData) {
        return larkData.map(record => ({
            id: record.record_id,
            employeeId: record.fields['MÃ£ nhÃ¢n viÃªn'] || '',
            requestNo: record.fields['Request No.'] || '',
            fromDate: record.fields['Tá»« ngÃ y'] || null,
            toDate: record.fields['Äáº¿n ngÃ y'] || null,
            hourlyRate: record.fields['Má»©c lÆ°Æ¡ng/giá»'] || null,
            // Sá»¬A: Láº¥y giÃ¡ trá»‹ thá»±c tá»« Lark, khÃ´ng tá»± táº¡o má»›i
            createdAt: record.fields['Created At'] || null,
            updatedAt: record.fields['Updated At'] || null
        }));
    }


    // transformWorkHistoryForLark(workHistoryData) {
    //     const larkData = {
    //         'MÃ£ nhÃ¢n viÃªn': workHistoryData.employeeId,
    //         'Request No.': workHistoryData.requestNo
    //     };

    //     if (workHistoryData.fromDate) {
    //         larkData['Tá»« ngÃ y'] = workHistoryData.fromDate;
    //     }

    //     if (workHistoryData.toDate) {
    //         larkData['Äáº¿n ngÃ y'] = workHistoryData.toDate;
    //     }

    //     if (workHistoryData.hourlyRate !== undefined && workHistoryData.hourlyRate !== null) {
    //         larkData['Má»©c lÆ°Æ¡ng/giá»'] = parseFloat(workHistoryData.hourlyRate);
    //     }

    //     return larkData;
    // }

    transformWorkHistoryForLark(workHistoryData) {
        const larkData = {
            'MÃ£ nhÃ¢n viÃªn': workHistoryData.employeeId,
            'Request No.': workHistoryData.requestNo
        };

        // âœ… Convert string date to timestamp
        if (workHistoryData.fromDate) {
            const fromDate = new Date(workHistoryData.fromDate);
            larkData['Tá»« ngÃ y'] = fromDate.getTime(); // Convert to timestamp
        }

        if (workHistoryData.toDate) {
            const toDate = new Date(workHistoryData.toDate);
            larkData['Äáº¿n ngÃ y'] = toDate.getTime(); // Convert to timestamp
        }

        if (workHistoryData.hourlyRate !== undefined && workHistoryData.hourlyRate !== null) {
            larkData['Má»©c lÆ°Æ¡ng/giá»'] = parseFloat(workHistoryData.hourlyRate);
        }

        return larkData;
    }



}


export default WorkHistoryService;

```


==================== File: .\server\services\master-data\index.js ====================

// Master data services exports
export { default as StoreService } from './store-service.js';
export { default as PositionService } from './position-service.js';
export { default as MasterDataValidator } from './master-data-validator.js';

```


==================== File: .\server\services\master-data\master-data-validator.js ====================

// Master data validation service
class MasterDataValidator {
    static validateStoreData(storeData) {
        const errors = [];

        // Required fields validation
        if (!storeData.storeName || storeData.storeName.trim().length < 2) {
            errors.push('TÃªn cá»­a hÃ ng pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±');
        }

        if (!storeData.address || storeData.address.trim().length < 5) {
            errors.push('Äá»‹a chá»‰ pháº£i cÃ³ Ã­t nháº¥t 5 kÃ½ tá»±');
        }

        // Status validation
        if (storeData.status && !['active', 'inactive'].includes(storeData.status)) {
            errors.push('Tráº¡ng thÃ¡i pháº£i lÃ  active hoáº·c inactive');
        }

        return errors;
    }

    static validatePositionData(positionData) {
        const errors = [];

        // Required fields validation
        if (!positionData.positionName || positionData.positionName.trim().length < 2) {
            errors.push('TÃªn vá»‹ trÃ­ pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±');
        }

        // Description validation (optional but if provided must be reasonable)
        if (positionData.description && positionData.description.trim().length < 3) {
            errors.push('MÃ´ táº£ pháº£i cÃ³ Ã­t nháº¥t 3 kÃ½ tá»± náº¿u Ä‘Æ°á»£c cung cáº¥p');
        }

        // Status validation
        if (positionData.status && !['active', 'inactive'].includes(positionData.status)) {
            errors.push('Tráº¡ng thÃ¡i pháº£i lÃ  active hoáº·c inactive');
        }

        return errors;
    }

    static validateMasterDataBatch(dataArray, type) {
        const errors = [];
        const names = [];

        dataArray.forEach((item, index) => {
            // Validate individual item
            let itemErrors = [];
            if (type === 'store') {
                itemErrors = this.validateStoreData(item);
            } else if (type === 'position') {
                itemErrors = this.validatePositionData(item);
            }

            if (itemErrors.length > 0) {
                errors.push(`Item ${index + 1}: ${itemErrors.join(', ')}`);
            }

            // Check for duplicate names
            const nameField = type === 'store' ? 'storeName' : 'positionName';
            if (item[nameField] && names.includes(item[nameField])) {
                errors.push(`Item ${index + 1}: TÃªn Ä‘Ã£ bá»‹ trÃ¹ng láº·p trong batch`);
            } else if (item[nameField]) {
                names.push(item[nameField]);
            }
        });

        return errors;
    }

    static sanitizeStoreData(storeData) {
        return {
            storeName: storeData.storeName?.trim() || '',
            address: storeData.address?.trim() || '',
            status: storeData.status || 'active',
            createdAt: storeData.createdAt || new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
    }

    static sanitizePositionData(positionData) {
        return {
            positionName: positionData.positionName?.trim() || '',
            description: positionData.description?.trim() || '',
            status: positionData.status || 'active',
            createdAt: positionData.createdAt || new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
    }
}

export default MasterDataValidator;

```


==================== File: .\server\services\master-data\position-service.js ====================

// Position management service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class PositionService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_POSITION_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Position Service...');
    }

    async getAllPositions() {
        const cacheKey = 'positions_all';
        let positions = CacheService.get(cacheKey);
        
        if (!positions) {
            try {
                const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
                positions = this.transformPositionData(response.data?.items || []);
                CacheService.set(cacheKey, positions, 300000); // 5 minutes
            } catch (error) {
                console.error('Error fetching positions from Lark:', error);
                positions = this.getMockPositions();
            }
        }
        
        return positions;
    }

    async addPosition(positionData) {
        try {
            const transformedData = this.transformPositionForLark(positionData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('positions_all');
            
            return this.transformPositionData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'addPosition');
            throw error;
        }
    }

    async updatePosition(id, positionData) {
        try {
            const transformedData = this.transformPositionForLark(positionData);
            
            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('positions_all');
            
            return this.transformPositionData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'updatePosition');
            throw error;
        }
    }

    async deletePosition(id) {
        try {
            await LarkClient.delete(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`);
            
            // Clear cache
            CacheService.delete('positions_all');
            
            return true;
        } catch (error) {
            await this.handleError(error, 'deletePosition');
            throw error;
        }
    }

    async getActivePositions() {
        const positions = await this.getAllPositions();
        return positions.filter(position => position.status === 'active');
    }

    async searchPositions(query) {
        const positions = await this.getAllPositions();
        
        if (!query) return positions;
        
        const searchTerm = query.toLowerCase();
        return positions.filter(position => 
            position.positionName.toLowerCase().includes(searchTerm) ||
            (position.description && position.description.toLowerCase().includes(searchTerm))
        );
    }

    transformPositionData(larkData) {
        return larkData.map(record => ({
            id: record.record_id,
            positionName: record.fields['Position Name'] || '',
            description: record.fields['Description'] || '',
            status: record.fields['Status'] || 'active',
            createdAt: record.fields['Created At'] || new Date().toISOString(),
            updatedAt: record.fields['Updated At'] || new Date().toISOString()
        }));
    }

    transformPositionForLark(positionData) {
        return {
            'Position Name': positionData.positionName,
            'Description': positionData.description || '',
            'Status': positionData.status || 'active',
            'Created At': positionData.createdAt || new Date().toISOString(),
            'Updated At': positionData.updatedAt || new Date().toISOString()
        };
    }

    getMockPositions() {
        return [
            {
                id: 'pos_001',
                positionName: 'NhÃ¢n viÃªn bÃ¡n hÃ ng',
                description: 'NhÃ¢n viÃªn bÃ¡n hÃ ng táº¡i cá»­a hÃ ng',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'pos_002',
                positionName: 'NhÃ¢n viÃªn kho',
                description: 'NhÃ¢n viÃªn quáº£n lÃ½ kho hÃ ng',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'pos_003',
                positionName: 'TrÆ°á»Ÿng ca',
                description: 'TrÆ°á»Ÿng ca quáº£n lÃ½ nhÃ¢n viÃªn',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            }
        ];
    }
}

export default PositionService;

```


==================== File: .\server\services\master-data\store-service.js ====================

// Store management service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class StoreService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_STORE_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Store Service...');
    }

    async getAllStores() {
        const cacheKey = 'stores_all';
        let stores = CacheService.get(cacheKey);
        
        if (!stores) {
            try {
                const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
                stores = this.transformStoreData(response.data?.items || []);
                CacheService.set(cacheKey, stores, 300000); // 5 minutes
            } catch (error) {
                console.error('Error fetching stores from Lark:', error);
                stores = this.getMockStores();
            }
        }
        
        return stores;
    }

    async addStore(storeData) {
        try {
            const transformedData = this.transformStoreForLark(storeData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('stores_all');
            
            return this.transformStoreData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'addStore');
            throw error;
        }
    }

    async updateStore(id, storeData) {
        try {
            const transformedData = this.transformStoreForLark(storeData);
            
            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('stores_all');
            
            return this.transformStoreData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'updateStore');
            throw error;
        }
    }

    async deleteStore(id) {
        try {
            await LarkClient.delete(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`);
            
            // Clear cache
            CacheService.delete('stores_all');
            
            return true;
        } catch (error) {
            await this.handleError(error, 'deleteStore');
            throw error;
        }
    }

    async getActiveStores() {
        const stores = await this.getAllStores();
        return stores.filter(store => store.status === 'active');
    }

    async searchStores(query) {
        const stores = await this.getAllStores();
        
        if (!query) return stores;
        
        const searchTerm = query.toLowerCase();
        return stores.filter(store => 
            store.storeName.toLowerCase().includes(searchTerm) ||
            store.address.toLowerCase().includes(searchTerm)
        );
    }

    transformStoreData(larkData) {
        return larkData.map(record => ({
            id: record.record_id,
            storeName: record.fields['Store Name'] || '',
            address: record.fields['Address'] || '',
            status: record.fields['Status'] || 'active',
            createdAt: record.fields['Created At'] || new Date().toISOString(),
            updatedAt: record.fields['Updated At'] || new Date().toISOString()
        }));
    }

    transformStoreForLark(storeData) {
        return {
            'Store Name': storeData.storeName,
            'Address': storeData.address,
            'Status': storeData.status || 'active',
            'Created At': storeData.createdAt || new Date().toISOString(),
            'Updated At': storeData.updatedAt || new Date().toISOString()
        };
    }

    getMockStores() {
        return [
            {
                id: 'store_001',
                storeName: '116 Cáº§u Giáº¥y',
                address: '116 Cáº§u Giáº¥y, HÃ  Ná»™i',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'store_002',
                storeName: 'TrÃ¢m Trá»—i',
                address: 'TrÃ¢m Trá»—i, HÃ  Ná»™i',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            }
        ];
    }
}

export default StoreService;

```


==================== File: .\server\services\recruitment\index.js ====================

// Recruitment services exports
export { default as RecruitmentService } from './recruitment-service.js';
export { default as RecruitmentValidator } from './recruitment-validator.js';

```


==================== File: .\server\services\recruitment\recruitment-service.js ====================

//hr-management-system\server\services\recruitment\recruitment-service.js

// Recruitment service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';
import larkServiceManager from '../lark-service-manager.js';
import { larkConfig } from '../../config/lark-config.js';

// **HÃ€M TIá»†N ÃCH Äá»ŠNH Dáº NG NGÃ€Y**
const formatDate = (dateValue) => {
    if (!dateValue) return null;
    const date = new Date(dateValue);
    if (isNaN(date.getTime())) return null;

    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
};

class RecruitmentService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_RECRUITMENT_TABLE_ID;
        this.hoursSummaryTableId = process.env.LARK_HOURS_SUMMARY_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Recruitment Service...');
    }


    async getRecruitmentRequests(filters = {}) {
        try {
            console.log('ğŸ“¡ RECRUITMENT: Fetching ALL recruitment requests from Lark...');
            
            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`
            );

            let requests = this.transformRecruitmentData(response.data?.items || []);
            console.log(`âœ… RECRUITMENT: Retrieved ${requests.length} total records from Lark`);
            
            // âœ… Sá»¬A: Filter á»Ÿ application level - chá»‰ láº¥y chÃ­nh xÃ¡c "Approved" vÃ  "Under Review"
            if (filters.status) {
                const statusArray = Array.isArray(filters.status) 
                    ? filters.status 
                    : filters.status.split(',').map(s => s.trim());
                
                console.log('ğŸ” RECRUITMENT: Filtering by status:', statusArray);
                
                requests = requests.filter(request => {
                    const requestStatus = request.status;
                    console.log(`ğŸ“ Checking: ${request.requestNo} - Status: "${requestStatus}"`);
                    
                    // âœ… ÄÆ N GIáº¢N: Chá»‰ kiá»ƒm tra exact match
                    return statusArray.includes(requestStatus);
                });
            }

            console.log(`âœ… RECRUITMENT: After filtering: ${requests.length} records`);
            return requests;
            
        } catch (error) {
            console.error('âŒ Error fetching recruitment requests:', error);
            throw error;
        }
    }



    async addRecruitmentRequest(requestData) {
        // Giá»¯ nguyÃªn logic
    }

    async updateRecruitmentRequest(id, requestData) {
        // Giá»¯ nguyÃªn logic
    }


    async getRequestByNo(requestNo) {
        console.log('ğŸ” RECRUITMENT: Searching for request number:', requestNo);

        const allRequests = await this.getRecruitmentRequests();
        
        if (!allRequests || allRequests.length === 0) {
            console.log('âš ï¸ RECRUITMENT: No requests found to search in.');
            return null;
        }

        // âœ… THAY Äá»”I: TÃ¬m Táº¤T Cáº¢ records cÃ³ cÃ¹ng requestNo
        const matchingRecords = allRequests.filter(record => {
            const requestValue = record.requestNo;
            return String(requestValue || '').trim() === String(requestNo).trim();
        });

        if (matchingRecords.length === 0) {
            console.log('ğŸ” RECRUITMENT: Search result: NOT_FOUND');
            return null;
        }

        // âœ… THÃŠM: Logic merge giá»‘ng Frontend
        if (matchingRecords.length === 1) {
            return matchingRecords[0];
        }

        // Merge multiple records
        const allFromDates = matchingRecords
            .map(r => r.fromDate)
            .filter(date => date && typeof date === 'number')
            .sort((a, b) => a - b);
            
        const allToDates = matchingRecords
            .map(r => r.toDate)
            .filter(date => date && typeof date === 'number') 
            .sort((a, b) => a - b);

        const minFromDate = allFromDates[0];
        const maxToDate = allToDates[allToDates.length - 1];

        // âœ… TRáº¢ Vá»€: Record Ä‘Ã£ merge
        const mergedRecord = {
            ...matchingRecords[0], // Base record
            fromDate: minFromDate,
            toDate: maxToDate,
            fromDateFormatted: this.formatDate(minFromDate),
            toDateFormatted: this.formatDate(maxToDate),
            originalRecordCount: matchingRecords.length
        };

        console.log('âœ… RECRUITMENT: Merged record:', {
            requestNo,
            fromDate: mergedRecord.fromDateFormatted,
            toDate: mergedRecord.toDateFormatted,
            recordCount: matchingRecords.length
        });

        return mergedRecord;
    }

    // âœ… THÃŠM: Helper method format ngÃ y
    formatDate(timestamp) {
        if (!timestamp || typeof timestamp !== 'number') return null;
        
        try {
            const date = new Date(timestamp);
            if (isNaN(date.getTime())) return null;
            
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        } catch (error) {
            console.error('Error formatting date:', error);
            return null;
        }
    }


    // âœ… THAY Äá»”I LOGIC Cá»T LÃ•I Táº I ÄÃ‚Y
    async getRecruitmentHoursSummary() {
        try {
            console.log('ğŸ“Š Getting recruitment hours summary with NEW logic...');

            // 1. Láº¥y táº¥t cáº£ recruitment requests
            const recruitmentRequests = await this.getRecruitmentRequests();
            console.log('ğŸ“‹ RECRUITMENT REQUESTS:', recruitmentRequests.length, 'requests found');

            // 2. Láº¥y services cáº§n thiáº¿t
            const employeeService = larkServiceManager.getService('employee');

            // 3. Láº¥y dá»¯ liá»‡u cáº§n thiáº¿t Ä‘á»ƒ mapping
            const allWorkHistory = await this.getAllWorkHistory();
            const allEmployees = await employeeService.getAllEmployees();
            console.log('ğŸ“š WORK HISTORY:', allWorkHistory.length, 'records');
            console.log('ğŸ‘¥ EMPLOYEES:', allEmployees.length, 'employees');

            // âœ… Cáº¬P NHáº¬T: Láº¥y cáº£ hours vÃ  salary maps
            const mapsResult = await this.getEmployeeHoursFromSummaryTable();
            const employeeHoursMap = mapsResult.hoursMap;
            const employeeSalaryMap = mapsResult.salaryMap;
            console.log('â° EMPLOYEE HOURS MAP:', employeeHoursMap.size, 'entries');
            console.log('ğŸ’° EMPLOYEE SALARY MAP:', employeeSalaryMap.size, 'entries');

            // 4. Táº¡o map Ä‘á»ƒ lookup nhanh
            const employeeMap = new Map(allEmployees.map(emp => [emp.employeeId, emp]));
            console.log('ğŸ‘¤ EMPLOYEE MAP:', employeeMap.size, 'entries');

            // âœ… THÃŠM: Group requests by requestNo Ä‘á»ƒ merge
            const groupedRequests = new Map();
            recruitmentRequests.forEach(request => {
                if (!groupedRequests.has(request.requestNo)) {
                    groupedRequests.set(request.requestNo, []);
                }
                groupedRequests.get(request.requestNo).push(request);
            });

            // 5. Xá»­ lÃ½ tá»«ng grouped recruitment request
            const hoursSummary = [];
            let totalCalculatedHours = 0;
            let totalCalculatedSalary = 0; // âœ… THÃŠM: Tracking tá»•ng lÆ°Æ¡ng

            // âœ… Cáº¬P NHáº¬T: Process theo grouped requests
            for (const [requestNo, requestGroup] of groupedRequests.entries()) {
                console.log(`\nğŸ”„ Processing merged request: ${requestNo} (${requestGroup.length} records)`);
                
                // âœ… MERGE: Láº¥y thÃ´ng tin tá»« record Ä‘áº§u tiÃªn, merge ngÃ y thÃ¡ng
                const baseRequest = requestGroup[0];
                const allFromDates = requestGroup
                    .map(r => r.fromDate)
                    .filter(date => date && typeof date === 'number')
                    .sort((a, b) => a - b);
                    
                const allToDates = requestGroup
                    .map(r => r.toDate)
                    .filter(date => date && typeof date === 'number')
                    .sort((a, b) => a - b);

                const minFromDate = allFromDates[0];
                const maxToDate = allToDates[allToDates.length - 1];

                const mergedRequest = {
                    ...baseRequest,
                    fromDate: minFromDate,
                    toDate: maxToDate,
                    fromDateFormatted: this.formatDate(minFromDate),
                    toDateFormatted: this.formatDate(maxToDate)
                };

                const requestSummary = await this.calculateRequestHours(
                    mergedRequest,
                    allWorkHistory,
                    employeeMap,
                    employeeHoursMap,
                    employeeSalaryMap // âœ… THÃŠM: Pass salary map
                );

                console.log(`ğŸ“Š Request ${requestNo} summary:`, {
                    totalEmployees: requestSummary.totalEmployees,
                    totalHoursNumeric: requestSummary.totalHoursNumeric,
                    totalSalaryNumeric: requestSummary.totalSalaryNumeric // âœ… THÃŠM
                });

                totalCalculatedHours += requestSummary.totalHoursNumeric;
                totalCalculatedSalary += requestSummary.totalSalaryNumeric; // âœ… THÃŠM

                if (requestSummary.employees.length > 0) {
                    hoursSummary.push(requestSummary);
                }
            }

            console.log(`\nğŸ“Š FINAL CALCULATION RESULT:`);
            console.log(`- Total requests: ${hoursSummary.length}`);
            console.log(`- Total hours: ${totalCalculatedHours}`);
            console.log(`- Total salary: ${totalCalculatedSalary}`); // âœ… THÃŠM

            return hoursSummary;

        } catch (error) {
            console.error('âŒ Error getting recruitment hours summary:', error);
            throw error;
        }
    }


    // âœ… HÃ€M Má»šI: Láº¥y dá»¯ liá»‡u tá»« báº£ng tá»•ng há»£p giá» cÃ´ng
    async getEmployeeHoursFromSummaryTable() {
        console.log('ğŸ“¡ Fetching data from hours summary table...');
        const cacheKey = 'hours_summary_table_data';
        let cachedData = CacheService.get(cacheKey);
        if (cachedData) {
            console.log('âœ… Loaded hours summary from cache.');
            console.log('ğŸ—‚ï¸ CACHED HOURS MAP:', Array.from(cachedData.hoursMap.entries()));
            console.log('ğŸ’° CACHED SALARY MAP:', Array.from(cachedData.salaryMap.entries()));
            return cachedData;
        }

        try {
            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${this.baseId}/tables/${this.hoursSummaryTableId}/records`
            );
            const records = response.data?.items || [];
            console.log('ğŸ“„ RAW HOURS SUMMARY RECORDS:', records.length, 'records');

            const employeeHoursMap = new Map();
            const employeeSalaryMap = new Map();
            const employeeHourlyRateMap = new Map();

            records.forEach((record, index) => {
                const fields = record.fields;
                console.log(`\nğŸ“ Record #${index + 1} FULL FIELDS:`, fields);
                
                const employeeIdField = fields['MÃ£ nhÃ¢n viÃªn'];
                console.log(`Record #${index + 1} - MÃ£ nhÃ¢n viÃªn:`, employeeIdField, '| Type:', typeof employeeIdField);
                
                let employeeId = '';
                if (Array.isArray(employeeIdField) && employeeIdField.length > 0) {
                    employeeId = employeeIdField[0]?.text;
                } else if (typeof employeeIdField === 'string') {
                    employeeId = employeeIdField;
                }

                const totalHours = fields['Tá»•ng sá»‘ giá» lÃ m'] || 0;
                // âœ… THÃŠM: Láº¥y cá»™t lÆ°Æ¡ng vá»›i nhiá»u tÃªn cÃ³ thá»ƒ
                const salary = fields['LÆ°Æ¡ng'] || 0;
                const hourlyRate = fields['Má»©c lÆ°Æ¡ng/giá»'] || 0;
                console.log(`ğŸ“Š Record #${index + 1} - Employee: "${employeeId}", Hours: ${totalHours}, Salary: ${salary}`);

                if (employeeId) {
                    // âœ… Cá»˜NG Dá»’N GIá»œ CÃ”NG
                    const currentHours = employeeHoursMap.get(employeeId) || 0;
                    const newTotalHours = currentHours + totalHours;
                    employeeHoursMap.set(employeeId, newTotalHours);
                    
                    // âœ… THÃŠM: Cá»˜NG Dá»’N LÆ¯Æ NG
                    const currentSalary = employeeSalaryMap.get(employeeId) || 0;
                    const newTotalSalary = currentSalary + salary;
                    employeeSalaryMap.set(employeeId, newTotalSalary);
                    
                    // âœ… THÃŠM: LÆ°u hourly rate náº¿u cÃ³
                    if (hourlyRate > 0) {
                        employeeHourlyRateMap.set(employeeId, hourlyRate);
                    }

                    console.log(`âœ… Updated: "${employeeId}" -> Hours: ${currentHours} + ${totalHours} = ${newTotalHours}, Salary: ${currentSalary} + ${salary} = ${newTotalSalary}`);
                } else {
                    console.log(`âš ï¸ Skipped record #${index + 1} - No valid employeeId`);
                }
            });

            console.log(`\nğŸ—ºï¸ FINAL EMPLOYEE HOURS MAP:`, Array.from(employeeHoursMap.entries()));
            console.log(`ğŸ’° FINAL EMPLOYEE SALARY MAP:`, Array.from(employeeSalaryMap.entries()));
            
            // âœ… THAY Äá»”I: Tráº£ vá» object chá»©a cáº£ hours vÃ  salary maps
            const result = {
                hoursMap: employeeHoursMap,
                salaryMap: employeeSalaryMap,
                hourlyRateMap: employeeHourlyRateMap
                
            };
            
            CacheService.set(cacheKey, result, 300000);
            console.log(`âœ… Created maps - Hours: ${employeeHoursMap.size}, Salary: ${employeeSalaryMap.size} entries.`);
            return result;
        } catch (error) {
            console.error('âŒ Error fetching from hours summary table:', error);
            return {
                hoursMap: new Map(),
                salaryMap: new Map(),
                hourlyRateMap: new Map()
            };
        }
    }



    // âœ… HÃ€M ÄÆ¯á»¢C Cáº¬P NHáº¬T: Thay Ä‘á»•i logic tÃ­nh toÃ¡n
    async calculateRequestHours(request, allWorkHistory, employeeMap, employeeHoursMap, employeeSalaryMap) {
        console.log(`\nğŸ” CALCULATING for REQUEST: ${request.requestNo}`);
        
        const requestEmployees = allWorkHistory.filter(wh => wh.requestNo === request.requestNo);
        
        // âœ… THÃŠM: Äáº¿m unique employees
        const uniqueEmployeeIds = [...new Set(requestEmployees.map(re => re.employeeId))];
        console.log(`ğŸ‘¥ Found ${uniqueEmployeeIds.length} UNIQUE employees for request ${request.requestNo}`);

        const employeeDetails = [];
        let totalRequestHours = 0;
        let totalRequestSalary = 0; // âœ… THÃŠM

        for (const employeeId of uniqueEmployeeIds) {
            const employee = employeeMap.get(employeeId);
            if (!employee) {
                console.log(`âŒ Employee not found: ${employeeId}`);
                continue;
            }

            const totalHoursNumeric = employeeHoursMap.get(employeeId) || 0;
            const totalSalaryNumeric = employeeSalaryMap.get(employeeId) || 0; // âœ… THÃŠM

            totalRequestHours += totalHoursNumeric;
            totalRequestSalary += totalSalaryNumeric; // âœ… THÃŠM

            employeeDetails.push({
                employeeId: employeeId,
                fullName: employee.fullName,
                totalHours: this.formatHoursDisplay(totalHoursNumeric),
                totalHoursNumeric: totalHoursNumeric,
                totalSalary: this.formatCurrency(totalSalaryNumeric), // âœ… THÃŠM
                totalSalaryNumeric: totalSalaryNumeric // âœ… THÃŠM
            });
        }

        return {
            requestNo: request.requestNo,
            department: request.department,
            status: request.status,
            fromDate: request.fromDateFormatted,
            toDate: request.toDateFormatted,
            totalEmployees: uniqueEmployeeIds.length, // âœ… Sá»¬A: DÃ¹ng unique count
            totalHours: this.formatHoursDisplay(totalRequestHours),
            totalHoursNumeric: totalRequestHours,
            totalSalary: this.formatCurrency(totalRequestSalary), // âœ… THÃŠM
            totalSalaryNumeric: totalRequestSalary, // âœ… THÃŠM
            employees: employeeDetails
        };
    }


    async getDetailedHoursForRequest(requestNo) {
        try {
            console.log(`ğŸ“Š Getting detailed hours for request: ${requestNo}`);
            
            // Láº¥y chi tiáº¿t tá»« báº£ng Hours Summary (tblV2dGhT2O7w30b)
            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${this.baseId}/tables/${this.hoursSummaryTableId}/records`
            );
            
            const allRecords = response.data?.items || [];
            console.log(`ğŸ“„ Found ${allRecords.length} total records in hours summary table`);
        

            // Láº¥y danh sÃ¡ch nhÃ¢n viÃªn thuá»™c request nÃ y tá»« Work History
            const workHistoryService = larkServiceManager.getService('workHistory');
            const workHistoryRecords = await workHistoryService.getAllWorkHistory(); // Cáº§n thÃªm method nÃ y
            
            const employeesInRequest = workHistoryRecords
                .filter(wh => wh.requestNo === requestNo)
                .map(wh => wh.employeeId);
                
            console.log(`ğŸ‘¥ Employees in request ${requestNo}:`, employeesInRequest);
            
            // Lá»c vÃ  transform dá»¯ liá»‡u
            const detailedRecords = [];
            
            allRecords.forEach(record => {
                const fields = record.fields;
                
                // Láº¥y mÃ£ nhÃ¢n viÃªn
                const employeeIdField = fields['MÃ£ nhÃ¢n viÃªn'];
                let employeeId = '';
                if (Array.isArray(employeeIdField) && employeeIdField.length > 0) {
                    employeeId = employeeIdField[0]?.text;
                } else if (typeof employeeIdField === 'string') {
                    employeeId = employeeIdField;
                }
                
                // Chá»‰ láº¥y báº£n ghi cá»§a nhÃ¢n viÃªn thuá»™c request nÃ y
                if (employeesInRequest.includes(employeeId)) {
                    detailedRecords.push({
                        employeeId: employeeId,
                        workDate: this.formatLarkDate(fields['NgÃ y cháº¥m cÃ´ng']),
                        //checkInTime: this.formatLarkTime(fields['Thá»i gian cháº¥m cÃ´ng vÃ o']),
                        checkInTime: fields['Thá»i gian cháº¥m cÃ´ng vÃ o'],
                        //checkOutTime: this.formatLarkTime(fields['Thá»i gian cháº¥m cÃ´ng ra']),
                        checkOutTime: fields['Thá»i gian cháº¥m cÃ´ng ra'],
                        totalHours: fields['Tá»•ng sá»‘ giá» lÃ m'] || 0,
                        requestNo: requestNo
                    });
                }
            });
            
            console.log(`âœ… Retrieved ${detailedRecords.length} detailed records for request ${requestNo}`);
            return detailedRecords;
            
        } catch (error) {
            console.error('âŒ Error getting detailed hours for request:', error);
            throw error;
        }
    }

    // âœ… THÃŠM: Method format tiá»n tá»‡ VNÄ
    formatCurrency(amount) {
        if (!amount || amount === 0) return '0 â‚«';
        try {
            return new Intl.NumberFormat('vi-VN', { 
                style: 'currency', 
                currency: 'VND',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        } catch (error) {
            console.error('Error formatting currency:', error);
            return `${amount.toLocaleString('vi-VN')} â‚«`;
        }
    }

    formatLarkDate(dateValue) {
        if (!dateValue) return '';
        
        try {
            let date;
            
            // Náº¿u lÃ  timestamp (number)
            if (typeof dateValue === 'number') {
                date = new Date(dateValue);
            } 
            // Náº¿u lÃ  string ISO
            else if (typeof dateValue === 'string') {
                date = new Date(dateValue);
            }
            // Náº¿u Ä‘Ã£ lÃ  Date object
            else if (dateValue instanceof Date) {
                date = dateValue;
            }
            else {
                return 'Invalid Date';
            }
            
            // Kiá»ƒm tra tÃ­nh há»£p lá»‡ cá»§a date
            if (isNaN(date.getTime())) {
                return 'Invalid Date';
            }
            
            // Format thÃ nh DD/MM/YYYY
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            
            return `${day}/${month}/${year}`;
        } catch (error) {
            console.error('Error formatting Lark date:', error);
            return 'Format Error';
        }
    }

    formatLarkTime(timeValue) {
        if (!timeValue) return '';
        
        try {
            let date;
            
            // Náº¿u lÃ  timestamp (number)
            if (typeof timeValue === 'number') {
                date = new Date(timeValue);
            }
            // Náº¿u lÃ  string ISO
            else if (typeof timeValue === 'string') {
                date = new Date(timeValue);
            }
            // Náº¿u Ä‘Ã£ lÃ  Date object
            else if (timeValue instanceof Date) {
                date = timeValue;
            }
            else {
                return 'Invalid Time';
            }
            
            // Kiá»ƒm tra tÃ­nh há»£p lá»‡ cá»§a date
            if (isNaN(date.getTime())) {
                return 'Invalid Time';
            }
            
            // Format thÃ nh HH:MM
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${hours}:${minutes}`;
        } catch (error) {
            console.error('Error formatting Lark time:', error);
            return 'Format Error';
        }
    }


    async getAllWorkHistory() {
        const cacheKey = 'work_history_all';
        let history = CacheService.get(cacheKey);

        if (history) {
            console.log(`âœ… WORK HISTORY: Loaded ${history.length} records from cache.`);
            return history;
        }

        try {
            console.log('ğŸ“¡ WORK HISTORY: Fetching all work history from Lark...');
            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${process.env.LARK_BASE_ID}/tables/${process.env.LARK_WORK_HISTORY_TABLE_ID}/records`
            );

            history = this.transformWorkHistoryData(response.data?.items || []);
            console.log(`âœ… WORK HISTORY: Transformed ${history.length} total records.`);

            CacheService.set(cacheKey, history, 300000);
            return history;
        } catch (error) {
            console.error('âŒ Error getting all work history:', error);
            return [];
        }
    }

    transformWorkHistoryData(larkData) {
        return larkData.map(record => ({
            id: record.record_id,
            employeeId: record.fields['MÃ£ nhÃ¢n viÃªn'] || '',
            requestNo: record.fields['Request No.'] || ''
        }));
    }

    transformRecruitmentData(larkData) {
        return larkData.map(record => ({
            id: record.record_id,
            requestNo: this.extractRequestNo(record.fields['Request No.']),
            requester: this.extractRequesterName(record.fields['Requester']),
            status: record.fields['Status'] || '',
            department: record.fields['Details_PhÃ²ng ban'] || record.fields['Department'] || '',
            quantity: record.fields['Details_Sá»‘ lÆ°á»£ng cáº§n tuyá»ƒn'] || record.fields['Quantity'] || '',
            gender: record.fields['Details_Giá»›i tÃ­nh'] || record.fields['Gender'] || '',
            fromDate: record.fields['Details_Tá»« ngÃ y'] || record.fields['From Date'] || '',
            toDate: record.fields['Details_Äáº¿n ngÃ y'] || record.fields['To Date'] || '',
            fromDateFormatted: formatDate(record.fields['Details_Tá»« ngÃ y'] || record.fields['From Date'] || ''),
            toDateFormatted: formatDate(record.fields['Details_Äáº¿n ngÃ y'] || record.fields['To Date'] || ''),
            position: record.fields['Details_Vá»‹ trÃ­'] || record.fields['Position'] || '',
            approvalStatus: record.fields['Status'] || ''
        }));
    }

    extractRequestNo(requestNoData) {
        if (!requestNoData) return '';
        if (typeof requestNoData === 'object' && requestNoData.text) {
            return requestNoData.text;
        }
        if (typeof requestNoData === 'string') {
            return requestNoData;
        }
        return requestNoData.toString();
    }

    extractRequesterName(requesterData) {
        if (!requesterData) return '';
        if (Array.isArray(requesterData)) {
            return requesterData.map(user => user.name || user.en_name || user.id || 'Unknown').join(', ');
        }
        if (typeof requesterData === 'object') {
            return requesterData.name || requesterData.en_name || requesterData.id || 'Unknown';
        }
        return requesterData.toString();
    }

    transformRecruitmentForLark(requestData) {
        return {
            'Request No': requestData.requestNo,
            'Requester': requestData.requester,
            'Status': requestData.status,
            'Department': requestData.department,
            'Quantity': requestData.quantity,
            'Gender': requestData.gender,
            'From Date': requestData.fromDate,
            'To Date': requestData.toDate,
            'Approval Status': requestData.approvalStatus || 'pending',
            'Created At': requestData.createdAt || new Date().toISOString()
        };
    }

    formatHoursDisplay(totalHours) {
        if (!totalHours || totalHours === 0) return '0 giá»';

        const hours = Math.floor(totalHours);
        const minutes = Math.round((totalHours - hours) * 60);

        if (minutes === 0) {
            return `${hours} giá»`;
        } else if (hours === 0) {
            return `${minutes} phÃºt`;
        } else {
            return `${hours} giá» ${minutes} phÃºt`;
        }
    }
}

export default RecruitmentService;

```


==================== File: .\server\services\recruitment\recruitment-validator.js ====================

// Recruitment validation service
class RecruitmentValidator {
    static validateRecruitmentData(requestData) {
        const errors = [];

        // Required fields validation
        if (!requestData.requestNo) {
            errors.push('Request No lÃ  báº¯t buá»™c');
        }

        if (!requestData.requester) {
            errors.push('Requester lÃ  báº¯t buá»™c');
        }

        if (!requestData.department) {
            errors.push('Department lÃ  báº¯t buá»™c');
        }

        if (!requestData.quantity || requestData.quantity <= 0) {
            errors.push('Quantity pháº£i lá»›n hÆ¡n 0');
        }

        if (!requestData.gender) {
            errors.push('Gender lÃ  báº¯t buá»™c');
        }

        if (!requestData.fromDate) {
            errors.push('From Date lÃ  báº¯t buá»™c');
        } else if (!this.isValidDate(requestData.fromDate)) {
            errors.push('From Date khÃ´ng há»£p lá»‡');
        }

        if (!requestData.toDate) {
            errors.push('To Date lÃ  báº¯t buá»™c');
        } else if (!this.isValidDate(requestData.toDate)) {
            errors.push('To Date khÃ´ng há»£p lá»‡');
        }

        // Check if toDate is after fromDate
        if (requestData.fromDate && requestData.toDate) {
            if (!this.isToDateAfterFromDate(requestData.fromDate, requestData.toDate)) {
                errors.push('To Date pháº£i sau From Date');
            }
        }

        return errors;
    }

    static isValidDate(dateString) {
        const date = new Date(dateString);
        return date instanceof Date && !isNaN(date);
    }

    static isToDateAfterFromDate(fromDate, toDate) {
        const from = new Date(fromDate);
        const to = new Date(toDate);
        return to >= from;
    }
}

export default RecruitmentValidator;

```


==================== File: .\server\services\utils\error-handler.js ====================

// Centralized error handling utilities
import ResponseFormatter from './response-formatter.js';

class ErrorHandler {
    static handleLarkError(error) {
        if (error.response?.data?.code) {
            const larkCode = error.response.data.code;
            const larkMessage = error.response.data.msg || 'Lark API Error';
            
            switch (larkCode) {
                case 99991663:
                    return ResponseFormatter.formatError('App access token invalid', 'LARK_AUTH_ERROR');
                case 99991664:
                    return ResponseFormatter.formatError('Tenant access token invalid', 'LARK_AUTH_ERROR');
                case 99991665:
                    return ResponseFormatter.formatError('User access token invalid', 'LARK_AUTH_ERROR');
                case 230002:
                    return ResponseFormatter.formatError('Base not found', 'LARK_BASE_NOT_FOUND');
                case 230003:
                    return ResponseFormatter.formatError('Table not found', 'LARK_TABLE_NOT_FOUND');
                case 230004:
                    return ResponseFormatter.formatError('Record not found', 'LARK_RECORD_NOT_FOUND');
                case 1254006:
                    return ResponseFormatter.formatError('Rate limit exceeded', 'LARK_RATE_LIMIT');
                default:
                    return ResponseFormatter.formatError(`Lark API Error: ${larkMessage}`, 'LARK_API_ERROR');
            }
        }
        
        return ResponseFormatter.formatError('Unknown Lark API error', 'LARK_UNKNOWN_ERROR');
    }

    static handleValidationError(errors) {
        const message = Array.isArray(errors) ? errors.join(', ') : errors;
        return ResponseFormatter.formatError(message, 'VALIDATION_ERROR');
    }

    static handleDatabaseError(error) {
        console.error('Database error:', error);
        
        if (error.code === 'ECONNREFUSED') {
            return ResponseFormatter.formatError('Database connection failed', 'DATABASE_CONNECTION_ERROR');
        }
        
        if (error.code === 'ER_DUP_ENTRY') {
            return ResponseFormatter.formatError('Duplicate entry', 'DUPLICATE_ENTRY');
        }
        
        return ResponseFormatter.formatError('Database operation failed', 'DATABASE_ERROR');
    }

    static handleNetworkError(error) {
        console.error('Network error:', error);
        
        if (error.code === 'ENOTFOUND') {
            return ResponseFormatter.formatError('Service not found', 'SERVICE_NOT_FOUND');
        }
        
        if (error.code === 'ECONNRESET') {
            return ResponseFormatter.formatError('Connection reset', 'CONNECTION_RESET');
        }
        
        if (error.code === 'ETIMEDOUT') {
            return ResponseFormatter.formatError('Request timeout', 'REQUEST_TIMEOUT');
        }
        
        return ResponseFormatter.formatError('Network error', 'NETWORK_ERROR');
    }

    static handleGenericError(error, operation = 'operation') {
        console.error(`Error in ${operation}:`, error);
        
        // Check for specific error types
        if (error.isAxiosError) {
            if (error.response?.status === 401) {
                return ResponseFormatter.formatUnauthorized('Authentication required');
            }
            
            if (error.response?.status === 403) {
                return ResponseFormatter.formatForbidden('Access forbidden');
            }
            
            if (error.response?.status === 404) {
                return ResponseFormatter.formatNotFound('Resource');
            }
            
            if (error.response?.status >= 500) {
                return ResponseFormatter.formatServerError('External service error');
            }
            
            return this.handleLarkError(error);
        }
        
        // Check for validation errors
        if (error.name === 'ValidationError') {
            return this.handleValidationError(error.message);
        }
        
        // Check for database errors
        if (error.code && error.code.startsWith('ER_')) {
            return this.handleDatabaseError(error);
        }
        
        // Check for network errors
        if (error.code && ['ENOTFOUND', 'ECONNRESET', 'ETIMEDOUT'].includes(error.code)) {
            return this.handleNetworkError(error);
        }
        
        // Default generic error
        return ResponseFormatter.formatServerError(`Error in ${operation}: ${error.message}`);
    }

    static async wrapAsync(fn, operation = 'operation') {
        try {
            return await fn();
        } catch (error) {
            throw this.handleGenericError(error, operation);
        }
    }

    static logError(error, context = {}) {
        const errorInfo = {
            message: error.message,
            stack: error.stack,
            context,
            timestamp: new Date().toISOString()
        };
        
        console.error('Error logged:', JSON.stringify(errorInfo, null, 2));
        
        // In production, you might want to send this to a logging service
        // like Winston, Sentry, or CloudWatch
    }
}

export default ErrorHandler;

```


==================== File: .\server\services\utils\index.js ====================

// Utilities services exports
export { default as ResponseFormatter, formatResponse } from './response-formatter.js';
export { default as ServiceFactory } from './service-factory.js';
export { default as ErrorHandler } from './error-handler.js';

// Re-export commonly used functions
export {
    getEmployeeService,
    getWorkHistoryService,
    getAttendanceService,
    getRecruitmentService,
    getStoreService,
    getPositionService,
    getAuthService,
    getSessionService
} from './service-factory.js';

```


==================== File: .\server\services\utils\response-formatter.js ====================

// Response formatting utilities
class ResponseFormatter {
    static formatResponse(success, message, data = null, errorCode = null) {
        const response = {
            success,
            message,
            timestamp: new Date().toISOString()
        };

        if (success && data) {
            response.data = data;
        }

        if (!success && errorCode) {
            response.errorCode = errorCode;
        }

        return response;
    }

    static formatSuccess(message, data = null) {
        return this.formatResponse(true, message, data);
    }

    static formatError(message, errorCode = null) {
        return this.formatResponse(false, message, null, errorCode);
    }

    static formatValidationError(errors) {
        return this.formatResponse(false, 'Validation failed', null, 'VALIDATION_ERROR');
    }

    static formatNotFound(resource) {
        return this.formatResponse(false, `${resource} not found`, null, 'NOT_FOUND');
    }

    static formatUnauthorized(message = 'Unauthorized access') {
        return this.formatResponse(false, message, null, 'UNAUTHORIZED');
    }

    static formatForbidden(message = 'Forbidden access') {
        return this.formatResponse(false, message, null, 'FORBIDDEN');
    }

    static formatServerError(message = 'Internal server error') {
        return this.formatResponse(false, message, null, 'SERVER_ERROR');
    }

    static formatPaginatedResponse(data, pagination) {
        return this.formatResponse(true, 'Success', {
            items: data,
            pagination: {
                page: pagination.page || 1,
                limit: pagination.limit || 10,
                total: pagination.total || 0,
                pages: Math.ceil((pagination.total || 0) / (pagination.limit || 10))
            }
        });
    }

    static formatBatchResponse(results) {
        const successCount = results.filter(r => r.success).length;
        const failureCount = results.length - successCount;

        return this.formatResponse(
            failureCount === 0,
            `Batch operation completed: ${successCount} successful, ${failureCount} failed`,
            {
                results,
                summary: {
                    total: results.length,
                    successful: successCount,
                    failed: failureCount
                }
            }
        );
    }
}

// Legacy function for backward compatibility
export function formatResponse(success, message, data = null, errorCode = null) {
    return ResponseFormatter.formatResponse(success, message, data, errorCode);
}

export default ResponseFormatter;

```


==================== File: .\server\services\utils\service-factory.js ====================

// Service factory for dependency injection
import { EmployeeService } from '../employee/index.js';
import { WorkHistoryService } from '../employee/index.js';
import { AttendanceService } from '../attendance/index.js';
import { RecruitmentService } from '../recruitment/index.js';
import { StoreService, PositionService } from '../master-data/index.js';
import { AuthService, SessionService } from '../auth/index.js';

class ServiceFactory {
    constructor() {
        this.services = new Map();
        this.singletons = new Map();
    }

    // Register a service class
    register(name, ServiceClass, singleton = true) {
        this.services.set(name, { ServiceClass, singleton });
    }

    // Get service instance
    get(name) {
        const serviceConfig = this.services.get(name);
        if (!serviceConfig) {
            throw new Error(`Service '${name}' not found`);
        }

        const { ServiceClass, singleton } = serviceConfig;

        if (singleton) {
            if (!this.singletons.has(name)) {
                this.singletons.set(name, new ServiceClass());
            }
            return this.singletons.get(name);
        }

        return new ServiceClass();
    }

    // Initialize all services
    async initialize() {
        for (const [name, config] of this.services.entries()) {
            const service = this.get(name);
            if (service.init && typeof service.init === 'function') {
                await service.init();
            }
        }
    }

    // Clear all singleton instances
    clear() {
        this.singletons.clear();
    }

    // Get all service names
    getServiceNames() {
        return Array.from(this.services.keys());
    }

    // Check if service exists
    has(name) {
        return this.services.has(name);
    }
}

// Create and configure the global service factory
const serviceFactory = new ServiceFactory();

// Register core services
serviceFactory.register('employee', EmployeeService, true);
serviceFactory.register('workHistory', WorkHistoryService, true);
serviceFactory.register('attendance', AttendanceService, true);
serviceFactory.register('recruitment', RecruitmentService, true);
serviceFactory.register('store', StoreService, true);
serviceFactory.register('position', PositionService, true);
serviceFactory.register('auth', AuthService, true);
serviceFactory.register('session', SessionService, true);

// Helper functions for common service access
export const getEmployeeService = () => serviceFactory.get('employee');
export const getWorkHistoryService = () => serviceFactory.get('workHistory');
export const getAttendanceService = () => serviceFactory.get('attendance');
export const getRecruitmentService = () => serviceFactory.get('recruitment');
export const getStoreService = () => serviceFactory.get('store');
export const getPositionService = () => serviceFactory.get('position');
export const getAuthService = () => serviceFactory.get('auth');
export const getSessionService = () => serviceFactory.get('session');

export default serviceFactory;

```


==================== File: .\src\App.jsx ====================

import React, { useEffect, useState } from 'react';
import { Routes, Route, Navigate, useLocation } from 'react-router-dom';
import { useAuth } from './hooks/useAuth';
import { useNotification } from './hooks/useNotification';

// Components - ThÃ nh pháº§n giao diá»‡n
import Layout from './components/layout/Layout';
import Loading from './components/common/Loading';
import ProtectedRoute from './components/auth/ProtectedRoute';

// Pages - CÃ¡c trang chÃ­nh
import LoginPage from './pages/LoginPage';
import EmployeeManagementPage from './pages/EmployeeManagementPage';
import AttendanceLogsPage from './pages/AttendanceLogsPage';
import HRDashboardPage from './pages/HRDashboardPage';

// Global styles - Styles toÃ n cá»¥c
import './styles/globals.css';

const App = () => {
  const [loading, setLoading] = useState(true);
  const [initialized, setInitialized] = useState(false);
  const { user, checkAuth, loading: authLoading } = useAuth();
  const { showNotification } = useNotification();
  const location = useLocation();

  useEffect(() => {
    const initializeApp = async () => {
      try {
        console.log('ğŸš€ Báº¯t Ä‘áº§u khá»Ÿi táº¡o á»©ng dá»¥ng React...');
        
        initializeGlobalUtilities();
        
        if (isProtectedPage()) {
          console.log('ğŸ” Äang kiá»ƒm tra xÃ¡c thá»±c...');
          const authUser = await checkAuth();
          if (!authUser && !isPublicPage()) {
            console.log('âŒ XÃ¡c thá»±c tháº¥t báº¡i cho trang Ä‘Æ°á»£c báº£o vá»‡');
            return;
          }
          console.log('âœ… HoÃ n thÃ nh kiá»ƒm tra xÃ¡c thá»±c');
        }
        
        setInitialized(true);
        console.log('âœ… Khá»Ÿi táº¡o á»©ng dá»¥ng React thÃ nh cÃ´ng');
        
      } catch (error) {
        console.error('âŒ Lá»—i khá»Ÿi táº¡o á»©ng dá»¥ng:', error);
        
        if (error.name === 'TypeError') {
          showNotification('Lá»—i táº£i module. Vui lÃ²ng refresh trang.', 'error');
        } else if (error.message.includes('fetch')) {
          showNotification('Lá»—i káº¿t ná»‘i server. Vui lÃ²ng kiá»ƒm tra máº¡ng.', 'error');
        } else {
          showNotification('Lá»—i khá»Ÿi táº¡o á»©ng dá»¥ng. Vui lÃ²ng refresh trang.', 'error');
        }
      } finally {
        setLoading(false);
      }
    };

    initializeApp();
  }, []);

  const initializeGlobalUtilities = () => {
    try {
      if (typeof window.bootstrap !== 'undefined') {
        const tooltipTriggerList = [].slice.call(
          document.querySelectorAll('[data-bs-toggle="tooltip"]')
        );
        tooltipTriggerList.map(tooltipTriggerEl => {
          return new window.bootstrap.Tooltip(tooltipTriggerEl);
        });
      }
    } catch (error) {
      console.warn('Lá»—i khá»Ÿi táº¡o tooltips:', error);
    }
  };

  const isProtectedPage = () => {
    const publicPaths = ['/', '/login'];
    return !publicPaths.includes(location.pathname);
  };

  const isPublicPage = () => {
    const publicPaths = ['/', '/login'];
    return publicPaths.includes(location.pathname);
  };

  // Helper function Ä‘á»ƒ redirect theo role
  const getDefaultRedirectPath = (userRole) => {
    if (userRole === 'sales') {
      return '/attendance-logs';
    } else {
      return '/employee-management';
    }
  };

  if (loading || authLoading) {
    return (
      <div className="d-flex justify-content-center align-items-center min-vh-100">
        <Loading />
      </div>
    );
  }

  if (!initialized) {
    return (
      <div className="container mt-5">
        <div className="alert alert-danger">
          <h4>Lá»—i khá»Ÿi táº¡o á»©ng dá»¥ng</h4>
          <p>KhÃ´ng thá»ƒ khá»Ÿi táº¡o á»©ng dá»¥ng. Vui lÃ²ng:</p>
          <ul>
            <li>Refresh láº¡i trang (F5)</li>
            <li>Kiá»ƒm tra káº¿t ná»‘i máº¡ng</li>
            <li>LiÃªn há»‡ IT support náº¿u váº¥n Ä‘á» váº«n tiáº¿p tá»¥c</li>
          </ul>
          <button 
            className="btn btn-primary" 
            onClick={() => window.location.reload()}
          >
            Refresh Trang
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="App">
      {/* âœ… BÆ¯á»šC 1: ThÃªm container cho thÃ´ng bÃ¡o táº¡i Ä‘Ã¢y */}
      <div id="alert-container" style={{
        position: 'fixed',
        top: '20px',
        right: '20px',
        zIndex: 1055,
        minWidth: '300px'
      }}></div>

      <Routes>
        {/* CÃ¡c route cÃ´ng khai */}
        <Route 
          path="/login" 
          element={
            // âœ… Sá»¬A: KhÃ´ng tá»± Ä‘á»™ng redirect, Ä‘á»ƒ LoginPage tá»± handle
            user ? (
              <Navigate to={getDefaultRedirectPath(user.role)} replace />
            ) : (
              <LoginPage />
            )
          } 
        />
        
        {/* CÃ¡c route Ä‘Æ°á»£c báº£o vá»‡ vá»›i Layout */}
        <Route 
          path="/" 
          element={
            <ProtectedRoute>
              <Layout />
            </ProtectedRoute>
          }
        >
          {/* âœ… Sá»¬A: Redirect máº·c Ä‘á»‹nh theo role */}
          <Route 
            index 
            element={
              <Navigate 
                to={user ? getDefaultRedirectPath(user.role) : '/login'} 
                replace 
              />
            } 
          />
          
          <Route path="dashboard" element={<HRDashboardPage />} />
          
          {/* Route quáº£n lÃ½ nhÃ¢n viÃªn */}
          <Route 
            path="employee-management" 
            element={
              <ProtectedRoute requiredRoles={['hr', 'admin']}>
                <EmployeeManagementPage />
              </ProtectedRoute>
            } 
          />
          
          {/* Route nháº­t kÃ½ cháº¥m cÃ´ng */}
          <Route path="attendance-logs" element={<AttendanceLogsPage />} />
        </Route>

        {/* âœ… Sá»¬A: Route báº¯t táº¥t cáº£ cÅ©ng theo role */}
        <Route 
          path="*" 
          element={
            user ? (
              <Navigate to={getDefaultRedirectPath(user.role)} replace />
            ) : (
              <Navigate to="/login" replace />
            )
          } 
        />
      </Routes>
    </div>
  );
};

export default App;

```


==================== File: .\src\main.jsx ====================

import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import App from './App.jsx';
import { AuthProvider } from './contexts/AuthContext.jsx';
import { NotificationProvider } from './contexts/NotificationContext.jsx';

// Import Bootstrap CSS vÃ  FontAwesome
import 'bootstrap/dist/css/bootstrap.min.css';
import 'bootstrap/dist/js/bootstrap.bundle.min.js';
import '@fortawesome/fontawesome-free/css/all.min.css';
import './styles/globals.css';

// Global error handler
window.addEventListener('error', (e) => {
  console.error('Global error:', e.error);
  console.error('Error details:', {
    message: e.message,
    filename: e.filename,
    lineno: e.lineno,
    colno: e.colno
  });
});

// Global unhandled promise rejection handler
window.addEventListener('unhandledrejection', (e) => {
  console.error('Unhandled promise rejection:', e.reason);
  console.error('Promise:', e.promise);
});

// Initialize tooltips when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  if (typeof window.bootstrap !== 'undefined') {
    const tooltipTriggerList = [].slice.call(
      document.querySelectorAll('[data-bs-toggle="tooltip"]')
    );
    tooltipTriggerList.map(tooltipTriggerEl => {
      return new window.bootstrap.Tooltip(tooltipTriggerEl);
    });
  }
});

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <NotificationProvider>
          <App />
        </NotificationProvider>
      </AuthProvider>
    </BrowserRouter>
  </React.StrictMode>
);

```


==================== File: .\src\components\attendance\AttendanceFilters.jsx ====================

import React from 'react';

const AttendanceFilters = ({ 
  employees, 
  filters, 
  onFilterChange, 
  onClearFilters 
}) => {
  const handleFilterSubmit = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const newFilters = {
      employeeId: formData.get('employeeId'),
      dateFrom: formData.get('dateFrom'),
      dateTo: formData.get('dateTo')
    };
    
    // Remove empty filters
    Object.keys(newFilters).forEach(key => {
      if (!newFilters[key]) delete newFilters[key];
    });
    
    onFilterChange(newFilters);
  };

  return (
    <form onSubmit={handleFilterSubmit} id="filterForm">
      <div className="row">
        <div className="col-md-4">
          <label className="form-label">NhÃ¢n viÃªn</label>
          <select 
            className="form-select" 
            name="employeeId"
            defaultValue={filters.employeeId || ''}
          >
            <option value="">Táº¥t cáº£ nhÃ¢n viÃªn</option>
            {employees.map(employee => (
              <option key={employee.id} value={employee.employeeId}>
                {employee.employeeId} - {employee.fullName}
              </option>
            ))}
          </select>
        </div>
        
        <div className="col-md-3">
          <label className="form-label">Tá»« ngÃ y</label>
          <input 
            type="date" 
            className="form-control" 
            name="dateFrom"
            defaultValue={filters.dateFrom || ''}
          />
        </div>
        
        <div className="col-md-3">
          <label className="form-label">Äáº¿n ngÃ y</label>
          <input 
            type="date" 
            className="form-control" 
            name="dateTo"
            defaultValue={filters.dateTo || ''}
          />
        </div>
        
        <div className="col-md-2">
          <label className="form-label">&nbsp;</label>
          <div className="d-grid gap-2">
            <button type="submit" className="btn btn-primary">
              <i className="fas fa-search me-2"></i>
              Lá»c
            </button>
            <button 
              type="button" 
              className="btn btn-outline-secondary"
              onClick={onClearFilters}
            >
              <i className="fas fa-times me-2"></i>
              XÃ³a
            </button>
          </div>
        </div>
      </div>
    </form>
  );
};

export default AttendanceFilters;

```


==================== File: .\src\components\attendance\AttendanceLogs.jsx ====================

// src/components/attendance/AttendanceLogs.jsx
import React, { useState } from 'react';

const AttendanceLogs = ({ logs, employees }) => {
  const [sortField, setSortField] = useState('timestamp');
  const [sortDirection, setSortDirection] = useState('desc');
  const [positionFilter, setPositionFilter] = useState('');

  // âœ… THÃŠM: HÃ m sáº¯p xáº¿p logs
  const sortedLogs = [...logs].sort((a, b) => {
    let aValue = a[sortField];
    let bValue = b[sortField];
    
    if (sortField === 'timestamp') {
      aValue = new Date(aValue);
      bValue = new Date(bValue);
    }
    
    if (sortDirection === 'asc') {
      return aValue > bValue ? 1 : -1;
    } else {
      return aValue < bValue ? 1 : -1;
    }
  });

  // âœ… THÃŠM: Lá»c theo vá»‹ trÃ­
  const filteredLogs = positionFilter 
    ? sortedLogs.filter(log => log.position === positionFilter)
    : sortedLogs;

  // âœ… THÃŠM: Láº¥y danh sÃ¡ch vá»‹ trÃ­ unique
  const positions = [...new Set(logs.map(log => log.position))].filter(Boolean);

  // âœ… THÃŠM: HÃ m láº¥y tÃªn nhÃ¢n viÃªn tá»« mÃ£
  const getEmployeeName = (employeeId) => {
    const employee = employees?.find(emp => emp.employeeId === employeeId);
    return employee?.fullName || employeeId;
  };

  // âœ… THÃŠM: HÃ m format timestamp Unix
  const formatTimestamp = (timestamp) => {
    if (!timestamp) return 'N/A';
    const date = new Date(timestamp);
    return date.toLocaleString('vi-VN');
  };

  // âœ… THÃŠM: HÃ m láº¥y icon cho loáº¡i cháº¥m cÃ´ng
  const getTypeIcon = (type) => {
    return type === 'Checkin' 
      ? <i className="fas fa-sign-in-alt text-success"></i>
      : <i className="fas fa-sign-out-alt text-danger"></i>;
  };

  // âœ… THÃŠM: HÃ m láº¥y badge color cho vá»‹ trÃ­
  const getPositionBadgeClass = (position) => {
    switch (position) {
      case 'NhÃ¢n viÃªn Mascot': return 'bg-info text-dark';
      case 'NhÃ¢n viÃªn BÃ¡n hÃ ng': return 'bg-success';
      case 'NhÃ¢n viÃªn Thu ngÃ¢n': return 'bg-primary';
      case 'NhÃ¢n viÃªn Tiáº¿p Ä‘Ã³n': return 'bg-secondary';
      default: return 'bg-light text-dark';
    }
  };

  const handleSort = (field) => {
    if (sortField === field) {
      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
    } else {
      setSortField(field);
      setSortDirection('desc');
    }
  };

  if (!logs || logs.length === 0) {
    return (
      <div className="text-center py-5">
        <i className="fas fa-calendar-times fa-3x text-muted mb-3"></i>
        <h5 className="text-muted">KhÃ´ng cÃ³ báº£n ghi cháº¥m cÃ´ng nÃ o</h5>
        <p className="text-muted">Dá»¯ liá»‡u cháº¥m cÃ´ng sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y khi cÃ³ nhÃ¢n viÃªn thá»±c hiá»‡n cháº¥m cÃ´ng.</p>
      </div>
    );
  }

  return (
    <div className="attendance-logs">
      {/* âœ… THÃŠM: Bá»™ lá»c vÃ  controls */}
      <div className="row mb-3">
        <div className="col-md-4">
          <select
            className="form-select form-select-sm"
            value={positionFilter}
            onChange={(e) => setPositionFilter(e.target.value)}
          >
            <option value="">Táº¥t cáº£ vá»‹ trÃ­</option>
            {positions.map(position => (
              <option key={position} value={position}>
                {position}
              </option>
            ))}
          </select>
        </div>
        <div className="col-md-8 text-end">
          <small className="text-muted">
            Hiá»ƒn thá»‹ {filteredLogs.length} / {logs.length} báº£n ghi
          </small>
        </div>
      </div>

      {/* âœ… Cáº¬P NHáº¬T: Báº£ng vá»›i cáº¥u trÃºc má»›i */}
      <div className="table-responsive">
        <table className="table table-striped table-hover align-middle">
          <thead className="table-dark">
            <tr>
              <th 
                style={{ cursor: 'pointer' }}
                onClick={() => handleSort('employeeId')}
              >
                MÃ£ NV
                {sortField === 'employeeId' && (
                  <i className={`fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'} ms-1`}></i>
                )}
              </th>
              <th>Há» tÃªn</th>
              <th 
                style={{ cursor: 'pointer' }}
                onClick={() => handleSort('type')}
              >
                Loáº¡i
                {sortField === 'type' && (
                  <i className={`fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'} ms-1`}></i>
                )}
              </th>
              <th 
                style={{ cursor: 'pointer' }}
                onClick={() => handleSort('position')}
              >
                Vá»‹ trÃ­
                {sortField === 'position' && (
                  <i className={`fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'} ms-1`}></i>
                )}
              </th>
              <th 
                style={{ cursor: 'pointer' }}
                onClick={() => handleSort('timestamp')}
              >
                Thá»i gian cháº¥m cÃ´ng
                {sortField === 'timestamp' && (
                  <i className={`fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'} ms-1`}></i>
                )}
              </th>
              <th>Ghi chÃº</th>
            </tr>
          </thead>
          <tbody>
            {filteredLogs.map((log, index) => (
              <tr key={log.id || index}>
                <td>
                  <span className="fw-bold text-primary">{log.employeeId}</span>
                </td>
                <td>
                  <div className="fw-semibold">{getEmployeeName(log.employeeId)}</div>
                </td>
                <td>
                  <div className="d-flex align-items-center">
                    {getTypeIcon(log.type)}
                    <span className="ms-2">{log.type}</span>
                  </div>
                </td>
                <td>
                  <span className={`badge ${getPositionBadgeClass(log.position)}`}>
                    {log.position || 'N/A'}
                  </span>
                </td>
                <td>
                  <div className="text-nowrap">
                    <div className="fw-semibold">{formatTimestamp(log.timestamp).split(' ')[1]}</div>
                    <small className="text-muted">{formatTimestamp(log.timestamp).split(' ')[0]}</small>
                  </div>
                </td>
                <td>
                  <span className="text-muted">{log.notes || '-'}</span>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* âœ… THÃŠM: Thá»‘ng kÃª nhanh */}
      <div className="row mt-4">
        <div className="col-12">
          <div className="card bg-light">
            <div className="card-body">
              <h6 className="card-title">ğŸ“Š Thá»‘ng kÃª nhanh</h6>
              <div className="row text-center">
                <div className="col-md-3">
                  <div className="h5 text-success mb-0">
                    {filteredLogs.filter(log => log.type === 'Checkin').length}
                  </div>
                  <small className="text-muted">Check-in</small>
                </div>
                <div className="col-md-3">
                  <div className="h5 text-danger mb-0">
                    {filteredLogs.filter(log => log.type === 'Checkout').length}
                  </div>
                  <small className="text-muted">Check-out</small>
                </div>
                <div className="col-md-3">
                  <div className="h5 text-primary mb-0">
                    {new Set(filteredLogs.map(log => log.employeeId)).size}
                  </div>
                  <small className="text-muted">NhÃ¢n viÃªn</small>
                </div>
                <div className="col-md-3">
                  <div className="h5 text-info mb-0">
                    {new Set(filteredLogs.map(log => log.date)).size}
                  </div>
                  <small className="text-muted">NgÃ y</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AttendanceLogs;

```


==================== File: .\src\components\attendance\EmployeeHours.jsx ====================

// import React, { useState, useEffect } from 'react';
// import { useAttendance } from '../../hooks/useAttendance';
// import { useNotification } from '../../hooks/useNotification';
// import Loading from '../common/Loading';
// import Alert from '../common/Alert';

// function EmployeeHours() {
//     const [employeeHours, setEmployeeHours] = useState([]);
//     const [filteredData, setFilteredData] = useState([]);
//     const [loading, setLoading] = useState(true);
//     const [error, setError] = useState(null);
//     const [stats, setStats] = useState(null);

//     // Bá»™ lá»c Ä‘Æ¡n giáº£n, khÃ´ng cÃ³ "Lá»—i" hay "Cáº£nh bÃ¡o"
//     const [filters, setFilters] = useState({
//         employeeId: '',
//         position: '',
//         dateFrom: '',
//         dateTo: ''
//     });

//     const { getEmployeeHours } = useAttendance();
//     const { showNotification } = useNotification();

//     useEffect(() => {
//         loadEmployeeHours();
//     }, []);

//     useEffect(() => {
//         applyFilters();
//     }, [employeeHours, filters]);

//     const loadEmployeeHours = async () => {
//         try {
//             setLoading(true);
//             setError(null);
//             const response = await getEmployeeHours();

//             if (response.success) {
//                 setEmployeeHours(response.data.employeeHours || []);
//                 setStats(response.data.summary || null);
//             } else {
//                 throw new Error(response.message || 'Failed to load employee hours');
//             }
//         } catch (err) {
//             setError(err.message);
//             showNotification('Lá»—i khi táº£i dá»¯ liá»‡u giá» cÃ´ng: ' + err.message, 'error');
//         } finally {
//             setLoading(false);
//         }
//     };

//     const applyFilters = () => {
//         let filtered = [...employeeHours];

//         // TÃ¬m kiáº¿m theo mÃ£ NV hoáº·c tÃªn
//         if (filters.employeeId.trim()) {
//             const searchTerm = filters.employeeId.toLowerCase();
//             filtered = filtered.filter(item =>
//                 item.employeeId.toLowerCase().includes(searchTerm) ||
//                 item.fullName.toLowerCase().includes(searchTerm)
//             );
//         }

//         // Theo chá»©c vá»¥
//         if (filters.position) {
//             filtered = filtered.filter(item => item.position === filters.position);
//         }

//         // Theo khoáº£ng ngÃ y
//         if (filters.dateFrom) {
//             filtered = filtered.filter(item =>
//                 new Date(item.date) >= new Date(filters.dateFrom)
//             );
//         }
//         if (filters.dateTo) {
//             filtered = filtered.filter(item =>
//                 new Date(item.date) <= new Date(filters.dateTo)
//             );
//         }

//         setFilteredData(filtered);
//     };

//     const handleFilterChange = (key, value) => {
//         setFilters(prev => ({
//             ...prev,
//             [key]: value
//         }));
//     };

//     const clearFilters = () => {
//         setFilters({
//             employeeId: '',
//             position: '',
//             dateFrom: '',
//             dateTo: ''
//         });
//     };

//     const exportToCSV = () => {
//         if (filteredData.length === 0) {
//             showNotification('KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ xuáº¥t', 'warning');
//             return;
//         }

//         const headers = [
//             'MÃ£ NV',
//             'Há» tÃªn',
//             'NgÃ y',
//             'Chá»©c vá»¥',
//             'Tá»•ng giá»',
//             'Cáº£nh bÃ¡o'
//         ];

//         const csvContent = [
//             headers.join(','),
//             ...filteredData.map(item => [
//                 item.employeeId,
//                 `"${item.fullName}"`,
//                 item.date,
//                 `"${item.position}"`,
//                 `"${item.totalHours}"`,
//                 `"${(item.warnings || []).join('; ')}"`
//             ].join(','))
//         ].join('\n');

//         const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
//         const link = document.createElement('a');
//         link.href = URL.createObjectURL(blob);
//         link.download = `employee_hours_${new Date().toISOString().split('T')[0]}.csv`;
//         link.click();

//         showNotification('Xuáº¥t file CSV thÃ nh cÃ´ng', 'success');
//     };

//     const getPositionOptions = () => {
//         const positions = [...new Set(employeeHours.map(item => item.position))];
//         return positions.filter(Boolean).sort();
//     };

//     const formatDate = (dateString) => {
//         if (!dateString) return '';
//         const date = new Date(dateString);
//         return date.toLocaleDateString('vi-VN');
//     };

//     // MÃ u dÃ²ng náº¿u cÃ³ cáº£nh bÃ¡o
//     const getRowClassName = (item) => {
//         if (item.warnings && item.warnings.length > 0) return 'table-warning';
//         return '';
//     };

//     if (loading) {
//         return (
//             <div className="container-fluid py-4">
//                 <div className="row">
//                     <div className="col-12">
//                         <div className="card">
//                             <div className="card-header">
//                                 <h5 className="mb-0">ğŸ“Š Tá»•ng Giá» CÃ´ng NhÃ¢n ViÃªn</h5>
//                             </div>
//                             <div className="card-body">
//                                 <Loading message="Äang táº£i dá»¯ liá»‡u giá» cÃ´ng..." />
//                             </div>
//                         </div>
//                     </div>
//                 </div>
//             </div>
//         );
//     }

//     if (error) {
//         return (
//             <div className="container-fluid py-4">
//                 <div className="row">
//                     <div className="col-12">
//                         <Alert
//                             type="danger"
//                             message={`Lá»—i táº£i dá»¯ liá»‡u: ${error}`}
//                             onRetry={loadEmployeeHours}
//                         />
//                     </div>
//                 </div>
//             </div>
//         );
//     }

//     return (
//         <div className="container-fluid py-4">
//             <div className="row">
//                 <div className="col-12">
//                     <div className="card">
//                         <div className="card-header d-flex justify-content-between align-items-center">
//                             <h5 className="mb-0">
//                                 ğŸ“Š Tá»•ng Giá» CÃ´ng NhÃ¢n ViÃªn
//                                 <small className="text-muted ms-2">
//                                     ({filteredData.length} / {employeeHours.length} báº£n ghi)
//                                 </small>
//                             </h5>
//                             <div className="d-flex gap-2">
//                                 <button
//                                     className="btn btn-outline-success btn-sm"
//                                     onClick={exportToCSV}
//                                     disabled={filteredData.length === 0}
//                                 >
//                                     <i className="fas fa-download me-1"></i>
//                                     Xuáº¥t CSV
//                                 </button>
//                                 <button
//                                     className="btn btn-outline-primary btn-sm"
//                                     onClick={loadEmployeeHours}
//                                 >
//                                     <i className="fas fa-sync-alt me-1"></i>
//                                     LÃ m má»›i
//                                 </button>
//                             </div>
//                         </div>

//                         {/* Filters Section (KHÃ”NG cÃ²n Lá»—i/Cáº£nh BÃ¡o) */}
//                         <div className="card-body border-bottom">
//                             <div className="row g-3">
//                                 <div className="col-md-3">
//                                     <label className="form-label">TÃ¬m nhÃ¢n viÃªn</label>
//                                     <input
//                                         type="text"
//                                         className="form-control form-control-sm"
//                                         placeholder="MÃ£ NV hoáº·c tÃªn..."
//                                         value={filters.employeeId}
//                                         onChange={(e) => handleFilterChange('employeeId', e.target.value)}
//                                     />
//                                 </div>
//                                 <div className="col-md-2">
//                                     <label className="form-label">Chá»©c vá»¥</label>
//                                     <select
//                                         className="form-select form-select-sm"
//                                         value={filters.position}
//                                         onChange={(e) => handleFilterChange('position', e.target.value)}
//                                     >
//                                         <option value="">Táº¥t cáº£ chá»©c vá»¥</option>
//                                         {getPositionOptions().map(position => (
//                                             <option key={position} value={position}>
//                                                 {position}
//                                             </option>
//                                         ))}
//                                     </select>
//                                 </div>
//                                 <div className="col-md-2">
//                                     <label className="form-label">Tá»« ngÃ y</label>
//                                     <input
//                                         type="date"
//                                         className="form-control form-control-sm"
//                                         value={filters.dateFrom}
//                                         onChange={(e) => handleFilterChange('dateFrom', e.target.value)}
//                                     />
//                                 </div>
//                                 <div className="col-md-2">
//                                     <label className="form-label">Äáº¿n ngÃ y</label>
//                                     <input
//                                         type="date"
//                                         className="form-control form-control-sm"
//                                         value={filters.dateTo}
//                                         onChange={(e) => handleFilterChange('dateTo', e.target.value)}
//                                     />
//                                 </div>
//                                 <div className="col-md-3 d-flex align-items-end">
//                                     <button
//                                         className="btn btn-outline-secondary btn-sm ms-auto"
//                                         onClick={clearFilters}
//                                         title="XÃ³a bá»™ lá»c"
//                                     >
//                                         <i className="fas fa-times"></i> XÃ³a lá»c
//                                     </button>
//                                 </div>
//                             </div>
//                         </div>

//                         {/* Table Section */}
//                         <div className="card-body p-0">
//                             <div className="table-responsive">
//                                 <table className="table table-hover mb-0">
//                                     <thead className="table-light">
//                                         <tr>
//                                             <th>MÃ£ NV</th>
//                                             <th>Há» tÃªn</th>
//                                             <th>NgÃ y</th>
//                                             <th>Chá»©c vá»¥</th>
//                                             <th className="text-center">Tá»•ng giá»</th>
//                                             <th>Cáº£nh bÃ¡o</th>
//                                         </tr>
//                                     </thead>
//                                     <tbody>
//                                         {filteredData.length === 0 ? (
//                                             <tr>
//                                                 <td colSpan="6" className="text-center py-4 text-muted">
//                                                     <i className="fas fa-calendar-times fa-2x mb-2"></i>
//                                                     <div>KhÃ´ng cÃ³ dá»¯ liá»‡u giá» cÃ´ng</div>
//                                                     <small>HÃ£y kiá»ƒm tra bá»™ lá»c hoáº·c thÃªm dá»¯ liá»‡u cháº¥m cÃ´ng</small>
//                                                 </td>
//                                             </tr>
//                                         ) : (
//                                             filteredData.map((item, index) => (
//                                                 <tr key={`${item.employeeId}-${item.date}-${index}`}
//                                                     className={getRowClassName(item)}>
//                                                     <td>
//                                                         <div className="fw-bold">{item.employeeId}</div>
//                                                     </td>
//                                                     <td>
//                                                         <div className="fw-semibold">{item.fullName}</div>
//                                                     </td>
//                                                     <td>
//                                                         <div className="text-nowrap">{formatDate(item.date)}</div>
//                                                     </td>
//                                                     <td>
//                                                         <span className={`badge ${getPositionBadgeClass(item.position)}`}>
//                                                             {item.position}
//                                                         </span>
//                                                     </td>
//                                                     <td className="text-center">
//                                                         <span className="badge bg-primary">
//                                                             {item.totalHours}
//                                                         </span>
//                                                     </td>
//                                                     <td>
//                                                         {(item.warnings && item.warnings.length > 0) ? (
//                                                             <div>
//                                                                 {item.warnings.map((warning, idx) => (
//                                                                     <small key={idx} className="text-warning d-block">
//                                                                         <i className="fas fa-exclamation-triangle me-1"></i>
//                                                                         {warning}
//                                                                     </small>
//                                                                 ))}
//                                                             </div>
//                                                         ) : (
//                                                             <span className="text-success">OK</span>
//                                                         )}
//                                                     </td>
//                                                 </tr>
//                                             ))
//                                         )}
//                                     </tbody>
//                                 </table>
//                             </div>
//                         </div>
//                     </div>
//                 </div>
//             </div>
//         </div>
//     );
// }

// // Helper function mÃ u badge chá»©c vá»¥
// function getPositionBadgeClass(position) {
//     switch (position) {
//         case 'NhÃ¢n viÃªn Mascot':
//             return 'bg-info text-dark';
//         case 'NhÃ¢n viÃªn BÃ¡n hÃ ng':
//             return 'bg-success';
//         case 'NhÃ¢n viÃªn Thu ngÃ¢n':
//             return 'bg-primary';
//         case 'NhÃ¢n viÃªn Tiáº¿p Ä‘Ã³n':
//             return 'bg-secondary';
//         default:
//             return 'bg-light text-dark';
//     }
// }

// export default EmployeeHours;

```


==================== File: .\src\components\attendance\LarkAttendanceEmbed.jsx ====================

import React from 'react';

// URL cá»§a Lark Base view báº¡n muá»‘n nhÃºng
const LARK_EMBED_URL = "https://atino-vietnam.sg.larksuite.com/base/Ey3EbVD9vacAHvs8cVvlHxkKg2r?table=tblU9YY1t4TwxXLh&view=vewpWpbNQv";

const LarkAttendanceEmbed = () => {
  return (
    // Container Ä‘áº£m báº£o iframe chiáº¿m háº¿t khÃ´ng gian Ä‘Æ°á»£c cáº¥p vÃ  cÃ³ chiá»u cao tá»‘i thiá»ƒu
    <div 
      className="h-full w-full" 
      style={{ minHeight: 'calc(100vh - 250px)' }} // Äiá»u chá»‰nh chiá»u cao Ä‘á»ƒ phÃ¹ há»£p layout
    >
      <iframe
        src={LARK_EMBED_URL}
        title="Báº£ng Cháº¥m CÃ´ng tá»« Lark Base"
        style={{
          width: '100%',
          height: '100%',
          border: 'none',
          borderRadius: '8px' // Bo gÃ³c cho iframe
        }}
        loading="lazy"
        allow="fullscreen"
      >
        TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ iframe.
      </iframe>
    </div>
  );
};

export default LarkAttendanceEmbed;

```


==================== File: .\src\components\auth\LoginForm.jsx ====================


```


==================== File: .\src\components\auth\ProtectedRoute.jsx ====================

import React from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';
import Loading from '../common/Loading';

const ProtectedRoute = ({ children, requiredRoles = [] }) => {
  const { user, loading } = useAuth();
  const location = useLocation();

  if (loading) {
    return <Loading fullScreen text="Äang kiá»ƒm tra quyá»n truy cáº­p..." />;
  }

  if (!user) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  // Check role-based access
  if (requiredRoles.length > 0 && !requiredRoles.includes(user.role)) {
    return (
      <div className="container mt-5">
        <div className="alert alert-danger">
          <h4>KhÃ´ng cÃ³ quyá»n truy cáº­p</h4>
          <p>Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p vÃ o trang nÃ y.</p>
          <button 
            className="btn btn-primary" 
            onClick={() => window.history.back()}
          >
            Quay láº¡i
          </button>
        </div>
      </div>
    );
  }

  return children;
};

export default ProtectedRoute;

```


==================== File: .\src\components\common\Alert.jsx ====================

import React, { useState, useEffect } from 'react';

// HÃ m helper Ä‘á»ƒ láº¥y icon dá»±a trÃªn loáº¡i thÃ´ng bÃ¡o
const getIconByType = (type) => {
    switch (type) {
        case 'success': return 'fa-check-circle';
        case 'error': return 'fa-times-circle';
        case 'warning': return 'fa-exclamation-triangle';
        case 'info': return 'fa-info-circle';
        default: return 'fa-info-circle';
    }
};

const Alert = ({ notification, onClose }) => {
    // âœ… THÃŠM: Guard clause Ä‘á»ƒ trÃ¡nh lá»—i destructuring khi notification = undefined
    if (!notification) {
        console.warn('Alert component received undefined notification');
        return null;
    }

    // âœ… Sá»¬A: ThÃªm default values Ä‘á»ƒ trÃ¡nh crash
    const { 
        id = 'unknown', 
        message = 'ThÃ´ng bÃ¡o khÃ´ng xÃ¡c Ä‘á»‹nh', 
        type = 'info',
        duration 
    } = notification;

    const [isExiting, setIsExiting] = useState(false);

    useEffect(() => {
        // Tá»± Ä‘á»™ng Ä‘Ã³ng sau má»™t khoáº£ng thá»i gian náº¿u cÃ³
        if (duration) {
            const timer = setTimeout(() => {
                handleClose();
            }, duration);
            return () => clearTimeout(timer);
        }
    }, [duration]); // âœ… Sá»¬A: Sá»­ dá»¥ng duration Ä‘Ã£ destructured

    const handleClose = () => {
        setIsExiting(true);
        // Äá»£i animation fade-out hoÃ n thÃ nh rá»“i má»›i gá»¡ component khá»i state
        setTimeout(() => {
            // âœ… THÃŠM: Kiá»ƒm tra onClose tá»“n táº¡i trÆ°á»›c khi gá»i
            if (onClose) {
                onClose(id);
            }
        }, 400); // Pháº£i khá»›p vá»›i thá»i gian transition trong CSS
    };

    return (
        <div className={`alert-toast ${type} ${isExiting ? '' : 'show'}`}>
            <i className={`fas ${getIconByType(type)} alert-toast-icon`}></i>
            <div className="alert-toast-content">
                <div className="alert-toast-message">{message}</div>
            </div>
            <button className="alert-toast-close" onClick={handleClose}>
                &times;
            </button>
        </div>
    );
};

export default Alert;

```


==================== File: .\src\components\common\Loading.jsx ====================

import React from 'react';

const Loading = ({ 
  size = 'medium', 
  text = 'Äang táº£i...', 
  overlay = false,
  fullScreen = false 
}) => {
  const getSizeClass = () => {
    switch (size) {
      case 'small': return 'spinner-border-sm';
      case 'large': return 'spinner-border spinner-border-lg';
      default: return 'spinner-border';
    }
  };

  const LoadingSpinner = () => (
    <div className="d-flex flex-column align-items-center justify-content-center p-3">
      <div className={`${getSizeClass()} text-primary`} role="status">
        <span className="visually-hidden">Loading...</span>
      </div>
      {text && (
        <div className="mt-2 text-muted small">
          {text}
        </div>
      )}
    </div>
  );

  if (fullScreen) {
    return (
      <div 
        className="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
        style={{ 
          backgroundColor: 'rgba(255, 255, 255, 0.9)', 
          zIndex: 9999 
        }}
      >
        <div className="text-center">
          <div className="spinner-border spinner-border-lg text-primary" role="status">
            <span className="visually-hidden">Loading...</span>
          </div>
          <div className="mt-3 h5 text-muted">{text}</div>
        </div>
      </div>
    );
  }

  if (overlay) {
    return (
      <div 
        className="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
        style={{ 
          backgroundColor: 'rgba(255, 255, 255, 0.8)', 
          zIndex: 1000 
        }}
      >
        <LoadingSpinner />
      </div>
    );
  }

  return <LoadingSpinner />;
};

// Loading wrapper component for conditional loading states
export const LoadingWrapper = ({ loading, children, ...loadingProps }) => {
  if (loading) {
    return <Loading {...loadingProps} />;
  }
  return children;
};

// Inline loading component for buttons
export const ButtonLoading = ({ loading, children, disabled, ...props }) => {
  return (
    <button 
      {...props} 
      disabled={disabled || loading}
      className={`${props.className || ''} ${loading ? 'position-relative' : ''}`}
    >
      {loading && (
        <span className="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
      )}
      {children}
    </button>
  );
};

export default Loading;

```


==================== File: .\src\components\common\Modal.jsx ====================

// src/components/common/Modal.jsx
import React from 'react';

const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
  if (!isOpen) return null;

  const handleBackdropClick = (e) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <div 
      className="modal fade show d-block" 
      style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}
      onClick={handleBackdropClick}
    >
      <div className={`modal-dialog modal-${size} modal-dialog-centered`}>
        <div className="modal-content">
          <div className="modal-header">
            <h5 className="modal-title">{title}</h5>
            <button 
              type="button" 
              className="btn-close" 
              onClick={onClose}
            ></button>
          </div>
          <div className="modal-body">
            {children}
          </div>
        </div>
      </div>
    </div>
  );
};

export default Modal;

```


==================== File: .\src\components\common\Table.jsx ====================


```


==================== File: .\src\components\dashboard\Dashboard.jsx ====================

// // src/components/dashboard/Dashboard.jsx
// import React, { useState, useEffect } from 'react';
// import { useAuth } from '../../hooks/useAuth';
// import { ApiClient } from '../../services/api';
// import Loading from '../common/Loading';
// import { useNotification } from '../../hooks/useNotification';

// const Dashboard = () => {
//   const [stats, setStats] = useState({});
//   const [loading, setLoading] = useState(true);
//   const { user } = useAuth();
//   const { showNotification } = useNotification();

//   useEffect(() => {
//     loadStats();
    
//     // Auto refresh every 5 minutes
//     const interval = setInterval(loadStats, 5 * 60 * 1000);
//     return () => clearInterval(interval);
//   }, []);

//   const loadStats = async () => {
//     try {
//       console.log('ğŸ” Dashboard: Loading stats...');
//       const response = await ApiClient.get('/api/employees/stats');
      
//       console.log('ğŸ“¨ Dashboard: Raw response:', response);
//       console.log('âœ… Dashboard: Response success:', response.success);
//       console.log('ğŸ“Š Dashboard: Response data:', response.data);
      
//       // âœ… FIX: Sá»­ dá»¥ng response.data thay vÃ¬ response
//       if (response.success && response.data) {
//         console.log('âœ… Dashboard: Setting stats to:', response.data);
//         setStats(response.data);
//       } else {
//         console.warn('âš ï¸ Dashboard: API returned success: false');
//         showNotification('KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u thá»‘ng kÃª', 'warning');
//       }
      
//     } catch (error) {
//       console.error('âŒ Dashboard: Error loading stats:', error);
//       showNotification('Lá»—i khi táº£i thá»‘ng kÃª dashboard', 'error');
//     } finally {
//       setLoading(false);
//     }
//   };

//   const handleRefresh = async () => {
//     setLoading(true);
//     await loadStats();
//     showNotification('ÄÃ£ cáº­p nháº­t dá»¯ liá»‡u dashboard', 'success');
//   };

//   // âœ… DEBUG: Log current stats state
//   console.log('ğŸ¯ Dashboard render - Current stats:', stats);
//   console.log('ğŸ¯ Dashboard render - Loading:', loading);

//   if (loading) {
//     return <Loading fullScreen text="Äang táº£i dashboard..." />;
//   }

//   return (
//     <div className="dashboard-page">
//       {/* âœ… DEBUG INFO - Remove this after fixing */}
//       <div style={{ 
//         background: '#f8f9fa', 
//         border: '1px solid #dee2e6', 
//         borderRadius: '0.25rem', 
//         padding: '1rem', 
//         marginBottom: '1rem' 
//       }}>
//         <h6 className="text-muted mb-2">ğŸ› DEBUG INFO:</h6>
//         <small className="d-block">Raw stats: {JSON.stringify(stats)}</small>
//         <small className="d-block">Total Employees: {stats.totalEmployees}</small>
//         <small className="d-block">Active Employees: {stats.activeEmployees}</small>
//         <small className="d-block">Inactive Employees: {stats.inactiveEmployees}</small>
//       </div>

//       {/* Header */}
//       <div className="d-flex justify-content-between align-items-center mb-4">
//         <div>
//           <h1>Dashboard</h1>
//           <p className="text-muted mb-0">ChÃ o má»«ng trá»Ÿ láº¡i, {user?.fullName}!</p>
//         </div>
//         <button 
//           className="btn btn-outline-primary"
//           onClick={handleRefresh}
//           disabled={loading}
//         >
//           <i className={`fas fa-sync-alt me-2 ${loading ? 'fa-spin' : ''}`}></i>
//           LÃ m má»›i
//         </button>
//       </div>

//       {/* Stats Cards */}
//       <div className="row mb-4">
//         <div className="col-md-4 mb-3">
//           <div className="card text-center bg-primary text-white h-100">
//             <div className="card-body">
//               <i className="fas fa-users fa-3x mb-3"></i>
//               <h2 className="card-title" id="totalEmployees">
//                 {stats.totalEmployees || 0}
//               </h2>
//               <p className="card-text">Tá»•ng nhÃ¢n viÃªn</p>
//             </div>
//           </div>
//         </div>

//         <div className="col-md-4 mb-3">
//           <div className="card text-center bg-success text-white h-100">
//             <div className="card-body">
//               <i className="fas fa-user-check fa-3x mb-3"></i>
//               <h2 className="card-title" id="activeEmployees">
//                 {stats.activeEmployees || 0}
//               </h2>
//               <p className="card-text">NhÃ¢n viÃªn hoáº¡t Ä‘á»™ng</p>
//             </div>
//           </div>
//         </div>

//         <div className="col-md-4 mb-3">
//           <div className="card text-center bg-info text-white h-100">
//             <div className="card-body">
//               <i className="fas fa-user-times fa-3x mb-3"></i>
//               <h2 className="card-title" id="inactiveEmployees">
//                 {stats.inactiveEmployees || 0}
//               </h2>
//               <p className="card-text">NhÃ¢n viÃªn khÃ´ng hoáº¡t Ä‘á»™ng</p>
//             </div>
//           </div>
//         </div>
//       </div>

//       {/* Quick Actions */}
//       <div className="row">
//         <div className="col-12">
//           <div className="card">
//             <div className="card-header">
//               <h5 className="card-title mb-0">Truy cáº­p nhanh</h5>
//             </div>
//             <div className="card-body">
//               <div className="row">
//                 <div className="col-md-4 mb-3">
//                   <a href="/attendance-logs" className="btn btn-outline-info w-100 h-100 d-flex flex-column justify-content-center">
//                     <i className="fas fa-clock fa-2x mb-2"></i>
//                     <span>Xem cháº¥m cÃ´ng</span>
//                   </a>
//                 </div>

//                 {(user?.role === 'hr' || user?.role === 'admin') && (
//                   <>
//                     <div className="col-md-4 mb-3">
//                       <a href="/employee-management" className="btn btn-outline-primary w-100 h-100 d-flex flex-column justify-content-center">
//                         <i className="fas fa-users-cog fa-2x mb-2"></i>
//                         <span>Quáº£n lÃ½ nhÃ¢n viÃªn</span>
//                       </a>
//                     </div>
                    
//                     <div className="col-md-4 mb-3">
//                       <a href="/hr-dashboard" className="btn btn-outline-success w-100 h-100 d-flex flex-column justify-content-center">
//                         <i className="fas fa-chart-bar fa-2x mb-2"></i>
//                         <span>HR Dashboard</span>
//                       </a>
//                     </div>
//                   </>
//                 )}
//               </div>
//             </div>
//           </div>
//         </div>
//       </div>

//       {/* HR Functions */}
//       {(user?.role === 'hr' || user?.role === 'admin') && (
//         <div className="row mt-4">
//           <div className="col-12">
//             <div className="card">
//               <div className="card-body text-center">
//                 <h5>Chá»©c nÄƒng HR</h5>
//                 <p className="text-muted">Truy cáº­p cÃ¡c cÃ´ng cá»¥ dÃ nh cho HR</p>
//                 <a 
//                   href="https://forms.google.com/your-form-url" 
//                   target="_blank"
//                   rel="noopener noreferrer"
//                   className="btn btn-outline-success me-2"
//                 >
//                   <i className="fas fa-external-link-alt me-2"></i>
//                   Má»Ÿ Google Form tuyá»ƒn dá»¥ng
//                 </a>
//                 <a 
//                   href="/hr-dashboard" 
//                   className="btn btn-primary"
//                 >
//                   <i className="fas fa-chart-line me-2"></i>
//                   Xem bÃ¡o cÃ¡o HR
//                 </a>
//               </div>
//             </div>
//           </div>
//         </div>
//       )}
//     </div>
//   );
// };

// export default Dashboard;

```


==================== File: .\src\components\dashboard\HRDashboard.jsx ====================


```


==================== File: .\src\components\dashboard\StatsCard.jsx ====================


```


==================== File: .\src\components\employee\AddWorkHistoryModal.jsx ====================

import React, { useState } from 'react';

// Import cÃ¡c thÃ nh pháº§n vÃ  services cáº§n thiáº¿t
import Modal from '../common/Modal.jsx';
import RecruitmentModal from './RecruitmentModal.jsx';
import { ButtonLoading } from '../common/Loading.jsx';
import { useNotification } from '../../hooks/useNotification';
import { addWorkHistory } from '../../services/employee.js';

/**
 * Modal Ä‘á»ƒ thÃªm má»™t báº£n ghi Lá»‹ch sá»­ cÃ´ng viá»‡c cho nhÃ¢n viÃªn.
 * NÃ³ cho phÃ©p ngÆ°á»i dÃ¹ng chá»n má»™t "Äá» xuáº¥t tuyá»ƒn dá»¥ng" Ä‘Ã£ cÃ³ sáºµn.
 * Logic Ä‘Æ°á»£c Ä‘iá»u chá»‰nh Ä‘á»ƒ luÃ´n lÃ m viá»‡c vá»›i má»™t máº£ng cÃ¡c Ä‘á» xuáº¥t,
 * nhÆ°ng RecruitmentModal Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ chá»‰ cho phÃ©p chá»n má»™t.
 *
 * @param {object} props
 * @param {boolean} props.isOpen - Cá» Ä‘á»ƒ Ä‘iá»u khiá»ƒn viá»‡c hiá»ƒn thá»‹ modal.
 * @param {Function} props.onClose - HÃ m Ä‘á»ƒ Ä‘Ã³ng modal.
 * @param {object} props.employee - Äá»‘i tÆ°á»£ng nhÃ¢n viÃªn Ä‘ang Ä‘Æ°á»£c thÃªm lá»‹ch sá»­.
 * @param {Function} props.onSave - HÃ m callback Ä‘Æ°á»£c gá»i sau khi lÆ°u thÃ nh cÃ´ng.
 */
const AddWorkHistoryModal = ({ isOpen, onClose, employee, onSave }) => {
  // Náº¿u khÃ´ng cÃ³ thÃ´ng tin nhÃ¢n viÃªn, khÃ´ng render gÃ¬ cáº£ Ä‘á»ƒ trÃ¡nh lá»—i.
  if (!employee) return null;

  // State quáº£n lÃ½ Ä‘á» xuáº¥t dÆ°á»›i dáº¡ng Máº¢NG Ä‘á»ƒ Ä‘á»“ng nháº¥t logic.
  const [selectedRecruitments, setSelectedRecruitments] = useState([]);
  const [isRecruitmentModalOpen, setIsRecruitmentModalOpen] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  
  // âœ… THÃŠM: State cho cÃ¡c trÆ°á»ng má»›i
  const [workHistoryData, setWorkHistoryData] = useState({
    fromDate: '',
    toDate: '',
    hourlyRate: ''
  });
  
  const { showNotification } = useNotification();

  /**
   * Xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng chá»n má»™t Ä‘á» xuáº¥t tá»« RecruitmentModal.
   * DÃ¹ RecruitmentModal cÃ³ singleSelect=true, nÃ³ váº«n Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ tráº£ vá» má»™t máº£ng.
   * @param {Array<object>} recruitmentObject - Máº£ng chá»©a Ä‘á» xuáº¥t Ä‘Ã£ chá»n.
   */
  const handleRecruitmentSelect = (recruitmentObject) => {
    // LuÃ´n nháº­n vá» má»™t máº£ng, ká»ƒ cáº£ khi chá»‰ cÃ³ má»™t lá»±a chá»n.
    setSelectedRecruitments(recruitmentObject ? [recruitmentObject] : []);
    setIsRecruitmentModalOpen(false);
  };

  // âœ… THÃŠM: Xá»­ lÃ½ thay Ä‘á»•i dá»¯ liá»‡u form
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setWorkHistoryData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  // âœ… THÃŠM: Validation cÃ¡c trÆ°á»ng má»›i
  const validateForm = () => {
    const errors = [];

    // Kiá»ƒm tra Ä‘Ã£ chá»n Ä‘á» xuáº¥t
    if (selectedRecruitments.length === 0) {
      errors.push('Vui lÃ²ng chá»n má»™t Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng.');
    }

    // Kiá»ƒm tra cÃ¡c trÆ°á»ng báº¯t buá»™c
    if (!workHistoryData.fromDate) {
      errors.push('Tá»« ngÃ y lÃ  báº¯t buá»™c.');
    }

    if (!workHistoryData.toDate) {
      errors.push('Äáº¿n ngÃ y lÃ  báº¯t buá»™c.');
    }

    // Kiá»ƒm tra logic ngÃ y
    if (workHistoryData.fromDate && workHistoryData.toDate) {
      const fromDate = new Date(workHistoryData.fromDate);
      const toDate = new Date(workHistoryData.toDate);
      
      if (toDate < fromDate) {
        errors.push('Äáº¿n ngÃ y pháº£i lá»›n hÆ¡n hoáº·c báº±ng Tá»« ngÃ y.');
      }
    }

    // Kiá»ƒm tra má»©c lÆ°Æ¡ng
    if (workHistoryData.hourlyRate && (isNaN(workHistoryData.hourlyRate) || parseFloat(workHistoryData.hourlyRate) < 0)) {
      errors.push('Má»©c lÆ°Æ¡ng/giá» pháº£i lÃ  sá»‘ vÃ  khÃ´ng Ä‘Æ°á»£c Ã¢m.');
    }

    return errors;
  };

  /**
   * Xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng nháº¥n nÃºt "LÆ°u" Ä‘á»ƒ gá»­i form.
   */
  const handleSubmit = async (e) => {
    e.preventDefault();

    // âœ… Cáº¬P NHáº¬T: Sá»­ dá»¥ng validation má»›i
    const validationErrors = validateForm();
    if (validationErrors.length > 0) {
      showNotification(validationErrors.join(' '), 'warning');
      return;
    }

    if (isLoading) return;
    setIsLoading(true);

    try {
      // âœ… Cáº¬P NHáº¬T: API payload vá»›i cÃ¡c trÆ°á»ng má»›i
      const workHistoryPayload = {
        employeeId: employee.employeeId,
        requestNo: selectedRecruitments[0].requestNo,
        fromDate: workHistoryData.fromDate,
        toDate: workHistoryData.toDate,
        hourlyRate: workHistoryData.hourlyRate ? parseFloat(workHistoryData.hourlyRate) : undefined,
      };

      console.log('ğŸ“¤ Sending work history payload:', workHistoryPayload);

      const response = await addWorkHistory(workHistoryPayload);

      if (response.success) {
        showNotification('ThÃªm lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng!', 'success');
        if (onSave) {
          onSave(); // Gá»i callback Ä‘á»ƒ Ä‘Ã³ng modal vÃ  refresh dá»¯ liá»‡u bÃªn ngoÃ i.
        }
      } else {
        showNotification(response.message || 'ThÃªm lá»‹ch sá»­ cÃ´ng viá»‡c tháº¥t báº¡i.', 'error');
      }
    } catch (error) {
      console.error('Lá»—i khi thÃªm lá»‹ch sá»­ cÃ´ng viá»‡c:', error);
      showNotification(error.message || 'Lá»—i há»‡ thá»‘ng, vui lÃ²ng thá»­ láº¡i.', 'error');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <>
      {/* Modal chÃ­nh Ä‘á»ƒ thÃªm Work History */}
      <Modal
        isOpen={isOpen}
        onClose={onClose}
        title={`ThÃªm Lá»‹ch sá»­ cho: ${employee.fullName}`}
        size="lg"
      >
        <form onSubmit={handleSubmit}>
          {/* TrÆ°á»ng hiá»ƒn thá»‹ mÃ£ nhÃ¢n viÃªn (khÃ´ng cho sá»­a) */}
          <div className="mb-3">
            <label htmlFor="employeeIdDisplay" className="form-label">MÃ£ nhÃ¢n viÃªn</label>
            <input
              id="employeeIdDisplay"
              type="text"
              className="form-control"
              value={employee.employeeId}
              disabled
            />
          </div>

          {/* Khu vá»±c chá»n Äá» xuáº¥t tuyá»ƒn dá»¥ng */}
          <div className="mb-4">
            <label className="form-label d-block">Äá» xuáº¥t tuyá»ƒn dá»¥ng <span className="text-danger">*</span></label>
            
            {/* Hiá»ƒn thá»‹ thÃ´ng tin Ä‘á» xuáº¥t náº¿u Ä‘Ã£ chá»n */}
            {selectedRecruitments.length > 0 ? (
              <div className="card mt-2 border-success bg-light">
                <div className="card-body p-2">
                  <div className="d-flex justify-content-between align-items-center">
                    <div>
                      <strong className="d-block">MÃ£ ÄX: {selectedRecruitments[0].requestNo}</strong>
                      <small className="text-muted">
                        Vá»‹ trÃ­: {selectedRecruitments[0].position} â€¢ PhÃ²ng ban: {selectedRecruitments[0].department}
                      </small>
                      <small className="d-block text-info">
                        Thá»i gian ÄX: {selectedRecruitments[0].fromDateFormatted} - {selectedRecruitments[0].toDateFormatted}
                      </small>
                    </div>
                    <div className="d-flex align-items-center gap-1">
                      <button
                        type="button"
                        className="btn btn-sm btn-outline-primary border-0"
                        title="Thay Ä‘á»•i lá»±a chá»n"
                        onClick={() => setIsRecruitmentModalOpen(true)}
                      >
                        <i className="bi bi-pencil-square"></i>
                      </button>
                      <button
                        type="button"
                        className="btn btn-sm btn-outline-danger border-0"
                        title="Bá» chá»n"
                        onClick={() => setSelectedRecruitments([])} // Reset máº£ng vá» rá»—ng
                      >
                        <i className="bi bi-x-lg"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            ) : (
              // Hiá»ƒn thá»‹ nÃºt chá»n náº¿u chÆ°a cÃ³ Ä‘á» xuáº¥t nÃ o
              <div className="d-flex align-items-center gap-2 mt-2">
                <button
                  type="button"
                  className="btn btn-outline-primary"
                  onClick={() => setIsRecruitmentModalOpen(true)}
                >
                  <i className="bi bi-search me-2"></i>
                  Chá»n Ä‘á» xuáº¥t
                </button>
              </div>
            )}
          </div>

          {/* âœ… THÃŠM: CÃ¡c trÆ°á»ng má»›i */}
          <div className="row mb-3">
            <div className="col-md-6">
              <label htmlFor="fromDate" className="form-label">
                Tá»« ngÃ y <span className="text-danger">*</span>
              </label>
              <input
                type="date"
                className="form-control"
                id="fromDate"
                name="fromDate"
                value={workHistoryData.fromDate}
                onChange={handleInputChange}
                disabled={isLoading}
              />
              <small className="form-text text-muted">
                NgÃ y báº¯t Ä‘áº§u lÃ m viá»‡c
              </small>
            </div>
            <div className="col-md-6">
              <label htmlFor="toDate" className="form-label">
                Äáº¿n ngÃ y <span className="text-danger">*</span>
              </label>
              <input
                type="date"
                className="form-control"
                id="toDate"
                name="toDate"
                value={workHistoryData.toDate}
                onChange={handleInputChange}
                disabled={isLoading}
              />
              <small className="form-text text-muted">
                NgÃ y káº¿t thÃºc lÃ m viá»‡c
              </small>
            </div>
          </div>

          <div className="mb-3">
            <label htmlFor="hourlyRate" className="form-label">
              Má»©c lÆ°Æ¡ng/giá» (VNÄ)
            </label>
            <input
              type="number"
              className="form-control"
              id="hourlyRate"
              name="hourlyRate"
              value={workHistoryData.hourlyRate}
              onChange={handleInputChange}
              min="0"
              step="1000"
              placeholder="VÃ­ dá»¥: 50000"
              disabled={isLoading}
            />
            <small className="form-text text-muted">
              Äá»ƒ trá»‘ng náº¿u sá»­ dá»¥ng má»©c lÆ°Æ¡ng máº·c Ä‘á»‹nh. Nháº­p sá»‘ Ä‘á»ƒ Ã¡p dá»¥ng má»©c lÆ°Æ¡ng Ä‘áº·c biá»‡t (ngÃ y lá»…, OT...)
            </small>
          </div>

          {/* âœ… THÃŠM: Cáº£nh bÃ¡o validation */}
          {selectedRecruitments.length > 0 && (workHistoryData.fromDate || workHistoryData.toDate) && (
            <div className="alert alert-info small">
              <i className="fas fa-info-circle me-2"></i>
              <strong>LÆ°u Ã½:</strong> Khoáº£ng thá»i gian lÃ m viá»‡c pháº£i náº±m trong khoáº£ng thá»i gian cá»§a Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng ({selectedRecruitments[0].fromDateFormatted} - {selectedRecruitments[0].toDateFormatted}).
            </div>
          )}

          {/* CÃ¡c nÃºt hÃ nh Ä‘á»™ng á»Ÿ chÃ¢n modal */}
          <div className="modal-footer px-0 pb-0 border-0">
            <button type="button" className="btn btn-secondary" onClick={onClose} disabled={isLoading}>
              Há»§y
            </button>
            <ButtonLoading
              type="submit"
              className="btn btn-primary"
              loading={isLoading}
              // NÃºt LÆ°u bá»‹ vÃ´ hiá»‡u hÃ³a khi Ä‘ang táº£i hoáº·c chÆ°a Ä‘á»§ thÃ´ng tin
              disabled={isLoading || selectedRecruitments.length === 0 || !workHistoryData.fromDate || !workHistoryData.toDate}
            >
              ThÃªm Lá»‹ch sá»­
            </ButtonLoading>
          </div>
        </form>
      </Modal>

      {/* Modal phá»¥ Ä‘á»ƒ chá»n Äá» xuáº¥t tuyá»ƒn dá»¥ng, chá»‰ hiá»‡n khi cáº§n */}
      {isRecruitmentModalOpen && (
        <RecruitmentModal
          isOpen={isRecruitmentModalOpen}
          onClose={() => setIsRecruitmentModalOpen(false)}
          onRecruitmentSelected={handleRecruitmentSelect}
          // Truyá»n máº£ng Ä‘Ã£ chá»n vÃ o Ä‘á»ƒ modal biáº¿t lá»±a chá»n hiá»‡n táº¡i
          selectedRecruitments={selectedRecruitments}
          // LuÃ´n giá»¯ singleSelect=true Ä‘á»ƒ Ä‘áº£m báº£o ngÆ°á»i dÃ¹ng chá»‰ chá»n 1
          singleSelect={true}
        />
      )}
    </>
  );
};

export default AddWorkHistoryModal;

```


==================== File: .\src\components\employee\EmployeeAddForm.jsx ====================

// src/components/employee/EmployeeAddForm.jsx

import React, { useState, useRef, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useNotification } from '../../hooks/useNotification';
import RecruitmentModal from './RecruitmentModal';

const EmployeeAddForm = ({ onSave, isLoading: externalLoading }) => {
  const navigate = useNavigate();
  const { showNotification } = useNotification();
  const fullNameInputRef = useRef(null);

  const [isSubmitting, setIsSubmitting] = useState(false);
  const [selectedRecruitment, setSelectedRecruitment] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  const initialFormData = {
    fullName: '',
    phoneNumber: '',
    gender: 'Nam',
    bankAccount: '',
    bankName: '',
  };

  const initialWorkHistoryData = {
    fromDate: '',
    toDate: '',
    hourlyRate: ''
  };

  const [formData, setFormData] = useState(initialFormData);
  const [workHistoryData, setWorkHistoryData] = useState(initialWorkHistoryData);

  const handleChange = e => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleWorkHistoryChange = e => {
    const { name, value } = e.target;
    setWorkHistoryData(prev => ({ ...prev, [name]: value }));
  };

  const resetForm = () => {
    setFormData(initialFormData);
    setWorkHistoryData(initialWorkHistoryData);
    setSelectedRecruitment(null);
    fullNameInputRef.current?.focus();
  };

  const handleSelectRecruitment = request => {
    setSelectedRecruitment(request);
    setIsModalOpen(false);
  };

  const handleRemoveRecruitment = () => {
    setSelectedRecruitment(null);
    setWorkHistoryData(initialWorkHistoryData);
  };

  const validateWorkHistory = () => {
    const errors = [];
    if (!workHistoryData.fromDate) errors.push('Tá»« ngÃ y lÃ  báº¯t buá»™c');
    if (!workHistoryData.toDate) errors.push('Äáº¿n ngÃ y lÃ  báº¯t buá»™c');

    if (workHistoryData.fromDate && workHistoryData.toDate) {

      const from = new Date(workHistoryData.fromDate);
      from.setHours(0, 0, 0, 0);
      const to = new Date(workHistoryData.toDate);
      to.setHours(0, 0, 0, 0);

      if (to < from) errors.push('Äáº¿n ngÃ y pháº£i lá»›n hÆ¡n hoáº·c báº±ng Tá»« ngÃ y');
      // âœ… VALIDATION  - Kiá»ƒm tra khoáº£ng ngÃ y
      if (selectedRecruitment) {
        const start = new Date(selectedRecruitment.fromDate);
        const end = new Date(selectedRecruitment.toDate);

        if (from < start || to > end) {
          errors.push(`Khoáº£ng thá»i gian pháº£i náº±m trong (${selectedRecruitment.fromDateFormatted} - ${selectedRecruitment.toDateFormatted})`);
        }
      }
    }
    // Validation má»©c lÆ°Æ¡ng/giá»
    if (workHistoryData.hourlyRate && (isNaN(workHistoryData.hourlyRate) || parseFloat(workHistoryData.hourlyRate) < 0)) {
      errors.push('Má»©c lÆ°Æ¡ng/giá» pháº£i lÃ  sá»‘ vÃ  khÃ´ng Ã¢m');
    }
    return errors;
  };

  const handleSubmit = async e => {
    e.preventDefault();
    if (!selectedRecruitment) {
      showNotification('Vui lÃ²ng chá»n má»™t Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng.', 'warning');
      return;
    }
    const errors = validateWorkHistory();
    if (errors.length) {
      showNotification(errors.join('. '), 'warning');
      return;
    }
    if (isSubmitting) return;
    setIsSubmitting(true);

    const payload = {
      ...formData,
      workHistoryData: [{
        requestNo: selectedRecruitment.requestNo,
        fromDate: workHistoryData.fromDate,
        toDate: workHistoryData.toDate,
        hourlyRate: workHistoryData.hourlyRate
          ? parseFloat(workHistoryData.hourlyRate)
          : undefined
      }]
    };

    try {
      const success = await onSave(payload);
      if (success) {
        showNotification('ThÃªm nhÃ¢n viÃªn thÃ nh cÃ´ng!', 'success');
        resetForm();
      } else {
        showNotification('ThÃªm nhÃ¢n viÃªn tháº¥t báº¡i.', 'error');
      }
    } catch (err) {
      showNotification(err.response?.data?.message || 'Lá»—i há»‡ thá»‘ng', 'error');
      console.error(err);
    } finally {
      setIsSubmitting(false);
    }
  };

  useEffect(() => {
    fullNameInputRef.current?.focus();
  }, []);

  const loading = externalLoading || isSubmitting;

  return (
    <div className="card">
      <div className="card-header">
        <h4 className="card-title mb-0">ThÃªm NhÃ¢n viÃªn Má»›i</h4>
      </div>
      <div className="card-body">
        <form onSubmit={handleSubmit}>
          {/* ThÃ´ng tin CÃ¡ nhÃ¢n */}
          <h5 className="mb-3">ThÃ´ng tin CÃ¡ nhÃ¢n</h5>
          <div className="row">
            <div className="col-md-6 mb-3">
              <label htmlFor="fullName" className="form-label">
                Há» tÃªn <span className="text-danger">*</span>
              </label>
              <input
                type="text"
                id="fullName"
                name="fullName"
                className="form-control"
                placeholder="Nháº­p há» tÃªn"
                value={formData.fullName}
                onChange={handleChange}
                required
                disabled={loading}
                ref={fullNameInputRef}
              />
            </div>
            <div className="col-md-6 mb-3">
              <label htmlFor="phoneNumber" className="form-label">
                Sá»‘ Ä‘iá»‡n thoáº¡i <span className="text-danger">*</span>
              </label>
              <input
                type="tel"
                id="phoneNumber"
                name="phoneNumber"
                className="form-control"
                placeholder="VÃ­ dá»¥: 0123456789"
                value={formData.phoneNumber}
                onChange={handleChange}
                required
                disabled={loading}
              />
            </div>
          </div>
          <div className="row">
            <div className="col-md-6 mb-3">
              <label htmlFor="gender" className="form-label">
                Giá»›i tÃ­nh <span className="text-danger">*</span>
              </label>
              <select
                id="gender"
                name="gender"
                className="form-select"
                value={formData.gender}
                onChange={handleChange}
                required
                disabled={loading}
              >
                <option value="Nam">Nam</option>
                <option value="Ná»¯">Ná»¯</option>
              </select>
            </div>
            {/* Pháº§n Má»©c lÆ°Æ¡ng/giá» máº·c Ä‘á»‹nh Ä‘Ã£ Ä‘Æ°á»£c loáº¡i bá» */}
          </div>

          {/* ThÃ´ng tin NgÃ¢n hÃ ng */}
          <h5 className="mb-3 mt-4">ThÃ´ng tin NgÃ¢n hÃ ng</h5>
          <div className="row">
            <div className="col-md-6 mb-3">
              <label htmlFor="bankAccount" className="form-label">
                Sá»‘ tÃ i khoáº£n <span className="text-danger">*</span>
              </label>
              <input
                type="text"
                id="bankAccount"
                name="bankAccount"
                className="form-control"
                placeholder="Nháº­p sá»‘ tÃ i khoáº£n"
                value={formData.bankAccount}
                onChange={handleChange}
                required
                disabled={loading}
              />
            </div>
            <div className="col-md-6 mb-3">
              <label htmlFor="bankName" className="form-label">
                TÃªn ngÃ¢n hÃ ng <span className="text-danger">*</span>
              </label>
              <input
                type="text"
                id="bankName"
                name="bankName"
                className="form-control"
                placeholder="VÃ­ dá»¥: Vietcombank"
                value={formData.bankName}
                onChange={handleChange}
                required
                disabled={loading}
              />
            </div>
          </div>

          <hr className="my-4" />

          {/* ThÃ´ng tin Tuyá»ƒn dá»¥ng */}
          <h5 className="mb-3">ThÃ´ng tin Tuyá»ƒn dá»¥ng</h5>
          {selectedRecruitment ? (
            <div className="alert alert-info d-flex justify-content-between align-items-center">
              <div>
                <strong>Äá» xuáº¥t:</strong> {selectedRecruitment.requestNo}<br/>
                <small className="text-muted">
                  {selectedRecruitment.department} â€“ {selectedRecruitment.position}
                </small><br/>
                <small className="text-info">
                  {selectedRecruitment.fromDateFormatted} â€“ {selectedRecruitment.toDateFormatted}
                </small>
              </div>
              <button
                type="button"
                className="btn-close"
                onClick={handleRemoveRecruitment}
                disabled={loading}
              />
            </div>
          ) : (
            <div className="alert alert-warning">
              <i className="fas fa-exclamation-triangle me-2"></i>
              ChÆ°a chá»n Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng.
            </div>
          )}

          <button
            type="button"
            className={`btn ${selectedRecruitment ? 'btn-secondary' : 'btn-primary'} mb-4`}
            onClick={() => setIsModalOpen(true)}
            disabled={!!selectedRecruitment || loading}
          >
            <i className="fas fa-search me-2"></i>
            {selectedRecruitment ? 'Thay Ä‘á»•i Äá» xuáº¥t' : 'Chá»n Äá» xuáº¥t Tuyá»ƒn dá»¥ng'}
          </button>

          {/* Chi tiáº¿t Thá»i gian & LÆ°Æ¡ng */}
          {selectedRecruitment && (
            <>
              <h6 className="mb-3">Chi tiáº¿t Thá»i gian &amp; LÆ°Æ¡ng</h6>
              <div className="row mb-3">
                <div className="col-md-6">
                  <label htmlFor="fromDate" className="form-label">
                    Tá»« ngÃ y <span className="text-danger">*</span>
                  </label>
                  <input
                    type="date"
                    id="fromDate"
                    name="fromDate"
                    className="form-control"
                    value={workHistoryData.fromDate}
                    onChange={handleWorkHistoryChange}
                    required
                    disabled={loading}
                  />
                </div>
                <div className="col-md-6">
                  <label htmlFor="toDate" className="form-label">
                    Äáº¿n ngÃ y <span className="text-danger">*</span>
                  </label>
                  <input
                    type="date"
                    id="toDate"
                    name="toDate"
                    className="form-control"
                    value={workHistoryData.toDate}
                    onChange={handleWorkHistoryChange}
                    required
                    disabled={loading}
                  />
                </div>
              </div>

              <div className="mb-3">
                <label htmlFor="workHistoryHourlyRate" className="form-label">
                  Má»©c lÆ°Æ¡ng/giá» (VNÄ)
                </label>
                <input
                  type="number"
                  id="workHistoryHourlyRate"
                  name="hourlyRate"
                  className="form-control"
                  placeholder="VÃ­ dá»¥: 30000"
                  min="0"
                  step="1000"
                  value={workHistoryData.hourlyRate}
                  onChange={handleWorkHistoryChange}
                  disabled={loading}
                />
                <small className="form-text text-muted">
                  Äá»ƒ trá»‘ng náº¿u dÃ¹ng má»©c lÆ°Æ¡ng máº·c Ä‘á»‹nh, nháº­p sá»‘ Ä‘á»ƒ ghi Ä‘Ã¨.
                </small>
              </div>

              { (workHistoryData.fromDate || workHistoryData.toDate) && (
                <div className="alert alert-info small">
                  <i className="fas fa-info-circle me-2"></i>
                  Khoáº£ng thá»i gian pháº£i náº±m trong ({selectedRecruitment.fromDateFormatted} â€“ {selectedRecruitment.toDateFormatted}).
                </div>
              )}
            </>
          )}

          {/* NÃºt hÃ nh Ä‘á»™ng cuá»‘i */}
          <div className="mt-4 d-flex justify-content-end gap-2">
            <button
              type="button"
              className="btn btn-outline-secondary"
              onClick={resetForm}
              disabled={loading}
            >
              <i className="fas fa-sync-alt me-2"></i>LÃ m má»›i Form
            </button>
            <button
              type="submit"
              className="btn btn-primary"
              disabled={loading || !selectedRecruitment || !workHistoryData.fromDate || !workHistoryData.toDate}
            >
              {loading ? (
                <>
                  <span className="spinner-border spinner-border-sm me-2" role="status"></span>
                  Äang lÆ°u...
                </>
              ) : (
                <>
                  <i className="fas fa-save me-2"></i>
                  LÆ°u NhÃ¢n viÃªn
                </>
              )}
            </button>
          </div>
        </form>
      </div>

      {/* Modal chá»n Äá» xuáº¥t Tuyá»ƒn dá»¥ng */}
      <RecruitmentModal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
        onRecruitmentSelected={handleSelectRecruitment}
      />
    </div>
  );
};

export default EmployeeAddForm;

```


==================== File: .\src\components\employee\EmployeeEditModal.jsx ====================

import React, { useState, useEffect } from 'react';
import { useNotification } from '../../hooks/useNotification';
import Modal from '../common/Modal.jsx';
import { ButtonLoading } from '../common/Loading.jsx';

const EmployeeEditModal = ({ isOpen, onClose, onSave, employee }) => {
    const [formData, setFormData] = useState({
    fullName: '',
    phoneNumber: '',
    gender: 'Nam',
    bankAccount: '',
    bankName: '',
    status: 'active',
  });
  //const [formData, setFormData] = useState({});
  const [loading, setLoading] = useState(false);
  const { showNotification } = useNotification();

  // Khi modal má»Ÿ hoáº·c nhÃ¢n viÃªn Ä‘Æ°á»£c chá»n thay Ä‘á»•i, cáº­p nháº­t state cá»§a form
  useEffect(() => {
    if (employee) {
      setFormData({
        fullName: employee.fullName || '',
        phoneNumber: employee.phoneNumber || '',
        gender: employee.gender || 'Nam',
        bankAccount: employee.bankAccount || '',
        bankName: employee.bankName || '',
        status: employee.status || 'active',
      });
    }
  }, [employee]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      // Gá»i hÃ m onSave Ä‘Æ°á»£c truyá»n tá»« EmployeeManagementPage. HÃ m nÃ y sáº½ gá»i hook useEmployees Ä‘á»ƒ thá»±c sá»± cáº­p nháº­t dá»¯ liá»‡u.
      const success = await onSave(formData);
      // if (success) {
      //   // Component cha (EmployeeManagementPage) sáº½ tá»± xá»­ lÃ½ viá»‡c Ä‘Ã³ng modal.
      // } else {
      //   // Náº¿u onSave tráº£ vá» false, hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i chung.
      //   showNotification('Cáº­p nháº­t tháº¥t báº¡i. Vui lÃ²ng thá»­ láº¡i.', 'error');
      // }
    } catch (error) {
      console.error('Lá»—i khi submit form sá»­a nhÃ¢n viÃªn:', error);
      showNotification(error.message || 'Lá»—i há»‡ thá»‘ng khi cáº­p nháº­t.', 'error');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen || !employee) return null;

  return (
    <Modal
      isOpen={isOpen}
      onClose={onClose}
      title={`Chá»‰nh sá»­a: ${employee.fullName}`}
    >
      <form onSubmit={handleSubmit}>
        <div className="row">
          <div className="col-md-6 mb-3">
            <label className="form-label">Há» tÃªn</label>
            <input name="fullName" value={formData.fullName} onChange={handleChange} className="form-control" required />
          </div>
          <div className="col-md-6 mb-3">
            <label className="form-label">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
            <input name="phoneNumber" value={formData.phoneNumber} onChange={handleChange} className="form-control" required />
          </div>
        </div>
        <div className="row">
          <div className="col-md-6 mb-3">
            <label className="form-label">Giá»›i tÃ­nh</label>
            <select name="gender" value={formData.gender} onChange={handleChange} className="form-select">
              <option value="Nam">Nam</option>
              <option value="Ná»¯">Ná»¯</option>
            </select>
          </div>
          {/* <div className="col-md-6 mb-3">
            <label className="form-label">LÆ°Æ¡ng/giá»</label>
            <input type="number" name="hourlyRate" value={formData.hourlyRate} onChange={handleChange} className="form-control" required min="0"/>
          </div> */}
        </div>
        <div className="row">
          <div className="col-md-6 mb-3">
            <label className="form-label">Sá»‘ tÃ i khoáº£n</label>
            <input name="bankAccount" value={formData.bankAccount} onChange={handleChange} className="form-control" />
          </div>
          <div className="col-md-6 mb-3">
            <label className="form-label">NgÃ¢n hÃ ng</label>
            <input name="bankName" value={formData.bankName} onChange={handleChange} className="form-control" />
          </div>
        </div>
        <div className="mb-3">
          <label className="form-label">Tráº¡ng thÃ¡i</label>
          <select name="status" value={formData.status} onChange={handleChange} className="form-select">
            <option value="active">Hoáº¡t Ä‘á»™ng</option>
            <option value="inactive">NgÆ°ng hoáº¡t Ä‘á»™ng</option>
          </select>
        </div>
        <div className="modal-footer border-0 px-0 pb-0">
          <button type="button" className="btn btn-secondary" onClick={onClose} disabled={loading}>
            Há»§y
          </button>
          <ButtonLoading type="submit" className="btn btn-primary" loading={loading}>
            LÆ°u thay Ä‘á»•i
          </ButtonLoading>
        </div>
      </form>
    </Modal>
  );
};

export default EmployeeEditModal;

```


==================== File: .\src\components\employee\EmployeeForm.jsx ====================

// src/components/employee/EmployeeForm.jsx

import React, { useState, useEffect } from 'react';

const EmployeeForm = ({ initialData, onSubmit, onCancel, isLoading }) => {
  const [formData, setFormData] = useState(initialData);

  useEffect(() => {
    setFormData(initialData);
  }, [initialData]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    onSubmit(formData);
  };

  return (
    <form onSubmit={handleSubmit}>
      <div className="row">
        <div className="col-md-6 mb-3">
          <label className="form-label">Há» tÃªn</label>
          <input name="fullName" value={formData.fullName} onChange={handleChange} className="form-control" required />
        </div>
        <div className="col-md-6 mb-3">
          <label className="form-label">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
          <input name="phoneNumber" value={formData.phoneNumber} onChange={handleChange} className="form-control" required />
        </div>
      </div>
      <div className="row">
        <div className="col-md-6 mb-3">
          <label className="form-label">Giá»›i tÃ­nh</label>
          <select name="gender" value={formData.gender} onChange={handleChange} className="form-select">
            <option value="Nam">Nam</option>
            <option value="Ná»¯">Ná»¯</option>
          </select>
        </div>
        <div className="col-md-6 mb-3">
          <label className="form-label">LÆ°Æ¡ng/giá»</label>
          <input type="number" name="hourlyRate" value={formData.hourlyRate} onChange={handleChange} className="form-control" required />
        </div>
      </div>
      <div className="row">
        <div className="col-md-6 mb-3">
          <label className="form-label">Sá»‘ tÃ i khoáº£n</label>
          <input name="bankAccount" value={formData.bankAccount} onChange={handleChange} className="form-control" />
        </div>
        <div className="col-md-6 mb-3">
          <label className="form-label">NgÃ¢n hÃ ng</label>
          <input name="bankName" value={formData.bankName} onChange={handleChange} className="form-control" />
        </div>
      </div>
      <div className="mb-3">
        <label className="form-label">Tráº¡ng thÃ¡i</label>
        <select name="status" value={formData.status} onChange={handleChange} className="form-select">
          <option value="active">Hoáº¡t Ä‘á»™ng</option>
          <option value="inactive">NgÆ°ng hoáº¡t Ä‘á»™ng</option>
        </select>
      </div>
      <div className="modal-footer">
        <button type="button" className="btn btn-secondary" onClick={onCancel} disabled={isLoading}>Há»§y</button>
        <button type="submit" className="btn btn-primary" disabled={isLoading}>
          {isLoading ? 'Äang lÆ°u...' : 'LÆ°u'}
        </button>
      </div>
    </form>
  );
};

export default EmployeeForm;

```


==================== File: .\src\components\employee\EmployeeList.jsx ====================

import React from 'react';
import EmployeeTable from './EmployeeTable';

const EmployeeList = ({ 
  employees, 
  onEdit, 
  onDelete, 
  onAddWorkHistory, 
  onManageWorkHistory // âœ… THAY Äá»”I: Äá»•i tÃªn tá»« onViewWorkHistory thÃ nh onManageWorkHistory
}) => {
  return (
    <div className="employee-list">
      <div className="mb-3">
        <small className="text-muted">
          Hiá»ƒn thá»‹ {employees.length} káº¿t quáº£
        </small>
      </div>
      <EmployeeTable
        employees={employees}
        onEdit={onEdit}
        onDelete={onDelete}
        onAddWorkHistory={onAddWorkHistory}
        onManageWorkHistory={onManageWorkHistory} // âœ… THAY Äá»”I: Truyá»n prop má»›i xuá»‘ng EmployeeTable
      />
    </div>
  );
};

export default EmployeeList;

```


==================== File: .\src\components\employee\EmployeeTable.jsx ====================

import React from 'react';

const EmployeeTable = ({ 
  employees, 
  onEdit, 
  onDelete, 
  onAddWorkHistory, 
  onManageWorkHistory
}) => {

  // âœ… Giá»¯ láº¡i pháº§n hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ¢n thiá»‡n khi khÃ´ng cÃ³ dá»¯ liá»‡u tá»« code cá»§a báº¡n.
  if (!employees || employees.length === 0) {
    return (
      <div className="text-center py-5">
        <p className="text-muted">KhÃ´ng cÃ³ dá»¯ liá»‡u nhÃ¢n viÃªn Ä‘á»ƒ hiá»ƒn thá»‹.</p>
        <p className="text-muted small">HÃ£y thá»­ thay Ä‘á»•i bá»™ lá»c hoáº·c thÃªm nhÃ¢n viÃªn má»›i.</p>
      </div>
    );
  }

  return (
    <div className="table-responsive">
      <table className="table table-hover table-striped align-middle">
        <thead className="table-dark">
          <tr>
            <th>MÃ£ NV</th>
            <th>Há» tÃªn</th>
            <th>Sá»‘ ÄT</th>
            <th>Giá»›i tÃ­nh</th>
            <th>TÃ i khoáº£n</th>
            <th>NgÃ¢n hÃ ng</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th className="text-center" style={{ minWidth: '180px' }}>Thao tÃ¡c</th> {/* âœ… TÄ‚NG chiá»u rá»™ng cho thÃªm nÃºt */}
          </tr>
        </thead>
        <tbody>
          {employees.map((employee) => (
            <tr key={employee.id}>
              <td>{employee.employeeId || 'N/A'}</td>
              <td>{employee.fullName || 'N/A'}</td>
              <td>{employee.phoneNumber || 'N/A'}</td>
              <td>{employee.gender || 'N/A'}</td>
              <td>{employee.bankAccount || 'N/A'}</td>
              <td>{employee.bankName || 'N/A'}</td>
              <td>
                <span className={`badge ${employee.status === 'active' ? 'bg-success' : 'bg-secondary'}`}>
                  {employee.status === 'active' ? 'Hoáº¡t Ä‘á»™ng' : 'NgÆ°ng'}
                </span>
              </td>
              <td className="text-center">
                <div className="btn-group" role="group">
                  {/* âœ… GIá»® Láº I: NÃºt ThÃªm Work History */}
                  {onAddWorkHistory && (
                    <button
                      className="btn btn-sm btn-success"
                      title="ThÃªm Lá»‹ch sá»­ cÃ´ng viá»‡c"
                      onClick={() => onAddWorkHistory(employee)}
                    >
                      <i className="fas fa-plus-circle"></i>
                    </button>
                  )}
                  
                  {/* âœ… THAY Äá»”I: NÃºt Quáº£n lÃ½ Work History (thay tháº¿ nÃºt Xem) */}
                  {onManageWorkHistory && (
                    <button
                      className="btn btn-sm btn-primary" // âœ… THAY Äá»”I: Äá»•i mÃ u tá»« info sang primary
                      title="Quáº£n lÃ½ Lá»‹ch sá»­ cÃ´ng viá»‡c" // âœ… THAY Äá»”I: Äá»•i tooltip
                      onClick={() => onManageWorkHistory(employee)}
                    >
                      <i className="fas fa-cogs"></i> {/* âœ… THAY Äá»”I: Äá»•i icon tá»« history sang cogs */}
                    </button>
                  )}
                  
                  {/* âœ… GIá»® Láº I: NÃºt Sá»­a */}
                  {onEdit && (
                     <button
                      className="btn btn-sm btn-warning" // âœ… THAY Äá»”I: Äá»•i mÃ u tá»« primary sang warning Ä‘á»ƒ phÃ¢n biá»‡t
                      title="Sá»­a thÃ´ng tin"
                      onClick={() => onEdit(employee)}
                    >
                      <i className="fas fa-pencil-alt"></i>
                    </button>
                  )}
                  
                  {/* âœ… GIá»® Láº I: NÃºt XÃ³a */}
                  {onDelete && (
                    <button
                      className="btn btn-sm btn-danger"
                      title="XÃ³a nhÃ¢n viÃªn"
                      onClick={() => {
                        if (window.confirm(`Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a nhÃ¢n viÃªn "${employee.fullName}"?`)) {
                          onDelete(employee.id);
                        }
                      }}
                    >
                      <i className="fas fa-trash"></i>
                    </button>
                  )}
                </div>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};

export default EmployeeTable;

```


==================== File: .\src\components\employee\RecruitmentModal.jsx ====================

import React, { useState, useEffect } from 'react';
// Sá»¬A ÄOáº N NÃ€Y: Import Ä‘Ãºng hÃ m getApprovedRecruitmentRequests tá»« services
import { getApprovedRecruitmentRequests } from '../../services/employee.js';
import { useNotification } from '../../hooks/useNotification';
import Loading from '../common/Loading';

const RecruitmentModal = ({ isOpen, onClose, onRecruitmentSelected, selectedRecruitment = null }) => {
  const [recruitmentRequests, setRecruitmentRequests] = useState([]);
  const [loading, setLoading] = useState(false);
  const [selectedItem, setSelectedItem] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const { showNotification } = useNotification();

  useEffect(() => {
    if (isOpen) {
      loadRecruitmentRequests();
      setSelectedItem(selectedRecruitment);
    }
  }, [isOpen, selectedRecruitment]);

  const loadRecruitmentRequests = async () => {
    try {
      setLoading(true);
      // Sá»¬A: Gá»i API Ä‘Ãºng hÃ m má»›i
      const data = await getApprovedRecruitmentRequests();
      setRecruitmentRequests(data || []);
    } catch (err) {
      showNotification('Lá»—i khi táº£i dá»¯ liá»‡u tuyá»ƒn dá»¥ng.', 'warning');
      setRecruitmentRequests(getMockData());
    } finally {
      setLoading(false);
    }
  };

  const getMockData = () => [
    {
      id: '1',
      requestNo: '202507140017',
      requester: '236LH.Nguyá»…n Huy ThÃ nh',
      status: 'Äang tuyá»ƒn dá»¥ng',
      department: '116 Cáº§u Giáº¥y',
      quantity: '2',
      gender: 'Nam/Ná»¯',
      fromDate: '2025-07-14',
      toDate: '2025-08-14',
      position: 'NhÃ¢n viÃªn bÃ¡n hÃ ng'
    },
    {
      id: '2',
      requestNo: '202507140018',
      requester: '225VVN.Nguyá»…n Trá»ng HoÃ ng An',
      status: 'Äang tuyá»ƒn dá»¥ng',
      department: 'TrÃ¢m Trá»—i',
      quantity: '1',
      gender: 'Ná»¯',
      fromDate: '2025-07-14',
      toDate: '2025-08-14',
      position: 'Thu ngÃ¢n'
    }
  ];

  const filteredData = recruitmentRequests.filter(item =>
    item.requestNo?.toLowerCase().includes(searchTerm.toLowerCase()) ||
    item.department?.toLowerCase().includes(searchTerm.toLowerCase()) ||
    item.requester?.toLowerCase().includes(searchTerm.toLowerCase()) ||
    item.position?.toLowerCase().includes(searchTerm.toLowerCase())
  );

  //const handleItemSelect = item => {
  //  setSelectedItem(selectedItem?.requestNo === item.requestNo ? null : item);
  //};

  // Trong hÃ m handleItemSelect, thÃªm logic xá»­ lÃ½ min/max

  const handleItemSelect = item => {
    console.log('ğŸ” User clicked item:', item);
    
    const relatedItems = filteredData.filter(dataItem => 
      dataItem.requestNo === item.requestNo
    );
    
    console.log(`ğŸ“‹ Found ${relatedItems.length} related items for ${item.requestNo}`);
    
    if (relatedItems.length === 1) {
      setSelectedItem(selectedItem?.requestNo === item.requestNo ? null : item);
      return;
    }
    
    const allFromDates = relatedItems
      .map(r => r.fromDate)
      .filter(date => date && typeof date === 'number') // Chá»‰ láº¥y timestamp numbers
      .sort((a, b) => a - b); // Sort timestamp ascending
      
    const allToDates = relatedItems
      .map(r => r.toDate)
      .filter(date => date && typeof date === 'number') // Chá»‰ láº¥y timestamp numbers
      .sort((a, b) => a - b); // Sort timestamp ascending
    
    console.log('ğŸ” DEBUG: Filtered timestamps:', { allFromDates, allToDates });
    
    const minFromDate = allFromDates[0]; // Earliest timestamp
    const maxToDate = allToDates[allToDates.length - 1]; // Latest timestamp
    
    console.log('ğŸ” DEBUG: Min/max timestamps:', { minFromDate, maxToDate });
    
    const formatTimestamp = (timestamp) => {
      if (!timestamp || typeof timestamp !== 'number') return null;
      
      try {
        const date = new Date(timestamp);
        if (isNaN(date.getTime())) return null;
        
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      } catch (error) {
        console.error('Error formatting timestamp:', error);
        return null;
      }
    };
    
    // âœ… Táº¡o merged item vá»›i timestamps Ä‘Ã£ xá»­ lÃ½
    const mergedItem = {
      ...item,
      fromDate: minFromDate,
      toDate: maxToDate,
      fromDateFormatted: formatTimestamp(minFromDate),
      toDateFormatted: formatTimestamp(maxToDate),
      originalRowCount: relatedItems.length,
      debugInfo: {
        allFromDates: allFromDates,
        allToDates: allToDates
      }
    };
    
    console.log('âœ… Final merged item:', mergedItem);
    console.log(`ğŸ“… Date range: ${mergedItem.fromDateFormatted} - ${mergedItem.toDateFormatted}`);
    
    setSelectedItem(selectedItem?.requestNo === item.requestNo ? null : mergedItem);
  };





  const handleConfirm = () => {
    if (!selectedItem) {
      showNotification('Vui lÃ²ng chá»n má»™t Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng', 'warning');
      return;
    }
    onRecruitmentSelected(selectedItem);
    onClose();
  };

  const handleCancel = () => {
    setSelectedItem(selectedRecruitment);
    setSearchTerm('');
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="modal fade show" style={{ display: 'block' }} tabIndex="-1">
      <div className="modal-dialog modal-xl">
        <div className="modal-content">
          <div className="modal-header">
            <h5 className="modal-title">
              <i className="fas fa-clipboard-list me-2"></i>
              Chá»n Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng
            </h5>
            <button type="button" className="btn-close" onClick={handleCancel}></button>
          </div>
          <div className="modal-body">
            {/* Ã” tÃ¬m kiáº¿m */}
            <div className="row mb-3">
              <div className="col-12">
                <div className="input-group">
                  <span className="input-group-text">
                    <i className="fas fa-search"></i>
                  </span>
                  <input
                    type="text"
                    className="form-control"
                    placeholder="TÃ¬m kiáº¿m theo Request No, PhÃ²ng ban, NgÆ°á»i yÃªu cáº§u, Vá»‹ trÃ­..."
                    value={searchTerm}
                    onChange={e => setSearchTerm(e.target.value)}
                  />
                  {searchTerm && (
                    <button
                      className="btn btn-outline-secondary"
                      type="button"
                      onClick={() => setSearchTerm('')}
                    >
                      <i className="fas fa-times"></i>
                    </button>
                  )}
                </div>
              </div>
            </div>

            {/* Selected Info */}
            {selectedItem && (
              <div className="alert alert-info">
                <i className="fas fa-info-circle me-2"></i>
                ÄÃ£ chá»n: <strong>{selectedItem.requestNo}</strong> - {selectedItem.position} ({selectedItem.department})
              </div>
            )}

            {loading ? (
              <Loading text="Äang táº£i danh sÃ¡ch Ä‘á» xuáº¥t..." />
            ) : (
              <div className="table-responsive" style={{ maxHeight: '400px', overflowY: 'auto' }}>
                <table className="table table-striped table-hover">
                  <thead className="table-dark sticky-top">
                    <tr>
                      <th width="50"><i className="fas fa-check"></i></th>
                      <th>Request No.</th>
                      <th>Vá»‹ trÃ­ tuyá»ƒn dá»¥ng</th>
                      <th>NgÆ°á»i yÃªu cáº§u</th>
                      <th>PhÃ²ng ban</th>
                      <th>Sá»‘ lÆ°á»£ng</th>
                      <th>Giá»›i tÃ­nh</th>
                      <th>Thá»i gian</th>
                      <th>Tráº¡ng thÃ¡i</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredData.map(item => {
                      const isSelected = selectedItem?.requestNo === item.requestNo;
                      return (
                        <tr
                          key={item.id || item.requestNo}
                          className={isSelected ? 'table-primary' : ''}
                          style={{ cursor: 'pointer' }}
                          onClick={() => handleItemSelect(item)}
                        >
                          <td>
                            <input
                              type="radio"
                              className="form-check-input"
                              checked={isSelected}
                              onChange={() => handleItemSelect(item)}
                            />
                          </td>
                          <td><strong className="text-primary">{item.requestNo}</strong></td>
                          <td><span className="badge bg-info">{item.position || 'N/A'}</span></td>
                          <td>{item.requester}</td>
                          <td><span className="badge bg-secondary">{item.department}</span></td>
                          <td className="text-center"><span className="badge bg-warning text-dark">{item.quantity}</span></td>
                          <td><span className="badge bg-light text-dark">{item.gender}</span></td>
                          <td>
                            <small>
                              {item.fromDateFormatted}<br />
                              Ä‘áº¿n {item.toDateFormatted}
                            </small>
                          </td>
                          <td>
                            <span className={`badge ${item.status === 'Äang tuyá»ƒn dá»¥ng' ? 'bg-success' : 'bg-warning'}`}>
                              {item.status}
                            </span>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
                {filteredData.length === 0 && (
                  <div className="text-center py-4">
                    <i className="fas fa-search fa-3x text-muted mb-3"></i>
                    <p className="text-muted">
                      {searchTerm ? 'KhÃ´ng tÃ¬m tháº¥y Ä‘á» xuáº¥t phÃ¹ há»£p' : 'ChÆ°a cÃ³ Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng nÃ o'}
                    </p>
                  </div>
                )}
              </div>
            )}
          </div>
          <div className="modal-footer">
            <button type="button" className="btn btn-secondary" onClick={handleCancel}>
              <i className="fas fa-times me-2"></i>Há»§y
            </button>
            <button
              type="button"
              className="btn btn-primary"
              onClick={handleConfirm}
              disabled={!selectedItem || loading}
            >
              <i className="fas fa-check me-2"></i>
              XÃ¡c nháº­n{selectedItem ? ` (${selectedItem.requestNo})` : ''}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default RecruitmentModal;

```


==================== File: .\src\components\employee\WorkHistoryModal.jsx ====================

import React, { useState, useEffect } from 'react';
import { getWorkHistory, addWorkHistory, updateWorkHistory, deleteWorkHistory } from '../../services/employee.js';
import { useNotification } from '../../hooks/useNotification';
import Modal from '../common/Modal.jsx';
import Loading from '../common/Loading.jsx';
import RecruitmentModal from './RecruitmentModal.jsx';
import { ButtonLoading } from '../common/Loading.jsx';

const WorkHistoryModal = ({ isOpen, onClose, employeeId, employeeName, workHistory,onDataChanged  }) => {
  // ===== STATE MANAGEMENT =====
  const [workHistoryData, setWorkHistoryData] = useState([]);
  const [loading, setLoading] = useState(false);
  const [mode, setMode] = useState('view'); // 'view' | 'add' | 'edit'
  const [selectedWorkHistory, setSelectedWorkHistory] = useState(null);
  const [isRecruitmentModalOpen, setIsRecruitmentModalOpen] = useState(false);
  const [selectedRecruitment, setSelectedRecruitment] = useState(null);
  const [saving, setSaving] = useState(false);
  
  // Form data cho add/edit
  const [formData, setFormData] = useState({
    fromDate: '',
    toDate: '',
    hourlyRate: ''
  });

  const { showNotification } = useNotification();

  // ===== EFFECTS =====
  useEffect(() => {
    if (isOpen && employeeId && !workHistory) {
      fetchWorkHistory();
    } else if (workHistory) {
      setWorkHistoryData(workHistory);
    }
    // Reset vá» view mode khi má»Ÿ modal
    setMode('view');
    resetForm();
  }, [isOpen, employeeId, workHistory]);

  // ===== DATA FETCHING =====
  const fetchWorkHistory = async () => {
    setLoading(true);
    try {
      const response = await getWorkHistory(employeeId);
      setWorkHistoryData(response || []);
    } catch (error) {
      console.error('Lá»—i khi táº£i lá»‹ch sá»­ cÃ´ng viá»‡c:', error);
      showNotification(error.message || 'Lá»—i káº¿t ná»‘i Ä‘áº¿n server', 'error');
    } finally {
      setLoading(false);
    }
  };

  // ===== FORM HANDLING =====
  const resetForm = () => {
    setFormData({
      fromDate: '',
      toDate: '',
      hourlyRate: ''
    });
    setSelectedRecruitment(null);
    setSelectedWorkHistory(null);
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  // ===== MODE SWITCHING =====
  const handleAddNew = () => {
    resetForm();
    setMode('add');
  };

  const handleEdit = (item) => {
    setSelectedWorkHistory(item);
    setFormData({
      fromDate: item.fromDate || '',
      toDate: item.toDate || '',
      hourlyRate: item.hourlyRate || ''
    });
    // Táº¡o mock recruitment object tá»« requestNo
    setSelectedRecruitment({
      requestNo: item.requestNo,
      position: 'N/A',
      department: 'N/A'
    });
    setMode('edit');
  };

  const handleCancel = () => {
    resetForm();
    setMode('view');
  };

  // ===== RECRUITMENT SELECTION =====
  const handleRecruitmentSelect = (recruitment) => {
    setSelectedRecruitment(recruitment);
    setIsRecruitmentModalOpen(false);
  };

  // ===== VALIDATION =====
  const validateForm = () => {
    const errors = [];

    if (mode === 'add' && !selectedRecruitment) {
      errors.push('Vui lÃ²ng chá»n má»™t Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng.');
    }

    if (!formData.fromDate) {
      errors.push('Tá»« ngÃ y lÃ  báº¯t buá»™c.');
    }

    if (!formData.toDate) {
      errors.push('Äáº¿n ngÃ y lÃ  báº¯t buá»™c.');
    }

    if (formData.fromDate && formData.toDate) {
      const fromDate = new Date(formData.fromDate);
      const toDate = new Date(formData.toDate);
      
      if (toDate < fromDate) {
        errors.push('Äáº¿n ngÃ y pháº£i lá»›n hÆ¡n hoáº·c báº±ng Tá»« ngÃ y.');
      }
    }

    if (formData.hourlyRate && (isNaN(formData.hourlyRate) || parseFloat(formData.hourlyRate) < 0)) {
      errors.push('Má»©c lÆ°Æ¡ng/giá» pháº£i lÃ  sá»‘ vÃ  khÃ´ng Ä‘Æ°á»£c Ã¢m.');
    }

    return errors;
  };

  // ===== CRUD OPERATIONS =====
  const handleSave = async () => {
    const validationErrors = validateForm();
    if (validationErrors.length > 0) {
      showNotification(validationErrors.join(' '), 'warning');
      return;
    }

    setSaving(true);
    try {
      const payload = {
        employeeId: employeeId,
        requestNo: selectedRecruitment?.requestNo || selectedWorkHistory?.requestNo,
        fromDate: formData.fromDate,
        toDate: formData.toDate,
        hourlyRate: formData.hourlyRate ? parseFloat(formData.hourlyRate) : undefined,
      };

      let response;
      if (mode === 'add') {
        response = await addWorkHistory(payload);
      } else if (mode === 'edit') {
        response = await updateWorkHistory(selectedWorkHistory.id, payload);
      }

      if (response.success) {
        showNotification(
          mode === 'add' ? 'ThÃªm lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng!' : 'Cáº­p nháº­t lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng!', 
          'success'
        );
        await fetchWorkHistory(); // Refresh data
        if (onDataChanged) {
          onDataChanged();
        }
        setMode('view');
        resetForm();
      } else {
        showNotification(response.message || 'CÃ³ lá»—i xáº£y ra', 'error');
      }
    } catch (error) {
      console.error('Lá»—i khi lÆ°u:', error);
      showNotification(error.message || 'Lá»—i há»‡ thá»‘ng', 'error');
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async (item) => {
    if (!window.confirm(`Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a lá»‹ch sá»­ cÃ´ng viá»‡c "${safeRenderRequestNo(item.requestNo)}"?`)) {
      return;
    }

    setSaving(true);
    try {
      const response = await deleteWorkHistory(item.id);
      if (response.success) {
        showNotification('XÃ³a lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng!', 'success');
        await fetchWorkHistory(); // Refresh data
        if (onDataChanged) {
          onDataChanged();
        }
      } else {
        showNotification(response.message || 'CÃ³ lá»—i xáº£y ra khi xÃ³a', 'error');
      }
    } catch (error) {
      console.error('Lá»—i khi xÃ³a:', error);
      showNotification(error.message || 'Lá»—i há»‡ thá»‘ng', 'error');
    } finally {
      setSaving(false);
    }
  };

  // ===== HELPER FUNCTIONS =====
  const safeRender = (value, fallback = 'N/A') => {
    if (value === null || value === undefined) return fallback;
    
    if (typeof value === 'object') {
      if (value.text) return value.text;
      if (value.link) return value.link;
      if (Array.isArray(value) && value.length > 0) {
        return safeRender(value[0]);
      }
      return JSON.stringify(value);
    }
    
    return String(value);
  };

  // âœ… Sá»¬A: HÃ m riÃªng Ä‘á»ƒ xá»­ lÃ½ requestNo (Æ°u tiÃªn text)
  const safeRenderRequestNo = (requestNo) => {
    if (!requestNo) return 'N/A';
    
    if (typeof requestNo === 'object') {
      // Æ¯u tiÃªn text trÆ°á»›c, sau Ä‘Ã³ má»›i Ä‘áº¿n link
      if (requestNo.text) return requestNo.text;
      if (requestNo.link) return requestNo.link;
      if (Array.isArray(requestNo) && requestNo.length > 0) {
        return safeRenderRequestNo(requestNo[0]);
      }
      return JSON.stringify(requestNo);
    }
    
    return String(requestNo);
  };

  // âœ… Sá»¬A: HÃ m format ngÃ y Ä‘á»ƒ xá»­ lÃ½ array timestamp
  const formatDate = (dateValue) => {
    if (!dateValue) return 'N/A';
    
    try {
      let timestamp = dateValue;
      
      // âœ… Sá»¬A: Xá»­ lÃ½ array chá»©a timestamp
      if (Array.isArray(dateValue) && dateValue.length > 0) {
        timestamp = dateValue[0];
      }
      
      // Chuyá»ƒn Ä‘á»•i timestamp thÃ nh Date object
      const date = new Date(timestamp);
      
      if (isNaN(date.getTime())) return 'N/A';
      
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    } catch (error) {
      console.error('Error formatting date:', error);
      return 'N/A';
    }
  };

  const formatCurrency = (amount) => {
    if (!amount || amount === 0) return 'N/A';
    try {
      return new Intl.NumberFormat('vi-VN', { 
        style: 'currency', 
        currency: 'VND' 
      }).format(amount);
    } catch (error) {
      return `${amount} VNÄ`;
    }
  };

  // ===== RENDER FUNCTIONS =====
  const renderViewMode = () => (
    <div>
      {/* Header Actions */}
      <div className="d-flex justify-content-between align-items-center mb-3">
        <h6 className="mb-0">Danh sÃ¡ch lá»‹ch sá»­ cÃ´ng viá»‡c</h6>
        <div className="btn-group">
          <button 
            className="btn btn-primary btn-sm" 
            onClick={handleAddNew}
            disabled={loading || saving}
          >
            <i className="fas fa-plus me-2"></i>
            ThÃªm má»›i
          </button>
          <button 
            className="btn btn-outline-secondary btn-sm" 
            onClick={fetchWorkHistory}
            disabled={loading || saving}
          >
            <i className={`fas fa-sync-alt me-2 ${loading ? 'fa-spin' : ''}`}></i>
            LÃ m má»›i
          </button>
        </div>
      </div>

      {workHistoryData.length === 0 ? (
        <div className="text-center py-4">
          <i className="fas fa-history fa-3x text-muted mb-3"></i>
          <p className="text-muted">NhÃ¢n viÃªn nÃ y chÆ°a cÃ³ lá»‹ch sá»­ lÃ m viá»‡c.</p>
          <button className="btn btn-primary" onClick={handleAddNew}>
            <i className="fas fa-plus me-2"></i>
            ThÃªm lá»‹ch sá»­ Ä‘áº§u tiÃªn
          </button>
        </div>
      ) : (
        <>
          <div className="table-responsive">
            <table className="table table-striped table-hover">
              <thead className="table-dark">
                <tr>
                  <th>Request No.</th>
                  <th>Tá»« ngÃ y</th>
                  <th>Äáº¿n ngÃ y</th>
                  <th>Má»©c lÆ°Æ¡ng/giá»</th>
                  {/* âœ… Bá»: Cá»™t "Thá»i gian táº¡o" */}
                  <th className="text-center">Thao tÃ¡c</th>
                </tr>
              </thead>
              <tbody>
                {workHistoryData.map((item, index) => (
                  <tr key={item.id || index}>
                    <td>
                      <span className="badge bg-primary fs-6">
                        {safeRenderRequestNo(item.requestNo)}
                      </span>
                    </td>
                    <td>
                      <span className="text-info">
                        {formatDate(item.fromDate)}
                      </span>
                    </td>
                    <td>
                      <span className="text-info">
                        {formatDate(item.toDate)}
                      </span>
                    </td>
                    <td>
                      {item.hourlyRate ? (
                        <span className="badge bg-success">
                          {formatCurrency(item.hourlyRate)}
                        </span>
                      ) : (
                        <span className="text-muted">Máº·c Ä‘á»‹nh</span>
                      )}
                    </td>
                    {/* âœ… Bá»: Cá»™t "Thá»i gian táº¡o" */}
                    <td className="text-center">
                      <div className="btn-group" role="group">
                        <button
                          className="btn btn-sm btn-warning"
                          title="Sá»­a"
                          onClick={() => handleEdit(item)}
                          disabled={saving}
                        >
                          <i className="fas fa-edit"></i>
                        </button>
                        <button
                          className="btn btn-sm btn-danger"
                          title="XÃ³a"
                          onClick={() => handleDelete(item)}
                          disabled={saving}
                        >
                          <i className="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {/* âœ… Bá»: Pháº§n thá»‘ng kÃª tá»•ng quan */}
        </>
      )}
    </div>
  );

  const renderFormMode = () => (
    <div>
      {/* Header */}
      <div className="d-flex justify-content-between align-items-center mb-3">
        <h6 className="mb-0">
          {mode === 'add' ? 'ThÃªm lá»‹ch sá»­ cÃ´ng viá»‡c má»›i' : 'Chá»‰nh sá»­a lá»‹ch sá»­ cÃ´ng viá»‡c'}
        </h6>
        <button 
          className="btn btn-outline-secondary btn-sm" 
          onClick={handleCancel}
          disabled={saving}
        >
          <i className="fas fa-arrow-left me-2"></i>
          Quay láº¡i
        </button>
      </div>

      <form onSubmit={(e) => { e.preventDefault(); handleSave(); }}>
        {/* Employee ID (read-only) */}
        <div className="mb-3">
          <label className="form-label">MÃ£ nhÃ¢n viÃªn</label>
          <input
            type="text"
            className="form-control"
            value={employeeId}
            disabled
          />
        </div>

        {/* Recruitment Selection - chá»‰ hiá»‡n khi add */}
        {mode === 'add' && (
          <div className="mb-4">
            <label className="form-label d-block">
              Äá» xuáº¥t tuyá»ƒn dá»¥ng <span className="text-danger">*</span>
            </label>
            
            {selectedRecruitment ? (
              <div className="card mt-2 border-success bg-light">
                <div className="card-body p-2">
                  <div className="d-flex justify-content-between align-items-center">
                    <div>
                      <strong className="d-block">MÃ£ ÄX: {selectedRecruitment.requestNo}</strong>
                      <small className="text-muted">
                        Vá»‹ trÃ­: {selectedRecruitment.position} â€¢ PhÃ²ng ban: {selectedRecruitment.department}
                      </small>
                    </div>
                    <div className="d-flex align-items-center gap-1">
                      <button
                        type="button"
                        className="btn btn-sm btn-outline-primary border-0"
                        title="Thay Ä‘á»•i lá»±a chá»n"
                        onClick={() => setIsRecruitmentModalOpen(true)}
                        disabled={saving}
                      >
                        <i className="fas fa-pencil-alt"></i>
                      </button>
                      <button
                        type="button"
                        className="btn btn-sm btn-outline-danger border-0"
                        title="Bá» chá»n"
                        onClick={() => setSelectedRecruitment(null)}
                        disabled={saving}
                      >
                        <i className="fas fa-times"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            ) : (
              <div className="d-flex align-items-center gap-2 mt-2">
                <button
                  type="button"
                  className="btn btn-outline-primary"
                  onClick={() => setIsRecruitmentModalOpen(true)}
                  disabled={saving}
                >
                  <i className="fas fa-search me-2"></i>
                  Chá»n Ä‘á» xuáº¥t
                </button>
              </div>
            )}
          </div>
        )}

        {/* Request No - chá»‰ hiá»ƒn thá»‹ khi edit */}
        {mode === 'edit' && (
          <div className="mb-3">
            <label className="form-label">Request No.</label>
            <input
              type="text"
              className="form-control"
              value={safeRenderRequestNo(selectedWorkHistory?.requestNo) || ''}
              disabled
            />
          </div>
        )}

        {/* Date Range */}
        <div className="row mb-3">
          <div className="col-md-6">
            <label className="form-label">
              Tá»« ngÃ y <span className="text-danger">*</span>
            </label>
            <input
              type="date"
              className="form-control"
              name="fromDate"
              value={formData.fromDate}
              onChange={handleInputChange}
              disabled={saving}
            />
          </div>
          <div className="col-md-6">
            <label className="form-label">
              Äáº¿n ngÃ y <span className="text-danger">*</span>
            </label>
            <input
              type="date"
              className="form-control"
              name="toDate"
              value={formData.toDate}
              onChange={handleInputChange}
              disabled={saving}
            />
          </div>
        </div>

        {/* Hourly Rate */}
        <div className="mb-3">
          <label className="form-label">
            Má»©c lÆ°Æ¡ng/giá» (VNÄ)
          </label>
          <input
            type="number"
            className="form-control"
            name="hourlyRate"
            value={formData.hourlyRate}
            onChange={handleInputChange}
            min="0"
            step="1000"
            placeholder="VÃ­ dá»¥: 50000"
            disabled={saving}
          />
          <small className="form-text text-muted">
            Äá»ƒ trá»‘ng náº¿u sá»­ dá»¥ng má»©c lÆ°Æ¡ng máº·c Ä‘á»‹nh
          </small>
        </div>

        {/* Form Actions */}
        <div className="d-flex justify-content-end gap-2">
          <button 
            type="button"
            className="btn btn-secondary" 
            onClick={handleCancel}
            disabled={saving}
          >
            Há»§y
          </button>
          <ButtonLoading
            type="submit"
            className="btn btn-primary"
            loading={saving}
            disabled={saving || (mode === 'add' && !selectedRecruitment)}
          >
            {mode === 'add' ? 'ThÃªm má»›i' : 'Cáº­p nháº­t'}
          </ButtonLoading>
        </div>
      </form>
    </div>
  );

  if (!isOpen) return null;

  return (
    <>
      <Modal 
        isOpen={isOpen} 
        onClose={onClose}
        title={`Quáº£n lÃ½ lá»‹ch sá»­ lÃ m viá»‡c - ${employeeName || employeeId}`}
        size="xl"
      >
        {loading ? (
          <Loading text="Äang táº£i lá»‹ch sá»­..." />
        ) : (
          <>
            {mode === 'view' ? renderViewMode() : renderFormMode()}
            
            {/* Footer - chá»‰ hiá»‡n khi á»Ÿ view mode */}
            {mode === 'view' && (
              <div className="modal-footer border-0 px-0 pb-0 mt-3">
                <button type="button" className="btn btn-secondary" onClick={onClose}>
                  ÄÃ³ng
                </button>
              </div>
            )}
          </>
        )}
      </Modal>

      {/* Recruitment Selection Modal */}
      {isRecruitmentModalOpen && (
        <RecruitmentModal
          isOpen={isRecruitmentModalOpen}
          onClose={() => setIsRecruitmentModalOpen(false)}
          onRecruitmentSelected={handleRecruitmentSelect}
          selectedRecruitment={selectedRecruitment}
          singleSelect={true}
        />
      )}
    </>
  );
};

export default WorkHistoryModal;

```


==================== File: .\src\components\layout\Layout.jsx ====================

import React, { useEffect } from 'react';
import { Outlet, useLocation } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';
import ResponsiveNavigation from './ResponsiveNavigation';

const Layout = () => {
  const { user } = useAuth();
  const location = useLocation();

  useEffect(() => {
    // Initialize tooltips when location changes
    if (typeof window !== 'undefined' && window.bootstrap) {
      const tooltipTriggerList = [].slice.call(
        document.querySelectorAll('[data-bs-toggle="tooltip"]')
      );
      tooltipTriggerList.map(tooltipTriggerEl => {
        return new window.bootstrap.Tooltip(tooltipTriggerEl);
      });
    }
  }, [location]);

  if (!user) {
    return (
      <div className="d-flex justify-content-center align-items-center min-vh-100">
        <div className="spinner-border" role="status">
          <span className="visually-hidden">Loading...</span>
        </div>
      </div>
    );
  }

  return (
    <div className="d-flex">
      <ResponsiveNavigation />
      
      {/* Main content */}
      <div className="flex-grow-1">
        <main className="container-fluid py-4">
          <Outlet />
        </main>
      </div>

      {/* âœ… BÆ¯á»šC 2: XÃ³a bá» Alert Container khá»i Ä‘Ã¢y */}
      {/* Div Ä‘Ã£ Ä‘Æ°á»£c di chuyá»ƒn ra App.jsx */}
    </div>
  );
};

export default Layout;

```


==================== File: .\src\components\layout\ResponsiveNavigation.jsx ====================

import React, { useState, useEffect } from 'react';
import { useLocation, Link } from 'react-router-dom'; // âœ… THÃŠM Link
import { useAuth } from '../../hooks/useAuth';
import { useNotification } from '../../hooks/useNotification';

const ResponsiveNavigation = () => {
  const [isMobile, setIsMobile] = useState(false);
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [dropdownOpen, setDropdownOpen] = useState(false);
  
  const { user, logout } = useAuth();
  const { showNotification } = useNotification();
  const location = useLocation();

  // Detect mobile screen
  useEffect(() => {
    const checkScreenSize = () => {
      setIsMobile(window.innerWidth < 768);
    };
    
    checkScreenSize();
    window.addEventListener('resize', checkScreenSize);
    return () => window.removeEventListener('resize', checkScreenSize);
  }, []);

  // âœ… Sá»¬A: Menu items configuration - THÃŠM 'sales' vÃ o attendance-logs
  const menuItems = [
    {
      path: '/employee-management',
      icon: 'fas fa-users-cog',
      label: 'Quáº£n lÃ½ nhÃ¢n viÃªn',
      roles: ['admin', 'hr']
    },
    {
      path: '/hr-dashboard',
      icon: 'fas fa-chart-bar',
      label: 'HR Dashboard',
      roles: ['admin', 'hr']
    },
    {
      path: '/attendance-logs',
      icon: 'fas fa-clock',
      label: 'Báº£n ghi cháº¥m cÃ´ng',
      roles: ['admin', 'hr', 'sales', 'sales_manager', 'finance_manager', 'director'] // âœ… THÃŠM 'sales'
    }
  ];

  const filteredMenuItems = menuItems.filter(item => 
    item.roles.includes(user?.role)
  );

  const isActiveRoute = (path) => {
    return location.pathname === path || location.pathname.startsWith(path + '/');
  };

  const handleLogout = async () => {
    try {
      await logout();
      showNotification('ÄÄƒng xuáº¥t thÃ nh cÃ´ng!', 'success');
    } catch (error) {
      console.error('Logout error:', error);
      showNotification('Lá»—i khi Ä‘Äƒng xuáº¥t', 'error');
    }
  };

  // Desktop Navigation (Always visible sidebar)
  const DesktopNavigation = () => (
    <div className="d-none d-md-flex">
      {/* Desktop Sidebar */}
      <div className="bg-light border-end" style={{ width: '280px', minHeight: '100vh' }}>
        {/* Brand Header */}
        <div className="p-3 border-bottom">
          <div className="d-flex align-items-center">
            <div className="rounded-circle bg-primary d-flex align-items-center justify-content-center me-2" 
                 style={{ width: '40px', height: '40px' }}>
              <i className="fas fa-user text-white"></i>
            </div>
            <div>
              <div className="fw-semibold">{user?.fullName}</div>
              <small className="text-muted">{getRoleDisplayName(user?.role)}</small>
            </div>
          </div>
        </div>

        {/* Navigation Menu */}
        <nav className="flex-grow-1 p-2">
          {filteredMenuItems.map((item, index) => (
            <Link // âœ… Sá»¬A: DÃ¹ng Link thay vÃ¬ <a href>
              key={index}
              to={item.path}
              className={`nav-link d-flex align-items-center rounded mb-1 p-3 text-decoration-none ${
                isActiveRoute(item.path) ? 'active bg-primary text-white' : 'text-dark'
              }`}
            >
              <i className={`${item.icon} me-2`}></i>
              <span>{item.label}</span>
            </Link>
          ))}
        </nav>

        {/* User Actions */}
        <div className="border-top p-3">
          <button 
            className="btn btn-outline-danger w-100"
            onClick={handleLogout}
          >
            <i className="fas fa-sign-out-alt me-2"></i>
            ÄÄƒng xuáº¥t
          </button>
        </div>
      </div>
    </div>
  );

  // Mobile Navigation (Top navbar + collapsible menu)
  const MobileNavigation = () => (
    <div className="d-md-none">
      {/* Mobile Top Bar */}
      <nav className="navbar navbar-dark bg-dark">
        <div className="container-fluid">
          <Link className="navbar-brand" to="/dashboard"> {/* âœ… Sá»¬A: Link thay vÃ¬ <a> */}
            <i className="fas fa-users me-2"></i>
            HR Management
          </Link>
          
          <button
            className="navbar-toggler"
            type="button"
            onClick={() => setSidebarOpen(!sidebarOpen)}
          >
            <span className="navbar-toggler-icon"></span>
          </button>
        </div>
      </nav>

      {/* Mobile Sidebar Overlay */}
      {sidebarOpen && (
        <>
          {/* Backdrop */}
          <div 
            className="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50"
            style={{ zIndex: 1040 }}
            onClick={() => setSidebarOpen(false)}
          ></div>
          
          {/* Mobile Sidebar */}
          <div 
            className="position-fixed top-0 start-0 bg-light h-100"
            style={{ width: '280px', zIndex: 1050 }}
          >
            {/* Mobile Header */}
            <div className="p-3 border-bottom d-flex justify-content-between align-items-center">
              <div className="d-flex align-items-center">
                <div className="rounded-circle bg-primary d-flex align-items-center justify-content-center me-2" 
                     style={{ width: '32px', height: '32px' }}>
                  <i className="fas fa-user text-white"></i>
                </div>
                <div>
                  <div className="fw-semibold small">{user?.fullName}</div>
                  <small className="text-muted">{getRoleDisplayName(user?.role)}</small>
                </div>
              </div>
              <button 
                className="btn btn-sm btn-outline-secondary"
                onClick={() => setSidebarOpen(false)}
              >
                <i className="fas fa-times"></i>
              </button>
            </div>

            {/* Mobile Menu */}
            <nav className="p-2">
              {filteredMenuItems.map((item, index) => (
                <Link // âœ… Sá»¬A: Link thay vÃ¬ <a href>
                  key={index}
                  to={item.path}
                  className={`nav-link d-flex align-items-center rounded mb-1 p-3 text-decoration-none ${
                    isActiveRoute(item.path) ? 'active bg-primary text-white' : 'text-dark'
                  }`}
                  onClick={() => setSidebarOpen(false)}
                >
                  <i className={`${item.icon} me-2`}></i>
                  <span>{item.label}</span>
                </Link>
              ))}
            </nav>

            {/* Mobile User Actions */}
            <div className="position-absolute bottom-0 w-100 border-top p-3">
              <button 
                className="btn btn-outline-danger w-100"
                onClick={handleLogout}
              >
                <i className="fas fa-sign-out-alt me-2"></i>
                ÄÄƒng xuáº¥t
              </button>
            </div>
          </div>
        </>
      )}
    </div>
  );

  const getRoleDisplayName = (role) => {
    const roleMap = {
      'admin': 'Administrator',
      'hr': 'HR Manager',
      'sales': 'Sales', // âœ… THÃŠM mapping cho role 'sales'
      'sales_manager': 'Sales Manager',
      'finance_manager': 'Finance Manager',
      'director': 'Director'
    };
    return roleMap[role] || 'NhÃ¢n viÃªn';
  };

  if (!user) return null;

  return (
    <>
      <DesktopNavigation />
      <MobileNavigation />
    </>
  );
};

export default ResponsiveNavigation;

```


==================== File: .\src\components\masterdata\PositionManager.jsx ====================

import React, { useState, useEffect } from 'react';
import { ApiClient } from '../../services/api';
import { useNotification } from '../../hooks/useNotification';
import Loading from '../common/Loading';

const PositionManager = () => {
  const [positions, setPositions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [formData, setFormData] = useState({
    positionName: '',
    description: ''
  });
  const [editingPosition, setEditingPosition] = useState(null);
  const { showNotification } = useNotification();

  useEffect(() => {
    loadPositions();
  }, []);

  const loadPositions = async () => {
    try {
      setLoading(true);
      const data = await ApiClient.get('/api/employees/positions');
      setPositions(data);
    } catch (error) {
      console.error('Error loading positions:', error);
      showNotification('Lá»—i khi táº£i danh sÃ¡ch vá»‹ trÃ­', 'error');
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!formData.positionName.trim()) {
      showNotification('Vui lÃ²ng nháº­p tÃªn vá»‹ trÃ­!', 'error');
      return;
    }

    try {
      if (editingPosition) {
        await ApiClient.put(`/api/employees/positions/${editingPosition.id}`, formData);
        showNotification('Cáº­p nháº­t vá»‹ trÃ­ thÃ nh cÃ´ng', 'success');
      } else {
        await ApiClient.post('/api/employees/positions', formData);
        showNotification('ThÃªm vá»‹ trÃ­ thÃ nh cÃ´ng', 'success');
      }
      
      setFormData({ positionName: '', description: '' });
      setEditingPosition(null);
      await loadPositions();
    } catch (error) {
      console.error('Error saving position:', error);
      showNotification('Lá»—i khi lÆ°u vá»‹ trÃ­', 'error');
    }
  };

  const handleEdit = (position) => {
    setEditingPosition(position);
    setFormData({
      positionName: position.positionName,
      description: position.description || ''
    });
  };

  const handleDelete = async (position) => {
    const confirmed = window.confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a vá»‹ trÃ­ "${position.positionName}"?`);
    if (!confirmed) return;

    try {
      await ApiClient.delete(`/api/employees/positions/${position.id}`);
      showNotification('XÃ³a vá»‹ trÃ­ thÃ nh cÃ´ng', 'success');
      await loadPositions();
    } catch (error) {
      console.error('Error deleting position:', error);
      showNotification('Lá»—i khi xÃ³a vá»‹ trÃ­', 'error');
    }
  };

  const handleCancel = () => {
    setEditingPosition(null);
    setFormData({ positionName: '', description: '' });
  };

  if (loading) {
    return <Loading text="Äang táº£i danh sÃ¡ch vá»‹ trÃ­..." />;
  }

  return (
    <div className="position-manager">
      <div className="row">
        <div className="col-md-4">
          <div className="card">
            <div className="card-header">
              <h5>{editingPosition ? 'Chá»‰nh sá»­a' : 'ThÃªm'} vá»‹ trÃ­</h5>
            </div>
            <div className="card-body">
              <form onSubmit={handleSubmit}>
                <div className="mb-3">
                  <label className="form-label">
                    TÃªn vá»‹ trÃ­ <span className="text-danger">*</span>
                  </label>
                  <input
                    type="text"
                    className="form-control"
                    name="positionName"
                    value={formData.positionName}
                    onChange={handleInputChange}
                    required
                  />
                </div>
                
                <div className="mb-3">
                  <label className="form-label">MÃ´ táº£</label>
                  <textarea
                    className="form-control"
                    name="description"
                    value={formData.description}
                    onChange={handleInputChange}
                    rows="3"
                    placeholder="MÃ´ táº£ vá» vá»‹ trÃ­ cÃ´ng viá»‡c..."
                  />
                </div>
                
                <div className="d-grid gap-2">
                  <button type="submit" className="btn btn-primary">
                    {editingPosition ? 'Cáº­p nháº­t' : 'ThÃªm'} vá»‹ trÃ­
                  </button>
                  {editingPosition && (
                    <button 
                      type="button" 
                      className="btn btn-secondary"
                      onClick={handleCancel}
                    >
                      Há»§y
                    </button>
                  )}
                </div>
              </form>
            </div>
          </div>
        </div>
        
        <div className="col-md-8">
          <div className="card">
            <div className="card-header">
              <h5>Danh sÃ¡ch vá»‹ trÃ­</h5>
            </div>
            <div className="card-body">
              {positions.length === 0 ? (
                <div className="text-center py-4">
                  <i className="fas fa-briefcase fa-3x text-muted mb-3"></i>
                  <p className="text-muted">ChÆ°a cÃ³ vá»‹ trÃ­ nÃ o</p>
                </div>
              ) : (
                <div className="table-responsive">
                  <table className="table table-striped table-hover">
                    <thead className="table-dark">
                      <tr>
                        <th>TÃªn vá»‹ trÃ­</th>
                        <th>MÃ´ táº£</th>
                        <th>Tráº¡ng thÃ¡i</th>
                        <th>Thao tÃ¡c</th>
                      </tr>
                    </thead>
                    <tbody>
                      {positions.map(position => (
                        <tr key={position.id}>
                          <td>
                            <strong>{position.positionName}</strong>
                          </td>
                          <td>
                            <span className="text-muted">
                              {position.description || 'KhÃ´ng cÃ³ mÃ´ táº£'}
                            </span>
                          </td>
                          <td>
                            <span className={`badge ${
                              position.status === 'active' 
                                ? 'bg-success' 
                                : 'bg-secondary'
                            }`}>
                              {position.status === 'active' 
                                ? 'Hoáº¡t Ä‘á»™ng' 
                                : 'NgÆ°ng hoáº¡t Ä‘á»™ng'
                              }
                            </span>
                          </td>
                          <td>
                            <div className="btn-group" role="group">
                              <button
                                className="btn btn-sm btn-primary"
                                onClick={() => handleEdit(position)}
                                title="Chá»‰nh sá»­a"
                              >
                                <i className="fas fa-edit"></i>
                              </button>
                              <button
                                className="btn btn-sm btn-danger"
                                onClick={() => handleDelete(position)}
                                title="XÃ³a"
                              >
                                <i className="fas fa-trash"></i>
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default PositionManager;

```


==================== File: .\src\components\masterdata\StoreManager.jsx ====================

import React, { useState, useEffect } from 'react';
import { ApiClient } from '../../services/api';
import { useNotification } from '../../hooks/useNotification';
import Loading from '../common/Loading';

const StoreManager = () => {
  const [stores, setStores] = useState([]);
  const [loading, setLoading] = useState(true);
  const [formData, setFormData] = useState({
    storeName: '',
    address: ''
  });
  const [editingStore, setEditingStore] = useState(null);
  const { showNotification } = useNotification();

  useEffect(() => {
    loadStores();
  }, []);

  const loadStores = async () => {
    try {
      setLoading(true);
      const data = await ApiClient.get('/api/employees/stores');
      setStores(data);
    } catch (error) {
      console.error('Error loading stores:', error);
      showNotification('Lá»—i khi táº£i danh sÃ¡ch cá»­a hÃ ng', 'error');
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!formData.storeName.trim() || !formData.address.trim()) {
      showNotification('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!', 'error');
      return;
    }

    try {
      if (editingStore) {
        await ApiClient.put(`/api/employees/stores/${editingStore.id}`, formData);
        showNotification('Cáº­p nháº­t cá»­a hÃ ng thÃ nh cÃ´ng', 'success');
      } else {
        await ApiClient.post('/api/employees/stores', formData);
        showNotification('ThÃªm cá»­a hÃ ng thÃ nh cÃ´ng', 'success');
      }
      
      setFormData({ storeName: '', address: '' });
      setEditingStore(null);
      await loadStores();
    } catch (error) {
      console.error('Error saving store:', error);
      showNotification('Lá»—i khi lÆ°u cá»­a hÃ ng', 'error');
    }
  };

  const handleEdit = (store) => {
    setEditingStore(store);
    setFormData({
      storeName: store.storeName,
      address: store.address
    });
  };

  const handleDelete = async (store) => {
    const confirmed = window.confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a cá»­a hÃ ng "${store.storeName}"?`);
    if (!confirmed) return;

    try {
      await ApiClient.delete(`/api/employees/stores/${store.id}`);
      showNotification('XÃ³a cá»­a hÃ ng thÃ nh cÃ´ng', 'success');
      await loadStores();
    } catch (error) {
      console.error('Error deleting store:', error);
      showNotification('Lá»—i khi xÃ³a cá»­a hÃ ng', 'error');
    }
  };

  const handleCancel = () => {
    setEditingStore(null);
    setFormData({ storeName: '', address: '' });
  };

  if (loading) {
    return <Loading text="Äang táº£i danh sÃ¡ch cá»­a hÃ ng..." />;
  }

  return (
    <div className="store-manager">
      <div className="row">
        <div className="col-md-4">
          <div className="card">
            <div className="card-header">
              <h5>{editingStore ? 'Chá»‰nh sá»­a' : 'ThÃªm'} cá»­a hÃ ng</h5>
            </div>
            <div className="card-body">
              <form onSubmit={handleSubmit}>
                <div className="mb-3">
                  <label className="form-label">
                    TÃªn cá»­a hÃ ng <span className="text-danger">*</span>
                  </label>
                  <input
                    type="text"
                    className="form-control"
                    name="storeName"
                    value={formData.storeName}
                    onChange={handleInputChange}
                    required
                  />
                </div>
                
                <div className="mb-3">
                  <label className="form-label">
                    Äá»‹a chá»‰ <span className="text-danger">*</span>
                  </label>
                  <textarea
                    className="form-control"
                    name="address"
                    value={formData.address}
                    onChange={handleInputChange}
                    rows="3"
                    required
                  />
                </div>
                
                <div className="d-grid gap-2">
                  <button type="submit" className="btn btn-primary">
                    {editingStore ? 'Cáº­p nháº­t' : 'ThÃªm'} cá»­a hÃ ng
                  </button>
                  {editingStore && (
                    <button 
                      type="button" 
                      className="btn btn-secondary"
                      onClick={handleCancel}
                    >
                      Há»§y
                    </button>
                  )}
                </div>
              </form>
            </div>
          </div>
        </div>
        
        <div className="col-md-8">
          <div className="card">
            <div className="card-header">
              <h5>Danh sÃ¡ch cá»­a hÃ ng</h5>
            </div>
            <div className="card-body">
              {stores.length === 0 ? (
                <div className="text-center py-4">
                  <i className="fas fa-store fa-3x text-muted mb-3"></i>
                  <p className="text-muted">ChÆ°a cÃ³ cá»­a hÃ ng nÃ o</p>
                </div>
              ) : (
                <div className="table-responsive">
                  <table className="table table-striped table-hover">
                    <thead className="table-dark">
                      <tr>
                        <th>TÃªn cá»­a hÃ ng</th>
                        <th>Äá»‹a chá»‰</th>
                        <th>Tráº¡ng thÃ¡i</th>
                        <th>Thao tÃ¡c</th>
                      </tr>
                    </thead>
                    <tbody>
                      {stores.map(store => (
                        <tr key={store.id}>
                          <td>{store.storeName}</td>
                          <td>{store.address}</td>
                          <td>
                            <span className={`badge ${
                              store.status === 'active' 
                                ? 'bg-success' 
                                : 'bg-secondary'
                            }`}>
                              {store.status === 'active' 
                                ? 'Hoáº¡t Ä‘á»™ng' 
                                : 'NgÆ°ng hoáº¡t Ä‘á»™ng'
                              }
                            </span>
                          </td>
                          <td>
                            <div className="btn-group" role="group">
                              <button
                                className="btn btn-sm btn-primary"
                                onClick={() => handleEdit(store)}
                                title="Chá»‰nh sá»­a"
                              >
                                <i className="fas fa-edit"></i>
                              </button>
                              <button
                                className="btn btn-sm btn-danger"
                                onClick={() => handleDelete(store)}
                                title="XÃ³a"
                              >
                                <i className="fas fa-trash"></i>
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default StoreManager;

```


==================== File: .\src\contexts\AppContext.jsx ====================


```


==================== File: .\src\contexts\AuthContext.jsx ====================

import React, { createContext, useContext, useState, useEffect } from 'react';
import { ApiClient } from '../services/api.js';

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [initialized, setInitialized] = useState(false);

  useEffect(() => {
    initializeAuth();
  }, []);

  const initializeAuth = async () => {
    try {
      setLoading(true);
      // âœ… Sá»¬A: Thay tháº¿ checkAuth() báº±ng viá»‡c gá»i trá»±c tiáº¿p getProfile tá»« ApiClient
      const response = await ApiClient.get('/api/auth/profile');
      if (response.success && response.data.user) {
        setUser(response.data.user);
      } else {
        setUser(null);
      }
    } catch (error) {
      console.warn('Auth initialization: Not logged in.');
      setUser(null);
    } finally {
      setInitialized(true);
      setLoading(false);
    }
  };

  // HÃ m checkAuth cÅ© cÃ³ thá»ƒ xÃ³a hoáº·c giá»¯ láº¡i náº¿u cáº§n
  const checkAuth = async () => {
    try {
      const response = await ApiClient.get('/api/auth/profile');
      return response.success ? response.data.user : null;
    } catch (error) {
      return null;
    }
  };

  const login = async (credentials) => {
    try {
      setLoading(true);
      const response = await ApiClient.post('/api/auth/login', credentials);
      
      // âœ… Sá»¬A LOGIC KIá»‚M TRA Táº I ÄÃ‚Y
      // Kiá»ƒm tra `response.data.user` thay vÃ¬ `response.user`
      if (response.success && response.data && response.data.user) {
        setUser(response.data.user);
        return response.data; // Tráº£ vá» `response.data` Ä‘á»ƒ LoginPage cÃ³ thá»ƒ sá»­ dá»¥ng
      } else {
        // NÃ©m lá»—i vá»›i thÃ´ng Ä‘iá»‡p tá»« server náº¿u cÃ³
        throw new Error(response.message || 'Login failed: Invalid response structure');
      }
    } catch (error) {
      console.error('Login error:', error);
      // Äáº£m báº£o nÃ©m láº¡i lá»—i Ä‘á»ƒ component gá»i cÃ³ thá»ƒ báº¯t Ä‘Æ°á»£c
      throw error;
    } finally {
      setLoading(false);
    }
  };

  const logout = async () => {
    try {
      setLoading(true);
      await ApiClient.post('/api/auth/logout');
      setUser(null);
      // Chuyá»ƒn hÆ°á»›ng vá» trang login má»™t cÃ¡ch an toÃ n
      window.location.assign('/login');
    } catch (error) {
      console.error('Logout error:', error);
      // Váº«n xÃ³a user vÃ  chuyá»ƒn hÆ°á»›ng dÃ¹ API cÃ³ lá»—i
      setUser(null);
      window.location.assign('/login');
    } finally {
      setLoading(false);
    }
  };

  const updateUserInfo = (userData) => {
    setUser(prevUser => ({
      ...prevUser,
      ...userData
    }));
  };

  const hasRole = (requiredRoles) => {
    if (!user) return false;
    if (typeof requiredRoles === 'string') {
      return user.role === requiredRoles;
    }
    if (Array.isArray(requiredRoles)) {
      return requiredRoles.includes(user.role);
    }
    return false;
  };

  const value = {
    user,
    loading,
    initialized,
    login,
    logout,
    checkAuth,
    updateUserInfo,
    hasRole,
  };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

export default AuthContext;

```


==================== File: .\src\contexts\NotificationContext.jsx ====================

import React, { createContext, useState, useCallback, useContext } from 'react';
import ReactDOM from 'react-dom';
import Alert from '../components/common/Alert';
import '../styles/notifications.css';

// FIX: ThÃªm "export" vÃ o Ä‘Ã¢y. ÄÃ¢y lÃ  thay Ä‘á»•i quan trá»ng nháº¥t.
export const NotificationContext = createContext(null);

export const NotificationProvider = ({ children }) => {
    const [notifications, setNotifications] = useState([]);

    const showNotification = useCallback((message, type = 'info', duration = 5000) => {
        const newNotification = {
            id: Date.now() + Math.random(),
            message,
            type,
            duration,
        };
        // ThÃªm thÃ´ng bÃ¡o má»›i vÃ o Ä‘áº§u danh sÃ¡ch Ä‘á»ƒ hiá»‡n trÃªn cÃ¹ng
        setNotifications(prev => [newNotification, ...prev]);
    }, []);

    const removeNotification = useCallback((id) => {
        setNotifications(prev => prev.filter(n => n.id !== id));
    }, []);

    // GiÃ¡ trá»‹ mÃ  Context sáº½ cung cáº¥p cho cÃ¡c component con
    const value = {
        showNotification,
    };
    
    // Logic render thÃ´ng bÃ¡o qua Portal
    const alertContainer = document.getElementById('alert-container');
    if (!alertContainer) {
        console.error('Lá»–I NGHIÃŠM TRá»ŒNG: KhÃ´ng tÃ¬m tháº¥y tháº» <div id="alert-container"> trong DOM. ThÃ´ng bÃ¡o sáº½ khÃ´ng hiá»ƒn thá»‹.');
        // Váº«n render children Ä‘á»ƒ á»©ng dá»¥ng khÃ´ng bá»‹ sáº­p
        return (
             <NotificationContext.Provider value={value}>
                {children}
            </NotificationContext.Provider>
        );
    }

    return (
        <NotificationContext.Provider value={value}>
            {children}
            {/* Render cÃ¡c Alert vÃ o portal */}
            {ReactDOM.createPortal(
                <div className="notification-container">
                    {notifications.map((notification) => (
                        <Alert
                            key={notification.id}
                            notification={notification}
                            onClose={removeNotification}
                        />
                    ))}
                </div>,
                alertContainer
            )}
        </NotificationContext.Provider>
    );
};

// Báº¡n cÃ³ thá»ƒ giá»¯ hook nÃ y á»Ÿ Ä‘Ã¢y hoáº·c trong file riÃªng Ä‘á»u Ä‘Æ°á»£c
export const useNotification = () => {
    const context = useContext(NotificationContext);
    if (context === null) {
        throw new Error('useNotification must be used within a NotificationProvider');
    }
    return context;
};

```


==================== File: .\src\hooks\useApi.js ====================

import { useState, useEffect } from 'react';
import { ApiClient } from '../services/api.js';

export const useApi = (url, options = {}) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    if (!url) return;
    
    const fetchData = async () => {
      try {
        setLoading(true);
        setError(null);
        
        const response = await ApiClient.get(url, options);
        
        if (response.success && response.data) {
          setData(response.data);
        } else {
          setData(response.data || []);
        }
      } catch (err) {
        console.error('useApi error:', err);
        setError(err);
        setData([]);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [url]);

  return { data, loading, error };
};

```


==================== File: .\src\hooks\useAttendance.js ====================

// src/hooks/useAttendance.js
import { useState, useCallback } from 'react';
import { useNotification } from './useNotification';
import api from '../services/api';

export function useAttendance() {
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState(null);
    const { showNotification } = useNotification();

    // âœ… Cáº¬P NHáº¬T: Láº¥y logs cháº¥m cÃ´ng vá»›i filters nÃ¢ng cao
    const getAttendanceLogs = useCallback(async (filters = {}) => {
        try {
            setLoading(true);
            setError(null);
            
            console.log('ğŸ”„ useAttendance: Getting attendance logs with filters:', filters);
            
            const response = await api.get('/attendance/logs', {
                params: filters
            });
            
            console.log('âœ… useAttendance: Attendance logs loaded:', response.data.data?.length || 0, 'records');
            
            return {
                success: true,
                data: response.data.data || [],
                message: response.data.message
            };
            
        } catch (error) {
            console.error('âŒ useAttendance: Error getting attendance logs:', error);
            const errorMessage = error.response?.data?.message || 'Lá»—i khi táº£i logs cháº¥m cÃ´ng';
            setError(errorMessage);
            
            return {
                success: false,
                data: [],
                message: errorMessage
            };
        } finally {
            setLoading(false);
        }
    }, []);

    // âœ… Cáº¬P NHáº¬T: Láº¥y tá»•ng giá» cÃ´ng vá»›i format má»›i  
    const getEmployeeHours = useCallback(async () => {
        try {
            setLoading(true);
            setError(null);
            
            console.log('ğŸ“Š useAttendance: Getting employee hours...');
            
            const response = await api.get('/api/attendance/employee-hours');
            
            console.log('ğŸ” useAttendance RAW RESPONSE:', response);
            console.log('ğŸ” response.data:', response.data);
            console.log('ğŸ” response.data.data:', response.data.data);
            console.log('ğŸ” employeeHours array:', response.data.data?.employeeHours);
            console.log('ğŸ” employeeHours length:', response.data.data?.employeeHours?.length);
            
            return {
                success: true,
                // âœ… Sá»¬A: Thay response.data.data thÃ nh response.data
                data: response.data || { employeeHours: [], summary: {} },
                message: response.data.message
            };
            
        } catch (error) {
            // error handling
        } finally {
            setLoading(false);
        }
    }, []);



    // âœ… THÃŠM Má»šI: Láº¥y thá»‘ng kÃª cháº¥m cÃ´ng
    const getAttendanceStats = useCallback(async (filters = {}) => {
        try {
            setLoading(true);
            setError(null);
            
            console.log('ğŸ“ˆ useAttendance: Getting attendance stats...');
            
            const response = await api.get('/attendance/stats', {
                params: filters
            });
            
            console.log('âœ… useAttendance: Attendance stats loaded:', response.data.data);
            
            return {
                success: true,
                data: response.data.data || {},
                message: response.data.message
            };
            
        } catch (error) {
            console.error('âŒ useAttendance: Error getting attendance stats:', error);
            const errorMessage = error.response?.data?.message || 'Lá»—i khi táº£i thá»‘ng kÃª cháº¥m cÃ´ng';
            setError(errorMessage);
            
            return {
                success: false,
                data: {},
                message: errorMessage
            };
        } finally {
            setLoading(false);
        }
    }, []);

    // âœ… THÃŠM Má»šI: Láº¥y giá» cÃ´ng chi tiáº¿t cá»§a má»™t nhÃ¢n viÃªn
    const getEmployeeDetailedHours = useCallback(async (employeeId, filters = {}) => {
        try {
            setLoading(true);
            setError(null);
            
            console.log('ğŸ‘¤ useAttendance: Getting detailed hours for employee:', employeeId);
            
            const response = await api.get(`/attendance/employee/${employeeId}/detailed`, {
                params: filters
            });
            
            console.log('âœ… useAttendance: Employee detailed hours loaded:', response.data.data);
            
            return {
                success: true,
                data: response.data.data || {},
                message: response.data.message
            };
            
        } catch (error) {
            console.error('âŒ useAttendance: Error getting employee detailed hours:', error);
            const errorMessage = error.response?.data?.message || 'Lá»—i khi táº£i giá» cÃ´ng chi tiáº¿t';
            setError(errorMessage);
            
            return {
                success: false,
                data: {},
                message: errorMessage
            };
        } finally {
            setLoading(false);
        }
    }, []);

    // âœ… Cáº¬P NHáº¬T: ThÃªm log cháº¥m cÃ´ng vá»›i validation má»›i
    const addAttendanceLog = useCallback(async (attendanceData) => {
        try {
            setLoading(true);
            setError(null);
            
            // Validate required fields
            const validationErrors = validateAttendanceData(attendanceData);
            if (validationErrors.length > 0) {
                throw new Error(validationErrors.join(', '));
            }
            
            console.log('â• useAttendance: Adding attendance log:', attendanceData);
            
            const response = await api.post('/attendance/logs', attendanceData);
            
            console.log('âœ… useAttendance: Attendance log added successfully');
            showNotification('ThÃªm báº£n ghi cháº¥m cÃ´ng thÃ nh cÃ´ng', 'success');
            
            return {
                success: true,
                data: response.data.data,
                message: response.data.message
            };
            
        } catch (error) {
            console.error('âŒ useAttendance: Error adding attendance log:', error);
            const errorMessage = error.response?.data?.message || error.message || 'Lá»—i khi thÃªm báº£n ghi cháº¥m cÃ´ng';
            setError(errorMessage);
            showNotification(errorMessage, 'error');
            
            return {
                success: false,
                data: null,
                message: errorMessage
            };
        } finally {
            setLoading(false);
        }
    }, [showNotification]);

    // âœ… THÃŠM Má»šI: Cáº­p nháº­t log cháº¥m cÃ´ng  
    const updateAttendanceLog = useCallback(async (id, attendanceData) => {
        try {
            setLoading(true);
            setError(null);
            
            console.log('ğŸ“ useAttendance: Updating attendance log:', id, attendanceData);
            
            const response = await api.put(`/attendance/logs/${id}`, attendanceData);
            
            console.log('âœ… useAttendance: Attendance log updated successfully');
            showNotification('Cáº­p nháº­t báº£n ghi cháº¥m cÃ´ng thÃ nh cÃ´ng', 'success');
            
            return {
                success: true,
                data: response.data.data,
                message: response.data.message
            };
            
        } catch (error) {
            console.error('âŒ useAttendance: Error updating attendance log:', error);
            const errorMessage = error.response?.data?.message || 'Lá»—i khi cáº­p nháº­t báº£n ghi cháº¥m cÃ´ng';
            setError(errorMessage);
            showNotification(errorMessage, 'error');
            
            return {
                success: false,
                data: null,
                message: errorMessage
            };
        } finally {
            setLoading(false);
        }
    }, [showNotification]);

    // âœ… THÃŠM Má»šI: XÃ³a log cháº¥m cÃ´ng
    const deleteAttendanceLog = useCallback(async (id) => {
        try {
            setLoading(true);
            setError(null);
            
            console.log('ğŸ—‘ï¸ useAttendance: Deleting attendance log:', id);
            
            await api.delete(`/attendance/logs/${id}`);
            
            console.log('âœ… useAttendance: Attendance log deleted successfully');
            showNotification('XÃ³a báº£n ghi cháº¥m cÃ´ng thÃ nh cÃ´ng', 'success');
            
            return {
                success: true,
                message: 'XÃ³a báº£n ghi cháº¥m cÃ´ng thÃ nh cÃ´ng'
            };
            
        } catch (error) {
            console.error('âŒ useAttendance: Error deleting attendance log:', error);
            const errorMessage = error.response?.data?.message || 'Lá»—i khi xÃ³a báº£n ghi cháº¥m cÃ´ng';
            setError(errorMessage);
            showNotification(errorMessage, 'error');
            
            return {
                success: false,
                message: errorMessage
            };
        } finally {
            setLoading(false);
        }
    }, [showNotification]);

    // âœ… THÃŠM Má»šI: Refresh cache
    const refreshAttendanceData = useCallback(async () => {
        try {
            setLoading(true);
            console.log('ğŸ”„ useAttendance: Refreshing attendance data...');
            
            // Call cÃ¡c API Ä‘á»ƒ refresh cache
            await Promise.all([
                getAttendanceLogs(),
                getEmployeeHours()
            ]);
            
            showNotification('LÃ m má»›i dá»¯ liá»‡u thÃ nh cÃ´ng', 'success');
            
        } catch (error) {
            console.error('âŒ useAttendance: Error refreshing data:', error);
            showNotification('Lá»—i khi lÃ m má»›i dá»¯ liá»‡u', 'error');
        } finally {
            setLoading(false);
        }
    }, [getAttendanceLogs, getEmployeeHours, showNotification]);

    // âœ… HELPER: Export dá»¯ liá»‡u ra CSV
    const exportAttendanceToCSV = useCallback((data, filename = 'attendance_export') => {
        try {
            if (!data || data.length === 0) {
                showNotification('KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ xuáº¥t', 'warning');
                return false;
            }

            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => 
                    headers.map(header => {
                        const value = row[header];
                        // Escape commas and quotes in CSV
                        if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                            return `"${value.replace(/"/g, '""')}"`;
                        }
                        return value || '';
                    }).join(',')
                )
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showNotification('Xuáº¥t file CSV thÃ nh cÃ´ng', 'success');
            return true;
            
        } catch (error) {
            console.error('âŒ useAttendance: Error exporting CSV:', error);
            showNotification('Lá»—i khi xuáº¥t file CSV', 'error');
            return false;
        }
    }, [showNotification]);

    return {
        // State
        loading,
        error,
        
        // Main functions
        getAttendanceLogs,
        getEmployeeHours,
        addAttendanceLog,
        updateAttendanceLog,
        deleteAttendanceLog,
        
        // New functions
        getAttendanceStats,
        getEmployeeDetailedHours,
        refreshAttendanceData,
        exportAttendanceToCSV,
        
        // Utility functions
        clearError: () => setError(null)
    };
}

// âœ… HELPER: Validate dá»¯ liá»‡u cháº¥m cÃ´ng
function validateAttendanceData(data) {
    const errors = [];
    
    if (!data.employeeId?.trim()) {
        errors.push('MÃ£ nhÃ¢n viÃªn lÃ  báº¯t buá»™c');
    }
    
    if (!data.type || !['Checkin', 'Checkout'].includes(data.type)) {
        errors.push('PhÃ¢n loáº¡i pháº£i lÃ  Checkin hoáº·c Checkout');
    }
    
    if (!data.position?.trim()) {
        errors.push('Vá»‹ trÃ­ lÃ  báº¯t buá»™c');
    }
    
    // Validate position values
    const validPositions = ['NhÃ¢n viÃªn BÃ¡n hÃ ng', 'NhÃ¢n viÃªn Thu ngÃ¢n', 'NhÃ¢n viÃªn Tiáº¿p Ä‘Ã³n', 'NhÃ¢n viÃªn Mascot'];
    if (data.position && !validPositions.includes(data.position)) {
        errors.push(`Vá»‹ trÃ­ pháº£i lÃ  má»™t trong: ${validPositions.join(', ')}`);
    }
    
    if (!data.timestamp) {
        errors.push('Thá»i gian cháº¥m cÃ´ng lÃ  báº¯t buá»™c');
    } else {
        const timestamp = new Date(data.timestamp);
        if (isNaN(timestamp.getTime())) {
            errors.push('Thá»i gian cháº¥m cÃ´ng khÃ´ng há»£p lá»‡');
        }
    }
    
    return errors;
}

// âœ… HELPER: Format dá»¯ liá»‡u cho API
export function formatAttendanceForAPI(formData) {
    return {
        employeeId: formData.employeeId?.trim() || '',
        type: formData.type || 'Checkin',
        position: formData.position?.trim() || '',
        timestamp: formData.timestamp || new Date().toISOString(),
        notes: formData.notes?.trim() || ''
    };
}

// âœ… HELPER: Parse response tá»« API
export function parseAttendanceResponse(response) {
    if (!response || !response.data) {
        return { success: false, data: null, message: 'Invalid response' };
    }
    
    return {
        success: response.success || false,
        data: response.data || null,
        message: response.message || '',
        errorCode: response.errorCode || null
    };
}

export default useAttendance;

```


==================== File: .\src\hooks\useAuth.js ====================

import { useContext } from 'react';
import AuthContext from '../contexts/AuthContext';

export const useAuth = () => {
  const context = useContext(AuthContext);
  
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  
  return context;
};

export default useAuth;

```


==================== File: .\src\hooks\useEmployees.js ====================

// src/hooks/useEmployees.js

import { useState, useEffect, useCallback } from 'react';
import { 
  getEmployees, 
  addEmployee, 
  updateEmployee, 
  deleteEmployee 
} from '../services/employee.js';
import { useNotification } from './useNotification.js';

/**
 * Hook tÃ¹y chá»‰nh Ä‘á»ƒ quáº£n lÃ½ dá»¯ liá»‡u vÃ  logic cá»§a NhÃ¢n viÃªn.
 * @returns {object} Tráº¡ng thÃ¡i vÃ  cÃ¡c hÃ m xá»­ lÃ½.
 */
export const useEmployees = () => {
  const [employees, setEmployees] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const { showNotification } = useNotification();

  const fetchEmployees = useCallback(async () => {
    console.log('HOOK: Báº¯t Ä‘áº§u táº£i danh sÃ¡ch nhÃ¢n viÃªn...');
    setLoading(true);
    setError(null);
    try {
      const response = await getEmployees();
      if (response.success) {
        setEmployees(response.data || []);
        console.log('HOOK: Táº£i danh sÃ¡ch nhÃ¢n viÃªn thÃ nh cÃ´ng.');
      } else {
        // Xá»­ lÃ½ trÆ°á»ng há»£p server tráº£ vá» success: false nhÆ°ng khÃ´ng pháº£i lá»—i HTTP
        throw new Error(response.message || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh tá»« server.');
      }
    } catch (err) {
      // Báº¯t lá»—i Ä‘Æ°á»£c nÃ©m tá»« service (do lá»—i máº¡ng, 500, hoáº·c success: false)
      const errorMessage = err.message || 'KhÃ´ng thá»ƒ táº£i danh sÃ¡ch nhÃ¢n viÃªn.';
      console.error('HOOK: Lá»—i khi táº£i danh sÃ¡ch nhÃ¢n viÃªn:', errorMessage);

      const userMessage = `KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u. Lá»—i: ${errorMessage}. Vui lÃ²ng liÃªn há»‡ phÃ²ng CNTT Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£.`;
      
      setError(userMessage);
      showNotification(userMessage, 'error');
      
      // Äáº£m báº£o danh sÃ¡ch nhÃ¢n viÃªn lÃ  máº£ng rá»—ng khi cÃ³ lá»—i Ä‘á»ƒ trÃ¡nh crash UI
      setEmployees([]); 
    } finally {
      setLoading(false);
    }
  }, [showNotification]);

  // Tá»± Ä‘á»™ng gá»i fetchEmployees khi component Ä‘Æ°á»£c mount
  useEffect(() => {
    fetchEmployees();
  }, [fetchEmployees]);

  // HÃ m thÃªm nhÃ¢n viÃªn má»›i
  const handleAddEmployee = async (employeeData) => {
    try {
      const response = await addEmployee(employeeData);
      if (response.success) {
        showNotification('ThÃªm nhÃ¢n viÃªn má»›i thÃ nh cÃ´ng!', 'success');
        await fetchEmployees(); // Táº£i láº¡i danh sÃ¡ch Ä‘á»ƒ cáº­p nháº­t
        return true;
      } else {
        throw new Error(response.message || 'ThÃªm nhÃ¢n viÃªn tháº¥t báº¡i.');
      }
    } catch (err) {
      console.error('HOOK: Lá»—i khi thÃªm nhÃ¢n viÃªn:', err);
      // Hiá»ƒn thá»‹ lá»—i cá»¥ thá»ƒ tá»« server
      showNotification(`ThÃªm tháº¥t báº¡i: ${err.message}`, 'error');
      return false;
    }
  };

  // HÃ m cáº­p nháº­t thÃ´ng tin nhÃ¢n viÃªn
  const handleUpdateEmployee = async (id, employeeData) => {
    try {
      const response = await updateEmployee(id, employeeData);
      if (response.success) {
        showNotification('Cáº­p nháº­t thÃ´ng tin thÃ nh cÃ´ng!', 'success');
        await fetchEmployees();
        return true;
      } else {
        throw new Error(response.message || 'Cáº­p nháº­t tháº¥t báº¡i.');
      }
    } catch (err) {
      console.error('HOOK: Lá»—i khi cáº­p nháº­t nhÃ¢n viÃªn:', err);
      showNotification(`Cáº­p nháº­t tháº¥t báº¡i: ${err.message}`, 'error');
      return false;
    }
  };

  // HÃ m xÃ³a nhÃ¢n viÃªn
  const handleDeleteEmployee = async (id) => {
    try {
      const response = await deleteEmployee(id);
      if (response.success) {
        showNotification('XÃ³a nhÃ¢n viÃªn thÃ nh cÃ´ng!', 'success');
        await fetchEmployees(); // Táº£i láº¡i danh sÃ¡ch
        return true;
      } else {
        throw new Error(response.message || 'XÃ³a nhÃ¢n viÃªn tháº¥t báº¡i.');
      }
    } catch (err) {
      console.error('HOOK: Lá»—i khi xÃ³a nhÃ¢n viÃªn:', err);
      showNotification(`XÃ³a tháº¥t báº¡i: ${err.message}`, 'error');
      return false;
    }
  };

  // Tráº£ vá» state vÃ  cÃ¡c hÃ m Ä‘á»ƒ component cÃ³ thá»ƒ sá»­ dá»¥ng
  return {
    employees,
    loading,
    error, // Tráº¡ng thÃ¡i lá»—i nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ hiá»ƒn thá»‹ trÃªn UI
    addEmployee: handleAddEmployee,
    updateEmployee: handleUpdateEmployee,
    deleteEmployee: handleDeleteEmployee,
    refreshEmployees: fetchEmployees,
  };
};

```


==================== File: .\src\hooks\useNotification.js ====================

import { useContext } from 'react';
import { NotificationContext } from '../contexts/NotificationContext';

export const useNotification = () => {
  const context = useContext(NotificationContext);
  if (!context) {
    throw new Error('useNotification must be used within a NotificationProvider');
  }
  return context;
};

```


==================== File: .\src\pages\AttendanceLogsPage.jsx ====================

import { formatDateTimeForCSV, formatTimeForCSV } from '../utils/dateUtils';
import React, { useState, useEffect } from 'react';
import { ApiClient } from '../services/api';
import { useNotification } from '../hooks/useNotification';
import Loading from '../components/common/Loading';

const LARK_LOGS_URL = "https://atino-vietnam.sg.larksuite.com/base/Ey3EbVD9vacAHvs8cVvlHxkKg2r?table=tblU9YY1t4TwxXLh&view=vewpWpbNQv";
const LARK_HOURS_URL = "https://atino-vietnam.sg.larksuite.com/base/Ey3EbVD9vacAHvs8cVvlHxkKg2r?table=tblV2dGhT2O7w30b&view=vewDULr7HU";

const AttendanceLogsPage = () => {
  const [logs, setLogs] = useState([]);
  const [employees, setEmployees] = useState([]);
  const [stores, setStores] = useState([]);
  const [recruitmentRequests, setRecruitmentRequests] = useState([]);
  const [recruitmentHours, setRecruitmentHours] = useState([]);
  const [loading, setLoading] = useState(true);
  const [activeTab, setActiveTab] = useState('logs');
  const [loadingRecruitment, setLoadingRecruitment] = useState(false);
  const { showNotification } = useNotification();

  useEffect(() => {
    loadInitialData();
  }, []);

  useEffect(() => {
    if (activeTab === 'recruitment') {
      console.log('ğŸ“Š Tab recruitment Ä‘Æ°á»£c chá»n, Ä‘ang refresh data...');
      loadRecruitmentHours(true);
    }
  }, [activeTab]);

  const loadInitialData = async () => {
    try {
      setLoading(true);
      await Promise.all([
        loadEmployees(),
        loadAttendanceLogs(),
        loadStores(),
        loadRecruitmentRequests(),
        loadRecruitmentHours(true)
      ]);
    } catch (error) {
      console.error('Error loading initial data:', error);
      showNotification('Lá»—i khi táº£i dá»¯ liá»‡u cháº¥m cÃ´ng', 'error');
    } finally {
      setLoading(false);
    }
  };

  const loadEmployees = async () => {
    try {
      const response = await ApiClient.get('/api/employees');
      setEmployees(Array.isArray(response?.data) ? response.data : response || []);
    } catch (error) {
      setEmployees([]);
      showNotification('Lá»—i khi táº£i danh sÃ¡ch nhÃ¢n viÃªn', 'error');
    }
  };

  const loadAttendanceLogs = async () => {
    try {
      const response = await ApiClient.get('/api/attendance/logs');
      setLogs(Array.isArray(response?.data) ? response.data : response || []);
    } catch (error) {
      setLogs([]);
      showNotification('Lá»—i khi táº£i báº£n ghi cháº¥m cÃ´ng', 'error');
    }
  };

  const loadStores = async () => {
    try {
      const response = await ApiClient.get('/api/master-data/stores');
      setStores(Array.isArray(response?.data) ? response.data : response || []);
    } catch (error) {
      setStores([]);
    }
  };

  const loadRecruitmentRequests = async () => {
    try {
      const response = await ApiClient.get('/api/recruitment');
      setRecruitmentRequests(Array.isArray(response?.data) ? response.data : response || []);
    } catch (error) {
      setRecruitmentRequests([]);
    }
  };

  const loadRecruitmentHours = async (forceRefresh = true) => {
    try {
      setLoadingRecruitment(true);
      
      console.log('ğŸ”„ Loading recruitment hours with force refresh:', forceRefresh);
      
      const params = { refresh: 'true' };
      const response = await ApiClient.get('/api/recruitment/hours-summary', params);
      
      setRecruitmentHours(Array.isArray(response?.data?.summary) ? response.data.summary : []);
      
      console.log('âœ… Recruitment hours loaded successfully:', response?.data?.summary?.length || 0, 'records');
      
    } catch (error) {
      setRecruitmentHours([]);
      console.error('Error loading recruitment hours:', error);
      showNotification('Lá»—i khi táº£i tá»•ng há»£p giá» cÃ´ng theo tuyá»ƒn dá»¥ng', 'error');
    } finally {
      setLoadingRecruitment(false);
    }
  };

  const handleRefresh = async () => {
    try {
      setLoading(true);
      await Promise.all([
        loadEmployees(),
        loadAttendanceLogs(),
        loadStores(),
        loadRecruitmentRequests(),
        loadRecruitmentHours(true)
      ]);
      showNotification('ÄÃ£ cáº­p nháº­t dá»¯ liá»‡u', 'success');
    } catch (error) {
      console.error('Error loading initial data:', error);
      showNotification('Lá»—i khi táº£i dá»¯ liá»‡u cháº¥m cÃ´ng', 'error');
    } finally {
      setLoading(false);
    }
  };

  const handleTabChange = (tabName) => {
    console.log('ğŸ”„ Switching to tab:', tabName);
    setActiveTab(tabName);
    
    if (tabName === 'recruitment') {
      showNotification('Äang cáº­p nháº­t dá»¯ liá»‡u realtime...', 'info');
    }
  };

  const exportToExcel = async (request) => {
      try {
          setLoadingRecruitment(true);
          showNotification('Äang táº£i chi tiáº¿t dá»¯ liá»‡u...', 'info');
          
          const response = await ApiClient.get(`/api/recruitment/detailed-hours/${request.requestNo}`);
          
          if (!response.success || !response.data.records.length) {
              showNotification('KhÃ´ng cÃ³ dá»¯ liá»‡u chi tiáº¿t Ä‘á»ƒ xuáº¥t', 'warning');
              return;
          }
          
          const detailedRecords = response.data.records;
          
          // âœ… Sá»¬A: Ãp dá»¥ng conversion cho cÃ¡c trÆ°á»ng thá»i gian
          const worksheetData = [
              ['STT', 'MÃ£ nhÃ¢n viÃªn', 'NgÃ y cháº¥m cÃ´ng', 'Thá»i gian vÃ o', 'Thá»i gian ra', 'Tá»•ng giá» lÃ m', 'LÆ°Æ¡ng/giá» (VNÄ)', 'Tá»•ng lÆ°Æ¡ng (VNÄ)'],
              ...detailedRecords.map((record, index) => [
                  index + 1,
                  record.employeeId || 'N/A',
                  // âœ… CHUYá»‚N Äá»”I: workDate náº¿u lÃ  serial number
                  typeof record.workDate === 'number' ? 
                      formatDateTimeForCSV(record.workDate) : 
                      record.workDate || 'N/A',
                  // âœ… CHUYá»‚N Äá»”I: checkInTime náº¿u lÃ  serial number
                  typeof record.checkInTime === 'number' ? 
                      formatTimeForCSV(record.checkInTime) : 
                      record.checkInTime || 'N/A',
                  // âœ… CHUYá»‚N Äá»”I: checkOutTime náº¿u lÃ  serial number
                  typeof record.checkOutTime === 'number' ? 
                      formatTimeForCSV(record.checkOutTime) : 
                      record.checkOutTime || 'N/A',
                  record.totalHours || 0,
                  record.hourlyRate || 0,
                  record.totalSalary || 0 
              ])
          ];

          // Pháº§n cÃ²n láº¡i giá»¯ nguyÃªn
          const totalSalary = detailedRecords.reduce((sum, record) => sum + (record.totalSalary || 0), 0);
          
          const summaryData = [
              [],
              ['THÃ”NG TIN Tá»”NG Há»¢P'],
              ['Request No:', request.requestNo],
              ['PhÃ²ng ban:', request.department],
              ['Thá»i gian:', `${request.fromDate || 'N/A'} - ${request.toDate || 'N/A'}`],
              ['Tá»•ng báº£n ghi:', detailedRecords.length],
              ['Tá»•ng lÆ°Æ¡ng:', `${totalSalary.toLocaleString('vi-VN')} VNÄ`],
              ['Tráº¡ng thÃ¡i:', request.status],
              [],
              ['CHI TIáº¾T CHáº¤M CÃ”NG THEO NGÃ€Y'],
              ...worksheetData
          ];

          const csvContent = summaryData.map(row => 
              row.map(cell => {
                  const cellStr = String(cell || '');
                  if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                      return `"${cellStr.replace(/"/g, '""')}"`;
                  }
                  return cellStr;
              }).join(',')
          ).join('\n');

          const BOM = '\uFEFF';
          const blob = new Blob([BOM + csvContent], { 
              type: 'text/csv;charset=utf-8;' 
          });

          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = `chi_tiet_cham_cong_${request.requestNo}_${new Date().toISOString().split('T')[0]}.csv`;
          
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(link.href);
          
          showNotification(`ÄÃ£ xuáº¥t file chi tiáº¿t cho ${request.requestNo}`, 'success');
          
      } catch (error) {
          console.error('Error exporting detailed Excel:', error);
          showNotification('Lá»—i khi xuáº¥t file Excel chi tiáº¿t', 'error');
      } finally {
          setLoadingRecruitment(false);
      }
  };


  const totalEmployees = Array.isArray(employees) ? employees.length : 0;
  const totalStores = Array.isArray(stores) ? stores.length : 0;
  const activeRecruitmentRequests = Array.isArray(recruitmentRequests)
    ? recruitmentRequests.filter(req => req.status === 'Äang tuyá»ƒn dá»¥ng').length
    : 0;

  if (loading) {
    return <Loading fullScreen text="Äang táº£i dá»¯ liá»‡u..." />;
  }

  return (
    <div className="attendance-logs-page">
      {/* Header */}
      <div className="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1>Quáº£n lÃ½ Cháº¥m cÃ´ng & Tuyá»ƒn dá»¥ng</h1>
          <p className="text-muted mb-0">Xem vÃ  quáº£n lÃ½ cÃ¡c hoáº¡t Ä‘á»™ng nhÃ¢n sá»±</p>
        </div>
        <button
          className="btn btn-outline-primary"
          onClick={handleRefresh}
        >
          <i className="fas fa-sync-alt me-2"></i>
          LÃ m má»›i
        </button>
      </div>

      {/* Statistics */}
      <div className="row mb-4">
        <div className="col-md-3">
          <div className="card text-center bg-primary text-white">
            <div className="card-body">
              <h3 id="logCount">{Array.isArray(logs) ? logs.length : 0}</h3>
              <p className="mb-0">Tá»•ng báº£n ghi cháº¥m cÃ´ng</p>
            </div>
          </div>
        </div>
        <div className="col-md-3">
          <div className="card text-center bg-success text-white">
            <div className="card-body">
              <h3>{totalEmployees}</h3>
              <p className="mb-0">Tá»•ng nhÃ¢n viÃªn</p>
            </div>
          </div>
        </div>
        <div className="col-md-3">
          <div className="card text-center bg-info text-white">
            <div className="card-body">
              <h3>{totalStores}</h3>
              <p className="mb-0">Cá»­a hÃ ng</p>
            </div>
          </div>
        </div>
        <div className="col-md-3">
          <div className="card text-center bg-warning text-white">
            <div className="card-body">
              <h3>{activeRecruitmentRequests}</h3>
              <p className="mb-0">Äang tuyá»ƒn dá»¥ng</p>
            </div>
          </div>
        </div>
      </div>

      {/* Tabs */}
      <ul className="nav nav-tabs mb-4">
        <li className="nav-item">
          <a
            className={`nav-link${activeTab === 'logs' ? ' active' : ''}`}
            onClick={() => handleTabChange('logs')}
            role="button"
          >
            <i className="fas fa-list me-2"></i>
            Báº£n ghi cháº¥m cÃ´ng
          </a>
        </li>
        <li className="nav-item">
          <a
            className={`nav-link${activeTab === 'hours' ? ' active' : ''}`}
            onClick={() => handleTabChange('hours')}
            role="button"
          >
            <i className="fas fa-clock me-2"></i>
            Tá»•ng giá» cÃ´ng
          </a>
        </li>
        <li className="nav-item">
          <a
            className={`nav-link${activeTab === 'recruitment' ? ' active' : ''}`}
            onClick={() => handleTabChange('recruitment')}
            role="button"
          >
            <i className="fas fa-users me-2"></i>
            Tá»•ng há»£p giá» cÃ´ng theo tuyá»ƒn dá»¥ng
            {loadingRecruitment && (
              <span className="spinner-border spinner-border-sm ms-2" role="status" aria-hidden="true"></span>
            )}
          </a>
        </li>
      </ul>

      {/* Tab Content */}
      <div className="tab-content">
        {/* Tab Logs (iframe) */}
        <div
          className="iframe-tab-container"
          style={{
            display: activeTab === 'logs' ? 'block' : 'none',
            width: '100%',
            height: 'calc(100vh - 450px)',
            minHeight: '500px'
          }}
        >
          <div className="card h-100">
            <div className="card-header">
              <h5 className="mb-0">Chi tiáº¿t báº£n ghi cháº¥m cÃ´ng (Dá»¯ liá»‡u trá»±c tiáº¿p tá»« Lark)</h5>
            </div>
            <div className="card-body p-0 h-100">
              <iframe
                src={LARK_LOGS_URL}
                title="Báº£ng Cháº¥m CÃ´ng tá»« Lark Base"
                style={{ width: '100%', height: '100%', border: 'none' }}
                loading="lazy"
                allow="fullscreen"
              >
                TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ iframe.
              </iframe>
            </div>
          </div>
        </div>

        {/* Tab Hours (iframe) */}
        <div
          className="iframe-tab-container"
          style={{
            display: activeTab === 'hours' ? 'block' : 'none',
            width: '100%',
            height: 'calc(100vh - 450px)',
            minHeight: '500px'
          }}
        >
          <div className="card h-100">
            <div className="card-header">
              <h5 className="mb-0">Tá»•ng giá» cÃ´ng (Dá»¯ liá»‡u trá»±c tiáº¿p tá»« Lark)</h5>
            </div>
            <div className="card-body p-0 h-100">
              <iframe
                src={LARK_HOURS_URL}
                title="Tá»•ng Giá» CÃ´ng tá»« Lark Base"
                style={{ width: '100%', height: '100%', border: 'none' }}
                loading="lazy"
                allow="fullscreen"
              >
                TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ iframe.
              </iframe>
            </div>
          </div>
        </div>

        {/* Tab Recruitment */}
        {activeTab === 'recruitment' && (
          <div className="tab-pane fade show active" id="recruitment-tab">
            <div className="card">
              <div className="card-header d-flex justify-content-between align-items-center">
                <div>
                  <h5 className="mb-0">Tá»•ng há»£p giá» cÃ´ng theo káº¿ hoáº¡ch tuyá»ƒn dá»¥ng</h5>
                  <small className="text-muted">
                    Dá»¯ liá»‡u realtime - Click nÃºt download Ä‘á»ƒ xuáº¥t file Excel chi tiáº¿t
                    {loadingRecruitment && (
                      <span className="text-info ms-2">
                        <i className="fas fa-sync fa-spin"></i> Äang cáº­p nháº­t...
                      </span>
                    )}
                  </small>
                </div>
                <button
                  className="btn btn-sm btn-outline-primary"
                  onClick={() => loadRecruitmentHours(true)}
                  disabled={loadingRecruitment}
                >
                  <i className={`fas fa-sync ${loadingRecruitment ? 'fa-spin' : ''} me-1`}></i>
                  LÃ m má»›i ngay
                </button>
              </div>
              <div className="card-body">
                {loadingRecruitment && (
                  <div className="text-center py-4">
                    <div className="spinner-border text-primary" role="status">
                      <span className="visually-hidden">Loading...</span>
                    </div>
                    <p className="mt-2 text-muted">Äang táº£i dá»¯ liá»‡u má»›i nháº¥t...</p>
                  </div>
                )}
                
                {!loadingRecruitment && (
                  <div className="table-responsive">
                    <table className="table table-striped table-hover">
                      <thead>
                        <tr>
                          <th>Request No.</th>
                          <th>PhÃ²ng ban</th>
                          <th>Thá»i gian</th>
                          <th>NhÃ¢n viÃªn</th>
                          <th>Tá»•ng giá» cÃ´ng</th>
                          <th>Tá»•ng lÆ°Æ¡ng</th>
                          <th>Tráº¡ng thÃ¡i</th>
                          <th>Chi tiáº¿t</th>
                        </tr>
                      </thead>
                      <tbody>
                        {Array.isArray(recruitmentHours) && recruitmentHours.length > 0 ? (
                          recruitmentHours.map((request, index) => (
                            <tr key={request.requestNo || index}>
                              <td>
                                <strong className="text-primary">{request.requestNo || 'N/A'}</strong>
                              </td>
                              <td>{request.department || 'N/A'}</td>
                              <td>
                                <small>
                                  {request.fromDate && request.toDate ?
                                    `${request.fromDate} - ${request.toDate}` :
                                    'N/A'
                                  }
                                </small>
                              </td>
                              <td>
                                <span className="badge bg-info">
                                  {request.totalEmployees} ngÆ°á»i
                                </span>
                              </td>
                              <td>
                                <strong className="text-success">{request.totalHours || '0 giá»'}</strong>
                              </td>
                              <td>
                                <strong className="text-warning">{request.totalSalary || '0 â‚«'}</strong>
                              </td>
                              <td>
                                <span className={`badge ${
                                  request.status === 'Äang tuyá»ƒn dá»¥ng' ? 'bg-success' :
                                    request.status === 'ÄÃ£ hoÃ n thÃ nh' ? 'bg-primary' : 'bg-secondary'
                                  }`}>
                                  {request.status || 'N/A'}
                                </span>
                              </td>
                              <td>
                                <button
                                  className="btn btn-sm btn-success"
                                  onClick={() => exportToExcel(request)}
                                  title="Xuáº¥t Excel chi tiáº¿t"
                                  disabled={!request.employees || request.employees.length === 0}
                                >
                                  <i className="fas fa-file-excel"></i>
                                </button>
                              </td>
                            </tr>
                          ))
                        ) : (
                          <tr>
                            <td colSpan="8" className="text-center text-muted py-4">
                              <i className="fas fa-inbox fa-2x mb-2"></i>
                              <br />
                              ChÆ°a cÃ³ dá»¯ liá»‡u tá»•ng há»£p giá» cÃ´ng theo tuyá»ƒn dá»¥ng
                            </td>
                          </tr>
                        )}
                      </tbody>
                    </table>
                  </div>
                )}

                {/* Thá»‘ng kÃª tá»•ng quan */}
                {!loadingRecruitment && recruitmentHours.length > 0 && (
                  <div className="row mt-4">
                    <div className="col-md-3">
                      <div className="card text-center bg-light">
                        <div className="card-body">
                          <h4 className="text-primary">{recruitmentHours.length}</h4>
                          <p className="mb-0">Tá»•ng sá»‘ Ä‘á» xuáº¥t</p>
                        </div>
                      </div>
                    </div>
                    <div className="col-md-3">
                      <div className="card text-center bg-light">
                        <div className="card-body">
                          <h4 className="text-success">
                            {recruitmentHours.reduce((sum, req) => sum + req.totalEmployees, 0)}
                          </h4>
                          <p className="mb-0">Tá»•ng nhÃ¢n viÃªn</p>
                        </div>
                      </div>
                    </div>
                    <div className="col-md-3">
                      <div className="card text-center bg-light">
                        <div className="card-body">
                          <h4 className="text-warning">
                            {recruitmentHours.reduce((sum, req) => sum + (req.totalHoursNumeric || 0), 0).toFixed(1)} giá»
                          </h4>
                          <p className="mb-0">Tá»•ng giá» cÃ´ng</p>
                        </div>
                      </div>
                    </div>
                    <div className="col-md-3">
                      <div className="card text-center bg-light">
                        <div className="card-body">
                          <h4 className="text-danger">
                            {new Intl.NumberFormat('vi-VN', { 
                              style: 'currency', 
                              currency: 'VND' 
                            }).format(recruitmentHours.reduce((sum, req) => sum + (req.totalSalaryNumeric || 0), 0))}
                          </h4>
                          <p className="mb-0">Tá»•ng lÆ°Æ¡ng</p>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default AttendanceLogsPage;

```


==================== File: .\src\pages\EmployeeManagementPage.jsx ====================

import React, { useState, useMemo } from 'react';
import { useEmployees } from '../hooks/useEmployees';

// Import cÃ¡c components con
import EmployeeList from '../components/employee/EmployeeList.jsx';
import EmployeeAddForm from '../components/employee/EmployeeAddForm.jsx';
import EmployeeEditModal from '../components/employee/EmployeeEditModal.jsx';
// âœ… THÃŠM: Import cÃ¡c modal cho Work History
import AddWorkHistoryModal from '../components/employee/AddWorkHistoryModal.jsx';
import WorkHistoryModal from '../components/employee/WorkHistoryModal.jsx';
import Loading from '../components/common/Loading.jsx';
import Alert from '../components/common/Alert.jsx';

const EmployeeManagementPage = () => {
  const {
    employees,
    loading,
    error,
    addEmployee,
    updateEmployee,
    deleteEmployee,
    refreshEmployees,
  } = useEmployees();

  // State cho modal chá»‰nh sá»­a
  const [isEditModalOpen, setIsEditModalOpen] = useState(false);
  const [selectedEmployee, setSelectedEmployee] = useState(null);

  // âœ… Cáº¬P NHáº¬T: State cho cÃ¡c modal Work History
  const [isAddWorkHistoryModalOpen, setAddWorkHistoryModalOpen] = useState(false);
  const [isManageWorkHistoryModalOpen, setManageWorkHistoryModalOpen] = useState(false); // âœ… THAY Äá»”I: Äá»•i tÃªn tá»« isViewWorkHistoryModalOpen
  const [employeeForHistory, setEmployeeForHistory] = useState(null);
  
  // State cho tÃ¬m kiáº¿m vÃ  bá»™ lá»c
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState('');

  const filteredEmployees = useMemo(() => {
    // ... (Giá»¯ nguyÃªn logic lá»c)
    let filtered = employees;
    if (searchTerm) {
      const lowerCaseSearchTerm = searchTerm.toLowerCase();
      filtered = filtered.filter(
        (employee) =>
          employee.fullName.toLowerCase().includes(lowerCaseSearchTerm) ||
          employee.employeeId.toLowerCase().includes(lowerCaseSearchTerm) ||
          (employee.phoneNumber && employee.phoneNumber.includes(searchTerm))
      );
    }
    if (statusFilter) {
      filtered = filtered.filter((employee) => employee.status === statusFilter);
    }
    return filtered;
  }, [employees, searchTerm, statusFilter]);

  // CÃ¡c hÃ m xá»­ lÃ½ sá»± kiá»‡n cho NhÃ¢n viÃªn
  const handleOpenEditModal = (employee) => {
    setSelectedEmployee(employee);
    setIsEditModalOpen(true);
  };
  
  const handleUpdateEmployee = async (employeeData) => {
    if (!selectedEmployee) return;
    const success = await updateEmployee(selectedEmployee.id, employeeData);
    if (success) {
      setIsEditModalOpen(false);
      setSelectedEmployee(null);
    }
  };

  // const handleDeleteEmployee = async (id) => {
  //   await deleteEmployee(id);
  // };


  // âœ… Cáº¬P NHáº¬T: handleDeleteEmployee vá»›i warning vá» work history
  const handleDeleteEmployee = async (id) => {
      // TÃ¬m employee Ä‘á»ƒ láº¥y thÃ´ng tin
      const employee = employees.find(emp => emp.id === id);
      if (!employee) {
          showNotification('KhÃ´ng tÃ¬m tháº¥y nhÃ¢n viÃªn Ä‘á»ƒ xÃ³a', 'error');
          return;
      }
      
      // âœ… THÃŠM: Warning vá» cascade delete
      const confirmMessage = `âš ï¸ Cáº¢NH BÃO: XÃ³a nhÃ¢n viÃªn sáº½ xÃ³a vÄ©nh viá»…n:

  ğŸ‘¤ NhÃ¢n viÃªn: "${employee.fullName}" (${employee.employeeId})
  ğŸ“‹ Táº¤T Cáº¢ lá»‹ch sá»­ cÃ´ng viá»‡c liÃªn quan
  â° Táº¤T Cáº¢ dá»¯ liá»‡u cháº¥m cÃ´ng liÃªn quan

  â— HÃ nh Ä‘á»™ng nÃ y KHÃ”NG THá»‚ HOÃ€N TÃC!

  Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n tiáº¿p tá»¥c?`;

      if (!window.confirm(confirmMessage)) {
          return;
      }
      
      // âœ… THÃŠM: Second confirmation
      const finalConfirm = `XÃ¡c nháº­n láº§n cuá»‘i: XÃ³a "${employee.fullName}"?`;
      if (!window.confirm(finalConfirm)) {
          return;
      }
      
      // Thá»±c hiá»‡n xÃ³a
      const success = await deleteEmployee(id);
      if (success) {
          showNotification(`ÄÃ£ xÃ³a nhÃ¢n viÃªn "${employee.fullName}" vÃ  táº¥t cáº£ dá»¯ liá»‡u liÃªn quan`, 'success');
      }
  };



  const handleAddEmployee = async (formData) => {
    return await addEmployee(formData);
  };

  // âœ… Cáº¬P NHáº¬T: CÃ¡c hÃ m xá»­ lÃ½ cho Work History
  const handleOpenAddWorkHistoryModal = (employee) => {
    setEmployeeForHistory(employee);
    setAddWorkHistoryModalOpen(true);
  };

  // âœ… THAY Äá»”I: Äá»•i tÃªn function
  const handleOpenManageWorkHistoryModal = (employee) => {
    setEmployeeForHistory(employee);
    setManageWorkHistoryModalOpen(true); // âœ… THAY Äá»”I: Sá»­ dá»¥ng state má»›i
  };
  

  // âœ… THÃŠM: HÃ m refresh data sau khi sá»­a work history
  const handleWorkHistoryUpdated = async () => {
    console.log('ğŸ”„ Work history updated, refreshing employee data...');
    await refreshEmployees();
  };

  const handleCloseModals = () => {
    setAddWorkHistoryModalOpen(false);
    setManageWorkHistoryModalOpen(false); // âœ… THAY Äá»”I: Cáº­p nháº­t state má»›i
    setEmployeeForHistory(null);
  };

  // HÃ m nÃ y sáº½ Ä‘Æ°á»£c gá»i khi thÃªm Work History thÃ nh cÃ´ng tá»« modal
  const handleSaveWorkHistory = () => {
    refreshEmployees(); // Táº£i láº¡i danh sÃ¡ch Ä‘á»ƒ cáº­p nháº­t (náº¿u cáº§n)
    handleCloseModals();
  };

  const handleWorkHistoryDataChanged = () => {
    console.log('Work history Ä‘Ã£ thay Ä‘á»•i, Ä‘ang refresh...');
    // Gá»i láº¡i API Ä‘á»ƒ fetch data nhÃ¢n viÃªn má»›i
    refreshEmployees(); // Hoáº·c tÃªn hÃ m fetch data cá»§a báº¡n
  };


  return (
    <div className="container-fluid mt-4">
      <div className="page-header d-flex justify-content-between align-items-center mb-3">
        <h2>Quáº£n lÃ½ NhÃ¢n viÃªn</h2>
      </div>
      
      <div className="row">
        <div className="col-lg-5 mb-4">
          <EmployeeAddForm onSave={handleAddEmployee} isLoading={loading} />
        </div>
        <div className="col-lg-7">
          <div className="card">
            <div className="card-header">
              <h5 className="card-title mb-0">Danh sÃ¡ch nhÃ¢n viÃªn</h5>
            </div>
            <div className="card-body">
              <div className="row mb-3">
                <div className="col-md-8">
                  <input
                    type="text"
                    className="form-control"
                    placeholder="TÃ¬m kiáº¿m theo tÃªn, mÃ£ NV, SÄT..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                  />
                </div>
                <div className="col-md-4">
                  <select
                    className="form-select"
                    value={statusFilter}
                    onChange={(e) => setStatusFilter(e.target.value)}
                  >
                    <option value="">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
                    <option value="active">Hoáº¡t Ä‘á»™ng</option>
                    <option value="inactive">NgÆ°ng hoáº¡t Ä‘á»™ng</option>
                  </select>
                </div>
              </div>

              {loading && !error && <Loading />}
              {error && <Alert message={`Lá»—i: ${error}`} type="danger" onRetry={refreshEmployees} />}
              
              {!loading && !error && (
                <EmployeeList
                  employees={filteredEmployees}
                  onEdit={handleOpenEditModal}
                  onDelete={handleDeleteEmployee}
                  // âœ… Cáº¬P NHáº¬T: Truyá»n cÃ¡c hÃ m xá»­ lÃ½ Work History vá»›i tÃªn má»›i
                  onAddWorkHistory={handleOpenAddWorkHistoryModal}
                  onManageWorkHistory={handleOpenManageWorkHistoryModal} // âœ… THAY Äá»”I: Äá»•i tÃªn prop
                />
              )}
            </div>
          </div>
        </div>
      </div>

      {/* Modal chá»‰nh sá»­a nhÃ¢n viÃªn */}
      {isEditModalOpen && selectedEmployee && (
        <EmployeeEditModal
          isOpen={isEditModalOpen}
          onClose={() => setIsEditModalOpen(false)}
          onSave={handleUpdateEmployee}
          employee={selectedEmployee}
        />
      )}

      {/* âœ… Cáº¬P NHáº¬T: Render cÃ¡c modal cho Work History */}
      {isAddWorkHistoryModalOpen && employeeForHistory && (
        <AddWorkHistoryModal
          isOpen={isAddWorkHistoryModalOpen}
          onClose={handleCloseModals}
          onSave={handleSaveWorkHistory}
          employee={employeeForHistory}
        />
      )}
      
      {/* âœ… THAY Äá»”I: Sá»­ dá»¥ng WorkHistoryModal CRUD vá»›i state vÃ  props má»›i */}
      {isManageWorkHistoryModalOpen && employeeForHistory && (
        <WorkHistoryModal
          isOpen={isManageWorkHistoryModalOpen}
          onClose={handleCloseModals}
          onDataUpdated={handleWorkHistoryUpdated}
          employeeId={employeeForHistory.employeeId}
          employeeName={employeeForHistory.fullName}
          onDataChanged={handleWorkHistoryDataChanged}
        />
      )}
    </div>
  );
};

export default EmployeeManagementPage;

```


==================== File: .\src\pages\HRDashboardPage.jsx ====================

import React, { useState, useEffect } from 'react';
import { useAuth } from '../hooks/useAuth';
import { ApiClient } from '../services/api';
import { useNotification } from '../hooks/useNotification';
import Loading from '../components/common/Loading';

const HRDashboardPage = () => {
  const [stats, setStats] = useState({
    totalEmployees: 0,
    activeEmployees: 0,
    inactiveEmployees: 0,
    totalAttendanceLogs: 0,
    todayLogs: 0,
  });
  const [loading, setLoading] = useState(true);
  const { user } = useAuth();
  const { showNotification } = useNotification();

  useEffect(() => {
    checkPermissions();
    loadStats();
    // eslint-disable-next-line
  }, []);

  const checkPermissions = () => {
    if (!user || (user.role !== 'hr' && user.role !== 'admin')) {
      showNotification('Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p trang nÃ y', 'error');
      window.location.href = '/dashboard';
    }
  };

  // **LÆ°u Ã½ QUAN TRá»ŒNG: Pháº£i dÃ¹ng Ä‘Ãºng endpoint `/api/dashboard/stats`**
  const loadStats = async () => {
    setLoading(true);
    try {
      console.log('ğŸ” HRDashboard: Loading stats...');
      // Äá»”I endpoint
      const response = await ApiClient.get('/api/dashboard/stats');
      console.log('ğŸ“¨ HRDashboard: Raw response:', response);

      if (response.success && response.data) {
        // Gá»™p stats employee vÃ  attendance
        const employee = response.data.employee || {};
        const attendance = response.data.attendance || {};

        const statsObj = {
          totalEmployees: employee.totalEmployees || 0,
          activeEmployees: employee.activeEmployees || 0,
          inactiveEmployees:
            (employee.totalEmployees || 0) - (employee.activeEmployees || 0),
          totalAttendanceLogs: attendance.totalAttendanceLogs || 0,
          todayLogs: attendance.todayLogs || 0,
        };

        console.log('âœ… HRDashboard: Setting stats to:', statsObj);
        setStats(statsObj);
      } else {
        showNotification(
          response.message || 'KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u thá»‘ng kÃª',
          'warning'
        );
      }
    } catch (error) {
      console.error('âŒ HRDashboard: Error loading stats:', error);
      showNotification('Lá»—i khi táº£i thá»‘ng kÃª HR', 'error');
    } finally {
      setLoading(false);
    }
  };

  const handleRefresh = async () => {
    await loadStats();
    showNotification('ÄÃ£ cáº­p nháº­t dá»¯ liá»‡u HR dashboard', 'success');
  };

  // DEBUG info
  console.log('ğŸ¯ HRDashboard render - Current stats:', stats); // eslint-disable-line
  console.log('ğŸ¯ HRDashboard render - Loading:', loading); // eslint-disable-line

  if (loading) {
    return <Loading fullScreen text="Äang táº£i HR dashboard..." />;
  }

  return (
    <div className="hr-dashboard-page">
      {/* DEBUG INFO - CÃ³ thá»ƒ xoÃ¡ sau */}
      <div
        style={{
          background: '#f8f9fa',
          border: '1px solid #dee2e6',
          borderRadius: '0.25rem',
          padding: '1rem',
          marginBottom: '1rem',
        }}
      >
        <h6 className="text-muted mb-2">ğŸ› DEBUG INFO (HR Dashboard):</h6>
        <small className="d-block">Raw stats: {JSON.stringify(stats)}</small>
        <small className="d-block">Total Employees: {stats.totalEmployees}</small>
        <small className="d-block">Active Employees: {stats.activeEmployees}</small>
        <small className="d-block">Inactive Employees: {stats.inactiveEmployees}</small>
        <small className="d-block">Total Attendance Logs: {stats.totalAttendanceLogs}</small>
        <small className="d-block">Today Logs: {stats.todayLogs}</small>
      </div>

      {/* Header */}
      <div className="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1>HR Dashboard</h1>
          <p className="text-muted mb-0">Dashboard dÃ nh cho bá»™ pháº­n nhÃ¢n sá»±</p>
        </div>
        <button
          className="btn btn-outline-primary"
          onClick={handleRefresh}
          disabled={loading}
        >
          <i className={`fas fa-sync-alt me-2 ${loading ? 'fa-spin' : ''}`}></i>
          LÃ m má»›i
        </button>
      </div>

      {/* Stats Cards */}
      <div className="row mb-4">
        <div className="col-md-3 mb-3">
          <div className="card text-center bg-primary text-white h-100">
            <div className="card-body">
              <i className="fas fa-users fa-3x mb-3"></i>
              <h2>{stats.totalEmployees}</h2>
              <p className="mb-0">Tá»•ng nhÃ¢n viÃªn</p>
            </div>
          </div>
        </div>

        <div className="col-md-3 mb-3">
          <div className="card text-center bg-success text-white h-100">
            <div className="card-body">
              <i className="fas fa-user-check fa-3x mb-3"></i>
              <h2>{stats.activeEmployees}</h2>
              <p className="mb-0">NhÃ¢n viÃªn hoáº¡t Ä‘á»™ng</p>
            </div>
          </div>
        </div>

        <div className="col-md-3 mb-3">
          <div className="card text-center bg-warning text-white h-100">
            <div className="card-body">
              <i className="fas fa-user-times fa-3x mb-3"></i>
              <h2>{stats.inactiveEmployees}</h2>
              <p className="mb-0">KhÃ´ng hoáº¡t Ä‘á»™ng</p>
            </div>
          </div>
        </div>

        <div className="col-md-3 mb-3">
          <div className="card text-center bg-info text-white h-100">
            <div className="card-body">
              <i className="fas fa-clock fa-3x mb-3"></i>
              <h2>{stats.totalAttendanceLogs}</h2>
              <p className="mb-0">Tá»•ng cháº¥m cÃ´ng</p>
            </div>
          </div>
        </div>
      </div>

      {/* Management Actions */}
      <div className="row mb-4">
        <div className="col-md-6">
          <div className="card">
            <div className="card-header">
              <h5 className="mb-0">Quáº£n lÃ½ nhÃ¢n sá»±</h5>
            </div>
            <div className="card-body">
              <div className="d-grid gap-2">
                <a href="/employee-management" className="btn btn-primary">
                  <i className="fas fa-users-cog me-2"></i>
                  Quáº£n lÃ½ nhÃ¢n viÃªn
                </a>
                <a href="/attendance-logs" className="btn btn-info">
                  <i className="fas fa-clock me-2"></i>
                  Xem cháº¥m cÃ´ng
                </a>
                <button className="btn btn-success" onClick={handleRefresh}>
                  <i className="fas fa-sync-alt me-2"></i>
                  Cáº­p nháº­t dá»¯ liá»‡u
                </button>
              </div>
            </div>
          </div>
        </div>

        <div className="col-md-6">
          <div className="card">
            <div className="card-header">
              <h5 className="mb-0">CÃ´ng cá»¥ HR</h5>
            </div>
            <div className="card-body">
              <div className="d-grid gap-2">
                <button className="btn btn-outline-primary" disabled>
                  <i className="fas fa-user-plus me-2"></i>
                  Tuyá»ƒn dá»¥ng (Sáº¯p cÃ³)
                </button>
                <button className="btn btn-outline-secondary" disabled>
                  <i className="fas fa-file-export me-2"></i>
                  Xuáº¥t bÃ¡o cÃ¡o (Sáº¯p cÃ³)
                </button>
                <a href="/dashboard" className="btn btn-outline-info">
                  <i className="fas fa-tachometer-alt me-2"></i>
                  Dashboard chÃ­nh
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* HR Reports Section */}
      <div className="row">
        <div className="col-12">
          <div className="card">
            <div className="card-header">
              <h5 className="mb-0">BÃ¡o cÃ¡o HR</h5>
            </div>
            <div className="card-body">
              <div className="row">
                <div className="col-md-4 text-center">
                  <div className="p-3">
                    <i className="fas fa-chart-bar fa-2x text-primary mb-2"></i>
                    <h6>BÃ¡o cÃ¡o nhÃ¢n sá»±</h6>
                    <button className="btn btn-sm btn-primary" disabled>
                      Xem bÃ¡o cÃ¡o (Sáº¯p cÃ³)
                    </button>
                  </div>
                </div>
                <div className="col-md-4 text-center">
                  <div className="p-3">
                    <i className="fas fa-chart-line fa-2x text-success mb-2"></i>
                    <h6>BÃ¡o cÃ¡o cháº¥m cÃ´ng</h6>
                    <button className="btn btn-sm btn-success" disabled>
                      Xem bÃ¡o cÃ¡o (Sáº¯p cÃ³)
                    </button>
                  </div>
                </div>
                <div className="col-md-4 text-center">
                  <div className="p-3">
                    <i className="fas fa-chart-pie fa-2x text-info mb-2"></i>
                    <h6>BÃ¡o cÃ¡o tá»•ng há»£p</h6>
                    <button className="btn btn-sm btn-info" disabled>
                      Xem bÃ¡o cÃ¡o (Sáº¯p cÃ³)
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default HRDashboardPage;

```


==================== File: .\src\pages\LoginPage.jsx ====================

import React, { useState, useEffect } from 'react';
import { Navigate, useNavigate } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import { useNotification } from '../hooks/useNotification';
import Loading from '../components/common/Loading';

const LoginPage = () => {
  const [credentials, setCredentials] = useState({
    username: '',
    password: ''
  });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [errors, setErrors] = useState({});
  
  // âœ… THÃŠM: State Ä‘á»ƒ Ä‘Ã¡nh dáº¥u khi Ä‘ang thá»±c hiá»‡n quick access
  const [isQuickAccess, setIsQuickAccess] = useState(false);
  
  const { user, login, loading } = useAuth();
  const { showNotification } = useNotification();
  const navigate = useNavigate();

  useEffect(() => {
    // Clear any existing alerts
    const alertContainer = document.getElementById('alert-container');
    if (alertContainer) {
      alertContainer.innerHTML = '';
    }
  }, []);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setCredentials(prev => ({
      ...prev,
      [name]: value
    }));
    
    // Clear error when user starts typing
    if (errors[name]) {
      setErrors(prev => ({
        ...prev,
        [name]: ''
      }));
    }
  };

  const validateForm = () => {
    const newErrors = {};
    
    if (!credentials.username.trim()) {
      newErrors.username = 'Vui lÃ²ng nháº­p tÃªn Ä‘Äƒng nháº­p';
    }
    
    if (!credentials.password.trim()) {
      newErrors.password = 'Vui lÃ²ng nháº­p máº­t kháº©u';
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
      showNotification('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!', 'error');
      return;
    }

    setIsSubmitting(true);
    
    try {
      const response = await login(credentials);
      
      console.log('âœ… Regular login response:', response);
      console.log('ğŸ‘¤ User role:', response?.data?.user?.role);
      
      showNotification('ÄÄƒng nháº­p thÃ nh cÃ´ng!', 'success');
      
      // Login bÃ¬nh thÆ°á»ng - redirect to employee-management vá»›i full quyá»n
      setTimeout(() => {
        console.log('ğŸ¯ Regular login redirecting to /employee-management');
        navigate('/employee-management', { replace: true });
      }, 1000);
      
    } catch (error) {
      console.error('Login error:', error);
      showNotification('TÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng!', 'error');
    } finally {
      setIsSubmitting(false);
    }
  };

  // âœ… Sá»¬A: Handle quick access vá»›i giáº£i phÃ¡p 1
  const handleQuickAccess = async () => {
    setIsQuickAccess(true); // âœ… Set flag trÆ°á»›c khi login
    setIsSubmitting(true);
    console.log('ğŸš€ Starting quick access with bypass flag...');
    
    try {
      const salesCredentials = {
        username: 'sales',
        password: 'sales123'
      };
      
      console.log('ğŸ“ Calling login with sales credentials');
      const response = await login(salesCredentials);
      
      // âœ… ÄÆ¡n giáº£n hÃ³a logic xá»­ lÃ½ response
      if (response && (response.success || response.data?.user || response.user)) {
        const userData = response.data?.user || response.user;
        console.log('ğŸ‘¤ User found:', userData);
        console.log('ğŸ·ï¸ User role:', userData?.role);
        
        showNotification('Truy cáº­p thÃ nh cÃ´ng!', 'success');
        
        // âœ… Navigate ngay láº­p tá»©c, khÃ´ng cáº§n setTimeout
        console.log('ğŸ¯ Quick access redirecting to /attendance-logs');
        navigate('/attendance-logs', { replace: true });
        
      } else {
        console.error('âŒ Login failed - no user data found');
        showNotification('ÄÄƒng nháº­p tháº¥t báº¡i!', 'error');
      }
      
    } catch (error) {
      console.error('âŒ Quick access error:', error);
      console.error('âŒ Error details:', error.message);
      showNotification('KhÃ´ng thá»ƒ truy cáº­p há»‡ thá»‘ng. Vui lÃ²ng thá»­ láº¡i!', 'error');
    } finally {
      setIsSubmitting(false);
      setIsQuickAccess(false); // âœ… Reset flag
    }
  };

  // âœ… Sá»¬A: Logic redirect tá»± Ä‘á»™ng vá»›i bypass cho quick access
  if (user && !isQuickAccess) {
    // PhÃ¢n quyá»n redirect: sales -> attendance-logs, cÃ²n láº¡i -> employee-management
    const redirectPath = user.role === 'sales' ? '/attendance-logs' : '/employee-management';
    console.log('ğŸ”„ User already logged in, redirecting to:', redirectPath);
    return <Navigate to={redirectPath} replace />;
  }

  // Show loading during auth check
  if (loading) {
    return (
      <div className="d-flex justify-content-center align-items-center min-vh-100">
        <Loading />
      </div>
    );
  }

  return (
    <div className="min-vh-100 d-flex align-items-center justify-content-center bg-light">
      <div className="container">
        <div className="row justify-content-center">
          <div className="col-md-6 col-lg-4">
            <div className="card shadow">
              <div className="card-body p-4">
                <div className="text-center mb-4">
                  <h2 className="card-title">ÄÄƒng nháº­p</h2>
                  <p className="text-muted">Há»‡ thá»‘ng quáº£n lÃ½ nhÃ¢n sá»±</p>
                </div>

                <form onSubmit={handleSubmit} noValidate>
                  <div className="mb-3">
                    <label htmlFor="username" className="form-label">
                      TÃªn Ä‘Äƒng nháº­p <span className="text-danger">*</span>
                    </label>
                    <input
                      type="text"
                      className={`form-control ${errors.username ? 'is-invalid' : ''}`}
                      id="username"
                      name="username"
                      value={credentials.username}
                      onChange={handleInputChange}
                      placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p"
                      disabled={isSubmitting}
                      required
                    />
                    {errors.username && (
                      <div className="invalid-feedback">
                        {errors.username}
                      </div>
                    )}
                  </div>

                  <div className="mb-4">
                    <label htmlFor="password" className="form-label">
                      Máº­t kháº©u <span className="text-danger">*</span>
                    </label>
                    <input
                      type="password"
                      className={`form-control ${errors.password ? 'is-invalid' : ''}`}
                      id="password"
                      name="password"
                      value={credentials.password}
                      onChange={handleInputChange}
                      placeholder="Nháº­p máº­t kháº©u"
                      disabled={isSubmitting}
                      required
                    />
                    {errors.password && (
                      <div className="invalid-feedback">
                        {errors.password}
                      </div>
                    )}
                  </div>

                  {/* Hai nÃºt: ÄÄƒng nháº­p vÃ  Truy cáº­p nhanh */}
                  <div className="row mb-3">
                    <div className="col-6">
                      <button
                        type="submit"
                        className="btn btn-primary w-100"
                        disabled={isSubmitting}
                      >
                        {isSubmitting && !isQuickAccess ? (
                          <>
                            <span className="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Äang xá»­ lÃ½...
                          </>
                        ) : (
                          'ÄÄƒng nháº­p'
                        )}
                      </button>
                    </div>
                    <div className="col-6">
                      <button
                        type="button"
                        className="btn btn-outline-secondary w-100"
                        onClick={handleQuickAccess}
                        disabled={isSubmitting}
                      >
                        {isSubmitting && isQuickAccess ? (
                          <>
                            <span className="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Truy cáº­p...
                          </>
                        ) : (
                          'Truy cáº­p nhanh'
                        )}
                      </button>
                    </div>
                  </div>
                </form>

                {/* Ghi chÃº thÃ´ng tin */}
                <div className="mt-3 p-3 bg-info bg-opacity-10 rounded">
                  <small className="text-info">
                    <i className="bi bi-info-circle me-1"></i>
                    <strong>Ghi chÃº:</strong><br />
                    â€¢ <strong>ÄÄƒng nháº­p:</strong> Truy cáº­p Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng quáº£n lÃ½ nhÃ¢n viÃªn<br />
                    â€¢ <strong>Truy cáº­p nhanh:</strong> Xem bÃ¡o cÃ¡o cháº¥m cÃ´ng nhanh chÃ³ng
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default LoginPage;

```


==================== File: .\src\services\api.js ====================

// API helper functions - converted from vanilla JS
export class ApiClient {
  static async request(url, options = {}) {
    try {
      const response = await fetch(url, {
        headers: {
          'Content-Type': 'application/json',
          ...options.headers
        },
        credentials: 'include',
        ...options
      });

      // âœ… THÃŠM: Log request details Ä‘á»ƒ debug
      console.log('API Request:', {
        url,
        method: options.method || 'GET',
        body: options.body,
        status: response.status,
        statusText: response.statusText
      });

      if (!response.ok) {
        let errorData;
        try {
          errorData = await response.json();
          // âœ… THÃŠM: Log full error response
          console.error('Server error response:', errorData);
        } catch (parseError) {
          console.error('Could not parse error response:', parseError);
          errorData = { error: `HTTP ${response.status}: ${response.statusText}` };
        }
        
        // âœ… Sá»¬A: Tráº£ vá» object chá»©a Ä‘áº§y Ä‘á»§ thÃ´ng tin lá»—i
        throw new Error(JSON.stringify({
          status: response.status,
          message: errorData.message || errorData.error || 'Request failed',
          details: errorData
        }));
      }

      const data = await response.json();
      console.log('API Response:', data);
      return data;
    } catch (error) {
      console.error('API request error:', error);
      throw error;
    }
  }

  static async get(url, params = {}) {
    const queryString = new URLSearchParams(params).toString();
    const fullUrl = queryString ? `${url}?${queryString}` : url;
    return this.request(fullUrl);
  }

  static async post(url, data) {
    return this.request(url, {
      method: 'POST',
      body: JSON.stringify(data)
    });
  }

  static async put(url, data) {
    return this.request(url, {
      method: 'PUT',
      body: JSON.stringify(data)
    });
  }

  static async delete(url) {
    return this.request(url, {
      method: 'DELETE'
    });
  }
}

export default ApiClient;

```


==================== File: .\src\services\auth.js ====================


```


==================== File: .\src\services\employee.js ====================

// src/services/employee.js

import { ApiClient } from './api.js';

const handleError = (error, context) => {
    const message = error.response?.data?.message || error.message || `Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh khi ${context}.`;
    console.error(`âŒ Lá»—i Service API (${context}):`, message);
    throw new Error(message);
};

export const getEmployees = async () => {
    try {
        console.log('ğŸ“¡ SERVICE (FE): Gá»i API láº¥y danh sÃ¡ch nhÃ¢n viÃªn...');
        const response = await ApiClient.get('/api/employees');
        
        // âœ… Sá»¬A: Debug chi tiáº¿t response structure
        console.log('ğŸ” EMPLOYEE SERVICE: Raw axios response:', response);
        console.log('ğŸ” EMPLOYEE SERVICE: Response data type:', typeof response.data);
        console.log('ğŸ” EMPLOYEE SERVICE: Response data keys:', response.data ? Object.keys(response.data) : 'NULL');
        console.log('ğŸ” EMPLOYEE SERVICE: Response data:', response.data);
        
        if (!response.data) {
            throw new Error('Server khÃ´ng tráº£ vá» dá»¯ liá»‡u');
        }
        
        // âœ… Sá»¬A: Xá»­ lÃ½ cáº£ 2 trÆ°á»ng há»£p response structure
        
        // TrÆ°á»ng há»£p 1: Standard structure {success, data, message}
        if (typeof response.data.success !== 'undefined') {
            console.log('âœ… EMPLOYEE SERVICE: Found standard structure');
            console.log('  - success:', response.data.success);
            console.log('  - message:', response.data.message);
            console.log('  - data type:', Array.isArray(response.data.data) ? 'array' : typeof response.data.data);
            console.log('  - data length:', response.data.data?.length);
            
            if (!response.data.success) {
                throw new Error(response.data.message || 'Server tráº£ vá» lá»—i');
            }
            
            return response.data; // Tráº£ vá» {success: true, data: [...], message: "..."}
        }
        
        // TrÆ°á»ng há»£p 2: Backend tráº£ vá» array trá»±c tiáº¿p
        if (Array.isArray(response.data)) {
            console.log('âœ… EMPLOYEE SERVICE: Response is direct array, converting to standard structure');
            console.log('  - data length:', response.data.length);
            
            // Wrap array vÃ o standard structure
            return {
                success: true,
                data: response.data,
                message: 'Láº¥y danh sÃ¡ch nhÃ¢n viÃªn thÃ nh cÃ´ng'
            };
        }
        
        // TrÆ°á»ng há»£p 3: Unknown structure
        console.warn('âš ï¸ EMPLOYEE SERVICE: Unknown response structure, trying to extract data');
        
        // Thá»­ tÃ¬m array trong cÃ¡c keys cá»§a response
        const possibleArrays = Object.values(response.data).filter(val => Array.isArray(val));
        if (possibleArrays.length > 0) {
            console.log('âœ… EMPLOYEE SERVICE: Found array in response, using it as data');
            return {
                success: true,
                data: possibleArrays[0],
                message: 'Láº¥y danh sÃ¡ch nhÃ¢n viÃªn thÃ nh cÃ´ng'
            };
        }
        
        throw new Error('Server tráº£ vá» dá»¯ liá»‡u khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng');
        
    } catch (error) {
        console.error('âŒ EMPLOYEE SERVICE: Full error:', error);
        handleError(error, 'láº¥y danh sÃ¡ch nhÃ¢n viÃªn');
    }
};

// Giá»¯ nguyÃªn cÃ¡c functions khÃ¡c...
export const addEmployee = async (employeeData) => {
    try {
        console.log('ğŸ“¡ SERVICE (FE): Gá»i API thÃªm nhÃ¢n viÃªn má»›i...', employeeData);
        const response = await ApiClient.post('/api/employees', employeeData);
        
        // âœ… THÃŠM: Debug vÃ  handle response structure
        console.log('ğŸ” ADD EMPLOYEE SERVICE: Response:', response);
        
        if (!response) {
            throw new Error('Server khÃ´ng tráº£ vá» dá»¯ liá»‡u khi thÃªm nhÃ¢n viÃªn');
        }
        
        // Handle different response structures
        if (typeof response.success !== 'undefined') {
            return response;
        }
        
        // Fallback: assume success if we got a response
        return {
            success: true,
            data: response,
            message: 'ThÃªm nhÃ¢n viÃªn thÃ nh cÃ´ng'
        };
        
    } catch (error) {
        handleError(error, 'thÃªm nhÃ¢n viÃªn má»›i');
    }
};

export const updateEmployee = async (id, employeeData) => {
    try {
        console.log(`ğŸ“¡ SERVICE (FE): Gá»i API cáº­p nháº­t nhÃ¢n viÃªn ID: ${id}...`, employeeData);
        const response = await ApiClient.put(`/api/employees/${id}`, employeeData);
        
        console.log('ğŸ” DEBUG: PUT Response Status:', response.status);
        console.log('ğŸ” DEBUG: PUT Response Headers:', response.headers);
        console.log('ğŸ” DEBUG: PUT Response Data:', response.data);
        console.log('ğŸ” DEBUG: PUT Response Full:', response);

        console.log('ğŸ” UPDATE EMPLOYEE SERVICE: Response:', response);
        
        // Handle different response structures
        if (typeof response.success !== 'undefined') {
            return response;
        }
        
        return {
            success: true,
            data: response,
            message: 'Cáº­p nháº­t nhÃ¢n viÃªn thÃ nh cÃ´ng'
        };
        
    } catch (error) {
        handleError(error, 'cáº­p nháº­t nhÃ¢n viÃªn');
    }
};

// export const deleteEmployee = async (id) => {
//     try {
//         console.log(`ğŸ“¡ SERVICE (FE): Gá»i API xÃ³a nhÃ¢n viÃªn ID: ${id}...`);
//         const response = await ApiClient.delete(`/api/employees/${id}`);
        
//         console.log('ğŸ” DELETE EMPLOYEE SERVICE: Response:', response);
        
//         return {
//             success: true,
//             message: 'XÃ³a nhÃ¢n viÃªn thÃ nh cÃ´ng'
//         };
//     } catch (error) {
//         handleError(error, 'xÃ³a nhÃ¢n viÃªn');
//     }
// };


export const deleteEmployee = async (id) => {
    try {
        console.log(`ğŸ“¡ SERVICE (FE): Gá»i API xÃ³a nhÃ¢n viÃªn ID: ${id}...`);
        const response = await ApiClient.delete(`/api/employees/${id}`);
        
        console.log('ğŸ” DELETE EMPLOYEE SERVICE: Response:', response);
        
        // âœ… THÃŠM: Hiá»ƒn thá»‹ thÃ´ng tin chi tiáº¿t tá»« backend
        if (response.data?.deletedWorkHistories > 0) {
            console.log(`âœ… Deleted ${response.data.deletedWorkHistories} work history records`);
        }
        
        return {
            success: true,
            message: response.message || 'XÃ³a nhÃ¢n viÃªn thÃ nh cÃ´ng',
            data: response.data
        };
        
    } catch (error) {
        console.error('âŒ Delete employee service error:', error);
        
        // âœ… THÃŠM: Better error message
        let errorMessage = 'Lá»—i khi xÃ³a nhÃ¢n viÃªn';
        
        try {
            const errorData = JSON.parse(error.message);
            errorMessage = errorData.message || errorMessage;
        } catch (parseError) {
            errorMessage = error.message || errorMessage;
        }
        
        throw new Error(errorMessage);
    }
};



export const getApprovedRecruitmentRequests = async () => {
    try {
        console.log('ğŸ“¡ SERVICE (FE): Gá»i API láº¥y danh sÃ¡ch Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng...');
        //const response = await ApiClient.get('/api/recruitment');

        //ThÃªm filter theo status
        const response = await ApiClient.get('/api/recruitment', {
            status: 'Approved,Under Review'
        });
        console.log('ğŸ” RECRUITMENT SERVICE: Response:', response);
        
        // Handle different response structures
        if (typeof response.success !== 'undefined') {
            return response.data || [];
        }
        
        if (Array.isArray(response)) {
            return response;
        }
        
        if (Array.isArray(response.data)) {
            return response.data;
        }
        
        return [];
    } catch (error) {
        console.error('âŒ Recruitment service error:', error);
        return []; // Return empty array instead of throwing
    }
};

export const getWorkHistory = async (employeeId) => {
    try {
        console.log(`ğŸ“¡ SERVICE (FE): Gá»i API láº¥y lá»‹ch sá»­ cÃ´ng viá»‡c: ${employeeId}...`);
        const response = await ApiClient.get(`/api/employees/${employeeId}/work-history`);
        
        console.log('ğŸ” WORK HISTORY SERVICE: Response:', response);
        
        // Handle different response structures
        if (typeof response.success !== 'undefined') {
            return response.data || [];
        }
        
        if (Array.isArray(response)) {
            return response;
        }
        
        if (Array.isArray(response.data)) {
            return response.data;
        }
        
        return [];
    } catch (error) {
        console.error('âŒ Work history service error:', error);
        return [];
    }
};

export const addWorkHistory = async (workHistoryData) => {
    try {
        console.log('ğŸ“¡ SERVICE (FE): Gá»i API thÃªm lá»‹ch sá»­ cÃ´ng viá»‡c...', workHistoryData);
        const response = await ApiClient.post('/api/employees/work-history', workHistoryData);
        
        console.log('ğŸ” ADD WORK HISTORY SERVICE: Response:', response);
        
        // Handle different response structures
        if (typeof response.success !== 'undefined') {
            return response;
        }
        
        return {
            success: true,
            data: response,
            message: 'ThÃªm lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng'
        };
    } catch (error) {
        handleError(error, 'thÃªm lá»‹ch sá»­ cÃ´ng viá»‡c');
    }
};

// âœ… THÃŠM Má»šI: Update work history
export const updateWorkHistory = async (id, workHistoryData) => {
    try {
        console.log(`ğŸ“¡ SERVICE (FE): Gá»i API cáº­p nháº­t lá»‹ch sá»­ cÃ´ng viá»‡c ID: ${id}...`, workHistoryData);
        const response = await ApiClient.put(`/api/employees/work-history/${id}`, workHistoryData);
        
        console.log('ğŸ” UPDATE WORK HISTORY SERVICE: Response:', response);
        
        // Handle different response structures
        if (typeof response.success !== 'undefined') {
            return response;
        }
        
        return {
            success: true,
            data: response,
            message: 'Cáº­p nháº­t lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng'
        };
        
    } catch (error) {
        handleError(error, 'cáº­p nháº­t lá»‹ch sá»­ cÃ´ng viá»‡c');
    }
};

// âœ… THÃŠM Má»šI: Delete work history
export const deleteWorkHistory = async (id) => {
    try {
        console.log(`ğŸ“¡ SERVICE (FE): Gá»i API xÃ³a lá»‹ch sá»­ cÃ´ng viá»‡c ID: ${id}...`);
        const response = await ApiClient.delete(`/api/employees/work-history/${id}`);
        
        console.log('ğŸ” DELETE WORK HISTORY SERVICE: Response:', response);
        
        return {
            success: true,
            message: 'XÃ³a lá»‹ch sá»­ cÃ´ng viá»‡c thÃ nh cÃ´ng'
        };
        
    } catch (error) {
        handleError(error, 'xÃ³a lá»‹ch sá»­ cÃ´ng viá»‡c');
    }
};

```


==================== File: .\src\styles\components.css ====================


```


==================== File: .\src\styles\globals.css ====================

/* Global styles for React app */
.loading {
  position: relative;
}

.loading::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.min-vh-100 {
  min-height: 100vh;
}

/* Alert container */
#alert-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1055;
  min-width: 300px;
}

/* Table enhancements */
.table-hover tbody tr:hover {
  background-color: rgba(0, 0, 0, 0.075);
}

/* Button groups */
.btn-group .btn {
  margin-right: 2px;
}

.btn-group .btn:last-child {
  margin-right: 0;
}

/* Form enhancements */
.is-invalid {
  border-color: #dc3545;
}

.is-valid {
  border-color: #198754;
}

/* Modal enhancements */
.modal-backdrop {
  backdrop-filter: blur(2px);
}

/* Work history entries */
.work-history-entry {
  background: #f8f9fa;
  border-left: 4px solid #007bff;
}

/* Recruitment table */
.recruitment-row.table-primary {
  background-color: rgba(13, 110, 253, 0.1) !important;
}

/* Loading spinner */
.spinner-border-sm {
  width: 1rem;
  height: 1rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .btn-group {
    flex-direction: column;
  }
  
  .btn-group .btn {
    margin-right: 0;
    margin-bottom: 2px;
  }
  
  .table-responsive {
    font-size: 0.875rem;
  }
}

```


==================== File: .\src\styles\notifications.css ====================

/* CSS cho há»‡ thá»‘ng thÃ´ng bÃ¡o "toast" */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 380px;
}

.alert-toast {
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: flex-start; /* Canh lá» trÃªn cho icon vÃ  text */
    color: #fff;
    opacity: 0;
    transform: translateX(110%);
    transition: all 0.4s cubic-bezier(0.21, 1.02, 0.73, 1);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    font-size: 15px;
}

.alert-toast.show {
    opacity: 1;
    transform: translateX(0);
}

.alert-toast-icon {
    margin-right: 12px;
    font-size: 20px;
    flex-shrink: 0;
    line-height: 1.4;
}

.alert-toast-content {
    flex-grow: 1;
}

.alert-toast-message {
    font-weight: 500;
    line-height: 1.4;
}

.alert-toast-close {
    margin-left: 16px;
    background: none;
    border: none;
    color: inherit;
    font-size: 22px;
    cursor: pointer;
    opacity: 0.7;
    padding: 0;
    line-height: 1;
}

.alert-toast-close:hover {
    opacity: 1;
}

/* CÃ¡c loáº¡i thÃ´ng bÃ¡o */
.alert-toast.success { background-color: #28a745; }
.alert-toast.error { background-color: #dc3545; }
.alert-toast.warning { background-color: #ffc107; color: #212529; }
.alert-toast.info { background-color: #0d6efd; }

```


==================== File: .\src\utils\dateUtils.js ====================

// src/utils/dateUtils.js

export const convertExcelSerialToDate = (serialNumber) => {
    if (!serialNumber || typeof serialNumber !== 'number') return null;
    try {
        const excelEpoch = new Date(Date.UTC(1899, 11, 30, 0, 0, 0, 0));
        const msPerDay = 24 * 60 * 60 * 1000;
        const msOffset = serialNumber * msPerDay;
        return new Date(excelEpoch.getTime() + msOffset);
    } catch (error) {
        console.error('Error converting Excel serial number:', error);
        return null;
    }
};

export const formatDateTimeForCSV = (serialNumber) => {
    const date = convertExcelSerialToDate(serialNumber);
    if (!date) return 'Invalid Date';
    const y = date.getUTCFullYear(), m = String(date.getUTCMonth()+1).padStart(2,'0');
    const d = String(date.getUTCDate()).padStart(2,'0');
    const h = String(date.getUTCHours()).padStart(2,'0');
    const mi = String(date.getUTCMinutes()).padStart(2,'0');
    const s = String(date.getUTCSeconds()).padStart(2,'0');
    return `${y}-${m}-${d} ${h}:${mi}:${s}`;
};

export const formatTimeForCSV = (serialNumber) => {
    const date = convertExcelSerialToDate(serialNumber);
    if (!date) return 'Invalid Time';
    const h = String(date.getUTCHours()).padStart(2,'0');
    const mi = String(date.getUTCMinutes()).padStart(2,'0');
    const s = String(date.getUTCSeconds()).padStart(2,'0');
    return `${h}:${mi}:${s}`;
};

```


================================================================================
3. THá»NG KÃŠ Tá»”NG QUAN:
----------------------------------------
ğŸ“Š Tá»•ng sá»‘ file Ä‘Ã£ phÃ¢n tÃ­ch: 97
ğŸ“Š Tá»•ng sá»‘ dÃ²ng code (Æ°á»›c tÃ­nh): 24650

================================================================================
BÃ¡o cÃ¡o Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng!
================================================================================
