================================================================================
                   PHÃ‚N TÃCH Cáº¤U TRÃšC Dá»° ÃN VÃ€ Ná»˜I DUNG CODE
================================================================================

1. Cáº¤U TRÃšC THÆ¯ Má»¤C:
----------------------------------------
hr-management-system/
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Getcode.ipynb
â”œâ”€â”€ index.html
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ project_analysis.txt
â”œâ”€â”€ Readme.md
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ server.js
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.js
â”‚   â”‚   â””â”€â”€ lark-config.js
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ attendanceController.js
â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â”œâ”€â”€ dashboardController.js
â”‚   â”‚   â”œâ”€â”€ employeeController.js
â”‚   â”‚   â”œâ”€â”€ positionController.js
â”‚   â”‚   â”œâ”€â”€ recruitmentController.js
â”‚   â”‚   â””â”€â”€ storeController.js
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â””â”€â”€ validation.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ attendance.js
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ dashboard.js
â”‚   â”‚   â”œâ”€â”€ employees.js
â”‚   â”‚   â”œâ”€â”€ masterData.js
â”‚   â”‚   â””â”€â”€ recruitment.js
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ index.js
â”‚       â”œâ”€â”€ lark-service-manager.js
â”‚       â”œâ”€â”€ attendance/
â”‚       â”‚   â”œâ”€â”€ attendance-service.js
â”‚       â”‚   â”œâ”€â”€ attendance-validator.js
â”‚       â”‚   â””â”€â”€ index.js
â”‚       â”œâ”€â”€ auth/
â”‚       â”‚   â”œâ”€â”€ auth-service.js
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â””â”€â”€ session-service.js
â”‚       â”œâ”€â”€ core/
â”‚       â”‚   â”œâ”€â”€ base-service.js
â”‚       â”‚   â”œâ”€â”€ cache-service.js
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â””â”€â”€ lark-client.js
â”‚       â”œâ”€â”€ employees/
â”‚       â”‚   â”œâ”€â”€ employee-service.js
â”‚       â”‚   â”œâ”€â”€ employee-validator.js
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â””â”€â”€ work-history-service.js
â”‚       â”œâ”€â”€ master-data/
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â”œâ”€â”€ master-data-validator.js
â”‚       â”‚   â”œâ”€â”€ position-service.js
â”‚       â”‚   â””â”€â”€ store-service.js
â”‚       â”œâ”€â”€ recruitment/
â”‚       â”‚   â”œâ”€â”€ index.js
â”‚       â”‚   â”œâ”€â”€ recruitment-service.js
â”‚       â”‚   â””â”€â”€ recruitment-validator.js
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ error-handler.js
â”‚           â”œâ”€â”€ index.js
â”‚           â”œâ”€â”€ response-formatter.js
â”‚           â””â”€â”€ service-factory.js
â””â”€â”€ src/
    â”œâ”€â”€ App.jsx
    â”œâ”€â”€ main.jsx
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ attendance/
    â”‚   â”‚   â”œâ”€â”€ AttendanceFilters.jsx
    â”‚   â”‚   â”œâ”€â”€ AttendanceLogs.jsx
    â”‚   â”‚   â””â”€â”€ EmployeeHours.jsx
    â”‚   â”œâ”€â”€ auth/
    â”‚   â”‚   â”œâ”€â”€ LoginForm.jsx
    â”‚   â”‚   â””â”€â”€ ProtectedRoute.jsx
    â”‚   â”œâ”€â”€ common/
    â”‚   â”‚   â”œâ”€â”€ Alert.jsx
    â”‚   â”‚   â”œâ”€â”€ Loading.jsx
    â”‚   â”‚   â”œâ”€â”€ Modal.jsx
    â”‚   â”‚   â””â”€â”€ Table.jsx
    â”‚   â”œâ”€â”€ dashboard/
    â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx
    â”‚   â”‚   â”œâ”€â”€ HRDashboard.jsx
    â”‚   â”‚   â””â”€â”€ StatsCard.jsx
    â”‚   â”œâ”€â”€ employee/
    â”‚   â”‚   â”œâ”€â”€ AddWorkHistoryModal.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeAddForm.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeEditModal.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeForm.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeList.jsx
    â”‚   â”‚   â”œâ”€â”€ EmployeeTable.jsx
    â”‚   â”‚   â”œâ”€â”€ RecruitmentModal.jsx
    â”‚   â”‚   â””â”€â”€ WorkHistoryModal.jsx
    â”‚   â”œâ”€â”€ layout/
    â”‚   â”‚   â”œâ”€â”€ Layout.jsx
    â”‚   â”‚   â””â”€â”€ ResponsiveNavigation.jsx
    â”‚   â””â”€â”€ masterdata/
    â”‚       â”œâ”€â”€ PositionManager.jsx
    â”‚       â””â”€â”€ StoreManager.jsx
    â”œâ”€â”€ contexts/
    â”‚   â”œâ”€â”€ AppContext.jsx
    â”‚   â”œâ”€â”€ AuthContext.jsx
    â”‚   â””â”€â”€ NotificationContext.jsx
    â”œâ”€â”€ hooks/
    â”‚   â”œâ”€â”€ useApi.js
    â”‚   â”œâ”€â”€ useAttendance.js
    â”‚   â”œâ”€â”€ useAuth.js
    â”‚   â”œâ”€â”€ useEmployees.js
    â”‚   â””â”€â”€ useNotification.js
    â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ AttendanceLogsPage.jsx
    â”‚   â”œâ”€â”€ EmployeeManagementPage.jsx
    â”‚   â”œâ”€â”€ HRDashboardPage.jsx
    â”‚   â””â”€â”€ LoginPage.jsx
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ api.js
    â”‚   â”œâ”€â”€ auth.js
    â”‚   â””â”€â”€ employee.js
    â””â”€â”€ styles/
        â”œâ”€â”€ components.css
        â””â”€â”€ globals.css

2. Ná»˜I DUNG CHI TIáº¾T CÃC FILE:
----------------------------------------


==================== File: .\index.html ====================

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HR Management System - React</title>
</head>
<body>
  <div id="root"></div>
  <div id="alert-container"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>
</html>

```


==================== File: .\package.json ====================

{
  "name": "hr-management-system-react",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "server": "node server/server.js"
  },
  "dependencies": {
    "@fortawesome/fontawesome-free": "^6.7.2",
    "axios": "^1.10.0",
    "bootstrap": "^5.3.7",
    "cors": "^2.8.5",
    "dotenv": "^16.6.1",
    "express": "^4.21.2",
    "express-session": "^1.18.2",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.30.1"
  },
  "devDependencies": {
    "@types/react": "^18.0.28",
    "@types/react-dom": "^18.0.11",
    "@vitejs/plugin-react": "^3.1.0",
    "eslint": "^8.38.0",
    "eslint-plugin-react": "^7.32.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.3.4",
    "vite": "^4.5.14"
  }
}

```


==================== File: .\project_analysis.txt ====================


```


==================== File: .\Readme.md ====================

Backend (Node.js/Express)
Kiáº¿n trÃºc khuyáº¿n nghá»‹:
Layered Architecture (Service - Controller - Route - Middleware)
Routes: Äá»‹nh nghÄ©a cÃ¡c endpoint, phÃ¢n chia rÃµ theo module (vd: /employees, /attendance).
Controllers: Xá»­ lÃ½ request/response, gá»i sang service. KhÃ´ng chá»©a logic nghiá»‡p vá»¥ sÃ¢u.
Services: Chá»©a logic nghiá»‡p vá»¥ (business logic) vÃ  thao tÃ¡c dá»¯ liá»‡u (gá»i API, DB, Lark).
Utils & Validators: Kiá»ƒm tra, format, handler lá»—i, validation input.
Models: (Náº¿u xÃ i ORM/database thá»±c), mÃ´ táº£ cáº¥u trÃºc dá»¯ liá»‡u.
(Báº¡n Ä‘Ã£ cÃ³ phÃ¢n chia khÃ¡ chuáº©n, chá»‰ cáº§n dá»n láº¡i cÃ¡c chá»— cÃ²n láº«n lá»™n, loáº¡i bá» code cÅ©).
CÃ¡c Ä‘iá»ƒm cáº§n lÆ°u Ã½:
KhÃ´ng gá»i trá»±c tiáº¿p tá»« route xuá»‘ng service, luÃ´n qua controller.
Chá»‰ Ä‘á»ƒ má»™t nÆ¡i chá»‹u trÃ¡ch nhiá»‡m chÃ­nh vá» validate (thÆ°á»ng lÃ  middleware hoáº·c náº±m trong services/utils).
KhÃ´ng Ä‘á»ƒ controllers vá»«a thao tÃ¡c dá»¯ liá»‡u, vá»«a gá»i nhiá»u táº§ng - 1 controller = 1 use-case nghiá»‡p vá»¥.
Frontend (React + Context + Service Layer)
Kiáº¿n trÃºc khuyáº¿n nghá»‹:
Component-based (Atomic/Domain)
Pages: Trang tÆ°Æ¡ng á»©ng route (/dashboard, /employee-management...)
Components: ThÃ nh pháº§n tÃ¡i sá»­ dá»¥ng (Form, Table, Modal, Cards...)
Hooks: Quáº£n lÃ½ logic dÃ¹ng chung (fetch data, validate, notification...)
Contexts: Chá»©a state global (Auth, Notification).
Services layer: File JS quáº£n lÃ½ toÃ n bá»™ gá»i API, cÃ¡c hÃ m CRUD tráº£ ra Ä‘Ãºng format.
Styles: Äá»ƒ riÃªng, trÃ¡nh style inline nhiá»u.
NgoÃ i ra:
Háº¡n cháº¿ Ä‘á»ƒ logic xá»­ lÃ½ data trá»±c tiáº¿p trong component, hÃ£y Ä‘áº©y tá»‘i Ä‘a sang service/hook.
TÃ¡ch biá»‡t rÃµ cÃ¡c táº§ng: Page â†’ Hook â†’ Service â†’ API (vÃ  Context náº¿u cáº§n).
Kiá»ƒm tra toÃ n bá»™ cÃ¡c API báº¡n gá»i tráº£ Ä‘Ãºng structure JSON (success, data, message...), Ä‘á»«ng xá»­ lÃ½ dá»¯ liá»‡u tháº³ng tá»« response chÆ°a kiá»ƒm soÃ¡t.
```


==================== File: .\vite.config.js ====================

// vite.config.js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
      }
    }
  }
})

```


==================== File: .\server\server.js ====================

// server/server.js
import dotenv from 'dotenv';

// Configure dotenv FIRST
dotenv.config();

// Import cÃ¡c modules AFTER Ä‘Ã£ config dotenv
import express from 'express';
import cors from 'cors';
import session from 'express-session';
import path from 'path';
import { fileURLToPath } from 'url';

// ES6 module equivalent of __dirname
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Import service manager AFTER dotenv config
import larkServiceManager from './services/lark-service-manager.js';

// Import routes
import authRoutes from './routes/auth.js';
import employeeRoutes from './routes/employees.js';
import attendanceRoutes from './routes/attendance.js';
import recruitmentRoutes from './routes/recruitment.js';
import masterDataRoutes from './routes/masterData.js';
import dashboardRoutes from './routes/dashboard.js';

const app = express();
const PORT = process.env.PORT || 8080;

// Middleware
app.use(cors({
    origin: 'http://localhost:3000',
    credentials: true
}));

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Session configuration
app.use(session({
    secret: process.env.SESSION_SECRET || 'your-secret-key',
    resave: false,
    saveUninitialized: false,
    cookie: { secure: false, maxAge: 24 * 60 * 60 * 1000 }
}));

// API Routes
app.use('/api/auth', authRoutes);
app.use('/api/employees', employeeRoutes);
app.use('/api/attendance', attendanceRoutes);
app.use('/api/recruitment', recruitmentRoutes);
app.use('/api/master-data', masterDataRoutes);
app.use('/api/dashboard', dashboardRoutes);

// Health check endpoint
app.get('/api/health', (req, res) => {
    res.json({
        status: 'OK',
        timestamp: new Date().toISOString(),
        services: {
            larkServiceManager: larkServiceManager.initialized
        }
    });
});

// Root endpoint
app.get('/', (req, res) => {
    res.json({
        message: 'HR Management System API',
        version: '1.0.0',
        timestamp: new Date().toISOString()
    });
});

// Start server with proper initialization
app.listen(PORT, async () => {
    console.log(`Server running on http://localhost:${PORT}`);
    
    try {
        await larkServiceManager.init();
        console.log('Server fully initialized and ready');
    } catch (error) {
        console.error('Service initialization failed:', error.message);
        console.log('Server running but services unavailable');
    }
});

```


==================== File: .\server\config\database.js ====================

// Demo users data (in production, use real database)
const users = {
    admin: {
        id: 'admin',
        username: 'admin',
        password: 'admin123',
        role: 'admin',
        fullName: 'System Admin'
    },
    hr: {
        id: 'hr',
        username: 'hr',
        password: 'hr123',
        role: 'hr',
        fullName: 'HR Manager'
    },
    sales: {
        id: 'sales',
        username: 'sales',
        password: 'sales123',
        role: 'sales_manager',
        fullName: 'Sales Manager'
    },
    finance: {
        id: 'finance',
        username: 'finance',
        password: 'finance123',
        role: 'finance_manager',
        fullName: 'Finance Manager'
    },
    director: {
        id: 'director',
        username: 'director',
        password: 'director123',
        role: 'director',
        fullName: 'Director'
    }
};

const roles = {
    admin: 'Admin',
    hr: 'HR',
    sales_manager: 'TrÆ°á»Ÿng phÃ²ng kinh doanh',
    finance_manager: 'TrÆ°á»Ÿng phÃ²ng tÃ i chÃ­nh káº¿ toÃ¡n',
    director: 'Tá»•ng giÃ¡m Ä‘á»‘c'
};

export {
    users,
    roles
};

```


==================== File: .\server\config\lark-config.js ====================

// server/config/lark-config.js
export const validateLarkConfig = () => {
    const requiredVars = [
        'LARK_APP_ID',
        'LARK_APP_SECRET', 
        'LARK_BASE_ID',
        'LARK_EMPLOYEE_TABLE_ID',
        'LARK_ATTENDANCE_TABLE_ID',
        'LARK_RECRUITMENT_TABLE_ID',
        'LARK_STORE_TABLE_ID',
        'LARK_POSITION_TABLE_ID',
        'LARK_WORK_HISTORY_TABLE_ID'
    ];

    const missing = requiredVars.filter(key => !process.env[key]);
    
    if (missing.length > 0) {
        throw new Error(`âŒ Missing Lark configuration: ${missing.join(', ')}`);
    }
    
    console.log('âœ… Lark configuration validated');
};

export const larkConfig = {
    appId: process.env.LARK_APP_ID,
    appSecret: process.env.LARK_APP_SECRET,
    baseId: process.env.LARK_BASE_ID,
    tables: {
        employee: process.env.LARK_EMPLOYEE_TABLE_ID,
        attendance: process.env.LARK_ATTENDANCE_TABLE_ID,
        recruitment: process.env.LARK_RECRUITMENT_TABLE_ID,
        store: process.env.LARK_STORE_TABLE_ID,
        position: process.env.LARK_POSITION_TABLE_ID,
        workHistory: process.env.LARK_WORK_HISTORY_TABLE_ID
    }
};

```


==================== File: .\server\controllers\attendanceController.js ====================

// server/controllers/attendanceController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

export const getAttendanceLogs = async (req, res) => {
    try {
        const filters = req.query;
        const logs = await larkServiceManager.getAttendanceLogs(filters);
        res.json(formatResponse(true, 'Láº¥y báº£n ghi cháº¥m cÃ´ng thÃ nh cÃ´ng', logs));
    } catch (error) {
        console.error('âŒ Controller: getAttendanceLogs failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y báº£n ghi cháº¥m cÃ´ng: ${error.message}`, 
            null, 
            'ATTENDANCE_LOAD_FAILED'
        ));
    }
};

export const addAttendanceLog = async (req, res) => {
    try {
        const attendanceData = req.body;
        const result = await larkServiceManager.addAttendanceLog(attendanceData);
        res.json(formatResponse(true, 'ThÃªm báº£n ghi cháº¥m cÃ´ng thÃ nh cÃ´ng', result));
    } catch (error) {
        console.error('âŒ Controller: addAttendanceLog failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi thÃªm báº£n ghi cháº¥m cÃ´ng: ${error.message}`, 
            null, 
            'ATTENDANCE_ADD_FAILED'
        ));
    }
};

export const getEmployeeHours = async (req, res) => {
    try {
        const employeeHours = await larkServiceManager.getEmployeeHours();
        res.json(formatResponse(true, 'Láº¥y tá»•ng giá» cÃ´ng thÃ nh cÃ´ng', employeeHours));
    } catch (error) {
        console.error('âŒ Controller: getEmployeeHours failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y tá»•ng giá» cÃ´ng: ${error.message}`, 
            null, 
            'EMPLOYEE_HOURS_LOAD_FAILED'
        ));
    }
};
```


==================== File: .\server\controllers\authController.js ====================

// server/controllers/authController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

/**
 * Xá»­ lÃ½ Ä‘Äƒng nháº­p ngÆ°á»i dÃ¹ng.
 * Controller gá»i Ä‘áº¿n AuthService Ä‘á»ƒ xÃ¡c thá»±c.
 * @route POST /api/auth/login
 */
const login = async (req, res) => {
    try {
        const { username, password } = req.body;
        const authService = larkServiceManager.getService('auth');

        // Gá»i service Ä‘á»ƒ xá»­ lÃ½ logic Ä‘Äƒng nháº­p
        const result = await authService.login({ username, password });

        // Náº¿u service tráº£ vá» thÃ nh cÃ´ng, táº¡o session
        if (result.success) {
            req.session.user = {
                id: result.user.id,
                username: result.user.username,
                role: result.user.role,
                fullName: result.user.fullName
            };
            
            // Tráº£ vá» response thÃ nh cÃ´ng vá»›i thÃ´ng tin user
            res.json(formatResponse(true, result.message, { user: req.session.user }));
        } else {
            // TrÆ°á»ng há»£p service xá»­ lÃ½ nhÆ°ng khÃ´ng thÃ nh cÃ´ng (Ã­t xáº£y ra vá»›i logic hiá»‡n táº¡i)
             res.status(401).json(formatResponse(false, result.message, null, 'LOGIN_FAILED'));
        }

    } catch (error) {
        // Báº¯t lá»—i do service throw (vÃ­ dá»¥: sai credentials)
        console.error('âŒ Controller: login failed:', error.message);
        res.status(401).json(formatResponse(false, 'TÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng.', null, 'INVALID_CREDENTIALS'));
    }
};

/**
 * Xá»­ lÃ½ Ä‘Äƒng xuáº¥t ngÆ°á»i dÃ¹ng.
 * @route POST /api/auth/logout
 */
const logout = (req, res) => {
    req.session.destroy((err) => {
        if (err) {
            console.error('âŒ Controller: logout failed:', err);
            return res.status(500).json(formatResponse(false, 'KhÃ´ng thá»ƒ Ä‘Äƒng xuáº¥t', null, 'LOGOUT_ERROR'));
        }
        res.clearCookie('connect.sid'); // XÃ³a cookie session phÃ­a client
        res.json(formatResponse(true, 'ÄÄƒng xuáº¥t thÃ nh cÃ´ng'));
    });
};

/**
 * Láº¥y thÃ´ng tin profile cá»§a user Ä‘ang Ä‘Äƒng nháº­p.
 * @route GET /api/auth/profile
 */
const getProfile = (req, res) => {
    // req.user Ä‘Æ°á»£c gÃ¡n tá»« middleware `authenticateUser`
    if (req.user) {
        res.json(formatResponse(true, 'Láº¥y thÃ´ng tin ngÆ°á»i dÃ¹ng thÃ nh cÃ´ng', { user: req.user }));
    } else {
        res.status(401).json(formatResponse(false, 'NgÆ°á»i dÃ¹ng chÆ°a Ä‘Æ°á»£c xÃ¡c thá»±c', null, 'UNAUTHENTICATED'));
    }
};

export {
    login,
    logout,
    getProfile
};

```


==================== File: .\server\controllers\dashboardController.js ====================

// server/controllers/dashboardController.js (Má»šI)
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

export const getDashboardStats = async (req, res) => {
    try {
        console.log('ğŸ“Š GETTING DASHBOARD STATS...');
        
        const employeeService = larkServiceManager.getService('employee');
        const attendanceService = larkServiceManager.getService('attendance');
        
        // âœ… TÃ¡ch riÃªng, handle error Ä‘á»™c láº­p
        let employeeStats = {
            totalEmployees: 0,
            activeEmployees: 0,
            error: null
        };
        
        let attendanceStats = {
            totalAttendanceLogs: 0,
            todayLogs: 0,
            error: null
        };
        
        // Get employee stats
        try {
            const employees = await employeeService.getAllEmployees();
            employeeStats = {
                totalEmployees: employees.length,
                activeEmployees: employees.filter(emp => emp.status === 'active').length,
                error: null
            };
        } catch (error) {
            console.error('âŒ Employee stats error:', error);
            employeeStats.error = 'KhÃ´ng thá»ƒ táº£i thá»‘ng kÃª nhÃ¢n viÃªn';
        }
        
        // Get attendance stats
        try {
            const logs = await attendanceService.getAttendanceLogs();
            const today = new Date().toISOString().split('T')[0];
            attendanceStats = {
                totalAttendanceLogs: logs.length,
                todayLogs: logs.filter(log => log.date === today).length,
                error: null
            };
        } catch (error) {
            console.error('âŒ Attendance stats error:', error);
            attendanceStats.error = 'KhÃ´ng thá»ƒ táº£i thá»‘ng kÃª cháº¥m cÃ´ng';
        }
        
        const dashboardData = {
            employee: employeeStats,
            attendance: attendanceStats,
            timestamp: new Date().toISOString()
        };
        
        res.json(formatResponse(true, 'Láº¥y thá»‘ng kÃª dashboard thÃ nh cÃ´ng', dashboardData));
        
    } catch (error) {
        console.error('âŒ Dashboard stats error:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i há»‡ thá»‘ng: ${error.message}`, 
            null, 
            'DASHBOARD_STATS_ERROR'
        ));
    }
};

```


==================== File: .\server\controllers\employeeController.js ====================

// server/controllers/employeeController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

class EmployeeController {
    /**
     * Get all employees
     * @route GET /api/employees
     */
    async getAllEmployees(req, res) {
        try {
            console.log('CONTROLLER: YÃªu cáº§u láº¥y danh sÃ¡ch nhÃ¢n viÃªn...');
            const employeeService = larkServiceManager.getService('employee');
            const employees = await employeeService.getAllEmployees();

            res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch nhÃ¢n viÃªn thÃ nh cÃ´ng', employees));
        } catch (error) {
            console.error('âŒ CONTROLLER: Lá»—i khi láº¥y danh sÃ¡ch nhÃ¢n viÃªn:', error);
            res.status(500).json(formatResponse(
                false, 
                `KhÃ´ng thá»ƒ táº£i danh sÃ¡ch nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_LOAD_FAILED'
            ));
        }
    }

    /**
     * Add new employee with work history support
     * @route POST /api/employees
     */
    async addEmployee(req, res) {
        try {
            const { fullName, phoneNumber, gender, hourlyRate, bankAccount, bankName, workHistoryData } = req.body;

            // Check for duplicate request numbers (pháº§n nÃ y váº«n nÃªn giá»¯ láº¡i vÃ¬ nÃ³ lÃ  logic nghiá»‡p vá»¥ Ä‘áº·c thÃ¹)
            const requestNos = workHistoryData.map(item => item.requestNo);
            const uniqueRequestNos = [...new Set(requestNos)];
            if (requestNos.length !== uniqueRequestNos.length) {
                return res.status(400).json(formatResponse(
                    false, 
                    'KhÃ´ng Ä‘Æ°á»£c trÃ¹ng láº·p Request No.', 
                    null, 
                    'DUPLICATE_REQUEST_NO'
                ));
            }

            // Generate employee ID and check for duplicates (Ä‘Ã£ chuyá»ƒn vÃ o service)
            const employeeId = larkServiceManager.getService('employee').generateEmployeeId(fullName, phoneNumber);
            const isDuplicate = await larkServiceManager.checkEmployeeIdExists(employeeId);
            if (isDuplicate) {
                return res.status(409).json(formatResponse(
                    false, 
                    'MÃ£ nhÃ¢n viÃªn Ä‘Ã£ tá»“n táº¡i trong há»‡ thá»‘ng', 
                    null, 
                    'DUPLICATE_EMPLOYEE_ID'
                ));
            }
            
            // Prepare employee data
            const employeeData = {
                employeeId,
                fullName,
                phoneNumber,
                gender,
                hourlyRate: parseFloat(hourlyRate),
                bankAccount,
                bankName,
                recruitmentLink: workHistoryData.map(item => item.requestNo).join(', '),
                status: 'active',
                createdAt: new Date().toISOString()
            };

            // Create employee
            const employee = await larkServiceManager.addEmployee(employeeData);
            
            // Add work history entries with duplicate check
            const workHistoryResults = [];
            for (const historyEntry of workHistoryData) {
                const workHistoryExists = await larkServiceManager.checkWorkHistoryExists(employeeId, historyEntry.requestNo);
                if (workHistoryExists) {
                    return res.status(409).json(formatResponse(
                        false, 
                        `Work History Ä‘Ã£ tá»“n táº¡i: ${employeeId} - ${historyEntry.requestNo}`, 
                        null, 
                        'DUPLICATE_WORK_HISTORY'
                    ));
                }
                
                const workHistory = await larkServiceManager.addWorkHistory({
                    employeeId: employeeId,
                    requestNo: historyEntry.requestNo
                });
                workHistoryResults.push(workHistory);
            }

            res.json(formatResponse(true, 'ThÃªm nhÃ¢n viÃªn thÃ nh cÃ´ng', {
                employee,
                workHistory: workHistoryResults
            }));
            
        } catch (error) {
            console.error('âŒ Controller: addEmployee failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i há»‡ thá»‘ng khi thÃªm nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_ADD_FAILED'
            ));
        }
    }

    /**
     * Update employee
     * @route PUT /api/employees/:id
     */
    async updateEmployee(req, res) {
        try {
            const { id } = req.params;
            const { fullName, phoneNumber, gender, hourlyRate, bankAccount, bankName, recruitmentLink, status } = req.body;
            
            // Generate new employee ID with updated info
            const employeeId = larkServiceManager.getService('employee').generateEmployeeId(fullName, phoneNumber);
            const updatedData = {
                employeeId,
                fullName,
                phoneNumber,
                gender,
                hourlyRate: parseFloat(hourlyRate),
                bankAccount,
                bankName,
                recruitmentLink: recruitmentLink || '',
                status,
                updatedAt: new Date().toISOString()
            };
            
            const employee = await larkServiceManager.updateEmployee(id, updatedData);
            
            res.json(formatResponse(true, 'Cáº­p nháº­t nhÃ¢n viÃªn thÃ nh cÃ´ng', { employee }));
            
        } catch (error) {
            console.error('âŒ Controller: updateEmployee failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi cáº­p nháº­t nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_UPDATE_FAILED'
            ));
        }
    }

    /**
     * Delete employee
     * @route DELETE /api/employees/:id
     */
    async deleteEmployee(req, res) {
        try {
            const { id } = req.params;
            await larkServiceManager.deleteEmployee(id);
            res.json(formatResponse(true, 'XÃ³a nhÃ¢n viÃªn thÃ nh cÃ´ng'));
        } catch (error) {
            console.error('âŒ Controller: deleteEmployee failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi xÃ³a nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_DELETE_FAILED'
            ));
        }
    }

    /**
     * Search employees
     * @route GET /api/employees/search
     */
    async searchEmployees(req, res) {
        try {
            const { q } = req.query;
            const employees = await larkServiceManager.searchEmployees(q);
            res.json(formatResponse(true, 'TÃ¬m kiáº¿m thÃ nh cÃ´ng', employees));
        } catch (error) {
            console.error('âŒ Controller: searchEmployees failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi tÃ¬m kiáº¿m nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_SEARCH_FAILED'
            ));
        }
    }

    /**
     * Get employee work history
     * @route GET /api/employees/:employeeId/work-history
     */
    async getEmployeeWorkHistory(req, res) {
        try {
            const { employeeId } = req.params;
            const workHistory = await larkServiceManager.getWorkHistoryByEmployee(employeeId);
            res.json(formatResponse(true, 'Láº¥y lá»‹ch sá»­ lÃ m viá»‡c thÃ nh cÃ´ng', workHistory));
        } catch (error) {
            console.error('âŒ Controller: getEmployeeWorkHistory failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi láº¥y lá»‹ch sá»­ lÃ m viá»‡c: ${error.message}`, 
                null, 
                'WORK_HISTORY_LOAD_FAILED'
            ));
        }
    }

    /**
     * Add work history for employee
     * @route POST /api/employees/work-history
     */
    async addWorkHistory(req, res) {
        try {
            const { employeeId, requestNo } = req.body;
            
            if (!employeeId || !requestNo) {
                return res.status(400).json(formatResponse(
                    false, 
                    'Thiáº¿u thÃ´ng tin báº¯t buá»™c', 
                    null, 
                    'VALIDATION_ERROR'
                ));
            }
            
            const workHistory = await larkServiceManager.addWorkHistory({
                employeeId,
                requestNo
            });
            
            res.json(formatResponse(true, 'ThÃªm work history thÃ nh cÃ´ng', { workHistory }));
            
        } catch (error) {
            console.error('âŒ Controller: addWorkHistory failed:', error);
            res.status(500).json(formatResponse(
                false, 
                `Lá»—i khi thÃªm work history: ${error.message}`, 
                null, 
                'WORK_HISTORY_ADD_FAILED'
            ));
        }
    }
}

// Export instance methods
const employeeController = new EmployeeController();

export const getAllEmployees = employeeController.getAllEmployees.bind(employeeController);
export const addEmployee = employeeController.addEmployee.bind(employeeController);
export const updateEmployee = employeeController.updateEmployee.bind(employeeController);
export const deleteEmployee = employeeController.deleteEmployee.bind(employeeController);
export const searchEmployees = employeeController.searchEmployees.bind(employeeController);
export const getEmployeeWorkHistory = employeeController.getEmployeeWorkHistory.bind(employeeController);
export const addWorkHistory = employeeController.addWorkHistory.bind(employeeController);

// DÃ’NG Bá»Š Lá»–I ÄÃƒ ÄÆ¯á»¢C XÃ“A Bá»

```


==================== File: .\server\controllers\positionController.js ====================

// server/controllers/positionController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

// ==================== POSITION MANAGEMENT ====================
export const getPositions = async (req, res) => {
    try {
        const positions = await larkServiceManager.getAllPositions();
        res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch vá»‹ trÃ­ thÃ nh cÃ´ng', positions));
    } catch (error) {
        console.error('âŒ Controller: getPositions failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi táº£i danh sÃ¡ch vá»‹ trÃ­: ${error.message}`, null, 'POSITION_LOAD_FAILED'));
    }
};

export const addPosition = async (req, res) => {
    try {
        const { positionName, description } = req.body;
        // (Validation sáº½ Ä‘Æ°á»£c thÃªm vÃ o á»Ÿ bÆ°á»›c sau)
        const position = {
            positionName,
            description: description || '',
            status: 'active',
            createdAt: new Date().toISOString()
        };
        const result = await larkServiceManager.addPosition(position);
        res.json(formatResponse(true, 'ThÃªm vá»‹ trÃ­ thÃ nh cÃ´ng', { position: result }));
    } catch (error) {
        console.error('âŒ Controller: addPosition failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi thÃªm vá»‹ trÃ­: ${error.message}`, null, 'POSITION_ADD_FAILED'));
    }
};

export const updatePosition = async (req, res) => {
    try {
        const { id } = req.params;
        const updatedData = { ...req.body, updatedAt: new Date().toISOString() };
        const result = await larkServiceManager.updatePosition(id, updatedData);
        res.json(formatResponse(true, 'Cáº­p nháº­t vá»‹ trÃ­ thÃ nh cÃ´ng', { position: result }));
    } catch (error) {
        console.error('âŒ Controller: updatePosition failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi cáº­p nháº­t vá»‹ trÃ­: ${error.message}`, null, 'POSITION_UPDATE_FAILED'));
    }
};

export const deletePosition = async (req, res) => {
    try {
        const { id } = req.params;
        await larkServiceManager.deletePosition(id);
        res.json(formatResponse(true, 'XÃ³a vá»‹ trÃ­ thÃ nh cÃ´ng'));
    } catch (error) {
        console.error('âŒ Controller: deletePosition failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi xÃ³a vá»‹ trÃ­: ${error.message}`, null, 'POSITION_DELETE_FAILED'));
    }
};

```


==================== File: .\server\controllers\recruitmentController.js ====================

import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

export const getRecruitmentRequests = async (req, res) => {
    try {
        const filters = req.query;
        const recruitmentService = larkServiceManager.getService('recruitment');
        const requests = await recruitmentService.getRecruitmentRequests(filters);

        res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch Ä‘á» xuáº¥t thÃ nh cÃ´ng', requests));
    } catch (error) {
        console.error('âŒ Controller: getRecruitmentRequests failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y danh sÃ¡ch Ä‘á» xuáº¥t: ${error.message}`, 
            null, 
            'RECRUITMENT_LOAD_FAILED'
        ));
    }
};

```


==================== File: .\server\controllers\storeController.js ====================

// server/controllers/storeController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

// ==================== STORE MANAGEMENT ====================
export const getStores = async (req, res) => {
    try {
        const stores = await larkServiceManager.getAllStores();
        res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch cá»­a hÃ ng thÃ nh cÃ´ng', stores));
    } catch (error) {
        console.error('âŒ Controller: getStores failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi táº£i danh sÃ¡ch cá»­a hÃ ng: ${error.message}`, null, 'STORE_LOAD_FAILED'));
    }
};

export const addStore = async (req, res) => {
    try {
        const { storeName, address } = req.body;
        // (Validation sáº½ Ä‘Æ°á»£c thÃªm vÃ o á»Ÿ bÆ°á»›c sau)
        const store = {
            storeName,
            address,
            status: 'active',
            createdAt: new Date().toISOString()
        };
        const result = await larkServiceManager.addStore(store);
        res.json(formatResponse(true, 'ThÃªm cá»­a hÃ ng thÃ nh cÃ´ng', { store: result }));
    } catch (error) {
        console.error('âŒ Controller: addStore failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi thÃªm cá»­a hÃ ng: ${error.message}`, null, 'STORE_ADD_FAILED'));
    }
};

export const updateStore = async (req, res) => {
    try {
        const { id } = req.params;
        const updatedData = { ...req.body, updatedAt: new Date().toISOString() };
        const result = await larkServiceManager.updateStore(id, updatedData);
        res.json(formatResponse(true, 'Cáº­p nháº­t cá»­a hÃ ng thÃ nh cÃ´ng', { store: result }));
    } catch (error) {
        console.error('âŒ Controller: updateStore failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi cáº­p nháº­t cá»­a hÃ ng: ${error.message}`, null, 'STORE_UPDATE_FAILED'));
    }
};

export const deleteStore = async (req, res) => {
    try {
        const { id } = req.params;
        await larkServiceManager.deleteStore(id);
        res.json(formatResponse(true, 'XÃ³a cá»­a hÃ ng thÃ nh cÃ´ng'));
    } catch (error) {
        console.error('âŒ Controller: deleteStore failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi xÃ³a cá»­a hÃ ng: ${error.message}`, null, 'STORE_DELETE_FAILED'));
    }
};

```


==================== File: .\server\middleware\auth.js ====================

const authenticateUser = (req, res, next) => {
    if (!req.session || !req.session.user) {
        return res.status(401).json({ error: 'Unauthorized' });
    }
    req.user = req.session.user;
    next();
};

const authorizeRoles = (...roles) => {
    return (req, res, next) => {
        if (!req.user || !roles.includes(req.user.role)) {
            return res.status(403).json({ error: 'Forbidden' });
        }
        next();
    };
};

export {
    authenticateUser,
    authorizeRoles
};

```


==================== File: .\server\middleware\validation.js ====================

// server/middleware/validation.js
import { formatResponse } from '../services/utils/response-formatter.js';
import { EmployeeValidator } from '../services/employees/index.js';
import { MasterDataValidator } from '../services/master-data/index.js';

class ValidationMiddleware {
    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u nhÃ¢n viÃªn má»›i
    static validateAddEmployee(req, res, next) {
        // Kiá»ƒm tra dá»¯ liá»‡u nhÃ¢n viÃªn
        const employeeErrors = EmployeeValidator.validateEmployeeData(req.body);
        if (employeeErrors.length > 0) {
            return res.status(400).json(formatResponse(false, employeeErrors.join(', '), null, 'VALIDATION_ERROR'));
        }

        // Kiá»ƒm tra dá»¯ liá»‡u work history
        const workHistoryErrors = EmployeeValidator.validateWorkHistoryData(req.body.workHistoryData || []);
        if (workHistoryErrors.length > 0) {
            return res.status(400).json(formatResponse(false, workHistoryErrors.join(', '), null, 'VALIDATION_ERROR'));
        }
        
        next();
    }

    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u khi cáº­p nháº­t nhÃ¢n viÃªn (cÃ³ thá»ƒ khÃ¡c vá»›i khi thÃªm má»›i)
    static validateUpdateEmployee(req, res, next) {
        const errors = EmployeeValidator.validateEmployeeData(req.body);
        if (errors.length > 0) {
            return res.status(400).json(formatResponse(false, errors.join(', '), null, 'VALIDATION_ERROR'));
        }
        next();
    }
    
    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u cá»­a hÃ ng
    static validateStore(req, res, next) {
        const errors = MasterDataValidator.validateStoreData(req.body);
         if (errors.length > 0) {
            return res.status(400).json(formatResponse(false, errors.join(', '), null, 'VALIDATION_ERROR'));
        }
        next();
    }
    
    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u vá»‹ trÃ­
    static validatePosition(req, res, next) {
        const errors = MasterDataValidator.validatePositionData(req.body);
         if (errors.length > 0) {
            return res.status(400).json(formatResponse(false, errors.join(', '), null, 'VALIDATION_ERROR'));
        }
        next();
    }
}

export default ValidationMiddleware;

```


==================== File: .\server\routes\attendance.js ====================

// server/routes/attendance.js
import express from 'express';
import { 
    getAttendanceLogs, 
    addAttendanceLog, 
    getEmployeeHours
} from '../controllers/attendanceController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.get('/logs', authenticateUser, getAttendanceLogs);
router.post('/logs', authenticateUser, addAttendanceLog);
router.get('/employee-hours', authenticateUser, getEmployeeHours);

export default router;

```


==================== File: .\server\routes\auth.js ====================

import express from 'express';
import { login, logout, getProfile } from '../controllers/authController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.post('/login', login);
router.post('/logout', logout);
router.get('/profile', authenticateUser, getProfile);

export default router;

```


==================== File: .\server\routes\dashboard.js ====================

import express from 'express';
import { getDashboardStats } from '../controllers/dashboardController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.get('/stats', authenticateUser, getDashboardStats);

export default router;

```


==================== File: .\server\routes\employees.js ====================

// server/routes/employees.js
import express from 'express';
import { 
    getAllEmployees, 
    addEmployee, 
    updateEmployee, 
    deleteEmployee, 
    searchEmployees, 
    getEmployeeWorkHistory, 
    addWorkHistory
} from '../controllers/employeeController.js';
import { authenticateUser, authorizeRoles } from '../middleware/auth.js';
import ValidationMiddleware from '../middleware/validation.js';

const router = express.Router();

// ==================== EMPLOYEE ROUTES ====================
// GET routes should come before parameterized routes
router.get('/search', authenticateUser, searchEmployees);
router.get('/', authenticateUser, getAllEmployees);

// Employee CRUD operations
router.post('/', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateAddEmployee, addEmployee);
router.put('/:id', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateUpdateEmployee, updateEmployee);
router.delete('/:id', authenticateUser, authorizeRoles('hr', 'admin'), deleteEmployee);

// ==================== WORK HISTORY ROUTES ====================
// Work history routes - Sá»¬A Äá»‚ TÆ¯Æ NG THÃCH Vá»šI CLIENT
router.get('/:employeeId/work-history', authenticateUser, getEmployeeWorkHistory);
router.post('/work-history', authenticateUser, authorizeRoles('hr', 'admin'), addWorkHistory);

// ==================== ERROR HANDLING ====================
// Handle 404 for unmatched routes
router.use('*', (req, res) => {
    res.status(404).json({
        success: false,
        error: 'Route not found',
        path: req.originalUrl
    });
});

export default router;

```


==================== File: .\server\routes\masterData.js ====================

// server/routes/masterData.js
import express from 'express';
import { authenticateUser, authorizeRoles } from '../middleware/auth.js';
import { getStores, addStore, updateStore, deleteStore } from '../controllers/storeController.js';
import { getPositions, addPosition, updatePosition, deletePosition } from '../controllers/positionController.js';
import ValidationMiddleware from '../middleware/validation.js';

const router = express.Router();

// ==================== STORE ROUTES ====================
router.get('/stores', authenticateUser, getStores);
router.post('/stores', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateStore, addStore);
router.put('/stores/:id', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateStore, updateStore);
router.delete('/stores/:id', authenticateUser, authorizeRoles('hr', 'admin'), deleteStore);

// ==================== POSITION ROUTES ====================
router.get('/positions', authenticateUser, getPositions);
router.post('/positions', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validatePosition, addPosition);
router.put('/positions/:id', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validatePosition, updatePosition);
router.delete('/positions/:id', authenticateUser, authorizeRoles('hr', 'admin'), deletePosition);

export default router;

```


==================== File: .\server\routes\recruitment.js ====================

// server/routes/recruitment.js
import express from 'express';
import { getRecruitmentRequests } from '../controllers/recruitmentController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.get('/', authenticateUser, getRecruitmentRequests);

export default router;

```


==================== File: .\server\services\index.js ====================

// Main services export file
export * from './core/index.js';
export * from './auth/index.js';
export * from './employee/index.js';
export * from './attendance/index.js';
export * from './recruitment/index.js';
export * from './master-data/index.js';
export * from './utils/index.js';

// Export service factory for easy access
export { default as ServiceFactory } from './utils/service-factory.js';

```


==================== File: .\server\services\lark-service-manager.js ====================

// server/services/lark-service-manager.js
import { EmployeeService, WorkHistoryService } from './employees/index.js';
import { AttendanceService } from './attendance/index.js';
import { RecruitmentService } from './recruitment/index.js';
import { StoreService, PositionService } from './master-data/index.js';
import { AuthService, SessionService } from './auth/index.js';
import { validateLarkConfig } from '../config/lark-config.js';

class LarkServiceManager {
    constructor() {
        this.services = {};
        this.initialized = false;
    }

    async init() {
        if (this.initialized) return;

        try {
            console.log('ğŸš€ Initializing Lark Service Manager...');
            
            // Validate configuration first
            validateLarkConfig();
            
            // Initialize all services
            this.services.employee = new EmployeeService();
            this.services.workHistory = new WorkHistoryService();
            this.services.attendance = new AttendanceService();
            this.services.recruitment = new RecruitmentService();
            this.services.store = new StoreService();
            this.services.position = new PositionService();
            this.services.auth = new AuthService();
            this.services.session = new SessionService();

            // Initialize each service
            await Promise.all([
                this.services.employee.init(),
                this.services.workHistory.init(),
                this.services.attendance.init(),
                this.services.recruitment.init(),
                this.services.store.init(),
                this.services.position.init(),
                this.services.auth.init(),
                this.services.session.init()
            ]);

            this.initialized = true;
            console.log('âœ… All Lark services initialized successfully');
            
        } catch (error) {
            console.error('âŒ Lark Service Manager initialization failed:', error);
            throw new Error(`Service Manager initialization failed: ${error.message}`);
        }
    }

    async ensureInitialized() {
        if (!this.initialized) {
            await this.init();
        }
    }

    // Get specific service for advanced operations
    getService(serviceName) {
        if (!this.services[serviceName]) {
            throw new Error(`Service '${serviceName}' not found. Available services: ${Object.keys(this.services).join(', ')}`);
        }
        return this.services[serviceName];
    }

    // ==================== EMPLOYEE METHODS ====================
    async getAllEmployees() {
        await this.ensureInitialized();
        return await this.services.employee.getAllEmployees();
    }

    async addEmployee(employeeData) {
        await this.ensureInitialized();
        return await this.services.employee.addEmployee(employeeData);
    }

    async updateEmployee(id, employeeData) {
        await this.ensureInitialized();
        return await this.services.employee.updateEmployee(id, employeeData);
    }

    async deleteEmployee(id) {
        await this.ensureInitialized();
        return await this.services.employee.deleteEmployee(id);
    }

    async checkEmployeeIdExists(employeeId) {
        await this.ensureInitialized();
        return await this.services.employee.checkEmployeeIdExists(employeeId);
    }

    async searchEmployees(query) {
        await this.ensureInitialized();
        return await this.services.employee.searchEmployees(query);
    }

    // ==================== WORK HISTORY METHODS ====================
    async getWorkHistoryByEmployee(employeeId) {
        await this.ensureInitialized();
        return await this.services.workHistory.getWorkHistoryByEmployee(employeeId);
    }

    async addWorkHistory(workHistoryData) {
        await this.ensureInitialized();
        return await this.services.workHistory.addWorkHistory(workHistoryData);
    }

    async checkWorkHistoryExists(employeeId, requestNo) {
        await this.ensureInitialized();
        return await this.services.workHistory.checkWorkHistoryExists(employeeId, requestNo);
    }
    
    // ==================== ATTENDANCE METHODS ====================
    async getAttendanceLogs(filters = {}) {
        await this.ensureInitialized();
        return await this.services.attendance.getAttendanceLogs(filters);
    }

    async addAttendanceLog(attendanceData) {
        await this.ensureInitialized();
        return await this.services.attendance.addAttendanceLog(attendanceData);
    }

    async getEmployeeHours() {
        await this.ensureInitialized();
        return await this.services.attendance.getEmployeeHours();
    }

    // ==================== STORE METHODS ====================
    async getAllStores() {
        await this.ensureInitialized();
        return await this.services.store.getAllStores();
    }

    async addStore(storeData) {
        await this.ensureInitialized();
        return await this.services.store.addStore(storeData);
    }

    async updateStore(id, storeData) {
        await this.ensureInitialized();
        return await this.services.store.updateStore(id, storeData);
    }

    async deleteStore(id) {
        await this.ensureInitialized();
        return await this.services.store.deleteStore(id);
    }

    // ==================== POSITION METHODS ====================
    async getAllPositions() {
        await this.ensureInitialized();
        return await this.services.position.getAllPositions();
    }

    async addPosition(positionData) {
        await this.ensureInitialized();
        return await this.services.position.addPosition(positionData);
    }

    async updatePosition(id, positionData) {
        await this.ensureInitialized();
        return await this.services.position.updatePosition(id, positionData);
    }

    async deletePosition(id) {
        await this.ensureInitialized();
        return await this.services.position.deletePosition(id);
    }
}

export default new LarkServiceManager();

```


==================== File: .\server\services\attendance\attendance-service.js ====================

// Attendance service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class AttendanceService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_ATTENDANCE_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Attendance Service...');
    }

    async getAttendanceLogs(filters = {}) {
        const cacheKey = `attendance_logs_${JSON.stringify(filters)}`;
        let logs = CacheService.get(cacheKey);
        
        if (!logs) {
            try {
                let filterString = '';
                if (filters.employeeId) {
                    filterString = `AND(CurrentValue.[Employee ID] = "${filters.employeeId}")`;
                }
                
                const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                    filter: filterString
                });

                logs = this.transformAttendanceData(response.data?.items || []);
                
                // Apply date filters if provided
                if (filters.dateFrom || filters.dateTo) {
                    logs = this.filterByDateRange(logs, filters.dateFrom, filters.dateTo);
                }
                
                CacheService.set(cacheKey, logs, 300000); // 5 minutes
            } catch (error) {
                console.error('Error fetching attendance logs:', error);
                logs = this.getMockAttendanceLogs();
            }
        }
        
        return logs;
    }

    async addAttendanceLog(attendanceData) {
        try {
            const transformedData = this.transformAttendanceForLark(attendanceData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.clear();
            
            return this.transformAttendanceData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'addAttendanceLog');
            throw error;
        }
    }

    async getEmployeeHours() {
        const logs = await this.getAttendanceLogs();
        const employeeHours = {};
        
        logs.forEach(log => {
            if (!employeeHours[log.employeeId]) {
                employeeHours[log.employeeId] = {
                    totalHours: 0,
                    totalDays: 0
                };
            }
            
            employeeHours[log.employeeId].totalHours += log.totalHours || 0;
            employeeHours[log.employeeId].totalDays += 1;
        });
        
        return employeeHours;
    }

    filterByDateRange(logs, dateFrom, dateTo) {
        return logs.filter(log => {
            const logDate = new Date(log.date);
            const fromDate = dateFrom ? new Date(dateFrom) : null;
            const toDate = dateTo ? new Date(dateTo) : null;
            
            if (fromDate && logDate < fromDate) return false;
            if (toDate && logDate > toDate) return false;
            
            return true;
        });
    }

    calculateTotalHours(timeIn, timeOut) {
        if (!timeIn || !timeOut) return 0;
        
        const inTime = new Date(`1970-01-01T${timeIn}`);
        const outTime = new Date(`1970-01-01T${timeOut}`);
        
        const diffMs = outTime - inTime;
        return Math.max(0, diffMs / (1000 * 60 * 60)); // Convert to hours
    }

    transformAttendanceData(larkData) {
        return larkData.map(record => {
            const timeIn = record.fields['Time In'] || '';
            const timeOut = record.fields['Time Out'] || '';
            const totalHours = this.calculateTotalHours(timeIn, timeOut);
            
            return {
                id: record.record_id,
                employeeId: record.fields['Employee ID'] || '',
                date: record.fields['Date'] || '',
                timeIn: timeIn,
                timeOut: timeOut,
                totalHours: totalHours,
                notes: record.fields['Notes'] || '',
                createdAt: record.fields['Created At'] || new Date().toISOString()
            };
        });
    }

    transformAttendanceForLark(attendanceData) {
        return {
            'Employee ID': attendanceData.employeeId,
            'Date': attendanceData.date,
            'Time In': attendanceData.timeIn,
            'Time Out': attendanceData.timeOut,
            'Notes': attendanceData.notes || '',
            'Created At': new Date().toISOString()
        };
    }

    getMockAttendanceLogs() {
        return [
            {
                id: 'att_001',
                employeeId: 'Nguyá»…n VÄƒn A - 0123456789',
                date: '2025-01-15',
                timeIn: '08:00',
                timeOut: '17:00',
                totalHours: 8,
                notes: 'LÃ m viá»‡c bÃ¬nh thÆ°á»ng',
                createdAt: new Date().toISOString()
            }
        ];
    }
}

export default AttendanceService;

```


==================== File: .\server\services\attendance\attendance-validator.js ====================

// Attendance validation service
class AttendanceValidator {
    static validateAttendanceData(attendanceData) {
        const errors = [];

        // Required fields validation
        if (!attendanceData.employeeId) {
            errors.push('Employee ID lÃ  báº¯t buá»™c');
        }

        if (!attendanceData.date) {
            errors.push('NgÃ y lÃ  báº¯t buá»™c');
        } else if (!this.isValidDate(attendanceData.date)) {
            errors.push('NgÃ y khÃ´ng há»£p lá»‡');
        }

        if (!attendanceData.timeIn) {
            errors.push('Thá»i gian vÃ o lÃ  báº¯t buá»™c');
        } else if (!this.isValidTime(attendanceData.timeIn)) {
            errors.push('Thá»i gian vÃ o khÃ´ng há»£p lá»‡');
        }

        if (!attendanceData.timeOut) {
            errors.push('Thá»i gian ra lÃ  báº¯t buá»™c');
        } else if (!this.isValidTime(attendanceData.timeOut)) {
            errors.push('Thá»i gian ra khÃ´ng há»£p lá»‡');
        }

        // Check if time out is after time in
        if (attendanceData.timeIn && attendanceData.timeOut) {
            if (!this.isTimeOutAfterTimeIn(attendanceData.timeIn, attendanceData.timeOut)) {
                errors.push('Thá»i gian ra pháº£i sau thá»i gian vÃ o');
            }
        }

        return errors;
    }

    static isValidDate(dateString) {
        const date = new Date(dateString);
        return date instanceof Date && !isNaN(date);
    }

    static isValidTime(timeString) {
        const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
        return timeRegex.test(timeString);
    }

    static isTimeOutAfterTimeIn(timeIn, timeOut) {
        const inTime = new Date(`1970-01-01T${timeIn}`);
        const outTime = new Date(`1970-01-01T${timeOut}`);
        return outTime > inTime;
    }
}

export default AttendanceValidator;

```


==================== File: .\server\services\attendance\index.js ====================

// Attendance services exports
export { default as AttendanceService } from './attendance-service.js';
export { default as AttendanceValidator } from './attendance-validator.js';

```


==================== File: .\server\services\auth\auth-service.js ====================

// Authentication service
import BaseService from '../core/base-service.js';
import { users } from '../../config/database.js';

class AuthService extends BaseService {
    constructor() {
        super();
        this.activeSessions = new Map();
    }

    async validateCredentials(username, password) {
        const user = users[username];
        if (!user || user.password !== password) {
            throw new Error('Invalid credentials');
        }
        return user;
    }

    createSession(user) {
        const sessionData = {
            id: user.id,
            username: user.username,
            role: user.role,
            fullName: user.fullName,
            loginTime: new Date().toISOString()
        };
        
        this.activeSessions.set(user.id, sessionData);
        return sessionData;
    }

    validateSession(sessionId) {
        return this.activeSessions.get(sessionId);
    }

    destroySession(sessionId) {
        return this.activeSessions.delete(sessionId);
    }

    async login(credentials) {
        const { username, password } = credentials;
        
        const user = await this.validateCredentials(username, password);
        const sessionData = this.createSession(user);
        
        return {
            success: true,
            user: sessionData,
            message: 'Login successful'
        };
    }

    async logout(sessionId) {
        const destroyed = this.destroySession(sessionId);
        return {
            success: destroyed,
            message: destroyed ? 'Logout successful' : 'Session not found'
        };
    }

    getActiveUsers() {
        return Array.from(this.activeSessions.values());
    }
}

export default AuthService;

```


==================== File: .\server\services\auth\index.js ====================

// Auth services exports
export { default as AuthService } from './auth-service.js';
export { default as SessionService } from './session-service.js';

```


==================== File: .\server\services\auth\session-service.js ====================

// Session management service
import BaseService from '../core/base-service.js';

class SessionService extends BaseService {
    constructor() {
        super();
        this.sessions = new Map();
        this.sessionTimeout = 24 * 60 * 60 * 1000; // 24 hours
    }

    createSession(user, req) {
        const sessionId = this.generateId('sess_');
        const sessionData = {
            id: sessionId,
            userId: user.id,
            user: user,
            createdAt: new Date().toISOString(),
            lastAccessed: new Date().toISOString(),
            ipAddress: req.ip || req.connection.remoteAddress,
            userAgent: req.get('User-Agent')
        };

        this.sessions.set(sessionId, sessionData);
        return sessionData;
    }

    getSession(sessionId) {
        const session = this.sessions.get(sessionId);
        if (!session) return null;

        // Check if session is expired
        const now = Date.now();
        const lastAccessed = new Date(session.lastAccessed).getTime();
        if (now - lastAccessed > this.sessionTimeout) {
            this.destroySession(sessionId);
            return null;
        }

        // Update last accessed
        session.lastAccessed = new Date().toISOString();
        this.sessions.set(sessionId, session);
        
        return session;
    }

    destroySession(sessionId) {
        return this.sessions.delete(sessionId);
    }

    cleanupExpiredSessions() {
        const now = Date.now();
        for (const [sessionId, session] of this.sessions.entries()) {
            const lastAccessed = new Date(session.lastAccessed).getTime();
            if (now - lastAccessed > this.sessionTimeout) {
                this.destroySession(sessionId);
            }
        }
    }

    getActiveSessions() {
        return Array.from(this.sessions.values());
    }

    getUserSessions(userId) {
        return Array.from(this.sessions.values()).filter(session => session.userId === userId);
    }
}

export default SessionService;

```


==================== File: .\server\services\core\base-service.js ====================

// Abstract base class for all services
import { formatResponse } from '../utils/response-formatter.js';

export default class BaseService {
    constructor() {
        this.initialized = false;
        this.cache = new Map();
    }

    async init() {
        if (!this.initialized) {
            await this.initializeService();
            this.initialized = true;
        }
    }

    async initializeService() {
        // Override in subclasses
    }

    formatResponse(success, message, data = null, errorCode = null) {
        return formatResponse(success, message, data, errorCode);
    }

    validateRequired(data, fields) {
        const errors = [];
        fields.forEach(field => {
            if (!data[field]) {
                errors.push(`${field} lÃ  báº¯t buá»™c`);
            }
        });
        return errors;
    }

    generateId(prefix = '') {
        return `${prefix}${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    async handleError(error, operation) {
        console.error(`Error in ${operation}:`, error);
        throw error;
    }
}

```


==================== File: .\server\services\core\cache-service.js ====================

// server/services/core/cache-service.js
class CacheService {
    constructor() {
        this.cache = new Map();
        this.ttl = new Map();
    }

    set(key, value, ttlMs = 300000) { // 5 minutes default
        this.cache.set(key, value);
        this.ttl.set(key, Date.now() + ttlMs);
    }

    get(key) {
        const expiry = this.ttl.get(key);
        if (expiry && Date.now() > expiry) {
            this.delete(key);
            return null;
        }
        return this.cache.get(key);
    }

    delete(key) {
        this.cache.delete(key);
        this.ttl.delete(key);
    }

    clear() {
        this.cache.clear();
        this.ttl.clear();
    }

    has(key) {
        const expiry = this.ttl.get(key);
        if (expiry && Date.now() > expiry) {
            this.delete(key);
            return false;
        }
        return this.cache.has(key);
    }

    size() {
        return this.cache.size;
    }

    cleanup() {
        const now = Date.now();
        for (const [key, expiry] of this.ttl.entries()) {
            if (now > expiry) {
                this.delete(key);
            }
        }
    }
}

export default new CacheService();

```


==================== File: .\server\services\core\index.js ====================

// Core services exports
export { default as BaseService } from './base-service.js';
export { default as LarkClient } from './lark-client.js';
export { default as CacheService } from './cache-service.js';

```


==================== File: .\server\services\core\lark-client.js ====================

// server/services/core/lark-client.js
import axios from 'axios';

class LarkClient {
    constructor() {
        // KhÃ´ng load env vars táº¡i constructor
        this.baseURL = 'https://open.larksuite.com/open-apis';
        this.tenantAccessToken = null;
        this.tokenExpiry = null;
    }

    // Getter methods Ä‘á»ƒ load env vars khi cáº§n
    get appId() {
        return process.env.LARK_APP_ID;
    }

    get appSecret() {
        return process.env.LARK_APP_SECRET;
    }

    async getTenantAccessToken() {
        console.log('ğŸ”‘ Getting tenant access token...');
        
        // Debug environment variables khi thá»±c sá»± sá»­ dá»¥ng
        console.log('ğŸ” DEBUG Lark Credentials:');
        console.log('App ID:', this.appId ? `${this.appId.substring(0, 8)}...` : 'Missing');
        console.log('App Secret:', this.appSecret ? `${this.appSecret.substring(0, 8)}...` : 'Missing');
        
        if (!this.appId || !this.appSecret) {
            throw new Error('Lark credentials not configured properly');
        }
        
        if (this.tenantAccessToken && this.tokenExpiry > Date.now()) {
            console.log('âœ… Using cached access token');
            return this.tenantAccessToken;
        }

        try {
            console.log('ğŸ“¡ Requesting new access token from Lark...');
            const payload = {
                app_id: this.appId,
                app_secret: this.appSecret
            };
            
            console.log('ğŸš€ Sending request to:', `${this.baseURL}/auth/v3/tenant_access_token/internal`);
            console.log('ğŸ“¦ Payload keys:', Object.keys(payload));
            
            const response = await axios.post(`${this.baseURL}/auth/v3/tenant_access_token/internal`, payload);
            
            console.log('ğŸ“¨ Lark auth response:', {
                status: response.status,
                code: response.data.code,
                msg: response.data.msg
            });

            if (response.data.code === 0) {
                this.tenantAccessToken = response.data.tenant_access_token;
                this.tokenExpiry = Date.now() + (response.data.expire - 300) * 1000;
                console.log('âœ… Access token obtained successfully');
                console.log('Token expires in:', Math.floor((this.tokenExpiry - Date.now()) / 1000), 'seconds');
                return this.tenantAccessToken;
            } else {
                console.error('âŒ Lark auth error:', response.data);
                throw new Error(`Lark Auth Error: ${response.data.msg}`);
            }
        } catch (error) {
            console.error('âŒ Error getting tenant access token:', {
                message: error.message,
                response: error.response?.data,
                status: error.response?.status
            });
            throw error;
        }
    }

    async request(endpoint, options = {}) {
        console.log(`ğŸ“ Making Lark API request: ${options.method || 'GET'} ${endpoint}`);
        
        const token = await this.getTenantAccessToken();
        
        const config = {
            ...options,
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
                ...options.headers
            }
        };

        try {
            console.log('ğŸ”„ Sending request to:', `${this.baseURL}${endpoint}`);
            const response = await axios(`${this.baseURL}${endpoint}`, config);
            
            console.log('âœ… Lark API response:', {
                status: response.status,
                dataLength: response.data ? JSON.stringify(response.data).length : 0
            });
            
            return response.data;
        } catch (error) {
            console.error('âŒ Lark API Error:', {
                endpoint,
                status: error.response?.status,
                data: error.response?.data,
                message: error.message
            });
            throw error;
        }
    }

    async get(endpoint, params = {}) {
        console.log('ğŸ“¥ GET request:', endpoint, params);
        return this.request(endpoint, { method: 'GET', params });
    }

    async post(endpoint, data = {}) {
        console.log('ğŸ“¤ POST request:', endpoint, { dataKeys: Object.keys(data) });
        return this.request(endpoint, { method: 'POST', data });
    }

    async put(endpoint, data = {}) {
        console.log('ğŸ“ PUT request:', endpoint, { dataKeys: Object.keys(data) });
        return this.request(endpoint, { method: 'PUT', data });
    }

    async delete(endpoint) {
        console.log('ğŸ—‘ï¸ DELETE request:', endpoint);
        return this.request(endpoint, { method: 'DELETE' });
    }
}

export default new LarkClient();

```


==================== File: .\server\services\employees\employee-service.js ====================

// Employee management service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class EmployeeService extends BaseService {
    constructor() {
        super();
        this.tableName = 'employees';
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_EMPLOYEE_TABLE_ID;
    }

    async initializeService() {
        // Initialize Lark Base connection
        console.log('Initializing Employee Service...');
    }

    async getAllEmployees() {
        const cacheKey = 'employees_all';
        let employees = CacheService.get(cacheKey);

        if (employees) {
            console.log('âœ… SERVICE: Sá»­ dá»¥ng dá»¯ liá»‡u nhÃ¢n viÃªn tá»« cache.');
            return employees;
        }

        try {
            console.log('ğŸ“¡ SERVICE: Äang láº¥y dá»¯ liá»‡u nhÃ¢n viÃªn tá»« Lark API...');
            const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
            
            employees = this.transformEmployeeData(response.data?.items || []);
            console.log(`âœ… SERVICE: Láº¥y vÃ  chuyá»ƒn Ä‘á»•i thÃ nh cÃ´ng ${employees.length} nhÃ¢n viÃªn.`);
            
            CacheService.set(cacheKey, employees, 300000); // Cache trong 5 phÃºt
            
            return employees;
        } catch (error) {
            console.error('âŒ SERVICE: Lá»—i khi láº¥y dá»¯ liá»‡u nhÃ¢n viÃªn tá»« Lark:', error.message);
            console.log('ğŸ”„ SERVICE: Sá»­ dá»¥ng dá»¯ liá»‡u máº«u (mock data) lÃ m phÆ°Æ¡ng Ã¡n dá»± phÃ²ng.');
            return this.getMockEmployees(); // Tráº£ vá» mock data náº¿u cÃ³ lá»—i
        }
    }

    generateEmployeeId(fullName, phoneNumber) {
        return `${fullName} - ${phoneNumber}`;
    }


    async addEmployee(employeeData) {
        try {
            const transformedData = this.transformEmployeeForLark(employeeData);
            
            console.log('ğŸ“¤ EMPLOYEE SERVICE: Sending data to Lark:', transformedData);
            console.log('ğŸ” EMPLOYEE SERVICE: Base ID:', this.baseId);
            console.log('ğŸ” EMPLOYEE SERVICE: Table ID:', this.tableId);
            console.log('ğŸ” EMPLOYEE SERVICE: URL will be:', `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            console.log('ğŸ“¥ EMPLOYEE SERVICE: Raw Lark response:', response);
            console.log('ğŸ“¥ EMPLOYEE SERVICE: Response status:', response?.status);
            console.log('ğŸ“¥ EMPLOYEE SERVICE: Response data:', response?.data);

            // Clear cache
            CacheService.delete('employees_all');
            
            return {
                success: true,
                employeeId: employeeData.employeeId,
                larkResponse: response  // âœ… THÃŠM: Debug response
            };
            
        } catch (error) {
            console.error('âŒ EMPLOYEE SERVICE: Full error:', error);
            console.error('âŒ EMPLOYEE SERVICE: Error message:', error.message);
            console.error('âŒ EMPLOYEE SERVICE: Error stack:', error.stack);
            await this.handleError(error, 'addEmployee');
            throw error;
        }
    }



    async updateEmployee(id, employeeData) {
        try {
            const transformedData = this.transformEmployeeForLark(employeeData);
            
            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('employees_all');
            
            return this.transformEmployeeData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'updateEmployee');
            throw error;
        }
    }

    async deleteEmployee(id) {
        try {
            await LarkClient.delete(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`);
            
            // Clear cache
            CacheService.delete('employees_all');
            
            return true;
        } catch (error) {
            await this.handleError(error, 'deleteEmployee');
            throw error;
        }
    }

    async checkEmployeeIdExists(employeeId) {
        const employees = await this.getAllEmployees();
        return employees.some(emp => emp.employeeId === employeeId);
    }

    async searchEmployees(query) {
        const employees = await this.getAllEmployees();
        
        if (!query) return employees;
        
        const searchTerm = query.toLowerCase();
        return employees.filter(emp => 
            emp.fullName.toLowerCase().includes(searchTerm) ||
            emp.employeeId.toLowerCase().includes(searchTerm) ||
            emp.phoneNumber.includes(searchTerm)
        );
    }

    //generateEmployeeId(fullName, phoneNumber) {
    //    return `${fullName} - ${phoneNumber}`;
    //}

    transformEmployeeData(larkData) {
        
        if (!Array.isArray(larkData)) {
            console.warn('âš ï¸ SERVICE: larkData is not an array:', typeof larkData);
            return [];
        }
        
        const transformed = larkData.map((record, index) => {

            const result = {
                id: record.record_id,
                // âœ… Sá»¬A: Sá»­ dá»¥ng tÃªn cá»™t tiáº¿ng Viá»‡t tá»« Larkbase
                employeeId: record.fields['MÃ£ nhÃ¢n viÃªn'] || '',
                fullName: record.fields['Há» tÃªn'] || '',
                phoneNumber: record.fields['Sá»‘ Ä‘iá»‡n thoáº¡i'] || '',
                gender: record.fields['Giá»›i tÃ­nh'] || '',
                position: record.fields['Vá»‹ trÃ­'] || '',
                hourlyRate: record.fields['Má»©c lÆ°Æ¡ng/giá»'] || 0,
                bankAccount: record.fields['Sá»‘ tÃ i khoáº£n'] || '',
                bankName: record.fields['NgÃ¢n hÃ ng'] || '',
                recruitmentLink: record.fields['Link Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng'] || '',
                status: record.fields['Tráº¡ng thÃ¡i'] || 'active',
                createdAt: record.fields['Created At'] || new Date().toISOString(),
                updatedAt: record.fields['Updated At'] || new Date().toISOString()
            };
            
            return result;
        });
        
        return transformed;
    }

    transformEmployeeForLark(employeeData) {
        return {
            'MÃ£ nhÃ¢n viÃªn': employeeData.employeeId,
            'Há» tÃªn': employeeData.fullName,
            'Sá»‘ Ä‘iá»‡n thoáº¡i': employeeData.phoneNumber,
            'Giá»›i tÃ­nh': employeeData.gender,
            'Vá»‹ trÃ­': employeeData.position || '',
            'Má»©c lÆ°Æ¡ng/giá»': employeeData.hourlyRate,
            'Sá»‘ tÃ i khoáº£n': employeeData.bankAccount,
            'NgÃ¢n hÃ ng': employeeData.bankName,
            'Link Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng': employeeData.recruitmentLink || '',
            'Tráº¡ng thÃ¡i': employeeData.status || 'active'
        };
    }

    getMockEmployees() {
        return [
            {
                id: 'emp_001',
                employeeId: 'Nguyá»…n VÄƒn A - 0123456789',
                fullName: 'Nguyá»…n VÄƒn A',
                phoneNumber: '0123456789',
                gender: 'Nam',
                position: 'NhÃ¢n viÃªn bÃ¡n hÃ ng',
                hourlyRate: 50000,
                bankAccount: '123456789',
                bankName: 'Vietcombank',
                recruitmentLink: '20250620014',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'emp_002',
                employeeId: 'Tráº§n Thá»‹ B - 0987654321',
                fullName: 'Tráº§n Thá»‹ B',
                phoneNumber: '0987654321',
                gender: 'Ná»¯',
                position: 'Thu ngÃ¢n',
                hourlyRate: 45000,
                bankAccount: '987654321',
                bankName: 'Techcombank',
                recruitmentLink: '20250620017',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            }
        ];
    }
}

export default EmployeeService;

```


==================== File: .\server\services\employees\employee-validator.js ====================

// Employee validation service
class EmployeeValidator {
    static validateEmployeeData(employeeData) {
        const errors = [];

        // Required fields validation
        if (!employeeData.fullName || employeeData.fullName.trim().length < 2) {
            errors.push('Há» tÃªn pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±');
        }

        if (!employeeData.phoneNumber || !this.isValidPhoneNumber(employeeData.phoneNumber)) {
            errors.push('Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng há»£p lá»‡');
        }

        if (!employeeData.gender || !['Nam', 'Ná»¯'].includes(employeeData.gender)) {
            errors.push('Giá»›i tÃ­nh pháº£i lÃ  Nam hoáº·c Ná»¯');
        }

        if (!employeeData.hourlyRate || employeeData.hourlyRate <= 0) {
            errors.push('LÆ°Æ¡ng theo giá» pháº£i lá»›n hÆ¡n 0');
        }

        if (!employeeData.bankAccount || employeeData.bankAccount.trim().length < 6) {
            errors.push('Sá»‘ tÃ i khoáº£n pháº£i cÃ³ Ã­t nháº¥t 6 kÃ½ tá»±');
        }

        if (!employeeData.bankName || employeeData.bankName.trim().length < 2) {
            errors.push('TÃªn ngÃ¢n hÃ ng lÃ  báº¯t buá»™c');
        }

        return errors;
    }

    static isValidPhoneNumber(phoneNumber) {
        const phoneRegex = /^[0-9]{10,11}$/;
        return phoneRegex.test(phoneNumber);
    }

    static validateWorkHistoryData(workHistoryData) {
        const errors = [];

        if (!Array.isArray(workHistoryData) || workHistoryData.length === 0) {
            errors.push('Pháº£i cÃ³ Ã­t nháº¥t má»™t work history entry');
        }

        const requestNos = workHistoryData.map(item => item.requestNo);
        const uniqueRequestNos = [...new Set(requestNos)];
        
        if (requestNos.length !== uniqueRequestNos.length) {
            errors.push('KhÃ´ng Ä‘Æ°á»£c trÃ¹ng láº·p Request No');
        }

        workHistoryData.forEach((item, index) => {
            if (!item.requestNo || item.requestNo.trim().length === 0) {
                errors.push(`Work history entry ${index + 1}: Request No lÃ  báº¯t buá»™c`);
            }
        });

        return errors;
    }
}

export default EmployeeValidator;

```


==================== File: .\server\services\employees\index.js ====================

// Employee services exports
export { default as EmployeeService } from './employee-service.js';
export { default as WorkHistoryService } from './work-history-service.js';
export { default as EmployeeValidator } from './employee-validator.js';

```


==================== File: .\server\services\employees\work-history-service.js ====================

// Work history service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';


class WorkHistoryService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_WORK_HISTORY_TABLE_ID;
    }


    async initializeService() {
        console.log('Initializing Work History Service...');
    }


    async getWorkHistoryByEmployee(employeeId) {
        try {
            const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                filter: `AND(CurrentValue.[Employee ID] = "${employeeId}")`
            });


            return this.transformWorkHistoryData(response.data?.items || []);
        } catch (error) {
            console.error('Error fetching work history:', error);
            return [];
        }
    }


    // âœ… THÃŠM METHOD Má»šI
    async checkWorkHistoryExists(employeeId, requestNo) {
        try {
            console.log(`ğŸ” WORK HISTORY: Checking duplicate (${employeeId}, ${requestNo})`);
            
            const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
            
            const records = response.data?.items || [];
            console.log(`ğŸ“‹ WORK HISTORY: Found ${records.length} total records`);
            
            // Check xem cÃ³ record nÃ o match (employeeId, requestNo) khÃ´ng
            const exists = records.some(record => {
                const fields = record.fields || {};
                const recordEmployeeId = fields['Employee ID'];
                const recordRequestNo = fields['Request No'];
                
                const isMatch = recordEmployeeId === employeeId && recordRequestNo === requestNo;
                
                if (isMatch) {
                    console.log(`âŒ WORK HISTORY: Found duplicate - ${recordEmployeeId} / ${recordRequestNo}`);
                }
                
                return isMatch;
            });
            
            console.log(`âœ… WORK HISTORY: Duplicate check result: ${exists ? 'EXISTS' : 'NOT_EXISTS'}`);
            return exists;
            
        } catch (error) {
            console.error('âŒ Error checking work history exists:', error);
            return false; // Safe fallback - cho phÃ©p thÃªm náº¿u khÃ´ng check Ä‘Æ°á»£c
        }
    }

    async addWorkHistory(workHistoryData) {
        try {
            const transformedData = this.transformWorkHistoryForLark(workHistoryData);
            
            console.log('ğŸ“¤ WORK HISTORY SERVICE: Sending data to Lark:', transformedData);
            console.log('ğŸ” WORK HISTORY SERVICE: Base ID:', this.baseId);
            console.log('ğŸ” WORK HISTORY SERVICE: Table ID:', this.tableId);
            console.log('ğŸ” WORK HISTORY SERVICE: URL will be:', `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            console.log('ğŸ“¥ WORK HISTORY SERVICE: Raw Lark response:', response);
            console.log('ğŸ“¥ WORK HISTORY SERVICE: Response status:', response?.status);
            console.log('ğŸ“¥ WORK HISTORY SERVICE: Response data:', response?.data);

            return {
                success: true,
                employeeId: workHistoryData.employeeId,
                requestNo: workHistoryData.requestNo,
                larkResponse: response  // âœ… THÃŠM: Debug response
            };
            
        } catch (error) {
            console.error('âŒ WORK HISTORY SERVICE: Full error:', error);
            console.error('âŒ WORK HISTORY SERVICE: Error message:', error.message);
            console.error('âŒ WORK HISTORY SERVICE: Error stack:', error.stack);
            await this.handleError(error, 'addWorkHistory');
            throw error;
        }
    }



    async deleteWorkHistory(id) {
        try {
            await LarkClient.delete(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`);
            return true;
        } catch (error) {
            await this.handleError(error, 'deleteWorkHistory');
            throw error;
        }
    }


    transformWorkHistoryData(larkData) {
        return larkData.map(record => ({
            id: record.record_id,
            employeeId: record.fields['MÃ£ nhÃ¢n viÃªn'] || '',
            requestNo: record.fields['Request No.'] || ''
        }));
    }


    transformWorkHistoryForLark(workHistoryData) {
        return {
            'MÃ£ nhÃ¢n viÃªn': workHistoryData.employeeId,
            'Request No.': workHistoryData.requestNo
        };
    }
}


export default WorkHistoryService;

```


==================== File: .\server\services\master-data\index.js ====================

// Master data services exports
export { default as StoreService } from './store-service.js';
export { default as PositionService } from './position-service.js';
export { default as MasterDataValidator } from './master-data-validator.js';

```


==================== File: .\server\services\master-data\master-data-validator.js ====================

// Master data validation service
class MasterDataValidator {
    static validateStoreData(storeData) {
        const errors = [];

        // Required fields validation
        if (!storeData.storeName || storeData.storeName.trim().length < 2) {
            errors.push('TÃªn cá»­a hÃ ng pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±');
        }

        if (!storeData.address || storeData.address.trim().length < 5) {
            errors.push('Äá»‹a chá»‰ pháº£i cÃ³ Ã­t nháº¥t 5 kÃ½ tá»±');
        }

        // Status validation
        if (storeData.status && !['active', 'inactive'].includes(storeData.status)) {
            errors.push('Tráº¡ng thÃ¡i pháº£i lÃ  active hoáº·c inactive');
        }

        return errors;
    }

    static validatePositionData(positionData) {
        const errors = [];

        // Required fields validation
        if (!positionData.positionName || positionData.positionName.trim().length < 2) {
            errors.push('TÃªn vá»‹ trÃ­ pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±');
        }

        // Description validation (optional but if provided must be reasonable)
        if (positionData.description && positionData.description.trim().length < 3) {
            errors.push('MÃ´ táº£ pháº£i cÃ³ Ã­t nháº¥t 3 kÃ½ tá»± náº¿u Ä‘Æ°á»£c cung cáº¥p');
        }

        // Status validation
        if (positionData.status && !['active', 'inactive'].includes(positionData.status)) {
            errors.push('Tráº¡ng thÃ¡i pháº£i lÃ  active hoáº·c inactive');
        }

        return errors;
    }

    static validateMasterDataBatch(dataArray, type) {
        const errors = [];
        const names = [];

        dataArray.forEach((item, index) => {
            // Validate individual item
            let itemErrors = [];
            if (type === 'store') {
                itemErrors = this.validateStoreData(item);
            } else if (type === 'position') {
                itemErrors = this.validatePositionData(item);
            }

            if (itemErrors.length > 0) {
                errors.push(`Item ${index + 1}: ${itemErrors.join(', ')}`);
            }

            // Check for duplicate names
            const nameField = type === 'store' ? 'storeName' : 'positionName';
            if (item[nameField] && names.includes(item[nameField])) {
                errors.push(`Item ${index + 1}: TÃªn Ä‘Ã£ bá»‹ trÃ¹ng láº·p trong batch`);
            } else if (item[nameField]) {
                names.push(item[nameField]);
            }
        });

        return errors;
    }

    static sanitizeStoreData(storeData) {
        return {
            storeName: storeData.storeName?.trim() || '',
            address: storeData.address?.trim() || '',
            status: storeData.status || 'active',
            createdAt: storeData.createdAt || new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
    }

    static sanitizePositionData(positionData) {
        return {
            positionName: positionData.positionName?.trim() || '',
            description: positionData.description?.trim() || '',
            status: positionData.status || 'active',
            createdAt: positionData.createdAt || new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
    }
}

export default MasterDataValidator;

```


==================== File: .\server\services\master-data\position-service.js ====================

// Position management service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class PositionService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_POSITION_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Position Service...');
    }

    async getAllPositions() {
        const cacheKey = 'positions_all';
        let positions = CacheService.get(cacheKey);
        
        if (!positions) {
            try {
                const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
                positions = this.transformPositionData(response.data?.items || []);
                CacheService.set(cacheKey, positions, 300000); // 5 minutes
            } catch (error) {
                console.error('Error fetching positions from Lark:', error);
                positions = this.getMockPositions();
            }
        }
        
        return positions;
    }

    async addPosition(positionData) {
        try {
            const transformedData = this.transformPositionForLark(positionData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('positions_all');
            
            return this.transformPositionData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'addPosition');
            throw error;
        }
    }

    async updatePosition(id, positionData) {
        try {
            const transformedData = this.transformPositionForLark(positionData);
            
            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('positions_all');
            
            return this.transformPositionData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'updatePosition');
            throw error;
        }
    }

    async deletePosition(id) {
        try {
            await LarkClient.delete(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`);
            
            // Clear cache
            CacheService.delete('positions_all');
            
            return true;
        } catch (error) {
            await this.handleError(error, 'deletePosition');
            throw error;
        }
    }

    async getActivePositions() {
        const positions = await this.getAllPositions();
        return positions.filter(position => position.status === 'active');
    }

    async searchPositions(query) {
        const positions = await this.getAllPositions();
        
        if (!query) return positions;
        
        const searchTerm = query.toLowerCase();
        return positions.filter(position => 
            position.positionName.toLowerCase().includes(searchTerm) ||
            (position.description && position.description.toLowerCase().includes(searchTerm))
        );
    }

    transformPositionData(larkData) {
        return larkData.map(record => ({
            id: record.record_id,
            positionName: record.fields['Position Name'] || '',
            description: record.fields['Description'] || '',
            status: record.fields['Status'] || 'active',
            createdAt: record.fields['Created At'] || new Date().toISOString(),
            updatedAt: record.fields['Updated At'] || new Date().toISOString()
        }));
    }

    transformPositionForLark(positionData) {
        return {
            'Position Name': positionData.positionName,
            'Description': positionData.description || '',
            'Status': positionData.status || 'active',
            'Created At': positionData.createdAt || new Date().toISOString(),
            'Updated At': positionData.updatedAt || new Date().toISOString()
        };
    }

    getMockPositions() {
        return [
            {
                id: 'pos_001',
                positionName: 'NhÃ¢n viÃªn bÃ¡n hÃ ng',
                description: 'NhÃ¢n viÃªn bÃ¡n hÃ ng táº¡i cá»­a hÃ ng',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'pos_002',
                positionName: 'NhÃ¢n viÃªn kho',
                description: 'NhÃ¢n viÃªn quáº£n lÃ½ kho hÃ ng',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'pos_003',
                positionName: 'TrÆ°á»Ÿng ca',
                description: 'TrÆ°á»Ÿng ca quáº£n lÃ½ nhÃ¢n viÃªn',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            }
        ];
    }
}

export default PositionService;

```


==================== File: .\server\services\master-data\store-service.js ====================

// Store management service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class StoreService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_STORE_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Store Service...');
    }

    async getAllStores() {
        const cacheKey = 'stores_all';
        let stores = CacheService.get(cacheKey);
        
        if (!stores) {
            try {
                const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
                stores = this.transformStoreData(response.data?.items || []);
                CacheService.set(cacheKey, stores, 300000); // 5 minutes
            } catch (error) {
                console.error('Error fetching stores from Lark:', error);
                stores = this.getMockStores();
            }
        }
        
        return stores;
    }

    async addStore(storeData) {
        try {
            const transformedData = this.transformStoreForLark(storeData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('stores_all');
            
            return this.transformStoreData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'addStore');
            throw error;
        }
    }

    async updateStore(id, storeData) {
        try {
            const transformedData = this.transformStoreForLark(storeData);
            
            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('stores_all');
            
            return this.transformStoreData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'updateStore');
            throw error;
        }
    }

    async deleteStore(id) {
        try {
            await LarkClient.delete(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`);
            
            // Clear cache
            CacheService.delete('stores_all');
            
            return true;
        } catch (error) {
            await this.handleError(error, 'deleteStore');
            throw error;
        }
    }

    async getActiveStores() {
        const stores = await this.getAllStores();
        return stores.filter(store => store.status === 'active');
    }

    async searchStores(query) {
        const stores = await this.getAllStores();
        
        if (!query) return stores;
        
        const searchTerm = query.toLowerCase();
        return stores.filter(store => 
            store.storeName.toLowerCase().includes(searchTerm) ||
            store.address.toLowerCase().includes(searchTerm)
        );
    }

    transformStoreData(larkData) {
        return larkData.map(record => ({
            id: record.record_id,
            storeName: record.fields['Store Name'] || '',
            address: record.fields['Address'] || '',
            status: record.fields['Status'] || 'active',
            createdAt: record.fields['Created At'] || new Date().toISOString(),
            updatedAt: record.fields['Updated At'] || new Date().toISOString()
        }));
    }

    transformStoreForLark(storeData) {
        return {
            'Store Name': storeData.storeName,
            'Address': storeData.address,
            'Status': storeData.status || 'active',
            'Created At': storeData.createdAt || new Date().toISOString(),
            'Updated At': storeData.updatedAt || new Date().toISOString()
        };
    }

    getMockStores() {
        return [
            {
                id: 'store_001',
                storeName: '116 Cáº§u Giáº¥y',
                address: '116 Cáº§u Giáº¥y, HÃ  Ná»™i',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'store_002',
                storeName: 'TrÃ¢m Trá»—i',
                address: 'TrÃ¢m Trá»—i, HÃ  Ná»™i',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            }
        ];
    }
}

export default StoreService;

```


==================== File: .\server\services\recruitment\index.js ====================

// Recruitment services exports
export { default as RecruitmentService } from './recruitment-service.js';
export { default as RecruitmentValidator } from './recruitment-validator.js';

```


==================== File: .\server\services\recruitment\recruitment-service.js ====================

// Recruitment service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class RecruitmentService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_RECRUITMENT_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Recruitment Service...');
    }

    async getRecruitmentRequests(filters = {}) {
        const cacheKey = `recruitment_requests_${JSON.stringify(filters)}`;
        let requests = CacheService.get(cacheKey);
        
        if (!requests) {
            try {
                let filterString = '';
                if (filters.status) {
                    filterString += `AND(CurrentValue.[Status] = "${filters.status}")`;
                }
                if (filters.department) {
                    filterString += `AND(CurrentValue.[Department] = "${filters.department}")`;
                }
                
                const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                    filter: filterString
                });

                requests = this.transformRecruitmentData(response.data?.items || []);
                CacheService.set(cacheKey, requests, 300000); // 5 minutes
            } catch (error) {
                console.error('Error fetching recruitment requests:', error);
                requests = this.getMockRecruitmentRequests();
            }
        }
        
        return requests;
    }

    async addRecruitmentRequest(requestData) {
        try {
            const transformedData = this.transformRecruitmentForLark(requestData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete(`recruitment_requests_${JSON.stringify({})}`);
            
            return this.transformRecruitmentData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'addRecruitmentRequest');
            throw error;
        }
    }

    async updateRecruitmentRequest(id, requestData) {
        try {
            const transformedData = this.transformRecruitmentForLark(requestData);
            
            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.clear();
            
            return this.transformRecruitmentData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'updateRecruitmentRequest');
            throw error;
        }
    }


    transformRecruitmentData(larkData) {
        
        return larkData.map(record => {
            
            const result = {
                id: record.record_id,
                // âœ… Sá»¬A: Extract Request No tá»« object structure
                requestNo: this.extractRequestNo(record.fields['Request No.']),
                // âœ… Sá»¬A: Extract Requester tá»« array structure  
                requester: this.extractRequesterName(record.fields['Requester']),
                status: record.fields['Status'] || '',
                department: record.fields['Details_PhÃ²ng ban'] || record.fields['Department'] || '',
                quantity: record.fields['Details_Sá»‘ lÆ°á»£ng cáº§n tuyá»ƒn'] || record.fields['Quantity'] || '',
                gender: record.fields['Details_Giá»›i tÃ­nh'] || record.fields['Gender'] || '',
                fromDate: record.fields['Details_Tá»« ngÃ y'] || record.fields['From Date'] || '',
                toDate: record.fields['Details_Äáº¿n ngÃ y'] || record.fields['To Date'] || '',
                position: record.fields['Details_Vá»‹ trÃ­'] || record.fields['Position'] || '',
                approvalStatus: record.fields['Status'] || 'pending'
            };
            
            return result;
        });
    }

    // âœ… THÃŠM: Method Ä‘á»ƒ extract Request No tá»« object
    extractRequestNo(requestNoData) {
        if (!requestNoData) return '';
        
        // Náº¿u lÃ  object vá»›i structure { "link": "...", "text": "202507140017" }
        if (typeof requestNoData === 'object' && requestNoData.text) {
            return requestNoData.text;
        }
        
        // Náº¿u lÃ  string trá»±c tiáº¿p
        if (typeof requestNoData === 'string') {
            return requestNoData;
        }
        
        // Fallback
        return requestNoData.toString();
    }

    // âœ… THÃŠM: Method Ä‘á»ƒ extract Requester tá»« array
    extractRequesterName(requesterData) {
        if (!requesterData) return '';
        
        // Náº¿u lÃ  array [{ "name": "236LH.Nguyá»…n Huy ThÃ nh", ... }]
        if (Array.isArray(requesterData)) {
            return requesterData.map(user => 
                user.name || user.en_name || user.id || 'Unknown'
            ).join(', ');
        }
        
        // Náº¿u lÃ  object { "name": "236LH.Nguyá»…n Huy ThÃ nh", ... }
        if (typeof requesterData === 'object') {
            return requesterData.name || requesterData.en_name || requesterData.id || 'Unknown';
        }
        
        // Náº¿u lÃ  string trá»±c tiáº¿p
        return requesterData.toString();
    }


    transformRecruitmentForLark(requestData) {
        return {
            'Request No': requestData.requestNo,
            'Requester': requestData.requester,
            'Status': requestData.status,
            'Department': requestData.department,
            'Quantity': requestData.quantity,
            'Gender': requestData.gender,
            'From Date': requestData.fromDate,
            'To Date': requestData.toDate,
            'Approval Status': requestData.approvalStatus || 'pending',
            'Created At': requestData.createdAt || new Date().toISOString()
        };
    }

    getMockRecruitmentRequests() {
        return [
            {
                id: '20250620014',
                requestNo: '20250620014',
                requester: 'Rikkei Test',
                status: 'Äang tuyá»ƒn dá»¥ng',
                department: '116 Cáº§u Giáº¥y',
                quantity: '2',
                gender: 'Nam/Ná»¯',
                fromDate: '2025-06-20',
                toDate: '2025-07-20',
                approvalStatus: 'approved',
                createdAt: '2025-06-20T00:00:00.000Z'
            },
            {
                id: '20250620017',
                requestNo: '20250620017',
                requester: 'Rikkei Test',
                status: 'Äang tuyá»ƒn dá»¥ng',
                department: 'TrÃ¢m Trá»—i',
                quantity: '1',
                gender: 'Ná»¯',
                fromDate: '2025-06-20',
                toDate: '2025-07-20',
                approvalStatus: 'approved',
                createdAt: '2025-06-20T00:00:00.000Z'
            }
        ];
    }
}

export default RecruitmentService;

```


==================== File: .\server\services\recruitment\recruitment-validator.js ====================

// Recruitment validation service
class RecruitmentValidator {
    static validateRecruitmentData(requestData) {
        const errors = [];

        // Required fields validation
        if (!requestData.requestNo) {
            errors.push('Request No lÃ  báº¯t buá»™c');
        }

        if (!requestData.requester) {
            errors.push('Requester lÃ  báº¯t buá»™c');
        }

        if (!requestData.department) {
            errors.push('Department lÃ  báº¯t buá»™c');
        }

        if (!requestData.quantity || requestData.quantity <= 0) {
            errors.push('Quantity pháº£i lá»›n hÆ¡n 0');
        }

        if (!requestData.gender) {
            errors.push('Gender lÃ  báº¯t buá»™c');
        }

        if (!requestData.fromDate) {
            errors.push('From Date lÃ  báº¯t buá»™c');
        } else if (!this.isValidDate(requestData.fromDate)) {
            errors.push('From Date khÃ´ng há»£p lá»‡');
        }

        if (!requestData.toDate) {
            errors.push('To Date lÃ  báº¯t buá»™c');
        } else if (!this.isValidDate(requestData.toDate)) {
            errors.push('To Date khÃ´ng há»£p lá»‡');
        }

        // Check if toDate is after fromDate
        if (requestData.fromDate && requestData.toDate) {
            if (!this.isToDateAfterFromDate(requestData.fromDate, requestData.toDate)) {
                errors.push('To Date pháº£i sau From Date');
            }
        }

        return errors;
    }

    static isValidDate(dateString) {
        const date = new Date(dateString);
        return date instanceof Date && !isNaN(date);
    }

    static isToDateAfterFromDate(fromDate, toDate) {
        const from = new Date(fromDate);
        const to = new Date(toDate);
        return to >= from;
    }
}

export default RecruitmentValidator;

```


==================== File: .\server\services\utils\error-handler.js ====================

// Centralized error handling utilities
import ResponseFormatter from './response-formatter.js';

class ErrorHandler {
    static handleLarkError(error) {
        if (error.response?.data?.code) {
            const larkCode = error.response.data.code;
            const larkMessage = error.response.data.msg || 'Lark API Error';
            
            switch (larkCode) {
                case 99991663:
                    return ResponseFormatter.formatError('App access token invalid', 'LARK_AUTH_ERROR');
                case 99991664:
                    return ResponseFormatter.formatError('Tenant access token invalid', 'LARK_AUTH_ERROR');
                case 99991665:
                    return ResponseFormatter.formatError('User access token invalid', 'LARK_AUTH_ERROR');
                case 230002:
                    return ResponseFormatter.formatError('Base not found', 'LARK_BASE_NOT_FOUND');
                case 230003:
                    return ResponseFormatter.formatError('Table not found', 'LARK_TABLE_NOT_FOUND');
                case 230004:
                    return ResponseFormatter.formatError('Record not found', 'LARK_RECORD_NOT_FOUND');
                case 1254006:
                    return ResponseFormatter.formatError('Rate limit exceeded', 'LARK_RATE_LIMIT');
                default:
                    return ResponseFormatter.formatError(`Lark API Error: ${larkMessage}`, 'LARK_API_ERROR');
            }
        }
        
        return ResponseFormatter.formatError('Unknown Lark API error', 'LARK_UNKNOWN_ERROR');
    }

    static handleValidationError(errors) {
        const message = Array.isArray(errors) ? errors.join(', ') : errors;
        return ResponseFormatter.formatError(message, 'VALIDATION_ERROR');
    }

    static handleDatabaseError(error) {
        console.error('Database error:', error);
        
        if (error.code === 'ECONNREFUSED') {
            return ResponseFormatter.formatError('Database connection failed', 'DATABASE_CONNECTION_ERROR');
        }
        
        if (error.code === 'ER_DUP_ENTRY') {
            return ResponseFormatter.formatError('Duplicate entry', 'DUPLICATE_ENTRY');
        }
        
        return ResponseFormatter.formatError('Database operation failed', 'DATABASE_ERROR');
    }

    static handleNetworkError(error) {
        console.error('Network error:', error);
        
        if (error.code === 'ENOTFOUND') {
            return ResponseFormatter.formatError('Service not found', 'SERVICE_NOT_FOUND');
        }
        
        if (error.code === 'ECONNRESET') {
            return ResponseFormatter.formatError('Connection reset', 'CONNECTION_RESET');
        }
        
        if (error.code === 'ETIMEDOUT') {
            return ResponseFormatter.formatError('Request timeout', 'REQUEST_TIMEOUT');
        }
        
        return ResponseFormatter.formatError('Network error', 'NETWORK_ERROR');
    }

    static handleGenericError(error, operation = 'operation') {
        console.error(`Error in ${operation}:`, error);
        
        // Check for specific error types
        if (error.isAxiosError) {
            if (error.response?.status === 401) {
                return ResponseFormatter.formatUnauthorized('Authentication required');
            }
            
            if (error.response?.status === 403) {
                return ResponseFormatter.formatForbidden('Access forbidden');
            }
            
            if (error.response?.status === 404) {
                return ResponseFormatter.formatNotFound('Resource');
            }
            
            if (error.response?.status >= 500) {
                return ResponseFormatter.formatServerError('External service error');
            }
            
            return this.handleLarkError(error);
        }
        
        // Check for validation errors
        if (error.name === 'ValidationError') {
            return this.handleValidationError(error.message);
        }
        
        // Check for database errors
        if (error.code && error.code.startsWith('ER_')) {
            return this.handleDatabaseError(error);
        }
        
        // Check for network errors
        if (error.code && ['ENOTFOUND', 'ECONNRESET', 'ETIMEDOUT'].includes(error.code)) {
            return this.handleNetworkError(error);
        }
        
        // Default generic error
        return ResponseFormatter.formatServerError(`Error in ${operation}: ${error.message}`);
    }

    static async wrapAsync(fn, operation = 'operation') {
        try {
            return await fn();
        } catch (error) {
            throw this.handleGenericError(error, operation);
        }
    }

    static logError(error, context = {}) {
        const errorInfo = {
            message: error.message,
            stack: error.stack,
            context,
            timestamp: new Date().toISOString()
        };
        
        console.error('Error logged:', JSON.stringify(errorInfo, null, 2));
        
        // In production, you might want to send this to a logging service
        // like Winston, Sentry, or CloudWatch
    }
}

export default ErrorHandler;

```


==================== File: .\server\services\utils\index.js ====================

// Utilities services exports
export { default as ResponseFormatter, formatResponse } from './response-formatter.js';
export { default as ServiceFactory } from './service-factory.js';
export { default as ErrorHandler } from './error-handler.js';

// Re-export commonly used functions
export {
    getEmployeeService,
    getWorkHistoryService,
    getAttendanceService,
    getRecruitmentService,
    getStoreService,
    getPositionService,
    getAuthService,
    getSessionService
} from './service-factory.js';

```


==================== File: .\server\services\utils\response-formatter.js ====================

// Response formatting utilities
class ResponseFormatter {
    static formatResponse(success, message, data = null, errorCode = null) {
        const response = {
            success,
            message,
            timestamp: new Date().toISOString()
        };

        if (success && data) {
            response.data = data;
        }

        if (!success && errorCode) {
            response.errorCode = errorCode;
        }

        return response;
    }

    static formatSuccess(message, data = null) {
        return this.formatResponse(true, message, data);
    }

    static formatError(message, errorCode = null) {
        return this.formatResponse(false, message, null, errorCode);
    }

    static formatValidationError(errors) {
        return this.formatResponse(false, 'Validation failed', null, 'VALIDATION_ERROR');
    }

    static formatNotFound(resource) {
        return this.formatResponse(false, `${resource} not found`, null, 'NOT_FOUND');
    }

    static formatUnauthorized(message = 'Unauthorized access') {
        return this.formatResponse(false, message, null, 'UNAUTHORIZED');
    }

    static formatForbidden(message = 'Forbidden access') {
        return this.formatResponse(false, message, null, 'FORBIDDEN');
    }

    static formatServerError(message = 'Internal server error') {
        return this.formatResponse(false, message, null, 'SERVER_ERROR');
    }

    static formatPaginatedResponse(data, pagination) {
        return this.formatResponse(true, 'Success', {
            items: data,
            pagination: {
                page: pagination.page || 1,
                limit: pagination.limit || 10,
                total: pagination.total || 0,
                pages: Math.ceil((pagination.total || 0) / (pagination.limit || 10))
            }
        });
    }

    static formatBatchResponse(results) {
        const successCount = results.filter(r => r.success).length;
        const failureCount = results.length - successCount;

        return this.formatResponse(
            failureCount === 0,
            `Batch operation completed: ${successCount} successful, ${failureCount} failed`,
            {
                results,
                summary: {
                    total: results.length,
                    successful: successCount,
                    failed: failureCount
                }
            }
        );
    }
}

// Legacy function for backward compatibility
export function formatResponse(success, message, data = null, errorCode = null) {
    return ResponseFormatter.formatResponse(success, message, data, errorCode);
}

export default ResponseFormatter;

```


==================== File: .\server\services\utils\service-factory.js ====================

// Service factory for dependency injection
import { EmployeeService } from '../employee/index.js';
import { WorkHistoryService } from '../employee/index.js';
import { AttendanceService } from '../attendance/index.js';
import { RecruitmentService } from '../recruitment/index.js';
import { StoreService, PositionService } from '../master-data/index.js';
import { AuthService, SessionService } from '../auth/index.js';

class ServiceFactory {
    constructor() {
        this.services = new Map();
        this.singletons = new Map();
    }

    // Register a service class
    register(name, ServiceClass, singleton = true) {
        this.services.set(name, { ServiceClass, singleton });
    }

    // Get service instance
    get(name) {
        const serviceConfig = this.services.get(name);
        if (!serviceConfig) {
            throw new Error(`Service '${name}' not found`);
        }

        const { ServiceClass, singleton } = serviceConfig;

        if (singleton) {
            if (!this.singletons.has(name)) {
                this.singletons.set(name, new ServiceClass());
            }
            return this.singletons.get(name);
        }

        return new ServiceClass();
    }

    // Initialize all services
    async initialize() {
        for (const [name, config] of this.services.entries()) {
            const service = this.get(name);
            if (service.init && typeof service.init === 'function') {
                await service.init();
            }
        }
    }

    // Clear all singleton instances
    clear() {
        this.singletons.clear();
    }

    // Get all service names
    getServiceNames() {
        return Array.from(this.services.keys());
    }

    // Check if service exists
    has(name) {
        return this.services.has(name);
    }
}

// Create and configure the global service factory
const serviceFactory = new ServiceFactory();

// Register core services
serviceFactory.register('employee', EmployeeService, true);
serviceFactory.register('workHistory', WorkHistoryService, true);
serviceFactory.register('attendance', AttendanceService, true);
serviceFactory.register('recruitment', RecruitmentService, true);
serviceFactory.register('store', StoreService, true);
serviceFactory.register('position', PositionService, true);
serviceFactory.register('auth', AuthService, true);
serviceFactory.register('session', SessionService, true);

// Helper functions for common service access
export const getEmployeeService = () => serviceFactory.get('employee');
export const getWorkHistoryService = () => serviceFactory.get('workHistory');
export const getAttendanceService = () => serviceFactory.get('attendance');
export const getRecruitmentService = () => serviceFactory.get('recruitment');
export const getStoreService = () => serviceFactory.get('store');
export const getPositionService = () => serviceFactory.get('position');
export const getAuthService = () => serviceFactory.get('auth');
export const getSessionService = () => serviceFactory.get('session');

export default serviceFactory;

```


==================== File: .\src\App.jsx ====================

import React, { useEffect, useState } from 'react';
import { Routes, Route, Navigate, useLocation } from 'react-router-dom';
import { useAuth } from './hooks/useAuth';
import { useNotification } from './hooks/useNotification';

// Components - ThÃ nh pháº§n giao diá»‡n
import Layout from './components/layout/Layout';
import Loading from './components/common/Loading';
import ProtectedRoute from './components/auth/ProtectedRoute';

// Pages - CÃ¡c trang chÃ­nh
import LoginPage from './pages/LoginPage';
import EmployeeManagementPage from './pages/EmployeeManagementPage';
import AttendanceLogsPage from './pages/AttendanceLogsPage';
import HRDashboardPage from './pages/HRDashboardPage';

// Global styles - Styles toÃ n cá»¥c
import './styles/globals.css';

const App = () => {
  const [loading, setLoading] = useState(true);
  const [initialized, setInitialized] = useState(false);
  const { user, checkAuth, loading: authLoading } = useAuth();
  const { showNotification } = useNotification();
  const location = useLocation();

  useEffect(() => {
    const initializeApp = async () => {
      try {
        console.log('ğŸš€ Báº¯t Ä‘áº§u khá»Ÿi táº¡o á»©ng dá»¥ng React...');
        
        initializeGlobalUtilities();
        
        if (isProtectedPage()) {
          console.log('ğŸ” Äang kiá»ƒm tra xÃ¡c thá»±c...');
          const authUser = await checkAuth();
          if (!authUser && !isPublicPage()) {
            console.log('âŒ XÃ¡c thá»±c tháº¥t báº¡i cho trang Ä‘Æ°á»£c báº£o vá»‡');
            return;
          }
          console.log('âœ… HoÃ n thÃ nh kiá»ƒm tra xÃ¡c thá»±c');
        }
        
        setInitialized(true);
        console.log('âœ… Khá»Ÿi táº¡o á»©ng dá»¥ng React thÃ nh cÃ´ng');
        
      } catch (error) {
        console.error('âŒ Lá»—i khá»Ÿi táº¡o á»©ng dá»¥ng:', error);
        
        if (error.name === 'TypeError') {
          showNotification('Lá»—i táº£i module. Vui lÃ²ng refresh trang.', 'error');
        } else if (error.message.includes('fetch')) {
          showNotification('Lá»—i káº¿t ná»‘i server. Vui lÃ²ng kiá»ƒm tra máº¡ng.', 'error');
        } else {
          showNotification('Lá»—i khá»Ÿi táº¡o á»©ng dá»¥ng. Vui lÃ²ng refresh trang.', 'error');
        }
      } finally {
        setLoading(false);
      }
    };

    initializeApp();
  }, []);

  const initializeGlobalUtilities = () => {
    try {
      if (typeof window.bootstrap !== 'undefined') {
        const tooltipTriggerList = [].slice.call(
          document.querySelectorAll('[data-bs-toggle="tooltip"]')
        );
        tooltipTriggerList.map(tooltipTriggerEl => {
          return new window.bootstrap.Tooltip(tooltipTriggerEl);
        });
      }
    } catch (error) {
      console.warn('Lá»—i khá»Ÿi táº¡o tooltips:', error);
    }
  };

  const isProtectedPage = () => {
    const publicPaths = ['/', '/login'];
    return !publicPaths.includes(location.pathname);
  };

  const isPublicPage = () => {
    const publicPaths = ['/', '/login'];
    return publicPaths.includes(location.pathname);
  };

  if (loading || authLoading) {
    return (
      <div className="d-flex justify-content-center align-items-center min-vh-100">
        <Loading />
      </div>
    );
  }

  if (!initialized) {
    return (
      <div className="container mt-5">
        <div className="alert alert-danger">
          <h4>Lá»—i khá»Ÿi táº¡o á»©ng dá»¥ng</h4>
          <p>KhÃ´ng thá»ƒ khá»Ÿi táº¡o á»©ng dá»¥ng. Vui lÃ²ng:</p>
          <ul>
            <li>Refresh láº¡i trang (F5)</li>
            <li>Kiá»ƒm tra káº¿t ná»‘i máº¡ng</li>
            <li>LiÃªn há»‡ IT support náº¿u váº¥n Ä‘á» váº«n tiáº¿p tá»¥c</li>
          </ul>
          <button 
            className="btn btn-primary" 
            onClick={() => window.location.reload()}
          >
            Refresh Trang
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="App">
      {/* âœ… BÆ¯á»šC 1: ThÃªm container cho thÃ´ng bÃ¡o táº¡i Ä‘Ã¢y */}
      <div id="alert-container" style={{
        position: 'fixed',
        top: '20px',
        right: '20px',
        zIndex: 1055,
        minWidth: '300px'
      }}></div>

      <Routes>
        {/* CÃ¡c route cÃ´ng khai */}
        <Route 
          path="/login" 
          element={
            user ? <Navigate to="/dashboard" replace /> : <LoginPage />
          } 
        />
        
        {/* CÃ¡c route Ä‘Æ°á»£c báº£o vá»‡ vá»›i Layout */}
        <Route 
          path="/" 
          element={
            <ProtectedRoute>
              <Layout />
            </ProtectedRoute>
          }
        >
          {/* Redirect máº·c Ä‘á»‹nh */}
          <Route index element={<Navigate to="/dashboard" replace />} />
          
          <Route path="dashboard" element={<HRDashboardPage />} />
          
          {/* Route quáº£n lÃ½ nhÃ¢n viÃªn */}
          <Route 
            path="employee-management" 
            element={
              <ProtectedRoute requiredRoles={['hr', 'admin']}>
                <EmployeeManagementPage />
              </ProtectedRoute>
            } 
          />
          
          {/* Route nháº­t kÃ½ cháº¥m cÃ´ng */}
          <Route path="attendance-logs" element={<AttendanceLogsPage />} />
        </Route>

        {/* Route báº¯t táº¥t cáº£ */}
        <Route 
          path="*" 
          element={
            user ? (
              <Navigate to="/dashboard" replace />
            ) : (
              <Navigate to="/login" replace />
            )
          } 
        />
      </Routes>
    </div>
  );
};

export default App;

```


==================== File: .\src\main.jsx ====================

import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import App from './App.jsx';
import { AuthProvider } from './contexts/AuthContext.jsx';
import { NotificationProvider } from './contexts/NotificationContext.jsx';

// Import Bootstrap CSS vÃ  FontAwesome
import 'bootstrap/dist/css/bootstrap.min.css';
import 'bootstrap/dist/js/bootstrap.bundle.min.js';
import '@fortawesome/fontawesome-free/css/all.min.css';
import './styles/globals.css';

// Global error handler
window.addEventListener('error', (e) => {
  console.error('Global error:', e.error);
  console.error('Error details:', {
    message: e.message,
    filename: e.filename,
    lineno: e.lineno,
    colno: e.colno
  });
});

// Global unhandled promise rejection handler
window.addEventListener('unhandledrejection', (e) => {
  console.error('Unhandled promise rejection:', e.reason);
  console.error('Promise:', e.promise);
});

// Initialize tooltips when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  if (typeof window.bootstrap !== 'undefined') {
    const tooltipTriggerList = [].slice.call(
      document.querySelectorAll('[data-bs-toggle="tooltip"]')
    );
    tooltipTriggerList.map(tooltipTriggerEl => {
      return new window.bootstrap.Tooltip(tooltipTriggerEl);
    });
  }
});

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <NotificationProvider>
          <App />
        </NotificationProvider>
      </AuthProvider>
    </BrowserRouter>
  </React.StrictMode>
);

```


==================== File: .\src\components\attendance\AttendanceFilters.jsx ====================

import React from 'react';

const AttendanceFilters = ({ 
  employees, 
  filters, 
  onFilterChange, 
  onClearFilters 
}) => {
  const handleFilterSubmit = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const newFilters = {
      employeeId: formData.get('employeeId'),
      dateFrom: formData.get('dateFrom'),
      dateTo: formData.get('dateTo')
    };
    
    // Remove empty filters
    Object.keys(newFilters).forEach(key => {
      if (!newFilters[key]) delete newFilters[key];
    });
    
    onFilterChange(newFilters);
  };

  return (
    <form onSubmit={handleFilterSubmit} id="filterForm">
      <div className="row">
        <div className="col-md-4">
          <label className="form-label">NhÃ¢n viÃªn</label>
          <select 
            className="form-select" 
            name="employeeId"
            defaultValue={filters.employeeId || ''}
          >
            <option value="">Táº¥t cáº£ nhÃ¢n viÃªn</option>
            {employees.map(employee => (
              <option key={employee.id} value={employee.employeeId}>
                {employee.employeeId} - {employee.fullName}
              </option>
            ))}
          </select>
        </div>
        
        <div className="col-md-3">
          <label className="form-label">Tá»« ngÃ y</label>
          <input 
            type="date" 
            className="form-control" 
            name="dateFrom"
            defaultValue={filters.dateFrom || ''}
          />
        </div>
        
        <div className="col-md-3">
          <label className="form-label">Äáº¿n ngÃ y</label>
          <input 
            type="date" 
            className="form-control" 
            name="dateTo"
            defaultValue={filters.dateTo || ''}
          />
        </div>
        
        <div className="col-md-2">
          <label className="form-label">&nbsp;</label>
          <div className="d-grid gap-2">
            <button type="submit" className="btn btn-primary">
              <i className="fas fa-search me-2"></i>
              Lá»c
            </button>
            <button 
              type="button" 
              className="btn btn-outline-secondary"
              onClick={onClearFilters}
            >
              <i className="fas fa-times me-2"></i>
              XÃ³a
            </button>
          </div>
        </div>
      </div>
    </form>
  );
};

export default AttendanceFilters;

```


==================== File: .\src\components\attendance\AttendanceLogs.jsx ====================

import React from 'react';

const AttendanceLogs = ({ logs }) => {
  if (!logs || logs.length === 0) {
    return (
      <div className="text-center py-4">
        <i className="fas fa-calendar-times fa-3x text-muted mb-3"></i>
        <p className="text-muted">KhÃ´ng cÃ³ báº£n ghi cháº¥m cÃ´ng nÃ o</p>
      </div>
    );
  }

  return (
    <div className="table-responsive">
      <table className="table table-striped table-hover">
        <thead className="table-dark">
          <tr>
            <th>MÃ£ nhÃ¢n viÃªn</th>
            <th>NgÃ y</th>
            <th>Giá» vÃ o</th>
            <th>Giá» ra</th>
            <th>Tá»•ng giá»</th>
            <th>Ghi chÃº</th>
          </tr>
        </thead>
        <tbody>
          {logs.map((log, index) => (
            <tr key={log.id || index}>
              <td>{log.employeeId}</td>
              <td>{log.date}</td>
              <td>{log.timeIn}</td>
              <td>{log.timeOut}</td>
              <td>
                <strong className="text-primary">{log.totalHours}</strong>
              </td>
              <td>{log.notes}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};

export default AttendanceLogs;

```


==================== File: .\src\components\attendance\EmployeeHours.jsx ====================

import React from 'react';

const EmployeeHours = ({ employees, employeeHours }) => {
  const hoursData = employees
    .map(employee => {
      const hours = employeeHours[employee.employeeId];
      return {
        ...employee,
        totalHours: hours ? hours.totalHours : 0
      };
    })
    .filter(emp => emp.totalHours > 0)
    .sort((a, b) => b.totalHours - a.totalHours);

  if (hoursData.length === 0) {
    return (
      <div className="text-center py-4">
        <i className="fas fa-clock fa-3x text-muted mb-3"></i>
        <p className="text-muted">KhÃ´ng cÃ³ dá»¯ liá»‡u giá» cÃ´ng</p>
      </div>
    );
  }

  return (
    <div className="table-responsive">
      <table className="table table-striped table-hover">
        <thead className="table-dark">
          <tr>
            <th>MÃ£ nhÃ¢n viÃªn</th>
            <th>Há» tÃªn</th>
            <th>Tá»•ng giá» cÃ´ng</th>
            <th>Sá»‘ ngÃ y</th>
            <th>Trung bÃ¬nh/ngÃ y</th>
          </tr>
        </thead>
        <tbody>
          {hoursData.map((employee) => {
            const hours = employeeHours[employee.employeeId];
            const avgHours = hours ? (hours.totalHours / (hours.totalDays || 1)) : 0;
            
            return (
              <tr key={employee.id}>
                <td>{employee.employeeId}</td>
                <td>{employee.fullName}</td>
                <td>
                  <strong className="text-success">
                    {employee.totalHours.toFixed(1)} giá»
                  </strong>
                </td>
                <td>
                  <span className="badge bg-info">
                    {hours ? hours.totalDays : 0} ngÃ y
                  </span>
                </td>
                <td>
                  <span className="text-muted">
                    {avgHours.toFixed(1)} giá»/ngÃ y
                  </span>
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
};

export default EmployeeHours;

```


==================== File: .\src\components\auth\LoginForm.jsx ====================


```


==================== File: .\src\components\auth\ProtectedRoute.jsx ====================

import React from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';
import Loading from '../common/Loading';

const ProtectedRoute = ({ children, requiredRoles = [] }) => {
  const { user, loading } = useAuth();
  const location = useLocation();

  if (loading) {
    return <Loading fullScreen text="Äang kiá»ƒm tra quyá»n truy cáº­p..." />;
  }

  if (!user) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  // Check role-based access
  if (requiredRoles.length > 0 && !requiredRoles.includes(user.role)) {
    return (
      <div className="container mt-5">
        <div className="alert alert-danger">
          <h4>KhÃ´ng cÃ³ quyá»n truy cáº­p</h4>
          <p>Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p vÃ o trang nÃ y.</p>
          <button 
            className="btn btn-primary" 
            onClick={() => window.history.back()}
          >
            Quay láº¡i
          </button>
        </div>
      </div>
    );
  }

  return children;
};

export default ProtectedRoute;

```


==================== File: .\src\components\common\Alert.jsx ====================

// src/components/common/Alert.jsx

// âœ… Sá»¬A: DÃ¹ng "export const" Ä‘á»ƒ táº¡o má»™t named export, khá»›p vá»›i cÃ¡ch import
export const Alert = ({ message, type = 'info', onClose }) => {
  if (!message) {
    return null;
  }

  // Chuyá»ƒn Ä‘á»•i type 'error' thÃ nh 'danger' cho Bootstrap
  const alertType = type === 'error' ? 'danger' : type;

  const getIcon = () => {
    switch (alertType) {
      case 'success':
        return 'fas fa-check-circle';
      case 'danger':
        return 'fas fa-exclamation-triangle';
      case 'warning':
        return 'fas fa-exclamation-circle';
      default:
        return 'fas fa-info-circle';
    }
  };

  return (
    <div
      className={`alert alert-${alertType} alert-dismissible fade show d-flex align-items-center`}
      role="alert"
    >
      <i className={`${getIcon()} me-2`}></i>
      <div>{message}</div>
      {onClose && (
        <button
          type="button"
          className="btn-close"
          onClick={onClose}
          aria-label="Close"
        ></button>
      )}
    </div>
  );
};

```


==================== File: .\src\components\common\Loading.jsx ====================

import React from 'react';

const Loading = ({ 
  size = 'medium', 
  text = 'Äang táº£i...', 
  overlay = false,
  fullScreen = false 
}) => {
  const getSizeClass = () => {
    switch (size) {
      case 'small': return 'spinner-border-sm';
      case 'large': return 'spinner-border spinner-border-lg';
      default: return 'spinner-border';
    }
  };

  const LoadingSpinner = () => (
    <div className="d-flex flex-column align-items-center justify-content-center p-3">
      <div className={`${getSizeClass()} text-primary`} role="status">
        <span className="visually-hidden">Loading...</span>
      </div>
      {text && (
        <div className="mt-2 text-muted small">
          {text}
        </div>
      )}
    </div>
  );

  if (fullScreen) {
    return (
      <div 
        className="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
        style={{ 
          backgroundColor: 'rgba(255, 255, 255, 0.9)', 
          zIndex: 9999 
        }}
      >
        <div className="text-center">
          <div className="spinner-border spinner-border-lg text-primary" role="status">
            <span className="visually-hidden">Loading...</span>
          </div>
          <div className="mt-3 h5 text-muted">{text}</div>
        </div>
      </div>
    );
  }

  if (overlay) {
    return (
      <div 
        className="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
        style={{ 
          backgroundColor: 'rgba(255, 255, 255, 0.8)', 
          zIndex: 1000 
        }}
      >
        <LoadingSpinner />
      </div>
    );
  }

  return <LoadingSpinner />;
};

// Loading wrapper component for conditional loading states
export const LoadingWrapper = ({ loading, children, ...loadingProps }) => {
  if (loading) {
    return <Loading {...loadingProps} />;
  }
  return children;
};

// Inline loading component for buttons
export const ButtonLoading = ({ loading, children, disabled, ...props }) => {
  return (
    <button 
      {...props} 
      disabled={disabled || loading}
      className={`${props.className || ''} ${loading ? 'position-relative' : ''}`}
    >
      {loading && (
        <span className="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
      )}
      {children}
    </button>
  );
};

export default Loading;

```


==================== File: .\src\components\common\Modal.jsx ====================

// src/components/common/Modal.jsx
import React from 'react';

const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
  if (!isOpen) return null;

  const handleBackdropClick = (e) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <div 
      className="modal fade show d-block" 
      style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}
      onClick={handleBackdropClick}
    >
      <div className={`modal-dialog modal-${size} modal-dialog-centered`}>
        <div className="modal-content">
          <div className="modal-header">
            <h5 className="modal-title">{title}</h5>
            <button 
              type="button" 
              className="btn-close" 
              onClick={onClose}
            ></button>
          </div>
          <div className="modal-body">
            {children}
          </div>
        </div>
      </div>
    </div>
  );
};

export default Modal;

```


==================== File: .\src\components\common\Table.jsx ====================


```


==================== File: .\src\components\dashboard\Dashboard.jsx ====================

// // src/components/dashboard/Dashboard.jsx
// import React, { useState, useEffect } from 'react';
// import { useAuth } from '../../hooks/useAuth';
// import { ApiClient } from '../../services/api';
// import Loading from '../common/Loading';
// import { useNotification } from '../../hooks/useNotification';

// const Dashboard = () => {
//   const [stats, setStats] = useState({});
//   const [loading, setLoading] = useState(true);
//   const { user } = useAuth();
//   const { showNotification } = useNotification();

//   useEffect(() => {
//     loadStats();
    
//     // Auto refresh every 5 minutes
//     const interval = setInterval(loadStats, 5 * 60 * 1000);
//     return () => clearInterval(interval);
//   }, []);

//   const loadStats = async () => {
//     try {
//       console.log('ğŸ” Dashboard: Loading stats...');
//       const response = await ApiClient.get('/api/employees/stats');
      
//       console.log('ğŸ“¨ Dashboard: Raw response:', response);
//       console.log('âœ… Dashboard: Response success:', response.success);
//       console.log('ğŸ“Š Dashboard: Response data:', response.data);
      
//       // âœ… FIX: Sá»­ dá»¥ng response.data thay vÃ¬ response
//       if (response.success && response.data) {
//         console.log('âœ… Dashboard: Setting stats to:', response.data);
//         setStats(response.data);
//       } else {
//         console.warn('âš ï¸ Dashboard: API returned success: false');
//         showNotification('KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u thá»‘ng kÃª', 'warning');
//       }
      
//     } catch (error) {
//       console.error('âŒ Dashboard: Error loading stats:', error);
//       showNotification('Lá»—i khi táº£i thá»‘ng kÃª dashboard', 'error');
//     } finally {
//       setLoading(false);
//     }
//   };

//   const handleRefresh = async () => {
//     setLoading(true);
//     await loadStats();
//     showNotification('ÄÃ£ cáº­p nháº­t dá»¯ liá»‡u dashboard', 'success');
//   };

//   // âœ… DEBUG: Log current stats state
//   console.log('ğŸ¯ Dashboard render - Current stats:', stats);
//   console.log('ğŸ¯ Dashboard render - Loading:', loading);

//   if (loading) {
//     return <Loading fullScreen text="Äang táº£i dashboard..." />;
//   }

//   return (
//     <div className="dashboard-page">
//       {/* âœ… DEBUG INFO - Remove this after fixing */}
//       <div style={{ 
//         background: '#f8f9fa', 
//         border: '1px solid #dee2e6', 
//         borderRadius: '0.25rem', 
//         padding: '1rem', 
//         marginBottom: '1rem' 
//       }}>
//         <h6 className="text-muted mb-2">ğŸ› DEBUG INFO:</h6>
//         <small className="d-block">Raw stats: {JSON.stringify(stats)}</small>
//         <small className="d-block">Total Employees: {stats.totalEmployees}</small>
//         <small className="d-block">Active Employees: {stats.activeEmployees}</small>
//         <small className="d-block">Inactive Employees: {stats.inactiveEmployees}</small>
//       </div>

//       {/* Header */}
//       <div className="d-flex justify-content-between align-items-center mb-4">
//         <div>
//           <h1>Dashboard</h1>
//           <p className="text-muted mb-0">ChÃ o má»«ng trá»Ÿ láº¡i, {user?.fullName}!</p>
//         </div>
//         <button 
//           className="btn btn-outline-primary"
//           onClick={handleRefresh}
//           disabled={loading}
//         >
//           <i className={`fas fa-sync-alt me-2 ${loading ? 'fa-spin' : ''}`}></i>
//           LÃ m má»›i
//         </button>
//       </div>

//       {/* Stats Cards */}
//       <div className="row mb-4">
//         <div className="col-md-4 mb-3">
//           <div className="card text-center bg-primary text-white h-100">
//             <div className="card-body">
//               <i className="fas fa-users fa-3x mb-3"></i>
//               <h2 className="card-title" id="totalEmployees">
//                 {stats.totalEmployees || 0}
//               </h2>
//               <p className="card-text">Tá»•ng nhÃ¢n viÃªn</p>
//             </div>
//           </div>
//         </div>

//         <div className="col-md-4 mb-3">
//           <div className="card text-center bg-success text-white h-100">
//             <div className="card-body">
//               <i className="fas fa-user-check fa-3x mb-3"></i>
//               <h2 className="card-title" id="activeEmployees">
//                 {stats.activeEmployees || 0}
//               </h2>
//               <p className="card-text">NhÃ¢n viÃªn hoáº¡t Ä‘á»™ng</p>
//             </div>
//           </div>
//         </div>

//         <div className="col-md-4 mb-3">
//           <div className="card text-center bg-info text-white h-100">
//             <div className="card-body">
//               <i className="fas fa-user-times fa-3x mb-3"></i>
//               <h2 className="card-title" id="inactiveEmployees">
//                 {stats.inactiveEmployees || 0}
//               </h2>
//               <p className="card-text">NhÃ¢n viÃªn khÃ´ng hoáº¡t Ä‘á»™ng</p>
//             </div>
//           </div>
//         </div>
//       </div>

//       {/* Quick Actions */}
//       <div className="row">
//         <div className="col-12">
//           <div className="card">
//             <div className="card-header">
//               <h5 className="card-title mb-0">Truy cáº­p nhanh</h5>
//             </div>
//             <div className="card-body">
//               <div className="row">
//                 <div className="col-md-4 mb-3">
//                   <a href="/attendance-logs" className="btn btn-outline-info w-100 h-100 d-flex flex-column justify-content-center">
//                     <i className="fas fa-clock fa-2x mb-2"></i>
//                     <span>Xem cháº¥m cÃ´ng</span>
//                   </a>
//                 </div>

//                 {(user?.role === 'hr' || user?.role === 'admin') && (
//                   <>
//                     <div className="col-md-4 mb-3">
//                       <a href="/employee-management" className="btn btn-outline-primary w-100 h-100 d-flex flex-column justify-content-center">
//                         <i className="fas fa-users-cog fa-2x mb-2"></i>
//                         <span>Quáº£n lÃ½ nhÃ¢n viÃªn</span>
//                       </a>
//                     </div>
                    
//                     <div className="col-md-4 mb-3">
//                       <a href="/hr-dashboard" className="btn btn-outline-success w-100 h-100 d-flex flex-column justify-content-center">
//                         <i className="fas fa-chart-bar fa-2x mb-2"></i>
//                         <span>HR Dashboard</span>
//                       </a>
//                     </div>
//                   </>
//                 )}
//               </div>
//             </div>
//           </div>
//         </div>
//       </div>

//       {/* HR Functions */}
//       {(user?.role === 'hr' || user?.role === 'admin') && (
//         <div className="row mt-4">
//           <div className="col-12">
//             <div className="card">
//               <div className="card-body text-center">
//                 <h5>Chá»©c nÄƒng HR</h5>
//                 <p className="text-muted">Truy cáº­p cÃ¡c cÃ´ng cá»¥ dÃ nh cho HR</p>
//                 <a 
//                   href="https://forms.google.com/your-form-url" 
//                   target="_blank"
//                   rel="noopener noreferrer"
//                   className="btn btn-outline-success me-2"
//                 >
//                   <i className="fas fa-external-link-alt me-2"></i>
//                   Má»Ÿ Google Form tuyá»ƒn dá»¥ng
//                 </a>
//                 <a 
//                   href="/hr-dashboard" 
//                   className="btn btn-primary"
//                 >
//                   <i className="fas fa-chart-line me-2"></i>
//                   Xem bÃ¡o cÃ¡o HR
//                 </a>
//               </div>
//             </div>
//           </div>
//         </div>
//       )}
//     </div>
//   );
// };

// export default Dashboard;

```


==================== File: .\src\components\dashboard\HRDashboard.jsx ====================


```


==================== File: .\src\components\dashboard\StatsCard.jsx ====================


```


==================== File: .\src\components\employee\AddWorkHistoryModal.jsx ====================

// src/components/employee/AddWorkHistoryModal.jsx
import React, { useState } from 'react';
import { addWorkHistory } from '../../services/employee.js';
import { useNotification } from '../../hooks/useNotification';
import { ButtonLoading } from '../common/Loading';
import Modal from '../common/Modal';
import RecruitmentModal from './RecruitmentModal';

const AddWorkHistoryModal = ({ isOpen, onClose, employeeId, employeeName, onWorkHistoryAdded }) => {
  const [selectedRecruitment, setSelectedRecruitment] = useState(null);
  const [showRecruitmentModal, setShowRecruitmentModal] = useState(false);
  const [loading, setLoading] = useState(false);
  const { showNotification } = useNotification();

  const handleRecruitmentSelect = (recruitments) => {
    if (recruitments && recruitments.length > 0) {
      setSelectedRecruitment(recruitments[0]); // Chá»‰ chá»n 1
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!selectedRecruitment) {
      showNotification('Vui lÃ²ng chá»n Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng', 'error');
      return;
    }

    setLoading(true);
    
    try {
      const workHistoryData = {
        employeeId: employeeId,
        requestNo: selectedRecruitment.requestNo
      };

      const response = await addWorkHistory(workHistoryData);
      
      if (response.success) {
        showNotification('ThÃªm work history thÃ nh cÃ´ng!', 'success');
        onWorkHistoryAdded?.();
        onClose();
        setSelectedRecruitment(null);
      } else {
        showNotification(response.message || 'Lá»—i khi thÃªm work history', 'error');
      }
      
    } catch (error) {
      console.error('âŒ Error adding work history:', error);
      showNotification(error.message || 'Lá»—i káº¿t ná»‘i Ä‘áº¿n server. Vui lÃ²ng thá»­ láº¡i.', 'error');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <>
      <Modal 
        isOpen={isOpen} 
        onClose={onClose}
        title={`ThÃªm Work History - ${employeeName || employeeId}`}
        size="md"
      >
        <form onSubmit={handleSubmit}>
          <div className="mb-3">
            <label className="form-label">MÃ£ nhÃ¢n viÃªn</label>
            <input
              type="text"
              className="form-control"
              value={employeeId}
              disabled
            />
          </div>

          <div className="mb-3">
            <label className="form-label">Äá» xuáº¥t tuyá»ƒn dá»¥ng *</label>
            
            <div className="d-flex align-items-center gap-2 mb-2">
              <button
                type="button"
                className="btn btn-outline-primary"
                onClick={() => setShowRecruitmentModal(true)}
              >
                <i className="fas fa-plus me-2"></i>
                Chá»n Ä‘á» xuáº¥t
              </button>
              
              {selectedRecruitment && (
                <span className="badge bg-success">
                  <i className="fas fa-check me-1"></i>
                  ÄÃ£ chá»n
                </span>
              )}
            </div>

            {selectedRecruitment && (
              <div className="mt-2">
                <div className="card">
                  <div className="card-body py-2">
                    <div className="d-flex justify-content-between align-items-center">
                      <div>
                        <strong>{selectedRecruitment.requestNo}</strong> - {selectedRecruitment.department}
                        <br />
                        <small className="text-muted">
                          {selectedRecruitment.quantity} ngÆ°á»i â€¢ {selectedRecruitment.gender}
                        </small>
                      </div>
                      <button
                        type="button"
                        className="btn btn-outline-danger btn-sm"
                        onClick={() => setSelectedRecruitment(null)}
                      >
                        <i className="fas fa-times"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>

          <div className="d-flex gap-2 justify-content-end">
            <button type="button" className="btn btn-secondary" onClick={onClose}>
              Há»§y
            </button>
            <ButtonLoading
              type="submit"
              className="btn btn-primary"
              loading={loading}
              disabled={loading || !selectedRecruitment}
            >
              {loading ? 'Äang thÃªm...' : 'ThÃªm Work History'}
            </ButtonLoading>
          </div>
        </form>
      </Modal>

      {showRecruitmentModal && (
        <RecruitmentModal
          isOpen={showRecruitmentModal}
          onClose={() => setShowRecruitmentModal(false)}
          onRecruitmentSelected={handleRecruitmentSelect}
          selectedRecruitment={selectedRecruitment}
          singleSelect={true}
        />
      )}
    </>
  );
};

export default AddWorkHistoryModal;

```


==================== File: .\src\components\employee\EmployeeAddForm.jsx ====================

// src/components/employee/EmployeeAddForm.jsx

import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
// âœ… Sá»¬A: Import employeeService thay vÃ¬ api trá»±c tiáº¿p
import { employeeService } from '../../services/employee';
import { useNotification } from '../../hooks/useNotification';
import RecruitmentModal from './RecruitmentModal';

const EmployeeAddForm = () => {
    const navigate = useNavigate();
    const { showNotification } = useNotification();
    
    // State cho Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng (chá»‰ má»™t Ä‘á» xuáº¥t duy nháº¥t)
    const [selectedRecruitment, setSelectedRecruitment] = useState(null); 
    const [isModalOpen, setIsModalOpen] = useState(false);
    
    // State cho form data nhÃ¢n viÃªn
    const [formData, setFormData] = useState({
        fullName: '',
        phoneNumber: '',
        gender: 'Nam',
        hourlyRate: '',
        bankAccount: '',
        bankName: '',
    });

    const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    // Xá»­ lÃ½ khi chá»n Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng
    const handleSelectRecruitment = (request) => {
        setSelectedRecruitment(request); // Ghi Ä‘Ã¨ lÃªn lá»±a chá»n cÅ©
        setIsModalOpen(false);
    };

    // XÃ³a Ä‘á» xuáº¥t Ä‘Ã£ chá»n
    const handleRemoveRecruitment = () => {
        setSelectedRecruitment(null);
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        
        if (!selectedRecruitment) {
            showNotification('Vui lÃ²ng chá»n má»™t Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng.', 'warning');
            return;
        }

        const payload = {
            ...formData,
            hourlyRate: parseFloat(formData.hourlyRate),
            // Backend yÃªu cáº§u workHistoryData lÃ  má»™t máº£ng
            workHistoryData: [{
                requestNo: selectedRecruitment.requestNo
            }]
        };

        try {
            console.log('ğŸ” COMPONENT: Calling employeeService.create with:', payload);
            
            // âœ… Sá»¬A: Sá»­ dá»¥ng employeeService.create thay vÃ¬ api.post
            const response = await employeeService.create(payload);
            
            console.log('âœ… COMPONENT: Response received:', response);
            
            if (response.success) {
                showNotification('ThÃªm nhÃ¢n viÃªn má»›i thÃ nh cÃ´ng!', 'success');
                navigate('/employees');
            } else {
                showNotification(response.message || 'CÃ³ lá»—i xáº£y ra.', 'error');
            }
        } catch (error) {
            console.error('âŒ COMPONENT: Error:', error);
            const errorMessage = error.response?.data?.message || 'Lá»—i há»‡ thá»‘ng, khÃ´ng thá»ƒ thÃªm nhÃ¢n viÃªn.';
            showNotification(errorMessage, 'error');
        }
    };

    return (
        <div className="card">
            <div className="card-header">
                <h4 className="card-title">ThÃªm NhÃ¢n viÃªn Má»›i</h4>
            </div>
            <div className="card-body">
                <form onSubmit={handleSubmit}>
                    {/* PHáº¦N THÃ”NG TIN CÃ NHÃ‚N */}
                    <h5 className="mb-3">ThÃ´ng tin CÃ¡ nhÃ¢n</h5>
                    <div className="row">
                        <div className="col-md-6 mb-3">
                            <label htmlFor="fullName" className="form-label">
                                Há» tÃªn <span className="text-danger">*</span>
                            </label>
                            <input 
                                type="text" 
                                className="form-control" 
                                id="fullName" 
                                name="fullName" 
                                value={formData.fullName} 
                                onChange={handleChange} 
                                required 
                                placeholder="Nháº­p há» tÃªn Ä‘áº§y Ä‘á»§"
                            />
                        </div>
                        <div className="col-md-6 mb-3">
                            <label htmlFor="phoneNumber" className="form-label">
                                Sá»‘ Ä‘iá»‡n thoáº¡i <span className="text-danger">*</span>
                            </label>
                            <input 
                                type="tel" 
                                className="form-control" 
                                id="phoneNumber" 
                                name="phoneNumber" 
                                value={formData.phoneNumber} 
                                onChange={handleChange} 
                                required 
                                placeholder="VÃ­ dá»¥: 0123456789"
                            />
                        </div>
                    </div>
                    
                    <div className="row">
                        <div className="col-md-6 mb-3">
                            <label htmlFor="gender" className="form-label">
                                Giá»›i tÃ­nh <span className="text-danger">*</span>
                            </label>
                            <select 
                                className="form-select" 
                                id="gender" 
                                name="gender" 
                                value={formData.gender} 
                                onChange={handleChange} 
                                required
                            >
                                <option value="Nam">Nam</option>
                                <option value="Ná»¯">Ná»¯</option>
                            </select>
                        </div>
                        <div className="col-md-6 mb-3">
                            <label htmlFor="hourlyRate" className="form-label">
                                Má»©c lÆ°Æ¡ng/giá» (VNÄ) <span className="text-danger">*</span>
                            </label>
                            <input 
                                type="number" 
                                className="form-control" 
                                id="hourlyRate" 
                                name="hourlyRate" 
                                value={formData.hourlyRate} 
                                onChange={handleChange} 
                                required 
                                min="0" 
                                step="1000"
                                placeholder="VÃ­ dá»¥: 50000"
                            />
                        </div>
                    </div>

                    {/* PHáº¦N THÃ”NG TIN NGÃ‚N HÃ€NG */}
                    <h5 className="mb-3 mt-4">ThÃ´ng tin NgÃ¢n hÃ ng</h5>
                    <div className="row">
                        <div className="col-md-6 mb-3">
                            <label htmlFor="bankAccount" className="form-label">
                                Sá»‘ tÃ i khoáº£n <span className="text-danger">*</span>
                            </label>
                            <input 
                                type="text" 
                                className="form-control" 
                                id="bankAccount" 
                                name="bankAccount" 
                                value={formData.bankAccount} 
                                onChange={handleChange} 
                                required 
                                placeholder="Nháº­p sá»‘ tÃ i khoáº£n ngÃ¢n hÃ ng"
                            />
                        </div>
                        <div className="col-md-6 mb-3">
                            <label htmlFor="bankName" className="form-label">
                                TÃªn ngÃ¢n hÃ ng <span className="text-danger">*</span>
                            </label>
                            <input 
                                type="text" 
                                className="form-control" 
                                id="bankName" 
                                name="bankName" 
                                value={formData.bankName} 
                                onChange={handleChange} 
                                required 
                                placeholder="VÃ­ dá»¥: Vietcombank, Techcombank..."
                            />
                        </div>
                    </div>

                    <hr />
                    
                    {/* PHáº¦N Äá»€ XUáº¤T TUYá»‚N Dá»¤NG */}
                    <h5 className="mb-3">ThÃ´ng tin Tuyá»ƒn dá»¥ng</h5>
                    
                    {selectedRecruitment ? (
                        <div className="alert alert-info d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Äá» xuáº¥t Ä‘Ã£ chá»n:</strong> {selectedRecruitment.requestNo} <br />
                                <small className="text-muted">
                                    PhÃ²ng ban: {selectedRecruitment.department} - Vá»‹ trÃ­: {selectedRecruitment.position || 'ChÆ°a xÃ¡c Ä‘á»‹nh'}
                                </small>
                            </div>
                            <button 
                                type="button" 
                                className="btn-close" 
                                onClick={handleRemoveRecruitment} 
                                aria-label="XÃ³a"
                                title="XÃ³a Ä‘á» xuáº¥t Ä‘Ã£ chá»n"
                            ></button>
                        </div>
                    ) : (
                        <div className="alert alert-warning">
                            <i className="fas fa-exclamation-triangle me-2"></i>
                            ChÆ°a chá»n Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng. Vui lÃ²ng chá»n má»™t Ä‘á» xuáº¥t.
                        </div>
                    )}

                    <button
                        type="button"
                        className={`btn ${selectedRecruitment ? 'btn-outline-secondary' : 'btn-outline-primary'}`}
                        onClick={() => setIsModalOpen(true)}
                        disabled={!!selectedRecruitment}
                    >
                        <i className="fas fa-search me-2"></i>
                        {selectedRecruitment ? 'ÄÃ£ chá»n Ä‘á» xuáº¥t' : 'Chá»n Äá» xuáº¥t Tuyá»ƒn dá»¥ng'}
                    </button>
                    
                    {/* BUTTONS */}
                    <div className="mt-4 d-flex gap-2">
                        <button type="submit" className="btn btn-primary">
                            <i className="fas fa-save me-2"></i>
                            LÆ°u NhÃ¢n viÃªn
                        </button>
                        <button 
                            type="button" 
                            className="btn btn-light" 
                            onClick={() => navigate('/employees')}
                        >
                            <i className="fas fa-times me-2"></i>
                            Há»§y
                        </button>
                    </div>
                </form>
            </div>

            {/* MODAL CHá»ŒN Äá»€ XUáº¤T */}
            <RecruitmentModal
                isOpen={isModalOpen}
                onClose={() => setIsModalOpen(false)}
                onRecruitmentSelected={handleSelectRecruitment}
            />
        </div>
    );
};

export default EmployeeAddForm;

```


==================== File: .\src\components\employee\EmployeeEditModal.jsx ====================

// src/components/employee/EmployeeEditModal.jsx

import React, { useState, useEffect } from 'react';
// âœ… Sá»¬A 1: Import cáº£ object `employeeService` thay vÃ¬ tá»«ng hÃ m láº»
import { employeeService } from '../../services/employee.js';
import { useNotification } from '../../hooks/useNotification';
import Modal from '../common/Modal.jsx';

// Component nÃ y chá»‰ nháº­n props vÃ  gá»i hÃ m `onSave` tá»« page cha
// NÃ³ khÃ´ng cáº§n biáº¿t logic update Ä‘áº¿n tá»« Ä‘Ã¢u
const EmployeeEditModal = ({ isOpen, onClose, onSave, employee }) => {
  const [formData, setFormData] = useState({});
  const [loading, setLoading] = useState(false);
  const { showNotification } = useNotification();

  useEffect(() => {
    if (employee) {
      setFormData({
        fullName: employee.fullName || '',
        phoneNumber: employee.phoneNumber || '',
        gender: employee.gender || '',
        hourlyRate: employee.hourlyRate || '',
        bankAccount: employee.bankAccount || '',
        bankName: employee.bankName || '',
        status: employee.status || 'active',
      });
    }
  }, [employee]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    // âœ… Sá»¬A 2: Gá»i hÃ m onSave Ä‘Æ°á»£c truyá»n tá»« page cha,
    // page cha (EmployeeManagementPage) sáº½ gá»i hook useEmployees Ä‘á»ƒ update
    await onSave(formData);
    setLoading(false);
  };

  if (!isOpen) return null;

  return (
    <Modal
      isOpen={isOpen}
      onClose={onClose}
      title={`Chá»‰nh sá»­a: ${employee.fullName}`}
    >
      <form onSubmit={handleSubmit}>
        {/* CÃ¡c trÆ°á»ng input trong form giá»¯ nguyÃªn */}
        <div className="row">
          <div className="col-md-6 mb-3">
            <label className="form-label">Há» tÃªn</label>
            <input name="fullName" value={formData.fullName} onChange={handleChange} className="form-control" />
          </div>
          <div className="col-md-6 mb-3">
            <label className="form-label">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
            <input name="phoneNumber" value={formData.phoneNumber} onChange={handleChange} className="form-control" />
          </div>
        </div>
        <div className="row">
          <div className="col-md-6 mb-3">
            <label className="form-label">Giá»›i tÃ­nh</label>
            <select name="gender" value={formData.gender} onChange={handleChange} className="form-select">
              <option value="Nam">Nam</option>
              <option value="Ná»¯">Ná»¯</option>
            </select>
          </div>
          <div className="col-md-6 mb-3">
            <label className="form-label">LÆ°Æ¡ng/giá»</label>
            <input type="number" name="hourlyRate" value={formData.hourlyRate} onChange={handleChange} className="form-control" />
          </div>
        </div>
        <div className="row">
          <div className="col-md-6 mb-3">
            <label className="form-label">Sá»‘ tÃ i khoáº£n</label>
            <input name="bankAccount" value={formData.bankAccount} onChange={handleChange} className="form-control" />
          </div>
          <div className="col-md-6 mb-3">
            <label className="form-label">NgÃ¢n hÃ ng</label>
            <input name="bankName" value={formData.bankName} onChange={handleChange} className="form-control" />
          </div>
        </div>
        <div className="mb-3">
          <label className="form-label">Tráº¡ng thÃ¡i</label>
          <select name="status" value={formData.status} onChange={handleChange} className="form-select">
            <option value="active">Hoáº¡t Ä‘á»™ng</option>
            <option value="inactive">NgÆ°ng hoáº¡t Ä‘á»™ng</option>
          </select>
        </div>
        <div className="modal-footer">
          <button type="button" className="btn btn-secondary" onClick={onClose}>Há»§y</button>
          <button type="submit" className="btn btn-primary" disabled={loading}>
            {loading ? 'Äang lÆ°u...' : 'LÆ°u thay Ä‘á»•i'}
          </button>
        </div>
      </form>
    </Modal>
  );
};

export default EmployeeEditModal;

```


==================== File: .\src\components\employee\EmployeeForm.jsx ====================

// src/components/employee/EmployeeForm.jsx

import React, { useState, useEffect } from 'react';

const EmployeeForm = ({ initialData, onSubmit, onCancel, isLoading }) => {
  const [formData, setFormData] = useState(initialData);

  useEffect(() => {
    setFormData(initialData);
  }, [initialData]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    onSubmit(formData);
  };

  return (
    <form onSubmit={handleSubmit}>
      <div className="row">
        <div className="col-md-6 mb-3">
          <label className="form-label">Há» tÃªn</label>
          <input name="fullName" value={formData.fullName} onChange={handleChange} className="form-control" required />
        </div>
        <div className="col-md-6 mb-3">
          <label className="form-label">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
          <input name="phoneNumber" value={formData.phoneNumber} onChange={handleChange} className="form-control" required />
        </div>
      </div>
      <div className="row">
        <div className="col-md-6 mb-3">
          <label className="form-label">Giá»›i tÃ­nh</label>
          <select name="gender" value={formData.gender} onChange={handleChange} className="form-select">
            <option value="Nam">Nam</option>
            <option value="Ná»¯">Ná»¯</option>
          </select>
        </div>
        <div className="col-md-6 mb-3">
          <label className="form-label">LÆ°Æ¡ng/giá»</label>
          <input type="number" name="hourlyRate" value={formData.hourlyRate} onChange={handleChange} className="form-control" required />
        </div>
      </div>
      <div className="row">
        <div className="col-md-6 mb-3">
          <label className="form-label">Sá»‘ tÃ i khoáº£n</label>
          <input name="bankAccount" value={formData.bankAccount} onChange={handleChange} className="form-control" />
        </div>
        <div className="col-md-6 mb-3">
          <label className="form-label">NgÃ¢n hÃ ng</label>
          <input name="bankName" value={formData.bankName} onChange={handleChange} className="form-control" />
        </div>
      </div>
      <div className="mb-3">
        <label className="form-label">Tráº¡ng thÃ¡i</label>
        <select name="status" value={formData.status} onChange={handleChange} className="form-select">
          <option value="active">Hoáº¡t Ä‘á»™ng</option>
          <option value="inactive">NgÆ°ng hoáº¡t Ä‘á»™ng</option>
        </select>
      </div>
      <div className="modal-footer">
        <button type="button" className="btn btn-secondary" onClick={onCancel} disabled={isLoading}>Há»§y</button>
        <button type="submit" className="btn btn-primary" disabled={isLoading}>
          {isLoading ? 'Äang lÆ°u...' : 'LÆ°u'}
        </button>
      </div>
    </form>
  );
};

export default EmployeeForm;

```


==================== File: .\src\components\employee\EmployeeList.jsx ====================

import React, { useState, useEffect } from 'react';
import { ApiClient } from '../../services/api';
import { useNotification } from '../../hooks/useNotification';
import EmployeeTable from './EmployeeTable';
import Loading from '../common/Loading';

const EmployeeList = () => {
  const [employees, setEmployees] = useState([]);
  const [filteredEmployees, setFilteredEmployees] = useState([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState('');
  const { showNotification } = useNotification();

  useEffect(() => {
    loadEmployees();
  }, []);

  useEffect(() => {
    filterEmployees();
  }, [employees, searchTerm, statusFilter]);

  const loadEmployees = async () => {
    try {
      setLoading(true);
      console.log('ğŸ” FRONTEND: Starting loadEmployees...');
      
      const response = await ApiClient.get('/api/employees');
      
      // ğŸš¨ DEBUG: In ra toÃ n bá»™ response Ä‘á»ƒ xem cáº¥u trÃºc
      console.log('ğŸ” RAW RESPONSE FROM BACKEND:', response);
      console.log('ğŸ” Response type:', typeof response);
      console.log('ğŸ” Response keys:', Object.keys(response || {}));
      
      // Kiá»ƒm tra tá»«ng thuá»™c tÃ­nh
      if (response?.data) {
        console.log('ğŸ” response.data:', response.data);
        console.log('ğŸ” response.data type:', typeof response.data);
        console.log('ğŸ” response.data is Array:', Array.isArray(response.data));
        
        if (Array.isArray(response.data) && response.data.length > 0) {
          console.log('ğŸ” First employee in response.data:', response.data[0]);
          console.log('ğŸ” First employee keys:', Object.keys(response.data[0] || {}));
        }
      }
      
      if (response?.success) {
        console.log('ğŸ” response.success:', response.success);
      }
      
      // Xá»­ lÃ½ dá»¯ liá»‡u dá»±a trÃªn cáº¥u trÃºc response
      let employeeData = [];
      
      if (response && response.success && Array.isArray(response.data)) {
        // TrÆ°á»ng há»£p API tráº£ vá» { success: true, data: [...] }
        employeeData = response.data;
        console.log('âœ… Using response.data (structured format)');
      } else if (Array.isArray(response)) {
        // TrÆ°á»ng há»£p API tráº£ vá» trá»±c tiáº¿p array
        employeeData = response;
        console.log('âœ… Using response directly (array format)');
      } else if (response && Array.isArray(response.employees)) {
        // TrÆ°á»ng há»£p API tráº£ vá» { employees: [...] }
        employeeData = response.employees;
        console.log('âœ… Using response.employees');
      } else {
        console.warn('âš ï¸ Unknown response format, using empty array');
        employeeData = [];
      }
      
      console.log('ğŸ” Final employeeData to set:', employeeData);
      console.log('ğŸ” Final employeeData length:', employeeData.length);
      
      setEmployees(employeeData);
      
    } catch (error) {
      console.error('âŒ Error loading employees:', error);
      console.error('âŒ Error details:', {
        message: error.message,
        response: error.response?.data,
        status: error.response?.status
      });
      
      // Set empty array on error
      setEmployees([]);
      showNotification('Lá»—i khi táº£i danh sÃ¡ch nhÃ¢n viÃªn', 'error');
    } finally {
      setLoading(false);
    }
  };

  const filterEmployees = () => {
    // Äáº£m báº£o employees luÃ´n lÃ  array trÆ°á»›c khi filter
    const safeEmployees = Array.isArray(employees) ? employees : [];
    let filtered = safeEmployees;

    if (searchTerm) {
      filtered = filtered.filter(employee => {
        // Safe check cho tá»«ng property
        const fullName = employee?.fullName || '';
        const employeeId = employee?.employeeId || '';
        const phoneNumber = employee?.phoneNumber || '';
        
        return (
          fullName.toLowerCase().includes(searchTerm.toLowerCase()) ||
          employeeId.toLowerCase().includes(searchTerm.toLowerCase()) ||
          phoneNumber.includes(searchTerm)
        );
      });
    }

    if (statusFilter) {
      filtered = filtered.filter(employee => employee?.status === statusFilter);
    }

    setFilteredEmployees(filtered);
  };

  const handleEdit = async (employeeId) => {
    // TODO: Implement edit functionality
    console.log('Edit employee:', employeeId);
    showNotification('Chá»©c nÄƒng chá»‰nh sá»­a Ä‘ang Ä‘Æ°á»£c phÃ¡t triá»ƒn', 'info');
  };

  const handleDelete = async (employeeId) => {
    const employee = employees.find(emp => emp?.id === employeeId);
    if (!employee) return;

    const confirmed = window.confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a nhÃ¢n viÃªn "${employee.fullName || 'N/A'}"?`);
    if (!confirmed) return;

    try {
      await ApiClient.delete(`/api/employees/${employeeId}`);
      
      // Remove from local state
      setEmployees(employees.filter(emp => emp?.id !== employeeId));
      showNotification('XÃ³a nhÃ¢n viÃªn thÃ nh cÃ´ng', 'success');
      
    } catch (error) {
      console.error('Error deleting employee:', error);
      showNotification('Lá»—i khi xÃ³a nhÃ¢n viÃªn', 'error');
    }
  };

  const handleAddWorkHistory = (employeeId, employeeName) => {
    // TODO: Implement add work history functionality
    console.log('Add work history for:', employeeId, employeeName);
    showNotification('Chá»©c nÄƒng thÃªm work history Ä‘ang Ä‘Æ°á»£c phÃ¡t triá»ƒn', 'info');
  };

  const handleViewWorkHistory = (employeeId) => {
    // TODO: Implement view work history functionality
    console.log('View work history for:', employeeId);
    showNotification('Chá»©c nÄƒng xem work history Ä‘ang Ä‘Æ°á»£c phÃ¡t triá»ƒn', 'info');
  };

  const handleRefresh = async () => {
    await loadEmployees();
    showNotification('ÄÃ£ lÃ m má»›i danh sÃ¡ch nhÃ¢n viÃªn', 'success');
  };

  if (loading) {
    return <Loading text="Äang táº£i danh sÃ¡ch nhÃ¢n viÃªn..." />;
  }

  return (
    <div className="employee-list">
      {/* Search and Filter Controls */}
      <div className="row mb-3">
        <div className="col-md-8">
          <input
            type="text"
            className="form-control"
            placeholder="TÃ¬m kiáº¿m nhÃ¢n viÃªn (tÃªn, mÃ£ NV, sá»‘ ÄT)..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            id="employeeSearch"
          />
        </div>
        <div className="col-md-3">
          <select
            className="form-select"
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            id="employeeStatusFilter"
          >
            <option value="">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
            <option value="active">Hoáº¡t Ä‘á»™ng</option>
            <option value="inactive">NgÆ°ng hoáº¡t Ä‘á»™ng</option>
          </select>
        </div>
        <div className="col-md-1">
          <button 
            className="btn btn-outline-secondary"
            onClick={handleRefresh}
            title="LÃ m má»›i"
          >
            <i className="fas fa-sync-alt"></i>
          </button>
        </div>
      </div>

      {/* Employee Count */}
      <div className="mb-3">
        <small className="text-muted">
          Hiá»ƒn thá»‹ {filteredEmployees.length} / {employees.length} nhÃ¢n viÃªn
        </small>
      </div>

      {/* Debug Info - Remove this in production */}
      <div className="mb-3 p-2 bg-light border rounded">
        <small className="text-muted">
          <strong>DEBUG:</strong> employees type: {typeof employees}, isArray: {Array.isArray(employees).toString()}, length: {Array.isArray(employees) ? employees.length : 'N/A'}
        </small>
      </div>

      {/* Employee Table */}
      <EmployeeTable
        employees={filteredEmployees}
        onEdit={handleEdit}
        onDelete={handleDelete}
        onAddWorkHistory={handleAddWorkHistory}
        onViewWorkHistory={handleViewWorkHistory}
      />
    </div>
  );
};

export default EmployeeList;

```


==================== File: .\src\components\employee\EmployeeTable.jsx ====================

import React from 'react';

const EmployeeTable = ({ 
  employees, 
  onEdit, 
  onDelete, 
  onAddWorkHistory, 
  onViewWorkHistory 
}) => {
  // Kiá»ƒm tra vÃ  Ä‘áº£m báº£o employees luÃ´n lÃ  array
  const employeeList = React.useMemo(() => {
    if (!employees) {
      return [];
    }
    
    // Náº¿u employees lÃ  object cÃ³ data property (tá»« API response)
    if (employees.data && Array.isArray(employees.data)) {
      return employees.data;
    }
    
    // Náº¿u employees Ä‘Ã£ lÃ  array
    if (Array.isArray(employees)) {
      return employees;
    }
    
    // Fallback: tráº£ vá» empty array
    console.warn('EmployeeTable: employees prop is not an array:', typeof employees, employees);
    return [];
  }, [employees]);

  if (!employeeList || employeeList.length === 0) {
    return (
      <div className="text-center py-4">
        <i className="fas fa-users fa-3x text-muted mb-3"></i>
        <p className="text-muted">KhÃ´ng cÃ³ nhÃ¢n viÃªn nÃ o</p>
      </div>
    );
  }

  return (
    <div className="table-responsive">
      <table className="table table-striped table-hover">
        <thead className="table-dark">
          <tr>
            <th>MÃ£ NV</th>
            <th>Há» tÃªn</th>
            <th>Sá»‘ ÄT</th>
            <th>Giá»›i tÃ­nh</th>
            <th>LÆ°Æ¡ng/giá»</th>
            <th>TÃ i khoáº£n</th>
            <th>NgÃ¢n hÃ ng</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th>Thao tÃ¡c</th>
          </tr>
        </thead>
        <tbody id="employeeTableBody">
          {employeeList.map((employee, index) => {
            // Äáº£m báº£o má»—i employee cÃ³ Ä‘á»§ thuá»™c tÃ­nh
            const safeEmployee = {
              id: employee?.id || `emp_${index}`,
              employeeId: employee?.employeeId || 'N/A',
              fullName: employee?.fullName || 'N/A',
              phoneNumber: employee?.phoneNumber || 'N/A',
              gender: employee?.gender || 'N/A',
              hourlyRate: employee?.hourlyRate || 0,
              bankAccount: employee?.bankAccount || 'N/A',
              bankName: employee?.bankName || 'N/A',
              status: employee?.status || 'inactive'
            };

            return (
              <tr key={safeEmployee.id}>
                <td>{safeEmployee.employeeId}</td>
                <td>{safeEmployee.fullName}</td>
                <td>{safeEmployee.phoneNumber}</td>
                <td>{safeEmployee.gender}</td>
                <td>
                  {safeEmployee.hourlyRate && safeEmployee.hourlyRate > 0
                    ? safeEmployee.hourlyRate.toLocaleString('vi-VN') + ' VNÄ'
                    : 'N/A'
                  }
                </td>
                <td>{safeEmployee.bankAccount}</td>
                <td>{safeEmployee.bankName}</td>
                <td>
                  <span className={`badge ${
                    safeEmployee.status === 'active' 
                      ? 'bg-success' 
                      : 'bg-secondary'
                  }`}>
                    {safeEmployee.status === 'active' 
                      ? 'Hoáº¡t Ä‘á»™ng' 
                      : 'NgÆ°ng hoáº¡t Ä‘á»™ng'
                    }
                  </span>
                </td>
                <td>
                  <div className="btn-group" role="group">
                    {onAddWorkHistory && (
                      <button
                        className="btn btn-sm btn-success"
                        onClick={() => onAddWorkHistory(safeEmployee.employeeId, safeEmployee.fullName)}
                        title="ThÃªm work history"
                      >
                        <i className="fas fa-plus"></i>
                      </button>
                    )}
                    
                    {onViewWorkHistory && (
                      <button
                        className="btn btn-sm btn-info"
                        onClick={() => onViewWorkHistory(safeEmployee.employeeId)}
                        title="Xem lá»‹ch sá»­"
                      >
                        <i className="fas fa-history"></i>
                      </button>
                    )}
                    
                    {onEdit && (
                      <button
                        className="btn btn-sm btn-primary"
                        onClick={() => onEdit(safeEmployee.id)}
                        title="Chá»‰nh sá»­a"
                      >
                        <i className="fas fa-edit"></i>
                      </button>
                    )}
                    
                    {onDelete && (
                      <button
                        className="btn btn-sm btn-danger"
                        onClick={() => {
                          if (window.confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a nhÃ¢n viÃªn "${safeEmployee.fullName}"?`)) {
                            onDelete(safeEmployee.id);
                          }
                        }}
                        title="XÃ³a"
                      >
                        <i className="fas fa-trash"></i>
                      </button>
                    )}
                  </div>
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
};

export default EmployeeTable;

```


==================== File: .\src\components\employee\RecruitmentModal.jsx ====================

// src/components/employee/RecruitmentModal.jsx
import React, { useState, useEffect } from 'react';
import { employeeService } from '../../services/employee';
import { useNotification } from '../../hooks/useNotification';
import Loading from '../common/Loading';

const RecruitmentModal = ({ isOpen, onClose, onRecruitmentSelected, selectedRecruitment = null }) => {
  const [recruitmentRequests, setRecruitmentRequests] = useState([]);
  const [loading, setLoading] = useState(false);
  const [selectedItem, setSelectedItem] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const { showNotification } = useNotification();

  useEffect(() => {
    if (isOpen) {
      loadRecruitmentRequests();
      // Set selected item tá»« props
      setSelectedItem(selectedRecruitment);
    }
  }, [isOpen, selectedRecruitment]);

  // âœ… THÃŠM: Helper function Ä‘á»ƒ extract requestNo tá»« structure phá»©c táº¡p
  const extractRequestNo = (requestNoData) => {
    if (!requestNoData) return '';
    
    console.log('ğŸ” RECRUITMENT MODAL: extractRequestNo input:', requestNoData);
    console.log('ğŸ” RECRUITMENT MODAL: requestNoData type:', typeof requestNoData);
    
    // Náº¿u lÃ  object vá»›i structure { "link": "...", "text": "202507140017" }
    if (typeof requestNoData === 'object' && requestNoData !== null) {
      if (requestNoData.text) {
        console.log('ğŸ” RECRUITMENT MODAL: Found text property:', requestNoData.text);
        return requestNoData.text;
      }
      
      // Náº¿u lÃ  object nhÆ°ng cÃ³ key khÃ¡c
      if (requestNoData.value) {
        console.log('ğŸ” RECRUITMENT MODAL: Found value property:', requestNoData.value);
        return requestNoData.value;
      }
      
      // Náº¿u object cÃ³ toString() method
      console.log('ğŸ” RECRUITMENT MODAL: Converting object to string');
      return requestNoData.toString();
    }
    
    // Náº¿u lÃ  string trá»±c tiáº¿p
    if (typeof requestNoData === 'string') {
      console.log('ğŸ” RECRUITMENT MODAL: Direct string:', requestNoData);
      return requestNoData;
    }
    
    // Fallback
    console.log('ğŸ” RECRUITMENT MODAL: Using fallback conversion');
    return requestNoData?.toString() || '';
  };

  // âœ… THÃŠM: Helper function Ä‘á»ƒ extract tÃªn ngÆ°á»i yÃªu cáº§u
  const extractRequesterName = (requesterData) => {
    if (!requesterData) return '';
    
    console.log('ğŸ” RECRUITMENT MODAL: extractRequesterName input:', requesterData);
    
    // Náº¿u lÃ  array [{ "name": "236LH.Nguyá»…n Huy ThÃ nh", ... }]
    if (Array.isArray(requesterData)) {
      return requesterData.map(user => 
        user.name || user.en_name || user.id || 'Unknown'
      ).join(', ');
    }
    
    // Náº¿u lÃ  object { "name": "236LH.Nguyá»…n Huy ThÃ nh", ... }
    if (typeof requesterData === 'object' && requesterData !== null) {
      return requesterData.name || requesterData.en_name || requesterData.id || 'Unknown';
    }
    
    // Náº¿u lÃ  string trá»±c tiáº¿p
    return requesterData.toString();
  };

  const loadRecruitmentRequests = async () => {
    try {
      setLoading(true);
      console.log('ğŸ” RECRUITMENT MODAL: Loading recruitment requests...');
      
      const response = await employeeService.getApprovedRecruitmentRequests();
      console.log('ğŸ” RECRUITMENT MODAL: Raw API response:', response);
      
      if (response.success && Array.isArray(response.data)) {
        // âœ… THÃŠM: Process data Ä‘á»ƒ extract requestNo vÃ  requester Ä‘Ãºng cÃ¡ch
        const processedData = response.data.map((item, index) => {
          console.log(`ğŸ” RECRUITMENT MODAL: Processing item ${index}:`, item);
          
          const processedItem = {
            ...item,
            requestNo: extractRequestNo(item.requestNo),
            requester: extractRequesterName(item.requester)
          };
          
          console.log(`ğŸ” RECRUITMENT MODAL: Processed item ${index}:`, processedItem);
          return processedItem;
        });
        
        console.log('ğŸ” RECRUITMENT MODAL: Final processed data:', processedData);
        setRecruitmentRequests(processedData);
        
        // Debug first item
        if (processedData.length > 0) {
          console.log('ğŸ” RECRUITMENT MODAL: First item structure:', processedData[0]);
          console.log('ğŸ” RECRUITMENT MODAL: First item requestNo type:', typeof processedData[0].requestNo);
          console.log('ğŸ” RECRUITMENT MODAL: First item requestNo value:', processedData[0].requestNo);
        }
        
      } else {
        throw new Error(response.message || 'Lá»—i khi táº£i dá»¯ liá»‡u');
      }
    } catch (error) {
      console.error('âŒ RECRUITMENT MODAL: Error loading recruitment requests:', error);
      showNotification('Lá»—i khi táº£i dá»¯ liá»‡u tuyá»ƒn dá»¥ng. Sá»­ dá»¥ng dá»¯ liá»‡u máº«u.', 'warning');
      setRecruitmentRequests(getMockData());
    } finally {
      setLoading(false);
    }
  };

  const getMockData = () => {
    return [
      {
        id: '1',
        requestNo: '202507140017',
        requester: '236LH.Nguyá»…n Huy ThÃ nh',
        status: 'Äang tuyá»ƒn dá»¥ng',
        department: '116 Cáº§u Giáº¥y',
        quantity: '2',
        gender: 'Nam/Ná»¯',
        fromDate: '2025-07-14',
        toDate: '2025-08-14',
        position: 'NhÃ¢n viÃªn bÃ¡n hÃ ng'
      },
      {
        id: '2',
        requestNo: '202507140018',
        requester: '225VVN.Nguyá»…n Trá»ng HoÃ ng An',
        status: 'Äang tuyá»ƒn dá»¥ng', 
        department: 'TrÃ¢m Trá»—i',
        quantity: '1',
        gender: 'Ná»¯',
        fromDate: '2025-07-14',
        toDate: '2025-08-14',
        position: 'Thu ngÃ¢n'
      }
    ];
  };

  const filteredData = recruitmentRequests.filter(item =>
    item.requestNo?.toLowerCase().includes(searchTerm.toLowerCase()) ||
    item.department?.toLowerCase().includes(searchTerm.toLowerCase()) ||
    item.requester?.toLowerCase().includes(searchTerm.toLowerCase()) ||
    item.position?.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // Handle single selection
  const handleItemSelect = (item) => {
    console.log('ğŸ” RECRUITMENT MODAL: handleItemSelect called with:', item);
    setSelectedItem(selectedItem?.requestNo === item.requestNo ? null : item);
  };

  const handleConfirm = () => {
    if (!selectedItem) {
      showNotification('Vui lÃ²ng chá»n má»™t Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng', 'warning');
      return;
    }
    
    console.log('ğŸ” RECRUITMENT MODAL: selectedItem before confirm:', selectedItem);
    console.log('ğŸ” RECRUITMENT MODAL: selectedItem.requestNo:', selectedItem.requestNo);
    console.log('ğŸ” RECRUITMENT MODAL: typeof selectedItem.requestNo:', typeof selectedItem.requestNo);
    
    // âœ… Sá»¬A: Kiá»ƒm tra requestNo cÃ³ há»£p lá»‡ khÃ´ng
    if (!selectedItem.requestNo || selectedItem.requestNo === 'undefined') {
      console.error('âŒ RECRUITMENT MODAL: Invalid requestNo:', selectedItem.requestNo);
      showNotification('Äá» xuáº¥t tuyá»ƒn dá»¥ng khÃ´ng há»£p lá»‡. Vui lÃ²ng chá»n láº¡i.', 'error');
      return;
    }
    
    // âœ… Sá»¬A: Táº¡o object vá»›i requestNo Ä‘Ã£ Ä‘Æ°á»£c extract
    const processedItem = {
      ...selectedItem,
      requestNo: selectedItem.requestNo // ÄÃ£ Ä‘Æ°á»£c extract trong loadRecruitmentRequests
    };
    
    console.log('ğŸ” RECRUITMENT MODAL: Final processed item for callback:', processedItem);
    
    // Gá»­i vá» component cha
    onRecruitmentSelected(processedItem); // âœ… Sá»¬A: Gá»­i object thay vÃ¬ array
    onClose();
  };

  const handleCancel = () => {
    setSelectedItem(selectedRecruitment);
    setSearchTerm(''); // Clear search term
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="modal fade show" style={{ display: 'block' }} tabIndex="-1">
      <div className="modal-dialog modal-xl">
        <div className="modal-content">
          <div className="modal-header">
            <h5 className="modal-title">
              <i className="fas fa-clipboard-list me-2"></i>
              Chá»n Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng
            </h5>
            <button
              type="button"
              className="btn-close"
              onClick={handleCancel}
            ></button>
          </div>

          <div className="modal-body">
            {/* Search */}
            <div className="row mb-3">
              <div className="col-12">
                <div className="input-group">
                  <span className="input-group-text">
                    <i className="fas fa-search"></i>
                  </span>
                  <input
                    type="text"
                    className="form-control"
                    placeholder="TÃ¬m kiáº¿m theo Request No, PhÃ²ng ban, NgÆ°á»i yÃªu cáº§u, Vá»‹ trÃ­..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                  />
                  {searchTerm && (
                    <button
                      className="btn btn-outline-secondary"
                      type="button"
                      onClick={() => setSearchTerm('')}
                    >
                      <i className="fas fa-times"></i>
                    </button>
                  )}
                </div>
              </div>
            </div>

            {/* Selected Info */}
            {selectedItem && (
              <div className="alert alert-info">
                <i className="fas fa-info-circle me-2"></i>
                ÄÃ£ chá»n: <strong>{selectedItem.requestNo}</strong> - {selectedItem.position} ({selectedItem.department})
              </div>
            )}

            {/* Content */}
            {loading ? (
              <Loading text="Äang táº£i danh sÃ¡ch Ä‘á» xuáº¥t..." />
            ) : (
              <div className="table-responsive" style={{ maxHeight: '400px', overflowY: 'auto' }}>
                <table className="table table-striped table-hover">
                  <thead className="table-dark sticky-top">
                    <tr>
                      <th width="50">
                        <i className="fas fa-check"></i>
                      </th>
                      <th>Request No.</th>
                      <th>Vá»‹ trÃ­ tuyá»ƒn dá»¥ng</th>
                      <th>NgÆ°á»i yÃªu cáº§u</th>
                      <th>PhÃ²ng ban</th>
                      <th>Sá»‘ lÆ°á»£ng</th>
                      <th>Giá»›i tÃ­nh</th>
                      <th>Thá»i gian</th>
                      <th>Tráº¡ng thÃ¡i</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredData.map((item) => {
                      const isSelected = selectedItem?.requestNo === item.requestNo;
                      
                      return (
                        <tr 
                          key={item.id || item.requestNo}
                          className={isSelected ? 'table-primary' : ''}
                          style={{ cursor: 'pointer' }}
                          onClick={() => handleItemSelect(item)}
                        >
                          <td>
                            <input
                              type="radio"
                              className="form-check-input"
                              checked={isSelected}
                              onChange={() => handleItemSelect(item)}
                            />
                          </td>
                          <td>
                            <strong className="text-primary">{item.requestNo}</strong>
                          </td>
                          <td>
                            <span className="badge bg-info">{item.position || 'N/A'}</span>
                          </td>
                          <td>{item.requester}</td>
                          <td>
                            <span className="badge bg-secondary">{item.department}</span>
                          </td>
                          <td className="text-center">
                            <span className="badge bg-warning text-dark">{item.quantity}</span>
                          </td>
                          <td>
                            <span className="badge bg-light text-dark">{item.gender}</span>
                          </td>
                          <td>
                            <small>
                              {item.fromDate}<br/>
                              Ä‘áº¿n {item.toDate}
                            </small>
                          </td>
                          <td>
                            <span className={`badge ${
                              item.status === 'Äang tuyá»ƒn dá»¥ng' ? 'bg-success' : 'bg-warning'
                            }`}>
                              {item.status}
                            </span>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>

                {filteredData.length === 0 && (
                  <div className="text-center py-4">
                    <i className="fas fa-search fa-3x text-muted mb-3"></i>
                    <p className="text-muted">
                      {searchTerm ? 'KhÃ´ng tÃ¬m tháº¥y Ä‘á» xuáº¥t phÃ¹ há»£p' : 'ChÆ°a cÃ³ Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng nÃ o'}
                    </p>
                  </div>
                )}
              </div>
            )}
          </div>

          <div className="modal-footer">
            <button
              type="button"
              className="btn btn-secondary"
              onClick={handleCancel}
            >
              <i className="fas fa-times me-2"></i>
              Há»§y
            </button>
            <button
              type="button"
              className="btn btn-primary"
              onClick={handleConfirm}
              disabled={!selectedItem || loading}
            >
              <i className="fas fa-check me-2"></i>
              XÃ¡c nháº­n{selectedItem ? ` (${selectedItem.requestNo})` : ''}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default RecruitmentModal;

```


==================== File: .\src\components\employee\WorkHistoryModal.jsx ====================

// src/components/employee/WorkHistoryModal.jsx  
import React, { useState, useEffect } from 'react';
import { getEmployeeWorkHistory } from '../../services/employee.js';
import { useNotification } from '../../hooks/useNotification';
import Modal from '../common/Modal';
import Loading from '../common/Loading';

const WorkHistoryModal = ({ isOpen, onClose, employeeId, employeeName, workHistory }) => {
  const [workHistoryData, setWorkHistoryData] = useState([]);
  const [loading, setLoading] = useState(false);
  const { showNotification } = useNotification();

  useEffect(() => {
    if (isOpen && employeeId && !workHistory) {
      fetchWorkHistory();
    } else if (workHistory) {
      setWorkHistoryData(workHistory);
    }
  }, [isOpen, employeeId, workHistory]);

  const fetchWorkHistory = async () => {
    setLoading(true);
    try {
      const response = await getEmployeeWorkHistory(employeeId);
      
      if (response.success) {
        setWorkHistoryData(response.data || []);
      } else {
        showNotification(response.message || 'Lá»—i khi táº£i work history', 'error');
      }
    } catch (error) {
      console.error('âŒ Error fetching work history:', error);
      showNotification(error.message || 'Lá»—i káº¿t ná»‘i Ä‘áº¿n server', 'error');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <Modal 
      isOpen={isOpen} 
      onClose={onClose}
      title={`Lá»‹ch sá»­ lÃ m viá»‡c - ${employeeName || employeeId}`}
      size="lg"
    >
      {loading ? (
        <Loading />
      ) : (
        <div>
          {workHistoryData.length === 0 ? (
            <div className="text-center py-4">
              <i className="fas fa-history fa-3x text-muted mb-3"></i>
              <p className="text-muted">KhÃ´ng cÃ³ lá»‹ch sá»­ lÃ m viá»‡c</p>
            </div>
          ) : (
            <div className="table-responsive">
              <table className="table table-striped">
                <thead className="table-dark">
                  <tr>
                    <th>Request No.</th>
                    <th>MÃ£ nhÃ¢n viÃªn</th>
                    <th>Thá»i gian</th>
                  </tr>
                </thead>
                <tbody>
                  {workHistoryData.map((item, index) => (
                    <tr key={item.id || index}>
                      <td>
                        <span className="badge bg-primary">{item.requestNo}</span>
                      </td>
                      <td>{item.employeeId}</td>
                      <td>
                        <small className="text-muted">
                          {item.createdAt ? new Date(item.createdAt).toLocaleString('vi-VN') : 'N/A'}
                        </small>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
          
          <div className="d-flex justify-content-end mt-3">
            <button type="button" className="btn btn-secondary" onClick={onClose}>
              ÄÃ³ng
            </button>
          </div>
        </div>
      )}
    </Modal>
  );
};

export default WorkHistoryModal;

```


==================== File: .\src\components\layout\Layout.jsx ====================

import React, { useEffect } from 'react';
import { Outlet, useLocation } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';
import ResponsiveNavigation from './ResponsiveNavigation';

const Layout = () => {
  const { user } = useAuth();
  const location = useLocation();

  useEffect(() => {
    // Initialize tooltips when location changes
    if (typeof window !== 'undefined' && window.bootstrap) {
      const tooltipTriggerList = [].slice.call(
        document.querySelectorAll('[data-bs-toggle="tooltip"]')
      );
      tooltipTriggerList.map(tooltipTriggerEl => {
        return new window.bootstrap.Tooltip(tooltipTriggerEl);
      });
    }
  }, [location]);

  if (!user) {
    return (
      <div className="d-flex justify-content-center align-items-center min-vh-100">
        <div className="spinner-border" role="status">
          <span className="visually-hidden">Loading...</span>
        </div>
      </div>
    );
  }

  return (
    <div className="d-flex">
      <ResponsiveNavigation />
      
      {/* Main content */}
      <div className="flex-grow-1">
        <main className="container-fluid py-4">
          <Outlet />
        </main>
      </div>

      {/* âœ… BÆ¯á»šC 2: XÃ³a bá» Alert Container khá»i Ä‘Ã¢y */}
      {/* Div Ä‘Ã£ Ä‘Æ°á»£c di chuyá»ƒn ra App.jsx */}
    </div>
  );
};

export default Layout;

```


==================== File: .\src\components\layout\ResponsiveNavigation.jsx ====================

import React, { useState, useEffect } from 'react';
import { useLocation } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';
import { useNotification } from '../../hooks/useNotification';

const ResponsiveNavigation = () => {
  const [isMobile, setIsMobile] = useState(false);
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [dropdownOpen, setDropdownOpen] = useState(false);
  
  const { user, logout } = useAuth();
  const { showNotification } = useNotification();
  const location = useLocation();

  // Detect mobile screen
  useEffect(() => {
    const checkScreenSize = () => {
      setIsMobile(window.innerWidth < 768);
    };
    
    checkScreenSize();
    window.addEventListener('resize', checkScreenSize);
    return () => window.removeEventListener('resize', checkScreenSize);
  }, []);

  // Menu items configuration
  const menuItems = [

    {
      path: '/employee-management',
      icon: 'fas fa-users-cog',
      label: 'Quáº£n lÃ½ nhÃ¢n viÃªn',
      roles: ['admin', 'hr']
    },
    {
      path: '/hr-dashboard',
      icon: 'fas fa-chart-bar',
      label: 'HR Dashboard',
      roles: ['admin', 'hr']
    },
    {
      path: '/attendance-logs',
      icon: 'fas fa-clock',
      label: 'Báº£n ghi cháº¥m cÃ´ng',
      roles: ['admin', 'hr', 'sales_manager', 'finance_manager', 'director']
    }
  ];

  const filteredMenuItems = menuItems.filter(item => 
    item.roles.includes(user?.role)
  );

  const isActiveRoute = (path) => {
    return location.pathname === path || location.pathname.startsWith(path + '/');
  };

  const handleLogout = async () => {
    try {
      await logout();
      showNotification('ÄÄƒng xuáº¥t thÃ nh cÃ´ng!', 'success');
    } catch (error) {
      console.error('Logout error:', error);
      showNotification('Lá»—i khi Ä‘Äƒng xuáº¥t', 'error');
    }
  };

  // Desktop Navigation (Always visible sidebar)
  const DesktopNavigation = () => (
    <div className="d-none d-md-flex">
      {/* Desktop Sidebar */}
      <div className="bg-light border-end" style={{ width: '280px', minHeight: '100vh' }}>
        {/* Brand Header */}
        <div className="p-3 border-bottom">
          <div className="d-flex align-items-center">
            <div className="rounded-circle bg-primary d-flex align-items-center justify-content-center me-2" 
                 style={{ width: '40px', height: '40px' }}>
              <i className="fas fa-user text-white"></i>
            </div>
            <div>
              <div className="fw-semibold">{user?.fullName}</div>
              <small className="text-muted">{getRoleDisplayName(user?.role)}</small>
            </div>
          </div>
        </div>

        {/* Navigation Menu */}
        <nav className="flex-grow-1 p-2">
          {filteredMenuItems.map((item, index) => (
            <a
              key={index}
              href={item.path}
              className={`nav-link d-flex align-items-center rounded mb-1 p-3 ${
                isActiveRoute(item.path) ? 'active bg-primary text-white' : 'text-dark'
              }`}
            >
              <i className={`${item.icon} me-2`}></i>
              <span>{item.label}</span>
            </a>
          ))}
        </nav>

        {/* User Actions */}
        <div className="border-top p-3">
          <button 
            className="btn btn-outline-danger w-100"
            onClick={handleLogout}
          >
            <i className="fas fa-sign-out-alt me-2"></i>
            ÄÄƒng xuáº¥t
          </button>
        </div>
      </div>
    </div>
  );

  // Mobile Navigation (Top navbar + collapsible menu)
  const MobileNavigation = () => (
    <div className="d-md-none">
      {/* Mobile Top Bar */}
      <nav className="navbar navbar-dark bg-dark">
        <div className="container-fluid">
          <a className="navbar-brand" href="/dashboard">
            <i className="fas fa-users me-2"></i>
            HR Management
          </a>
          
          <button
            className="navbar-toggler"
            type="button"
            onClick={() => setSidebarOpen(!sidebarOpen)}
          >
            <span className="navbar-toggler-icon"></span>
          </button>
        </div>
      </nav>

      {/* Mobile Sidebar Overlay */}
      {sidebarOpen && (
        <>
          {/* Backdrop */}
          <div 
            className="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50"
            style={{ zIndex: 1040 }}
            onClick={() => setSidebarOpen(false)}
          ></div>
          
          {/* Mobile Sidebar */}
          <div 
            className="position-fixed top-0 start-0 bg-light h-100"
            style={{ width: '280px', zIndex: 1050 }}
          >
            {/* Mobile Header */}
            <div className="p-3 border-bottom d-flex justify-content-between align-items-center">
              <div className="d-flex align-items-center">
                <div className="rounded-circle bg-primary d-flex align-items-center justify-content-center me-2" 
                     style={{ width: '32px', height: '32px' }}>
                  <i className="fas fa-user text-white"></i>
                </div>
                <div>
                  <div className="fw-semibold small">{user?.fullName}</div>
                  <small className="text-muted">{getRoleDisplayName(user?.role)}</small>
                </div>
              </div>
              <button 
                className="btn btn-sm btn-outline-secondary"
                onClick={() => setSidebarOpen(false)}
              >
                <i className="fas fa-times"></i>
              </button>
            </div>

            {/* Mobile Menu */}
            <nav className="p-2">
              {filteredMenuItems.map((item, index) => (
                <a
                  key={index}
                  href={item.path}
                  className={`nav-link d-flex align-items-center rounded mb-1 p-3 ${
                    isActiveRoute(item.path) ? 'active bg-primary text-white' : 'text-dark'
                  }`}
                  onClick={() => setSidebarOpen(false)}
                >
                  <i className={`${item.icon} me-2`}></i>
                  <span>{item.label}</span>
                </a>
              ))}
            </nav>

            {/* Mobile User Actions */}
            <div className="position-absolute bottom-0 w-100 border-top p-3">
              <button 
                className="btn btn-outline-danger w-100"
                onClick={handleLogout}
              >
                <i className="fas fa-sign-out-alt me-2"></i>
                ÄÄƒng xuáº¥t
              </button>
            </div>
          </div>
        </>
      )}
    </div>
  );

  const getRoleDisplayName = (role) => {
    const roleMap = {
      'admin': 'Administrator',
      'hr': 'HR Manager',
      'sales_manager': 'Sales Manager',
      'finance_manager': 'Finance Manager',
      'director': 'Director'
    };
    return roleMap[role] || 'NhÃ¢n viÃªn';
  };

  if (!user) return null;

  return (
    <>
      <DesktopNavigation />
      <MobileNavigation />
    </>
  );
};

export default ResponsiveNavigation;

```


==================== File: .\src\components\masterdata\PositionManager.jsx ====================

import React, { useState, useEffect } from 'react';
import { ApiClient } from '../../services/api';
import { useNotification } from '../../hooks/useNotification';
import Loading from '../common/Loading';

const PositionManager = () => {
  const [positions, setPositions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [formData, setFormData] = useState({
    positionName: '',
    description: ''
  });
  const [editingPosition, setEditingPosition] = useState(null);
  const { showNotification } = useNotification();

  useEffect(() => {
    loadPositions();
  }, []);

  const loadPositions = async () => {
    try {
      setLoading(true);
      const data = await ApiClient.get('/api/employees/positions');
      setPositions(data);
    } catch (error) {
      console.error('Error loading positions:', error);
      showNotification('Lá»—i khi táº£i danh sÃ¡ch vá»‹ trÃ­', 'error');
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!formData.positionName.trim()) {
      showNotification('Vui lÃ²ng nháº­p tÃªn vá»‹ trÃ­!', 'error');
      return;
    }

    try {
      if (editingPosition) {
        await ApiClient.put(`/api/employees/positions/${editingPosition.id}`, formData);
        showNotification('Cáº­p nháº­t vá»‹ trÃ­ thÃ nh cÃ´ng', 'success');
      } else {
        await ApiClient.post('/api/employees/positions', formData);
        showNotification('ThÃªm vá»‹ trÃ­ thÃ nh cÃ´ng', 'success');
      }
      
      setFormData({ positionName: '', description: '' });
      setEditingPosition(null);
      await loadPositions();
    } catch (error) {
      console.error('Error saving position:', error);
      showNotification('Lá»—i khi lÆ°u vá»‹ trÃ­', 'error');
    }
  };

  const handleEdit = (position) => {
    setEditingPosition(position);
    setFormData({
      positionName: position.positionName,
      description: position.description || ''
    });
  };

  const handleDelete = async (position) => {
    const confirmed = window.confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a vá»‹ trÃ­ "${position.positionName}"?`);
    if (!confirmed) return;

    try {
      await ApiClient.delete(`/api/employees/positions/${position.id}`);
      showNotification('XÃ³a vá»‹ trÃ­ thÃ nh cÃ´ng', 'success');
      await loadPositions();
    } catch (error) {
      console.error('Error deleting position:', error);
      showNotification('Lá»—i khi xÃ³a vá»‹ trÃ­', 'error');
    }
  };

  const handleCancel = () => {
    setEditingPosition(null);
    setFormData({ positionName: '', description: '' });
  };

  if (loading) {
    return <Loading text="Äang táº£i danh sÃ¡ch vá»‹ trÃ­..." />;
  }

  return (
    <div className="position-manager">
      <div className="row">
        <div className="col-md-4">
          <div className="card">
            <div className="card-header">
              <h5>{editingPosition ? 'Chá»‰nh sá»­a' : 'ThÃªm'} vá»‹ trÃ­</h5>
            </div>
            <div className="card-body">
              <form onSubmit={handleSubmit}>
                <div className="mb-3">
                  <label className="form-label">
                    TÃªn vá»‹ trÃ­ <span className="text-danger">*</span>
                  </label>
                  <input
                    type="text"
                    className="form-control"
                    name="positionName"
                    value={formData.positionName}
                    onChange={handleInputChange}
                    required
                  />
                </div>
                
                <div className="mb-3">
                  <label className="form-label">MÃ´ táº£</label>
                  <textarea
                    className="form-control"
                    name="description"
                    value={formData.description}
                    onChange={handleInputChange}
                    rows="3"
                    placeholder="MÃ´ táº£ vá» vá»‹ trÃ­ cÃ´ng viá»‡c..."
                  />
                </div>
                
                <div className="d-grid gap-2">
                  <button type="submit" className="btn btn-primary">
                    {editingPosition ? 'Cáº­p nháº­t' : 'ThÃªm'} vá»‹ trÃ­
                  </button>
                  {editingPosition && (
                    <button 
                      type="button" 
                      className="btn btn-secondary"
                      onClick={handleCancel}
                    >
                      Há»§y
                    </button>
                  )}
                </div>
              </form>
            </div>
          </div>
        </div>
        
        <div className="col-md-8">
          <div className="card">
            <div className="card-header">
              <h5>Danh sÃ¡ch vá»‹ trÃ­</h5>
            </div>
            <div className="card-body">
              {positions.length === 0 ? (
                <div className="text-center py-4">
                  <i className="fas fa-briefcase fa-3x text-muted mb-3"></i>
                  <p className="text-muted">ChÆ°a cÃ³ vá»‹ trÃ­ nÃ o</p>
                </div>
              ) : (
                <div className="table-responsive">
                  <table className="table table-striped table-hover">
                    <thead className="table-dark">
                      <tr>
                        <th>TÃªn vá»‹ trÃ­</th>
                        <th>MÃ´ táº£</th>
                        <th>Tráº¡ng thÃ¡i</th>
                        <th>Thao tÃ¡c</th>
                      </tr>
                    </thead>
                    <tbody>
                      {positions.map(position => (
                        <tr key={position.id}>
                          <td>
                            <strong>{position.positionName}</strong>
                          </td>
                          <td>
                            <span className="text-muted">
                              {position.description || 'KhÃ´ng cÃ³ mÃ´ táº£'}
                            </span>
                          </td>
                          <td>
                            <span className={`badge ${
                              position.status === 'active' 
                                ? 'bg-success' 
                                : 'bg-secondary'
                            }`}>
                              {position.status === 'active' 
                                ? 'Hoáº¡t Ä‘á»™ng' 
                                : 'NgÆ°ng hoáº¡t Ä‘á»™ng'
                              }
                            </span>
                          </td>
                          <td>
                            <div className="btn-group" role="group">
                              <button
                                className="btn btn-sm btn-primary"
                                onClick={() => handleEdit(position)}
                                title="Chá»‰nh sá»­a"
                              >
                                <i className="fas fa-edit"></i>
                              </button>
                              <button
                                className="btn btn-sm btn-danger"
                                onClick={() => handleDelete(position)}
                                title="XÃ³a"
                              >
                                <i className="fas fa-trash"></i>
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default PositionManager;

```


==================== File: .\src\components\masterdata\StoreManager.jsx ====================

import React, { useState, useEffect } from 'react';
import { ApiClient } from '../../services/api';
import { useNotification } from '../../hooks/useNotification';
import Loading from '../common/Loading';

const StoreManager = () => {
  const [stores, setStores] = useState([]);
  const [loading, setLoading] = useState(true);
  const [formData, setFormData] = useState({
    storeName: '',
    address: ''
  });
  const [editingStore, setEditingStore] = useState(null);
  const { showNotification } = useNotification();

  useEffect(() => {
    loadStores();
  }, []);

  const loadStores = async () => {
    try {
      setLoading(true);
      const data = await ApiClient.get('/api/employees/stores');
      setStores(data);
    } catch (error) {
      console.error('Error loading stores:', error);
      showNotification('Lá»—i khi táº£i danh sÃ¡ch cá»­a hÃ ng', 'error');
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!formData.storeName.trim() || !formData.address.trim()) {
      showNotification('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!', 'error');
      return;
    }

    try {
      if (editingStore) {
        await ApiClient.put(`/api/employees/stores/${editingStore.id}`, formData);
        showNotification('Cáº­p nháº­t cá»­a hÃ ng thÃ nh cÃ´ng', 'success');
      } else {
        await ApiClient.post('/api/employees/stores', formData);
        showNotification('ThÃªm cá»­a hÃ ng thÃ nh cÃ´ng', 'success');
      }
      
      setFormData({ storeName: '', address: '' });
      setEditingStore(null);
      await loadStores();
    } catch (error) {
      console.error('Error saving store:', error);
      showNotification('Lá»—i khi lÆ°u cá»­a hÃ ng', 'error');
    }
  };

  const handleEdit = (store) => {
    setEditingStore(store);
    setFormData({
      storeName: store.storeName,
      address: store.address
    });
  };

  const handleDelete = async (store) => {
    const confirmed = window.confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a cá»­a hÃ ng "${store.storeName}"?`);
    if (!confirmed) return;

    try {
      await ApiClient.delete(`/api/employees/stores/${store.id}`);
      showNotification('XÃ³a cá»­a hÃ ng thÃ nh cÃ´ng', 'success');
      await loadStores();
    } catch (error) {
      console.error('Error deleting store:', error);
      showNotification('Lá»—i khi xÃ³a cá»­a hÃ ng', 'error');
    }
  };

  const handleCancel = () => {
    setEditingStore(null);
    setFormData({ storeName: '', address: '' });
  };

  if (loading) {
    return <Loading text="Äang táº£i danh sÃ¡ch cá»­a hÃ ng..." />;
  }

  return (
    <div className="store-manager">
      <div className="row">
        <div className="col-md-4">
          <div className="card">
            <div className="card-header">
              <h5>{editingStore ? 'Chá»‰nh sá»­a' : 'ThÃªm'} cá»­a hÃ ng</h5>
            </div>
            <div className="card-body">
              <form onSubmit={handleSubmit}>
                <div className="mb-3">
                  <label className="form-label">
                    TÃªn cá»­a hÃ ng <span className="text-danger">*</span>
                  </label>
                  <input
                    type="text"
                    className="form-control"
                    name="storeName"
                    value={formData.storeName}
                    onChange={handleInputChange}
                    required
                  />
                </div>
                
                <div className="mb-3">
                  <label className="form-label">
                    Äá»‹a chá»‰ <span className="text-danger">*</span>
                  </label>
                  <textarea
                    className="form-control"
                    name="address"
                    value={formData.address}
                    onChange={handleInputChange}
                    rows="3"
                    required
                  />
                </div>
                
                <div className="d-grid gap-2">
                  <button type="submit" className="btn btn-primary">
                    {editingStore ? 'Cáº­p nháº­t' : 'ThÃªm'} cá»­a hÃ ng
                  </button>
                  {editingStore && (
                    <button 
                      type="button" 
                      className="btn btn-secondary"
                      onClick={handleCancel}
                    >
                      Há»§y
                    </button>
                  )}
                </div>
              </form>
            </div>
          </div>
        </div>
        
        <div className="col-md-8">
          <div className="card">
            <div className="card-header">
              <h5>Danh sÃ¡ch cá»­a hÃ ng</h5>
            </div>
            <div className="card-body">
              {stores.length === 0 ? (
                <div className="text-center py-4">
                  <i className="fas fa-store fa-3x text-muted mb-3"></i>
                  <p className="text-muted">ChÆ°a cÃ³ cá»­a hÃ ng nÃ o</p>
                </div>
              ) : (
                <div className="table-responsive">
                  <table className="table table-striped table-hover">
                    <thead className="table-dark">
                      <tr>
                        <th>TÃªn cá»­a hÃ ng</th>
                        <th>Äá»‹a chá»‰</th>
                        <th>Tráº¡ng thÃ¡i</th>
                        <th>Thao tÃ¡c</th>
                      </tr>
                    </thead>
                    <tbody>
                      {stores.map(store => (
                        <tr key={store.id}>
                          <td>{store.storeName}</td>
                          <td>{store.address}</td>
                          <td>
                            <span className={`badge ${
                              store.status === 'active' 
                                ? 'bg-success' 
                                : 'bg-secondary'
                            }`}>
                              {store.status === 'active' 
                                ? 'Hoáº¡t Ä‘á»™ng' 
                                : 'NgÆ°ng hoáº¡t Ä‘á»™ng'
                              }
                            </span>
                          </td>
                          <td>
                            <div className="btn-group" role="group">
                              <button
                                className="btn btn-sm btn-primary"
                                onClick={() => handleEdit(store)}
                                title="Chá»‰nh sá»­a"
                              >
                                <i className="fas fa-edit"></i>
                              </button>
                              <button
                                className="btn btn-sm btn-danger"
                                onClick={() => handleDelete(store)}
                                title="XÃ³a"
                              >
                                <i className="fas fa-trash"></i>
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default StoreManager;

```


==================== File: .\src\contexts\AppContext.jsx ====================


```


==================== File: .\src\contexts\AuthContext.jsx ====================

import React, { createContext, useContext, useState, useEffect } from 'react';
import { ApiClient } from '../services/api.js';

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [initialized, setInitialized] = useState(false);

  useEffect(() => {
    initializeAuth();
  }, []);

  const initializeAuth = async () => {
    try {
      setLoading(true);
      // âœ… Sá»¬A: Thay tháº¿ checkAuth() báº±ng viá»‡c gá»i trá»±c tiáº¿p getProfile tá»« ApiClient
      const response = await ApiClient.get('/api/auth/profile');
      if (response.success && response.data.user) {
        setUser(response.data.user);
      } else {
        setUser(null);
      }
    } catch (error) {
      console.warn('Auth initialization: Not logged in.');
      setUser(null);
    } finally {
      setInitialized(true);
      setLoading(false);
    }
  };

  // HÃ m checkAuth cÅ© cÃ³ thá»ƒ xÃ³a hoáº·c giá»¯ láº¡i náº¿u cáº§n
  const checkAuth = async () => {
    try {
      const response = await ApiClient.get('/api/auth/profile');
      return response.success ? response.data.user : null;
    } catch (error) {
      return null;
    }
  };

  const login = async (credentials) => {
    try {
      setLoading(true);
      const response = await ApiClient.post('/api/auth/login', credentials);
      
      // âœ… Sá»¬A LOGIC KIá»‚M TRA Táº I ÄÃ‚Y
      // Kiá»ƒm tra `response.data.user` thay vÃ¬ `response.user`
      if (response.success && response.data && response.data.user) {
        setUser(response.data.user);
        return response.data; // Tráº£ vá» `response.data` Ä‘á»ƒ LoginPage cÃ³ thá»ƒ sá»­ dá»¥ng
      } else {
        // NÃ©m lá»—i vá»›i thÃ´ng Ä‘iá»‡p tá»« server náº¿u cÃ³
        throw new Error(response.message || 'Login failed: Invalid response structure');
      }
    } catch (error) {
      console.error('Login error:', error);
      // Äáº£m báº£o nÃ©m láº¡i lá»—i Ä‘á»ƒ component gá»i cÃ³ thá»ƒ báº¯t Ä‘Æ°á»£c
      throw error;
    } finally {
      setLoading(false);
    }
  };

  const logout = async () => {
    try {
      setLoading(true);
      await ApiClient.post('/api/auth/logout');
      setUser(null);
      // Chuyá»ƒn hÆ°á»›ng vá» trang login má»™t cÃ¡ch an toÃ n
      window.location.assign('/login');
    } catch (error) {
      console.error('Logout error:', error);
      // Váº«n xÃ³a user vÃ  chuyá»ƒn hÆ°á»›ng dÃ¹ API cÃ³ lá»—i
      setUser(null);
      window.location.assign('/login');
    } finally {
      setLoading(false);
    }
  };

  const updateUserInfo = (userData) => {
    setUser(prevUser => ({
      ...prevUser,
      ...userData
    }));
  };

  const hasRole = (requiredRoles) => {
    if (!user) return false;
    if (typeof requiredRoles === 'string') {
      return user.role === requiredRoles;
    }
    if (Array.isArray(requiredRoles)) {
      return requiredRoles.includes(user.role);
    }
    return false;
  };

  const value = {
    user,
    loading,
    initialized,
    login,
    logout,
    checkAuth,
    updateUserInfo,
    hasRole,
  };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

export default AuthContext;

```


==================== File: .\src\contexts\NotificationContext.jsx ====================

import React, { createContext, useContext, useCallback } from 'react';

const NotificationContext = createContext();

export const NotificationProvider = ({ children }) => {
  const showNotification = useCallback((message, type = 'info', duration = 5000) => {
    const alertContainer = document.getElementById('alert-container');
    if (!alertContainer) {
      console.warn('Alert container not found');
      return;
    }
    
    const alertId = `alert-${Date.now()}`;
    const alertDiv = document.createElement('div');
    alertDiv.id = alertId;
    alertDiv.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show`;
    alertDiv.style.marginBottom = '10px';
    
    alertDiv.innerHTML = `
      <div class="d-flex align-items-center">
        <i class="fas fa-${getIconByType(type)} me-2"></i>
        <div class="flex-grow-1">${message}</div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    `;
    
    alertContainer.appendChild(alertDiv);
    
    // Auto remove after duration
    setTimeout(() => {
      const element = document.getElementById(alertId);
      if (element && element.parentNode) {
        element.parentNode.removeChild(element);
      }
    }, duration);
  }, []);

  const getIconByType = (type) => {
    switch (type) {
      case 'success': return 'check-circle';
      case 'error': 
      case 'danger': return 'exclamation-triangle';
      case 'warning': return 'exclamation-circle';
      case 'info': return 'info-circle';
      default: return 'info-circle';
    }
  };

  const clearNotifications = useCallback(() => {
    const alertContainer = document.getElementById('alert-container');
    if (alertContainer) {
      alertContainer.innerHTML = '';
    }
  }, []);

  const value = {
    showNotification,
    clearNotifications
  };

  return (
    <NotificationContext.Provider value={value}>
      {children}
    </NotificationContext.Provider>
  );
};

export const useNotification = () => {
  const context = useContext(NotificationContext);
  if (!context) {
    throw new Error('useNotification must be used within a NotificationProvider');
  }
  return context;
};

export { NotificationContext };
export default NotificationContext;


```


==================== File: .\src\hooks\useApi.js ====================

import { useState, useEffect } from 'react';
import { ApiClient } from '../services/api.js';

export const useApi = (url, options = {}) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    if (!url) return;
    
    const fetchData = async () => {
      try {
        setLoading(true);
        setError(null);
        
        const response = await ApiClient.get(url, options);
        
        if (response.success && response.data) {
          setData(response.data);
        } else {
          setData(response.data || []);
        }
      } catch (err) {
        console.error('useApi error:', err);
        setError(err);
        setData([]);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [url]);

  return { data, loading, error };
};

```


==================== File: .\src\hooks\useAttendance.js ====================

export const useAttendanceStats = () => {
    const [stats, setStats] = useState({
        totalAttendanceLogs: 0,
        todayLogs: 0,
        thisWeekLogs: 0
    });
    const [loading, setLoading] = useState(false);
    
    const fetchStats = async () => {
        setLoading(true);
        try {
            const response = await api.get('/attendance/stats');
            if (response.data.success) {
                setStats(response.data.data);
            }
        } catch (error) {
            console.error('Error fetching attendance stats:', error);
        } finally {
            setLoading(false);
        }
    };
    
    return { stats, loading, fetchStats };
};

```


==================== File: .\src\hooks\useAuth.js ====================

import { useContext } from 'react';
import AuthContext from '../contexts/AuthContext';

export const useAuth = () => {
  const context = useContext(AuthContext);
  
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  
  return context;
};

export default useAuth;

```


==================== File: .\src\hooks\useEmployees.js ====================

// src/hooks/useEmployees.js - ÄÃƒ REFACTOR

import { useState, useEffect, useCallback } from 'react';
import { employeeService } from '../services/employee.js';
import { useNotification } from './useNotification.js';

/**
 * Hook tÃ¹y chá»‰nh Ä‘á»ƒ quáº£n lÃ½ dá»¯ liá»‡u vÃ  logic cá»§a NhÃ¢n viÃªn.
 * @returns {object} Tráº¡ng thÃ¡i vÃ  cÃ¡c hÃ m xá»­ lÃ½.
 */
export const useEmployees = () => {
  const [employees, setEmployees] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const { showNotification } = useNotification();

  /**
   * HÃ m Ä‘á»ƒ táº£i danh sÃ¡ch nhÃ¢n viÃªn tá»« server.
   * Sá»­ dá»¥ng useCallback Ä‘á»ƒ trÃ¡nh viá»‡c táº¡o láº¡i hÃ m má»™t cÃ¡ch khÃ´ng cáº§n thiáº¿t.
   */
  const fetchEmployees = useCallback(async () => {
    console.log('HOOK: Báº¯t Ä‘áº§u táº£i danh sÃ¡ch nhÃ¢n viÃªn...');
    setLoading(true);
    setError(null);
    try {
      const response = await employeeService.getAll();
      if (response.success) {
        setEmployees(response.data || []);
        console.log('HOOK: Táº£i danh sÃ¡ch nhÃ¢n viÃªn thÃ nh cÃ´ng.', response.data);
      } else {
        throw new Error(response.message || 'KhÃ´ng thá»ƒ táº£i danh sÃ¡ch nhÃ¢n viÃªn.');
      }
    } catch (err) {
      console.error('HOOK: Lá»—i khi táº£i danh sÃ¡ch nhÃ¢n viÃªn:', err);
      setError(err.message);
      showNotification(err.message, 'error');
    } finally {
      setLoading(false);
    }
  }, [showNotification]); // Phá»¥ thuá»™c vÃ o showNotification

  // Tá»± Ä‘á»™ng gá»i fetchEmployees khi component Ä‘Æ°á»£c mount láº§n Ä‘áº§u
  useEffect(() => {
    fetchEmployees();
  }, [fetchEmployees]); // Phá»¥ thuá»™c vÃ o hÃ m fetchEmployees Ä‘Ã£ Ä‘Æ°á»£c useCallback

  /**
   * HÃ m Ä‘á»ƒ thÃªm má»™t nhÃ¢n viÃªn má»›i.
   */
  const addEmployee = async (employeeData) => {
    setLoading(true);
    try {
      const response = await employeeService.create(employeeData);
      if (response.success) {
        showNotification('ThÃªm nhÃ¢n viÃªn má»›i thÃ nh cÃ´ng!', 'success');
        await fetchEmployees(); // Táº£i láº¡i danh sÃ¡ch Ä‘á»ƒ cáº­p nháº­t
        return true; // BÃ¡o hiá»‡u thÃ nh cÃ´ng Ä‘á»ƒ Ä‘Ã³ng modal
      } else {
        throw new Error(response.message || 'ThÃªm nhÃ¢n viÃªn tháº¥t báº¡i.');
      }
    } catch (err) {
      console.error('HOOK: Lá»—i khi thÃªm nhÃ¢n viÃªn:', err);
      showNotification(err.message, 'error');
      setLoading(false);
      return false; // BÃ¡o hiá»‡u tháº¥t báº¡i
    }
  };

  /**
   * HÃ m Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin nhÃ¢n viÃªn.
   */
  const updateEmployee = async (id, employeeData) => {
    setLoading(true);
    try {
      const response = await employeeService.update(id, employeeData);
      if (response.success) {
        showNotification('Cáº­p nháº­t thÃ´ng tin nhÃ¢n viÃªn thÃ nh cÃ´ng!', 'success');
        await fetchEmployees(); // Táº£i láº¡i danh sÃ¡ch
        return true;
      } else {
        throw new Error(response.message || 'Cáº­p nháº­t tháº¥t báº¡i.');
      }
    } catch (err) {
      console.error('HOOK: Lá»—i khi cáº­p nháº­t nhÃ¢n viÃªn:', err);
      showNotification(err.message, 'error');
      setLoading(false);
      return false;
    }
  };

  /**
   * HÃ m Ä‘á»ƒ xÃ³a nhÃ¢n viÃªn.
   */
  const deleteEmployee = async (id) => {
    setLoading(true);
    try {
      const response = await employeeService.remove(id);
      if (response.success) {
        showNotification('XÃ³a nhÃ¢n viÃªn thÃ nh cÃ´ng!', 'success');
        await fetchEmployees(); // Táº£i láº¡i danh sÃ¡ch
        return true;
      } else {
        throw new Error(response.message || 'XÃ³a nhÃ¢n viÃªn tháº¥t báº¡i.');
      }
    } catch (err) {
      console.error('HOOK: Lá»—i khi xÃ³a nhÃ¢n viÃªn:', err);
      showNotification(err.message, 'error');
      setLoading(false);
      return false;
    }
  };

  // Tráº£ vá» state vÃ  cÃ¡c hÃ m Ä‘á»ƒ component cÃ³ thá»ƒ sá»­ dá»¥ng
  return {
    employees,
    loading,
    error,
    addEmployee,
    updateEmployee,
    deleteEmployee,
    refreshEmployees: fetchEmployees, // Cung cáº¥p hÃ m Ä‘á»ƒ refresh thá»§ cÃ´ng náº¿u cáº§n
  };
};

```


==================== File: .\src\hooks\useNotification.js ====================

import { useContext } from 'react';
import { NotificationContext } from '../contexts/NotificationContext';

export const useNotification = () => {
  const context = useContext(NotificationContext);
  if (!context) {
    throw new Error('useNotification must be used within a NotificationProvider');
  }
  return context;
};

export default useNotification;

```


==================== File: .\src\pages\AttendanceLogsPage.jsx ====================

import React, { useState, useEffect } from 'react';
import { ApiClient } from '../services/api';
import { useNotification } from '../hooks/useNotification';
import Loading from '../components/common/Loading';
import AttendanceFilters from '../components/attendance/AttendanceFilters';
import AttendanceLogs from '../components/attendance/AttendanceLogs';
import EmployeeHours from '../components/attendance/EmployeeHours';

const AttendanceLogsPage = () => {
  const [employees, setEmployees] = useState([]);
  const [logs, setLogs] = useState([]);
  const [employeeHours, setEmployeeHours] = useState({});
  const [loading, setLoading] = useState(true);
  const [filters, setFilters] = useState({});
  const { showNotification } = useNotification();

  useEffect(() => {
    loadInitialData();
  }, []);

  const loadInitialData = async () => {
    try {
      setLoading(true);
      await Promise.all([
        loadEmployees(),
        loadAttendanceLogs(),
        loadEmployeeHours()
      ]);
    } catch (error) {
      console.error('Error loading initial data:', error);
      showNotification('Lá»—i khi táº£i dá»¯ liá»‡u cháº¥m cÃ´ng', 'error');
    } finally {
      setLoading(false);
    }
  };

  const loadEmployees = async () => {
    try {
      const data = await ApiClient.get('/api/employees');
      setEmployees(data);
    } catch (error) {
      console.error('Error loading employees:', error);
      showNotification('Lá»—i khi táº£i danh sÃ¡ch nhÃ¢n viÃªn', 'error');
    }
  };

  const loadAttendanceLogs = async (filterParams = {}) => {
    try {
      const data = await ApiClient.get('/api/attendance/logs', filterParams);
      setLogs(data);
    } catch (error) {
      console.error('Error loading attendance logs:', error);
      showNotification('Lá»—i khi táº£i báº£n ghi cháº¥m cÃ´ng', 'error');
    }
  };

  const loadEmployeeHours = async () => {
    try {
      const data = await ApiClient.get('/api/attendance/employee-hours');
      setEmployeeHours(data);
    } catch (error) {
      console.error('Error loading employee hours:', error);
      showNotification('Lá»—i khi táº£i tá»•ng giá» cÃ´ng', 'error');
    }
  };

  const handleFilterChange = async (newFilters) => {
    setFilters(newFilters);
    await loadAttendanceLogs(newFilters);
  };

  const handleClearFilters = async () => {
    setFilters({});
    await loadAttendanceLogs();
  };

  const handleRefresh = async () => {
    await loadInitialData();
    showNotification('ÄÃ£ cáº­p nháº­t dá»¯ liá»‡u cháº¥m cÃ´ng', 'success');
  };

  if (loading) {
    return <Loading fullScreen text="Äang táº£i dá»¯ liá»‡u cháº¥m cÃ´ng..." />;
  }

  return (
    <div className="attendance-logs-page">
      {/* Header */}
      <div className="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1>Báº£n ghi cháº¥m cÃ´ng</h1>
          <p className="text-muted mb-0">Xem vÃ  quáº£n lÃ½ báº£n ghi cháº¥m cÃ´ng cá»§a nhÃ¢n viÃªn</p>
        </div>
        <button 
          className="btn btn-outline-primary"
          onClick={handleRefresh}
        >
          <i className="fas fa-sync-alt me-2"></i>
          LÃ m má»›i
        </button>
      </div>

      {/* Filters */}
      <div className="card mb-4">
        <div className="card-header">
          <h5 className="mb-0">Bá»™ lá»c</h5>
        </div>
        <div className="card-body">
          <AttendanceFilters
            employees={employees}
            filters={filters}
            onFilterChange={handleFilterChange}
            onClearFilters={handleClearFilters}
          />
        </div>
      </div>

      {/* Statistics */}
      <div className="row mb-4">
        <div className="col-md-4">
          <div className="card text-center bg-primary text-white">
            <div className="card-body">
              <h3 id="logCount">{logs.length}</h3>
              <p className="mb-0">Tá»•ng báº£n ghi</p>
            </div>
          </div>
        </div>
        <div className="col-md-4">
          <div className="card text-center bg-success text-white">
            <div className="card-body">
              <h3>{employees.filter(emp => emp.status === 'active').length}</h3>
              <p className="mb-0">NhÃ¢n viÃªn hoáº¡t Ä‘á»™ng</p>
            </div>
          </div>
        </div>
        <div className="col-md-4">
          <div className="card text-center bg-info text-white">
            <div className="card-body">
              <h3>{Object.keys(employeeHours).length}</h3>
              <p className="mb-0">NhÃ¢n viÃªn cÃ³ giá» cÃ´ng</p>
            </div>
          </div>
        </div>
      </div>

      {/* Content Tabs */}
      <ul className="nav nav-tabs mb-4">
        <li className="nav-item">
          <a className="nav-link active" data-bs-toggle="tab" href="#logs-tab">
            <i className="fas fa-list me-2"></i>
            Báº£n ghi cháº¥m cÃ´ng
          </a>
        </li>
        <li className="nav-item">
          <a className="nav-link" data-bs-toggle="tab" href="#hours-tab">
            <i className="fas fa-clock me-2"></i>
            Tá»•ng giá» cÃ´ng
          </a>
        </li>
      </ul>

      <div className="tab-content">
        {/* Attendance Logs Tab */}
        <div className="tab-pane fade show active" id="logs-tab">
          <div className="card">
            <div className="card-header">
              <h5 className="mb-0">Chi tiáº¿t báº£n ghi cháº¥m cÃ´ng</h5>
            </div>
            <div className="card-body">
              <AttendanceLogs logs={logs} />
            </div>
          </div>
        </div>

        {/* Employee Hours Tab */}
        <div className="tab-pane fade" id="hours-tab">
          <div className="card">
            <div className="card-header">
              <h5 className="mb-0">Tá»•ng giá» cÃ´ng theo nhÃ¢n viÃªn</h5>
            </div>
            <div className="card-body">
              <EmployeeHours 
                employees={employees}
                employeeHours={employeeHours}
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AttendanceLogsPage;

```


==================== File: .\src\pages\EmployeeManagementPage.jsx ====================

// src/pages/EmployeeManagementPage.jsx

import React, { useState, useMemo } from 'react';
import { useEmployees } from '../hooks/useEmployees';

// Import cÃ¡c components con
import EmployeeList from '../components/employee/EmployeeList.jsx';
import EmployeeEditModal from '../components/employee/EmployeeEditModal.jsx';
import EmployeeAddForm from '../components/employee/EmployeeAddForm.jsx'; // âœ… Import form má»›i
import Loading from '../components/common/Loading.jsx';
import { Alert } from '../components/common/Alert.jsx';

const EmployeeManagementPage = () => {
  const {
    employees,
    loading,
    error,
    addEmployee,
    updateEmployee,
    deleteEmployee,
    refreshEmployees, // Láº¥y hÃ m refresh tá»« hook
  } = useEmployees();

  // State cho modal chá»‰nh sá»­a vÃ  Ã´ tÃ¬m kiáº¿m
  const [isEditModalOpen, setIsEditModalOpen] = useState(false);
  const [selectedEmployee, setSelectedEmployee] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');

  // âœ… Logic tÃ¬m kiáº¿m Ä‘Æ°á»£c gom vá» má»™t nÆ¡i duy nháº¥t
  const filteredEmployees = useMemo(() => {
    if (!searchTerm) return employees;
    return employees.filter(
      (employee) =>
        employee.fullName.toLowerCase().includes(searchTerm.toLowerCase()) ||
        employee.employeeId.toLowerCase().includes(searchTerm.toLowerCase())
    );
  }, [employees, searchTerm]);

  // CÃ¡c hÃ m xá»­ lÃ½ cho Sá»­a vÃ  XÃ³a (giá»¯ nguyÃªn)
  const handleOpenEditModal = (employee) => {
    setSelectedEmployee(employee);
    setIsEditModalOpen(true);
  };

  const handleUpdateEmployee = async (employeeData) => {
    if (!selectedEmployee) return;
    const success = await updateEmployee(selectedEmployee.id, employeeData);
    if (success) {
      setIsEditModalOpen(false);
      setSelectedEmployee(null);
    }
  };

  const handleDeleteEmployee = async (id) => {
    await deleteEmployee(id);
  };

  // âœ… HÃ m xá»­ lÃ½ cho ThÃªm má»›i, gá»i tháº³ng hÃ m tá»« hook
  const handleAddEmployee = async (formData) => {
    // Hook 'addEmployee' Ä‘Ã£ bao gá»“m loading, notification vÃ  refresh láº¡i list
    await addEmployee(formData);
  };

  return (
    <div className="container-fluid mt-4">
      <div className="page-header d-flex justify-content-between align-items-center mb-3">
        <h2>Quáº£n lÃ½ NhÃ¢n viÃªn</h2>
        {/* NÃºt refresh Ä‘á»ƒ táº£i láº¡i dá»¯ liá»‡u khi cáº§n */}
        <button className="btn btn-outline-secondary" onClick={refreshEmployees} disabled={loading}>
          <i className="bi bi-arrow-clockwise me-2"></i>LÃ m má»›i
        </button>
      </div>
      
      {/* âœ… Bá»‘ cá»¥c 2 cá»™t */}
      <div className="row">
        {/* Cá»™t trÃ¡i: Form thÃªm nhÃ¢n viÃªn */}
        <div className="col-lg-5">
          <EmployeeAddForm onSave={handleAddEmployee} isLoading={loading} />
        </div>

        {/* Cá»™t pháº£i: Danh sÃ¡ch vÃ  tÃ¬m kiáº¿m */}
        <div className="col-lg-7">
          <div className="card">
            <div className="card-header">
              <h5 className="card-title mb-0">Danh sÃ¡ch nhÃ¢n viÃªn</h5>
            </div>
            <div className="card-body">
              {/* âœ… Chá»‰ cÃ³ má»™t Ã´ tÃ¬m kiáº¿m á»Ÿ Ä‘Ã¢y */}
              <div className="mb-3">
                <input
                  type="text"
                  className="form-control"
                  placeholder="TÃ¬m kiáº¿m theo tÃªn hoáº·c mÃ£ nhÃ¢n viÃªn..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                />
              </div>

              {/* Hiá»ƒn thá»‹ tráº¡ng thÃ¡i Loading vÃ  Error */}
              {loading && !error && <Loading />}
              {error && <Alert message={`Lá»—i: ${error}`} type="danger" onRetry={refreshEmployees} />}
              
              {!loading && !error && (
                <EmployeeList
                  employees={filteredEmployees}
                  onEdit={handleOpenEditModal}
                  onDelete={handleDeleteEmployee}
                />
              )}
            </div>
          </div>
        </div>
      </div>

      {/* Modal chá»‰nh sá»­a váº«n Ä‘Æ°á»£c giá»¯ láº¡i */}
      {isEditModalOpen && selectedEmployee && (
        <EmployeeEditModal
          isOpen={isEditModalOpen}
          onClose={() => setIsEditModalOpen(false)}
          onSave={handleUpdateEmployee}
          employee={selectedEmployee}
        />
      )}
    </div>
  );
};

export default EmployeeManagementPage;

```


==================== File: .\src\pages\HRDashboardPage.jsx ====================

import React, { useState, useEffect } from 'react';
import { useAuth } from '../hooks/useAuth';
import { ApiClient } from '../services/api';
import { useNotification } from '../hooks/useNotification';
import Loading from '../components/common/Loading';

const HRDashboardPage = () => {
  const [stats, setStats] = useState({
    totalEmployees: 0,
    activeEmployees: 0,
    inactiveEmployees: 0,
    totalAttendanceLogs: 0,
    todayLogs: 0,
  });
  const [loading, setLoading] = useState(true);
  const { user } = useAuth();
  const { showNotification } = useNotification();

  useEffect(() => {
    checkPermissions();
    loadStats();
    // eslint-disable-next-line
  }, []);

  const checkPermissions = () => {
    if (!user || (user.role !== 'hr' && user.role !== 'admin')) {
      showNotification('Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p trang nÃ y', 'error');
      window.location.href = '/dashboard';
    }
  };

  // **LÆ°u Ã½ QUAN TRá»ŒNG: Pháº£i dÃ¹ng Ä‘Ãºng endpoint `/api/dashboard/stats`**
  const loadStats = async () => {
    setLoading(true);
    try {
      console.log('ğŸ” HRDashboard: Loading stats...');
      // Äá»”I endpoint
      const response = await ApiClient.get('/api/dashboard/stats');
      console.log('ğŸ“¨ HRDashboard: Raw response:', response);

      if (response.success && response.data) {
        // Gá»™p stats employee vÃ  attendance
        const employee = response.data.employee || {};
        const attendance = response.data.attendance || {};

        const statsObj = {
          totalEmployees: employee.totalEmployees || 0,
          activeEmployees: employee.activeEmployees || 0,
          inactiveEmployees:
            (employee.totalEmployees || 0) - (employee.activeEmployees || 0),
          totalAttendanceLogs: attendance.totalAttendanceLogs || 0,
          todayLogs: attendance.todayLogs || 0,
        };

        console.log('âœ… HRDashboard: Setting stats to:', statsObj);
        setStats(statsObj);
      } else {
        showNotification(
          response.message || 'KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u thá»‘ng kÃª',
          'warning'
        );
      }
    } catch (error) {
      console.error('âŒ HRDashboard: Error loading stats:', error);
      showNotification('Lá»—i khi táº£i thá»‘ng kÃª HR', 'error');
    } finally {
      setLoading(false);
    }
  };

  const handleRefresh = async () => {
    await loadStats();
    showNotification('ÄÃ£ cáº­p nháº­t dá»¯ liá»‡u HR dashboard', 'success');
  };

  // DEBUG info
  console.log('ğŸ¯ HRDashboard render - Current stats:', stats); // eslint-disable-line
  console.log('ğŸ¯ HRDashboard render - Loading:', loading); // eslint-disable-line

  if (loading) {
    return <Loading fullScreen text="Äang táº£i HR dashboard..." />;
  }

  return (
    <div className="hr-dashboard-page">
      {/* DEBUG INFO - CÃ³ thá»ƒ xoÃ¡ sau */}
      <div
        style={{
          background: '#f8f9fa',
          border: '1px solid #dee2e6',
          borderRadius: '0.25rem',
          padding: '1rem',
          marginBottom: '1rem',
        }}
      >
        <h6 className="text-muted mb-2">ğŸ› DEBUG INFO (HR Dashboard):</h6>
        <small className="d-block">Raw stats: {JSON.stringify(stats)}</small>
        <small className="d-block">Total Employees: {stats.totalEmployees}</small>
        <small className="d-block">Active Employees: {stats.activeEmployees}</small>
        <small className="d-block">Inactive Employees: {stats.inactiveEmployees}</small>
        <small className="d-block">Total Attendance Logs: {stats.totalAttendanceLogs}</small>
        <small className="d-block">Today Logs: {stats.todayLogs}</small>
      </div>

      {/* Header */}
      <div className="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1>HR Dashboard</h1>
          <p className="text-muted mb-0">Dashboard dÃ nh cho bá»™ pháº­n nhÃ¢n sá»±</p>
        </div>
        <button
          className="btn btn-outline-primary"
          onClick={handleRefresh}
          disabled={loading}
        >
          <i className={`fas fa-sync-alt me-2 ${loading ? 'fa-spin' : ''}`}></i>
          LÃ m má»›i
        </button>
      </div>

      {/* Stats Cards */}
      <div className="row mb-4">
        <div className="col-md-3 mb-3">
          <div className="card text-center bg-primary text-white h-100">
            <div className="card-body">
              <i className="fas fa-users fa-3x mb-3"></i>
              <h2>{stats.totalEmployees}</h2>
              <p className="mb-0">Tá»•ng nhÃ¢n viÃªn</p>
            </div>
          </div>
        </div>

        <div className="col-md-3 mb-3">
          <div className="card text-center bg-success text-white h-100">
            <div className="card-body">
              <i className="fas fa-user-check fa-3x mb-3"></i>
              <h2>{stats.activeEmployees}</h2>
              <p className="mb-0">NhÃ¢n viÃªn hoáº¡t Ä‘á»™ng</p>
            </div>
          </div>
        </div>

        <div className="col-md-3 mb-3">
          <div className="card text-center bg-warning text-white h-100">
            <div className="card-body">
              <i className="fas fa-user-times fa-3x mb-3"></i>
              <h2>{stats.inactiveEmployees}</h2>
              <p className="mb-0">KhÃ´ng hoáº¡t Ä‘á»™ng</p>
            </div>
          </div>
        </div>

        <div className="col-md-3 mb-3">
          <div className="card text-center bg-info text-white h-100">
            <div className="card-body">
              <i className="fas fa-clock fa-3x mb-3"></i>
              <h2>{stats.totalAttendanceLogs}</h2>
              <p className="mb-0">Tá»•ng cháº¥m cÃ´ng</p>
            </div>
          </div>
        </div>
      </div>

      {/* Management Actions */}
      <div className="row mb-4">
        <div className="col-md-6">
          <div className="card">
            <div className="card-header">
              <h5 className="mb-0">Quáº£n lÃ½ nhÃ¢n sá»±</h5>
            </div>
            <div className="card-body">
              <div className="d-grid gap-2">
                <a href="/employee-management" className="btn btn-primary">
                  <i className="fas fa-users-cog me-2"></i>
                  Quáº£n lÃ½ nhÃ¢n viÃªn
                </a>
                <a href="/attendance-logs" className="btn btn-info">
                  <i className="fas fa-clock me-2"></i>
                  Xem cháº¥m cÃ´ng
                </a>
                <button className="btn btn-success" onClick={handleRefresh}>
                  <i className="fas fa-sync-alt me-2"></i>
                  Cáº­p nháº­t dá»¯ liá»‡u
                </button>
              </div>
            </div>
          </div>
        </div>

        <div className="col-md-6">
          <div className="card">
            <div className="card-header">
              <h5 className="mb-0">CÃ´ng cá»¥ HR</h5>
            </div>
            <div className="card-body">
              <div className="d-grid gap-2">
                <button className="btn btn-outline-primary" disabled>
                  <i className="fas fa-user-plus me-2"></i>
                  Tuyá»ƒn dá»¥ng (Sáº¯p cÃ³)
                </button>
                <button className="btn btn-outline-secondary" disabled>
                  <i className="fas fa-file-export me-2"></i>
                  Xuáº¥t bÃ¡o cÃ¡o (Sáº¯p cÃ³)
                </button>
                <a href="/dashboard" className="btn btn-outline-info">
                  <i className="fas fa-tachometer-alt me-2"></i>
                  Dashboard chÃ­nh
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* HR Reports Section */}
      <div className="row">
        <div className="col-12">
          <div className="card">
            <div className="card-header">
              <h5 className="mb-0">BÃ¡o cÃ¡o HR</h5>
            </div>
            <div className="card-body">
              <div className="row">
                <div className="col-md-4 text-center">
                  <div className="p-3">
                    <i className="fas fa-chart-bar fa-2x text-primary mb-2"></i>
                    <h6>BÃ¡o cÃ¡o nhÃ¢n sá»±</h6>
                    <button className="btn btn-sm btn-primary" disabled>
                      Xem bÃ¡o cÃ¡o (Sáº¯p cÃ³)
                    </button>
                  </div>
                </div>
                <div className="col-md-4 text-center">
                  <div className="p-3">
                    <i className="fas fa-chart-line fa-2x text-success mb-2"></i>
                    <h6>BÃ¡o cÃ¡o cháº¥m cÃ´ng</h6>
                    <button className="btn btn-sm btn-success" disabled>
                      Xem bÃ¡o cÃ¡o (Sáº¯p cÃ³)
                    </button>
                  </div>
                </div>
                <div className="col-md-4 text-center">
                  <div className="p-3">
                    <i className="fas fa-chart-pie fa-2x text-info mb-2"></i>
                    <h6>BÃ¡o cÃ¡o tá»•ng há»£p</h6>
                    <button className="btn btn-sm btn-info" disabled>
                      Xem bÃ¡o cÃ¡o (Sáº¯p cÃ³)
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default HRDashboardPage;

```


==================== File: .\src\pages\LoginPage.jsx ====================

import React, { useState, useEffect } from 'react';
import { Navigate } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import { useNotification } from '../hooks/useNotification';
import Loading from '../components/common/Loading';

const LoginPage = () => {
  const [credentials, setCredentials] = useState({
    username: '',
    password: ''
  });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [errors, setErrors] = useState({});
  
  const { user, login, loading } = useAuth();
  const { showNotification } = useNotification();

  useEffect(() => {
    // Clear any existing alerts
    const alertContainer = document.getElementById('alert-container');
    if (alertContainer) {
      alertContainer.innerHTML = '';
    }
  }, []);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setCredentials(prev => ({
      ...prev,
      [name]: value
    }));
    
    // Clear error when user starts typing
    if (errors[name]) {
      setErrors(prev => ({
        ...prev,
        [name]: ''
      }));
    }
  };

  const validateForm = () => {
    const newErrors = {};
    
    if (!credentials.username.trim()) {
      newErrors.username = 'Vui lÃ²ng nháº­p tÃªn Ä‘Äƒng nháº­p';
    }
    
    if (!credentials.password.trim()) {
      newErrors.password = 'Vui lÃ²ng nháº­p máº­t kháº©u';
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
      showNotification('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!', 'error');
      return;
    }

    setIsSubmitting(true);
    
    try {
      const response = await login(credentials);
      
      showNotification('ÄÄƒng nháº­p thÃ nh cÃ´ng!', 'success');
      
      // Redirect based on role after short delay
      setTimeout(() => {
        if (response.user.role === 'hr' || response.user.role === 'admin') {
          window.location.href = '/hr-dashboard';
        } else {
          window.location.href = '/dashboard';
        }
      }, 1000);
      
    } catch (error) {
      console.error('Login error:', error);
      showNotification('TÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng!', 'error');
    } finally {
      setIsSubmitting(false);
    }
  };

  // Redirect if already logged in
  if (user) {
    const redirectPath = user.role === 'hr' || user.role === 'admin' ? '/hr-dashboard' : '/dashboard';
    return <Navigate to={redirectPath} replace />;
  }

  // Show loading during auth check
  if (loading) {
    return (
      <div className="d-flex justify-content-center align-items-center min-vh-100">
        <Loading />
      </div>
    );
  }

  return (
    <div className="min-vh-100 d-flex align-items-center justify-content-center bg-light">
      <div className="container">
        <div className="row justify-content-center">
          <div className="col-md-6 col-lg-4">
            <div className="card shadow">
              <div className="card-body p-4">
                <div className="text-center mb-4">
                  <h2 className="card-title">ÄÄƒng nháº­p</h2>
                  <p className="text-muted">Há»‡ thá»‘ng quáº£n lÃ½ nhÃ¢n sá»±</p>
                </div>

                <form onSubmit={handleSubmit} noValidate>
                  <div className="mb-3">
                    <label htmlFor="username" className="form-label">
                      TÃªn Ä‘Äƒng nháº­p <span className="text-danger">*</span>
                    </label>
                    <input
                      type="text"
                      className={`form-control ${errors.username ? 'is-invalid' : ''}`}
                      id="username"
                      name="username"
                      value={credentials.username}
                      onChange={handleInputChange}
                      placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p"
                      disabled={isSubmitting}
                      required
                    />
                    {errors.username && (
                      <div className="invalid-feedback">
                        {errors.username}
                      </div>
                    )}
                  </div>

                  <div className="mb-4">
                    <label htmlFor="password" className="form-label">
                      Máº­t kháº©u <span className="text-danger">*</span>
                    </label>
                    <input
                      type="password"
                      className={`form-control ${errors.password ? 'is-invalid' : ''}`}
                      id="password"
                      name="password"
                      value={credentials.password}
                      onChange={handleInputChange}
                      placeholder="Nháº­p máº­t kháº©u"
                      disabled={isSubmitting}
                      required
                    />
                    {errors.password && (
                      <div className="invalid-feedback">
                        {errors.password}
                      </div>
                    )}
                  </div>

                  <button
                    type="submit"
                    className="btn btn-primary w-100"
                    disabled={isSubmitting}
                  >
                    {isSubmitting ? (
                      <>
                        <span className="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        Äang Ä‘Äƒng nháº­p...
                      </>
                    ) : (
                      'ÄÄƒng nháº­p'
                    )}
                  </button>
                </form>

                {/* Demo credentials info */}
                <div className="mt-4 p-3 bg-light rounded">
                  <small className="text-muted">
                    <strong>TÃ i khoáº£n demo:</strong><br />
                    Admin: admin / admin123<br />
                    HR: hr / hr123<br />
                    Sales: sales / sales123
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default LoginPage;

```


==================== File: .\src\services\api.js ====================

// API helper functions - converted from vanilla JS
export class ApiClient {
  static async request(url, options = {}) {
    try {
      const response = await fetch(url, {
        headers: {
          'Content-Type': 'application/json',
          ...options.headers
        },
        credentials: 'include',
        ...options
      });

      // âœ… THÃŠM: Log request details Ä‘á»ƒ debug
      console.log('API Request:', {
        url,
        method: options.method || 'GET',
        body: options.body,
        status: response.status,
        statusText: response.statusText
      });

      if (!response.ok) {
        let errorData;
        try {
          errorData = await response.json();
          // âœ… THÃŠM: Log full error response
          console.error('Server error response:', errorData);
        } catch (parseError) {
          console.error('Could not parse error response:', parseError);
          errorData = { error: `HTTP ${response.status}: ${response.statusText}` };
        }
        
        // âœ… Sá»¬A: Tráº£ vá» object chá»©a Ä‘áº§y Ä‘á»§ thÃ´ng tin lá»—i
        throw new Error(JSON.stringify({
          status: response.status,
          message: errorData.message || errorData.error || 'Request failed',
          details: errorData
        }));
      }

      const data = await response.json();
      console.log('API Response:', data);
      return data;
    } catch (error) {
      console.error('API request error:', error);
      throw error;
    }
  }

  static async get(url, params = {}) {
    const queryString = new URLSearchParams(params).toString();
    const fullUrl = queryString ? `${url}?${queryString}` : url;
    return this.request(fullUrl);
  }

  static async post(url, data) {
    return this.request(url, {
      method: 'POST',
      body: JSON.stringify(data)
    });
  }

  static async put(url, data) {
    return this.request(url, {
      method: 'PUT',
      body: JSON.stringify(data)
    });
  }

  static async delete(url) {
    return this.request(url, {
      method: 'DELETE'
    });
  }
}

export default ApiClient;

```


==================== File: .\src\services\auth.js ====================


```


==================== File: .\src\services\employee.js ====================

import { ApiClient } from './api.js';

/**
 * Service layer Ä‘á»ƒ quáº£n lÃ½ cÃ¡c API liÃªn quan Ä‘áº¿n NhÃ¢n viÃªn.
 */
export const employeeService = {
  /**
   * Láº¥y danh sÃ¡ch táº¥t cáº£ nhÃ¢n viÃªn.
   * @returns {Promise<object>} Response tá»« API.
   */
  getAll() {
    console.log('SERVICE (FE): Gá»i API láº¥y danh sÃ¡ch nhÃ¢n viÃªn...');
    return ApiClient.get('/api/employees');
  },

  /**
   * ThÃªm má»™t nhÃ¢n viÃªn má»›i.
   * @param {object} employeeData - Dá»¯ liá»‡u cá»§a nhÃ¢n viÃªn má»›i.
   * @returns {Promise<object>} Response tá»« API.
   */
  create(employeeData) {
    console.log('SERVICE (FE): Gá»i API thÃªm nhÃ¢n viÃªn má»›i...', employeeData);
    return ApiClient.post('/api/employees', employeeData);
  },

  /**
   * Cáº­p nháº­t thÃ´ng tin má»™t nhÃ¢n viÃªn.
   * @param {string} id - ID cá»§a nhÃ¢n viÃªn (record_id tá»« Lark).
   * @param {object} employeeData - Dá»¯ liá»‡u cáº§n cáº­p nháº­t.
   * @returns {Promise<object>} Response tá»« API.
   */
  update(id, employeeData) {
    console.log(`SERVICE (FE): Gá»i API cáº­p nháº­t nhÃ¢n viÃªn ID: ${id}...`, employeeData);
    return ApiClient.put(`/api/employees/${id}`, employeeData);
  },

  /**
   * XÃ³a má»™t nhÃ¢n viÃªn.
   * @param {string} id - ID cá»§a nhÃ¢n viÃªn (record_id tá»« Lark).
   * @returns {Promise<object>} Response tá»« API.
   */
  remove(id) {
    console.log(`SERVICE (FE): Gá»i API xÃ³a nhÃ¢n viÃªn ID: ${id}...`);
    return ApiClient.delete(`/api/employees/${id}`);
  },

  /**
   * Láº¥y danh sÃ¡ch cÃ¡c Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t.
   * @returns {Promise<object>} Response tá»« API.
   */
  getApprovedRecruitmentRequests() {
    console.log('SERVICE (FE): Gá»i API láº¥y danh sÃ¡ch Ä‘á» xuáº¥t tuyá»ƒn dá»¥ng...');
    
    return ApiClient.get('/api/recruitment', {
      params: {
        status: 'Äang tuyá»ƒn dá»¥ng'
      }
    });
  }
};

```


==================== File: .\src\styles\components.css ====================


```


==================== File: .\src\styles\globals.css ====================

/* Global styles for React app */
.loading {
  position: relative;
}

.loading::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.min-vh-100 {
  min-height: 100vh;
}

/* Alert container */
#alert-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1055;
  min-width: 300px;
}

/* Table enhancements */
.table-hover tbody tr:hover {
  background-color: rgba(0, 0, 0, 0.075);
}

/* Button groups */
.btn-group .btn {
  margin-right: 2px;
}

.btn-group .btn:last-child {
  margin-right: 0;
}

/* Form enhancements */
.is-invalid {
  border-color: #dc3545;
}

.is-valid {
  border-color: #198754;
}

/* Modal enhancements */
.modal-backdrop {
  backdrop-filter: blur(2px);
}

/* Work history entries */
.work-history-entry {
  background: #f8f9fa;
  border-left: 4px solid #007bff;
}

/* Recruitment table */
.recruitment-row.table-primary {
  background-color: rgba(13, 110, 253, 0.1) !important;
}

/* Loading spinner */
.spinner-border-sm {
  width: 1rem;
  height: 1rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .btn-group {
    flex-direction: column;
  }
  
  .btn-group .btn {
    margin-right: 0;
    margin-bottom: 2px;
  }
  
  .table-responsive {
    font-size: 0.875rem;
  }
}

```


================================================================================
3. THá»NG KÃŠ Tá»”NG QUAN:
----------------------------------------
ğŸ“Š Tá»•ng sá»‘ file Ä‘Ã£ phÃ¢n tÃ­ch: 93
ğŸ“Š Tá»•ng sá»‘ dÃ²ng code (Æ°á»›c tÃ­nh): 15523

================================================================================
BÃ¡o cÃ¡o Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng!
================================================================================
