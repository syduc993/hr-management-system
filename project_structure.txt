ğŸ“‚ Cáº¥u trÃºc thÆ° má»¥c: .
==================================================
ğŸ“„ .dockerignore
  === Ná»™i dung .dockerignore ===
# CÃ¡c thÆ° má»¥c dependencies cá»¥c bá»™
node_modules/
server/node_modules/

# ThÆ° má»¥c build (sáº½ Ä‘Æ°á»£c táº¡o bÃªn trong container)
dist/
build/

# CÃ¡c file cáº¥u hÃ¬nh vÃ  log cá»§a mÃ´i trÆ°á»ng local
# DÃ²ng '.env' Ä‘Ã£ Ä‘Æ°á»£c xÃ³a Ä‘á»ƒ cho phÃ©p Docker sao chÃ©p file cáº¥u hÃ¬nh nÃ y
.env.*
npm-debug.log*
yarn-debug.log*
yarn-error.log*
cookies.txt
project_analysis.txt

# File Jupyter Notebook (náº¿u cÃ³)
Getcode.ipynb

# ThÆ° má»¥c há»‡ thá»‘ng cá»§a Git vÃ  cÃ¡c IDE
.git
.gitignore
.idea
.vscode
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

  === Káº¿t thÃºc .dockerignore ===
ğŸ“„ Dockerfile
  === Ná»™i dung Dockerfile ===
# ==============================================================================
# STAGE 1: Build Frontend (React)
# ==============================================================================
# Sá»­ dá»¥ng má»™t Node.js image lÃ m base Ä‘á»ƒ build
FROM node:20-alpine AS builder

# Thiáº¿t láº­p thÆ° má»¥c lÃ m viá»‡c trong container
WORKDIR /app

# Sao chÃ©p cÃ¡c file quáº£n lÃ½ package vÃ  cÃ i Ä‘áº·t dependencies
# Äiá»u nÃ y táº­n dá»¥ng Docker layer caching, chá»‰ cÃ i láº¡i khi package.json thay Ä‘á»•i
COPY package.json package-lock.json ./
RUN npm install

# Sao chÃ©p toÃ n bá»™ source code cá»§a project vÃ o container
COPY . .

# Cháº¡y lá»‡nh build cá»§a Vite Ä‘á»ƒ táº¡o ra cÃ¡c file static cho frontend
# CÃ¡c file nÃ y sáº½ Ä‘Æ°á»£c lÆ°u trong thÆ° má»¥c /app/dist
RUN npm run build

# ==============================================================================
# STAGE 2: Production Image
# ==============================================================================
# Báº¯t Ä‘áº§u má»™t stage má»›i tá»« má»™t base image Node.js gá»n nháº¹
FROM node:20-alpine

# Thiáº¿t láº­p thÆ° má»¥c lÃ m viá»‡c cho mÃ´i trÆ°á»ng production
WORKDIR /app

# Sao chÃ©p cÃ¡c file quáº£n lÃ½ package tá»« stage trÆ°á»›c
COPY package.json package-lock.json ./

# --- Báº®T Äáº¦U PHáº¦N ÄÃƒ Sá»¬A ---
# Sao chÃ©p file .env vÃ o trong image.
# Lá»‡nh nÃ y sáº½ hoáº¡t Ä‘á»™ng sau khi báº¡n Ä‘Ã£ xÃ³a dÃ²ng '.env' khá»i file .dockerignore.
# Nhá» cÃ³ file nÃ y, lá»‡nh dotenv.config() trong server.js sáº½ cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c cÃ¡c biáº¿n mÃ´i trÆ°á»ng.
COPY .env .
# --- Káº¾T THÃšC PHáº¦N ÄÃƒ Sá»¬A ---

# Chá»‰ cÃ i Ä‘áº·t cÃ¡c dependencies cáº§n thiáº¿t cho production (bá» qua devDependencies)
RUN npm install --omit=dev

# Sao chÃ©p mÃ£ nguá»“n cá»§a server tá»« thÆ° má»¥c local
COPY --chown=node:node ./server ./server

# Sao chÃ©p thÆ° má»¥c build cá»§a frontend tá»« stage "builder"
# Káº¿t quáº£ build cá»§a React sáº½ Ä‘Æ°á»£c Ä‘áº·t vÃ o thÆ° má»¥c /app/dist
COPY --chown=node:node --from=builder /app/dist ./dist

# Má»Ÿ cá»•ng 8080 mÃ  server Express Ä‘ang láº¯ng nghe
EXPOSE 8080

# Chuyá»ƒn sang ngÆ°á»i dÃ¹ng "node" khÃ´ng cÃ³ quyá»n root Ä‘á»ƒ tÄƒng cÆ°á»ng báº£o máº­t
USER node

# Lá»‡nh máº·c Ä‘á»‹nh Ä‘á»ƒ khá»Ÿi cháº¡y serv...
  === Káº¿t thÃºc Dockerfile ===
ğŸ“„ Getcode.ipynb
  === Ná»™i dung Getcode.ipynb ===
{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "68a6e605",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "3f21e831",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "ÄÃ£ lÆ°u cáº¥u trÃºc vÃ o file project_structure.txt\n",
      "\n",
      "Preview:\n",
      "ğŸ“‚ Cáº¥u trÃºc thÆ° má»¥c: .\n",
      "==================================================\n",
      "ğŸ“„ .dockerignore\n",
      "  === Ná»™i dung .dockerignore ===\n",
      "# CÃ¡c thÆ° má»¥c dependencies cá»¥c bá»™\n",
      "node_modules/\n",
      "server/node_modules/\n",
      "\n",
      "# ThÆ° má»¥c build (sáº½ Ä‘Æ°á»£c táº¡o bÃªn trong container)\n",
      "dist/\n",
      "build/\n",
      "\n",
      "# CÃ¡c file cáº¥u hÃ¬nh vÃ  log cá»§a mÃ´i trÆ°á»ng local\n",
      "# DÃ²ng '.env' Ä‘Ã£ Ä‘Æ°á»£c xÃ³a Ä‘á»ƒ cho phÃ©p Docker sao chÃ©p file cáº¥u hÃ¬nh nÃ y\n",
      ".env.*\n",
      "npm-debug.log*\n",
      "yarn-debug.log*\n",
      "yarn-error.log*\n",
      "cookies.txt\n",
      "project_analysis.txt\n",
      "\n",
      "# File Jupyter Notebook (náº¿u cÃ³)\n",
      "Getcode.ipynb\n",
      "\n",
      "# ThÆ° má»¥c há»‡ thá»‘ng cá»§a Git vÃ  cÃ¡c IDE\n",
      ".git\n",
      ".gitignore\n",
      ".idea\n",
      ".vscode\n",
      "*.suo\n",
      "*.ntvs*\n",
      "*.njsproj\n",
      "*.sln\n",
      "*.sw?\n",
      "\n",
      "  === Káº¿t thÃºc .dockerignore ===\n",
      "ğŸ“„ Dockerfile\n",
      "  === Ná»™i dung Dockerfile ===\n",
      "# ==============================================================================\n",
      "# STAGE 1: Build Frontend (React)\n",
      "# ==============================================================================\n",
      "# Sá»­ dá»¥ng má»™t Node.js image lÃ m base Ä‘á»ƒ build\n",
      "FROM node:20-alpine AS builder\n",
      "\n",
      "# Thiáº¿t láº­p thÆ° má»¥c lÃ m viá»‡c tron...\n"
     ]
    }
   ],
   "source": [
    "import os\n",
    "import fnmatch\n",
  ...
  === Káº¿t thÃºc Getcode.ipynb ===
ğŸ“„ Readme.md
  === Ná»™i dung Readme.md ===
Há»† THá»NG QUáº¢N LÃ NHÃ‚N Sá»° (HR Management System)
ÄÃ¢y lÃ  tÃ i liá»‡u hÆ°á»›ng dáº«n vá» kiáº¿n trÃºc, luá»“ng hoáº¡t Ä‘á»™ng vÃ  cÃ¡ch phÃ¡t triá»ƒn cÃ¡c tÃ­nh nÄƒng má»›i cho dá»± Ã¡n.

1. Luá»“ng Hoáº¡t Äá»™ng Cá»§a Má»™t TÃ­nh NÄƒng (VÃ­ dá»¥: ThÃªm NhÃ¢n ViÃªn Má»›i)
TÃ­nh nÄƒng "ThÃªm nhÃ¢n viÃªn má»›i" lÃ  má»™t vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh cho tháº¥y sá»± tÆ°Æ¡ng tÃ¡c giá»¯a Frontend vÃ  Backend. Luá»“ng dá»¯ liá»‡u Ä‘i tá»« giao diá»‡n ngÆ°á»i dÃ¹ng, qua cÃ¡c táº§ng xá»­ lÃ½ á»Ÿ client, gá»­i yÃªu cáº§u Ä‘áº¿n server, server xá»­ lÃ½ vÃ  lÆ°u vÃ o "database" (Lark Bitable), sau Ä‘Ã³ tráº£ káº¿t quáº£ vá» cho client.

a. PhÃ­a Frontend (React)
Giao diá»‡n ngÆ°á»i dÃ¹ng (src/components/employee/EmployeeAddForm.jsx)

NgÆ°á»i dÃ¹ng nháº­p thÃ´ng tin (Há» tÃªn, SÄT, Giá»›i tÃ­nh, NgÃ¢n hÃ ng...) vÃ o cÃ¡c Ã´ input trong form.

NgÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt "Chá»n Äá» xuáº¥t Tuyá»ƒn dá»¥ng", má»™t modal (RecruitmentModal.jsx) hiá»‡n lÃªn Ä‘á»ƒ chá»n.

Tráº¡ng thÃ¡i cá»§a form Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi useState trong component.

Xá»­ lÃ½ sá»± kiá»‡n (src/components/employee/EmployeeAddForm.jsx)

Khi ngÆ°á»i dÃ¹ng nháº¥n nÃºt "LÆ°u NhÃ¢n viÃªn", hÃ m handleSubmit Ä‘Æ°á»£c kÃ­ch hoáº¡t.

HÃ m nÃ y thá»±c hiá»‡n validation cÆ¡ báº£n, sau Ä‘Ã³ Ä‘Ã³ng gÃ³i dá»¯ liá»‡u (bao gá»“m thÃ´ng tin cÃ¡ nhÃ¢n vÃ  workHistoryData) thÃ nh má»™t Ä‘á»‘i tÆ°á»£ng payload.

Gá»i Hook (src/pages/EmployeeManagementPage.jsx)

EmployeeAddForm gá»i hÃ m onSave Ä‘Æ°á»£c truyá»n tá»« trang cha lÃ  EmployeeManagementPage.

HÃ m onSave nÃ y chÃ­nh lÃ  handleAddEmployee Ä‘Æ°á»£c cung cáº¥p bá»Ÿi hook useEmployees.

Xá»­ lÃ½ logic trong Hook (src/hooks/useEmployees.js)

Hook useEmployees nháº­n payload vÃ  gá»i hÃ m addEmployee tá»« táº§ng service cá»§a client.

NÃ³ quáº£n lÃ½ tráº¡ng thÃ¡i loading vÃ  hiá»ƒn thá»‹ thÃ´ng bÃ¡o (thÃ nh cÃ´ng/tháº¥t báº¡i) thÃ´ng qua useNotification.

Táº§ng Service Client (src/services/employee.js)

HÃ m addEmployee trong file nÃ y táº¡o vÃ  gá»­i má»™t yÃªu cáº§u HTTP POST Ä‘áº¿n API cá»§a server táº¡i endpoint /api/employees báº±ng axios (thÃ´ng qua ApiClient).

b. PhÃ­a Backend (Node.js/Express)
Tiáº¿p nháº­n yÃªu cáº§u (server/server.js)

Server Express nháº­n yÃªu cáº§u POST táº¡i /api/employees.

Äá»‹nh tuyáº¿n (server/routes/employees.js)

Router xá»­ lÃ½ endpoint /api/employees. NÃ³ Ã¡p dá»¥ng cÃ¡c middlew...
  === Káº¿t thÃºc Readme.md ===
ğŸ“„ cookies.txt
  === Ná»™i dung cookies.txt ===
# Netscape HTTP Cookie File
# https://curl.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.


  === Káº¿t thÃºc cookies.txt ===
ğŸ“„ index.html
  === Ná»™i dung index.html ===
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cháº¥m cÃ´ng thá»i vá»¥</title>
</head>
<body>
  <div id="root"></div>
  <div id="alert-container"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>
</html>

  === Káº¿t thÃºc index.html ===
ğŸ“„ package-lock.json
  (File quÃ¡ lá»›n)
ğŸ“„ package.json
  === Ná»™i dung package.json ===
{
  "name": "hr-management-system-react",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "server": "node server/server.js"
  },
  "dependencies": {
    "@fortawesome/fontawesome-free": "^6.7.2",
    "axios": "^1.10.0",
    "bootstrap": "^5.3.7",
    "cors": "^2.8.5",
    "dotenv": "^16.6.1",
    "express": "^4.21.2",
    "express-session": "^1.18.2",
    "jspdf": "^3.0.1",
    "jspdf-autotable": "^5.0.2",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.30.1"
  },
  "devDependencies": {
    "@types/react": "^18.0.28",
    "@types/react-dom": "^18.0.11",
    "@vitejs/plugin-react": "^3.1.0",
    "eslint": "^8.38.0",
    "eslint-plugin-react": "^7.32.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.3.4",
    "vite": "^4.5.14"
  }
}

  === Káº¿t thÃºc package.json ===
ğŸ“„ project_analysis.txt
  (File quÃ¡ lá»›n)
ğŸ“„ project_structure.txt
  (File quÃ¡ lá»›n)
ğŸ“ public/
  ğŸ“ fonts/
    ğŸ“„ Roboto-Bold.ttf
      (File quÃ¡ lá»›n)
    ğŸ“„ Roboto-Regular.ttf
      (File quÃ¡ lá»›n)
ğŸ“ server/
  ğŸ“ config/
    ğŸ“„ database.js
      === Ná»™i dung database.js ===
// Demo users data (in production, use real database)
const users = {
    admin: {
        id: 'admin',
        username: 'admin',
        password: 'atino2025',
        role: 'admin',
        fullName: 'System Admin'
    },
    hr: {
        id: 'hr',
        username: 'hr',
        password: 'hr123',
        role: 'hr',
        fullName: 'HR Manager'
    },
    sales: {
        id: 'sales',
        username: 'sales',
        password: 'sales123',
        role: 'sales_manager',
        fullName: 'Sales Manager'
    },
    finance: {
        id: 'finance',
        username: 'finance',
        password: 'finance123',
        role: 'finance_manager',
        fullName: 'Finance Manager'
    },
    director: {
        id: 'director',
        username: 'director',
        password: 'director123',
        role: 'director',
        fullName: 'Director'
    }
};

const roles = {
    admin: 'Admin',
    hr: 'HR',
    sales_manager: 'TrÆ°á»Ÿng phÃ²ng kinh doanh',
    finance_manager: 'TrÆ°á»Ÿng phÃ²ng tÃ i chÃ­nh káº¿ toÃ¡n',
    director: 'Tá»•ng giÃ¡m Ä‘á»‘c'
};

export {
    users,
    roles
};

      === Káº¿t thÃºc database.js ===
    ğŸ“„ lark-config.js
      === Ná»™i dung lark-config.js ===
// server/config/lark-config.js
export const validateLarkConfig = () => {
    const requiredVars = [
        'LARK_APP_ID',
        'LARK_APP_SECRET', 
        'LARK_BASE_ID',
        'LARK_EMPLOYEE_TABLE_ID',
        'LARK_ATTENDANCE_TABLE_ID',
        'LARK_RECRUITMENT_TABLE_ID',
        'LARK_STORE_TABLE_ID',
        'LARK_POSITION_TABLE_ID',
        'LARK_WORK_HISTORY_TABLE_ID',
        'LARK_HOURS_SUMMARY_TABLE_ID'
    ];

    const missing = requiredVars.filter(key => !process.env[key]);
    
    if (missing.length > 0) {
        throw new Error(`âŒ Missing Lark configuration: ${missing.join(', ')}`);
    }
    
    console.log('âœ… Lark configuration validated');
};

export const larkConfig = {
    appId: process.env.LARK_APP_ID,
    appSecret: process.env.LARK_APP_SECRET,
    baseId: process.env.LARK_BASE_ID,
    tables: {
        employee: process.env.LARK_EMPLOYEE_TABLE_ID,
        attendance: process.env.LARK_ATTENDANCE_TABLE_ID,
        recruitment: process.env.LARK_RECRUITMENT_TABLE_ID,
        store: process.env.LARK_STORE_TABLE_ID,
        position: process.env.LARK_POSITION_TABLE_ID,
        workHistory: process.env.LARK_WORK_HISTORY_TABLE_ID,
        hoursSummary: process.env.LARK_HOURS_SUMMARY_TABLE_ID
    }
};
      === Káº¿t thÃºc lark-config.js ===
  ğŸ“ controllers/
    ğŸ“„ attendanceController.js
      === Ná»™i dung attendanceController.js ===
// server/controllers/attendanceController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';


/* ======================= Láº¥y danh sÃ¡ch báº£n ghi cháº¥m cÃ´ng ======================= */
/**
 * GET: Láº¥y danh sÃ¡ch cÃ¡c báº£n ghi cháº¥m cÃ´ng (attendance logs) dá»±a trÃªn filter tá»« query parameters.
 * - Tráº£ vá» data báº£n ghi cháº¥m cÃ´ng dáº¡ng list.
 * - Xá»­ lÃ½ lá»—i vÃ  gá»­i error message náº¿u cÃ³ váº¥n Ä‘á».
 */
export const getAttendanceLogs = async (req, res) => {
    try {
        const filters = req.query;
        const attendanceService = larkServiceManager.getService('attendance');
        const logs = await attendanceService.getAttendanceLogs(filters);
        
        res.json(formatResponse(true, 'Láº¥y báº£n ghi cháº¥m cÃ´ng thÃ nh cÃ´ng', logs));
    } catch (error) {
        console.error('âŒ Controller: getAttendanceLogs failed:', error);
        res.status(500).json(formatResponse(
            false, 
            `Lá»—i khi láº¥y báº£n ghi cháº¥m cÃ´ng: ${error.message}`, 
            null, 
            'ATTENDANCE_LOAD_FAILED'
        ));
    }
};


/* ======================= ThÃªm báº£n ghi cháº¥m cÃ´ng má»›i ======================= */
/**
 * POST: ThÃªm má»™t báº£n ghi cháº¥m cÃ´ng má»›i cho nhÃ¢n viÃªn.
 * - Nháº­n attendanceData tá»« body request (employeeId, type, position).
 * - Validate dá»¯ liá»‡u (Ä‘áº§y Ä‘á»§, há»£p lá»‡).
 * - Gá»i service Ä‘á»ƒ lÆ°u báº£n ghi má»›i vÃ o há»‡ thá»‘ng.
 * - Tráº£ káº¿t quáº£ thÃ nh cÃ´ng/tháº¥t báº¡i cho client.
 */
export const addAttendanceLog = async (req, res) => {
    try {
        const attendanceData = req.body;
        
        // Validate required fields
        if (!attendanceData.employeeId || !attendanceData.type || !attendanceData.position) {
            return res.status(400).json(formatResponse(
                false, 
                'Thiáº¿u thÃ´ng tin báº¯t buá»™c: employeeId, type (Checkin/Checkout), position', 
                null, 
                'VALIDATION_ERROR'
            ));
        }

        // Valida...
      === Káº¿t thÃºc attendanceController.js ===
    ğŸ“„ authController.js
      === Ná»™i dung authController.js ===
// server/controllers/authController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

/**
 * Xá»­ lÃ½ Ä‘Äƒng nháº­p ngÆ°á»i dÃ¹ng.
 * Controller gá»i Ä‘áº¿n AuthService Ä‘á»ƒ xÃ¡c thá»±c.
 * @route POST /api/auth/login
 */
const login = async (req, res) => {
    try {
        const { username, password } = req.body;
        const authService = larkServiceManager.getService('auth');

        // Gá»i service Ä‘á»ƒ xá»­ lÃ½ logic Ä‘Äƒng nháº­p
        const result = await authService.login({ username, password });

        // Náº¿u service tráº£ vá» thÃ nh cÃ´ng, táº¡o session
        if (result.success) {
            req.session.user = {
                id: result.user.id,
                username: result.user.username,
                role: result.user.role,
                fullName: result.user.fullName
            };
            
            // Tráº£ vá» response thÃ nh cÃ´ng vá»›i thÃ´ng tin user
            res.json(formatResponse(true, result.message, { user: req.session.user }));
        } else {
            // TrÆ°á»ng há»£p service xá»­ lÃ½ nhÆ°ng khÃ´ng thÃ nh cÃ´ng (Ã­t xáº£y ra vá»›i logic hiá»‡n táº¡i)
             res.status(401).json(formatResponse(false, result.message, null, 'LOGIN_FAILED'));
        }

    } catch (error) {
        // Báº¯t lá»—i do service throw (vÃ­ dá»¥: sai credentials)
        console.error('âŒ Controller: login failed:', error.message);
        res.status(401).json(formatResponse(false, 'TÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng.', null, 'INVALID_CREDENTIALS'));
    }
};

/**
 * Xá»­ lÃ½ Ä‘Äƒng xuáº¥t ngÆ°á»i dÃ¹ng.
 * @route POST /api/auth/logout
 */
const logout = (req, res) => {
    req.session.destroy((err) => {
        if (err) {
            console.error('âŒ Controller: logout failed:', err);
            return res.status(500).json(formatResponse(false, 'KhÃ´ng thá»ƒ Ä‘Äƒng xuáº¥t', null, 'LOGOUT_ERROR'));
        }
        res.clearCookie('connect.sid'); // XÃ³a cookie session phÃ­a client
        res.json(formatResponse...
      === Káº¿t thÃºc authController.js ===
    ğŸ“„ dashboardController.js
      === Ná»™i dung dashboardController.js ===
// server/controllers/dashboardController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';
import TimezoneService from '../core/timezone-service.js';

/**
 * Controller Ä‘á»ƒ láº¥y dá»¯ liá»‡u thá»‘ng kÃª cho dashboard.
 * HÃ m nÃ y sáº½ Ä‘Æ°á»£c gá»i khi cÃ³ request Ä‘áº¿n endpoint tÆ°Æ¡ng á»©ng.
 * @param {object} req - Äá»‘i tÆ°á»£ng request cá»§a Express.
 * @param {object} res - Äá»‘i tÆ°á»£ng response cá»§a Express.
 */
export const getDashboardStats = async (req, res) => {
    try {
        // Service 'employee' Ä‘á»ƒ xá»­ lÃ½ cÃ¡c nghiá»‡p vá»¥ liÃªn quan Ä‘áº¿n nhÃ¢n viÃªn.
        const employeeService = larkServiceManager.getService('employee');
        // Service 'attendance' Ä‘á»ƒ xá»­ lÃ½ cÃ¡c nghiá»‡p vá»¥ liÃªn quan Ä‘áº¿n cháº¥m cÃ´ng.
        const attendanceService = larkServiceManager.getService('attendance');

        // Khá»Ÿi táº¡o Ä‘á»‘i tÆ°á»£ng Ä‘á»ƒ lÆ°u trá»¯ thá»‘ng kÃª nhÃ¢n viÃªn vá»›i giÃ¡ trá»‹ máº·c Ä‘á»‹nh. Viá»‡c nÃ y Ä‘áº£m báº£o ráº±ng dÃ¹ cÃ³ lá»—i xáº£y ra, cáº¥u trÃºc dá»¯ liá»‡u tráº£ vá» váº«n nháº¥t quÃ¡n.
        let employeeStats = {
            totalEmployees: 0,
            activeEmployees: 0,
            error: null
        };

        let attendanceStats = {
            totalAttendanceLogs: 0,
            todayLogs: 0,
            error: null
        };

        // --- Báº¯t Ä‘áº§u láº¥y thá»‘ng kÃª nhÃ¢n viÃªn ---
        try {
            // Gá»i hÃ m tá»« service Ä‘á»ƒ láº¥y danh sÃ¡ch táº¥t cáº£ nhÃ¢n viÃªn. 'await' Ä‘Æ°á»£c sá»­ dá»¥ng vÃ¬ Ä‘Ã¢y lÃ  má»™t thao tÃ¡c báº¥t Ä‘á»“ng bá»™.
            const employees = await employeeService.getAllEmployees();

            // TÃ­nh toÃ¡n vÃ  cáº­p nháº­t cÃ¡c sá»‘ liá»‡u thá»‘ng kÃª.
            employeeStats = {
                totalEmployees: employees.length,
                activeEmployees: employees.filter(emp => emp.status === 'active').length,
                error: null
            };
        } catch (error) {
            console.error('âŒ Employee stats error:', error);
            employeeStats.error = 'KhÃ´ng thá»ƒ táº£i thá»‘ng kÃª nhÃ¢n viÃªn';
        }

        // --- ...
      === Káº¿t thÃºc dashboardController.js ===
    ğŸ“„ employeeController.js
      === Ná»™i dung employeeController.js ===
// server/controllers/employeeController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';
import CacheService from '../services/core/cache-service.js';
class EmployeeController {



    /* =================================================================================== */
    /* ======================= API ChÃ­nh - Quáº£n lÃ½ NhÃ¢n viÃªn ======================= */
    /* =================================================================================== */



    /* ======================= Quáº£n lÃ½ danh sÃ¡ch nhÃ¢n viÃªn ======================= */
    /**
     * GET: Láº¥y danh sÃ¡ch táº¥t cáº£ nhÃ¢n viÃªn trong há»‡ thá»‘ng.
     * - Tráº£ vá» array chá»©a thÃ´ng tin cÆ¡ báº£n cá»§a táº¥t cáº£ nhÃ¢n viÃªn.
     * - KhÃ´ng cÃ³ filter, pagination (láº¥y táº¥t cáº£).
     * @route GET /api/employees
     */
    async getAllEmployees(req, res) {
        try {
            const employeeService = larkServiceManager.getService('employee');
            const employees = await employeeService.getAllEmployees();

            res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch nhÃ¢n viÃªn thÃ nh cÃ´ng', employees));
        } catch (error) {
            console.error('âŒ CONTROLLER: Lá»—i khi láº¥y danh sÃ¡ch nhÃ¢n viÃªn:', error);
            res.status(500).json(formatResponse(
                false, 
                `KhÃ´ng thá»ƒ táº£i danh sÃ¡ch nhÃ¢n viÃªn: ${error.message}`, 
                null, 
                'EMPLOYEE_LOAD_FAILED'
            ));
        }
    }


    /**
     * GET: TÃ¬m kiáº¿m nhÃ¢n viÃªn dá»±a trÃªn má»™t chuá»—i truy váº¥n.
     * @route GET /api/employees/search
     */
    async searchEmployees(req, res) {
        try {
            const { q } = req.query;
            const employees = await larkServiceManager.searchEmployees(q);
            res.json(formatResponse(true, 'TÃ¬m kiáº¿m thÃ nh cÃ´ng', employees));
        } catch (error) {
            console.error('âŒ Controller: searchEmployees failed:', error);
            res.status(5...
      === Káº¿t thÃºc employeeController.js ===
    ğŸ“„ positionController.js
      === Ná»™i dung positionController.js ===
// server/controllers/positionController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

// ==================== POSITION MANAGEMENT ====================
export const getPositions = async (req, res) => {
    try {
        const positions = await larkServiceManager.getAllPositions();
        res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch vá»‹ trÃ­ thÃ nh cÃ´ng', positions));
    } catch (error) {
        console.error('âŒ Controller: getPositions failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi táº£i danh sÃ¡ch vá»‹ trÃ­: ${error.message}`, null, 'POSITION_LOAD_FAILED'));
    }
};

export const addPosition = async (req, res) => {
    try {
        const { positionName, description } = req.body;
        // (Validation sáº½ Ä‘Æ°á»£c thÃªm vÃ o á»Ÿ bÆ°á»›c sau)
        const position = {
            positionName,
            description: description || '',
            status: 'active',
            //createdAt: new Date().toISOString()
            createdAt: TimezoneService.getCurrentVietnamDate().toISOString()
        };
        const result = await larkServiceManager.addPosition(position);
        res.json(formatResponse(true, 'ThÃªm vá»‹ trÃ­ thÃ nh cÃ´ng', { position: result }));
    } catch (error) {
        console.error('âŒ Controller: addPosition failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi thÃªm vá»‹ trÃ­: ${error.message}`, null, 'POSITION_ADD_FAILED'));
    }
};

export const updatePosition = async (req, res) => {
    try {
        const { id } = req.params;
        //const updatedData = { ...req.body, updatedAt: new Date().toISOString() };
        const updatedData = { ...req.body, updatedAt: TimezoneService.getCurrentVietnamDate().toISOString() };
        const result = await larkServiceManager.updatePosition(id, updatedData);
        res.json(formatResponse(true, 'Cáº­p nháº­t vá»‹ trÃ­ thÃ nh cÃ´ng', { position: result }));
    } catch (error)...
      === Káº¿t thÃºc positionController.js ===
    ğŸ“„ recruitmentController.js
      === Ná»™i dung recruitmentController.js ===
// import larkServiceManager from '../services/lark-service-manager.js';
// import { formatResponse } from '../services/utils/response-formatter.js';
// import CacheService from '../services/core/cache-service.js';
// import LarkClient from '../services/core/lark-client.js';




// // =================================================================
// // HÃ€M PHá»¤ TRá»¢ (HELPER FUNCTIONS)
// // =================================================================


// export const getRecruitmentRequests = async (req, res) => {
//     try {
//         const filters = req.query;
//         const recruitmentService = larkServiceManager.getService('recruitment');
//         const requests = await recruitmentService.getRecruitmentRequests(filters);

//         res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch Ä‘á» xuáº¥t thÃ nh cÃ´ng', requests));
//     } catch (error) {
//         console.error('âŒ Controller: getRecruitmentRequests failed:', error);
//         res.status(500).json(formatResponse(
//             false, 
//             `Lá»—i khi láº¥y danh sÃ¡ch Ä‘á» xuáº¥t: ${error.message}`, 
//             null, 
//             'RECRUITMENT_LOAD_FAILED'
//         ));
//     }
// };

// export const getRecruitmentHoursSummary = async (req, res) => {
//     try {
        
//         // âœ… Sá»¬A: LuÃ´n clear cache Ä‘á»ƒ Ä‘áº£m báº£o realtime data

//         CacheService.delete('hours_summary_table_data');
//         CacheService.delete('work_history_all');
//         CacheService.delete('recruitment_requests_{}'); // Clear recruitment cache náº¿u cÃ³
        
//         const recruitmentService = larkServiceManager.getService('recruitment');
//         const hoursSummary = await recruitmentService.getRecruitmentHoursSummary();


//         res.json(formatResponse(true, 'Láº¥y tá»•ng há»£p giá» cÃ´ng theo tuyá»ƒn dá»¥ng thÃ nh cÃ´ng', {
//             summary: hoursSummary,
//             totalRequests: hoursSummary.length,
//             totalEmployees: hoursSummary.reduce((sum, req) => sum + req.totalEmployees, 0),
//    ...
      === Káº¿t thÃºc recruitmentController.js ===
    ğŸ“„ storeController.js
      === Ná»™i dung storeController.js ===
// server/controllers/storeController.js
import larkServiceManager from '../services/lark-service-manager.js';
import { formatResponse } from '../services/utils/response-formatter.js';

// ==================== STORE MANAGEMENT ====================
export const getStores = async (req, res) => {
    try {
        const stores = await larkServiceManager.getAllStores();
        res.json(formatResponse(true, 'Láº¥y danh sÃ¡ch cá»­a hÃ ng thÃ nh cÃ´ng', stores));
    } catch (error) {
        console.error('âŒ Controller: getStores failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi táº£i danh sÃ¡ch cá»­a hÃ ng: ${error.message}`, null, 'STORE_LOAD_FAILED'));
    }
};

export const addStore = async (req, res) => {
    try {
        const { storeName, address } = req.body;
        // (Validation sáº½ Ä‘Æ°á»£c thÃªm vÃ o á»Ÿ bÆ°á»›c sau)
        const store = {
            storeName,
            address,
            status: 'active',
            //createdAt: new Date().toISOString()
            createdAt: TimezoneService.getCurrentVietnamDate().toISOString()
        };
        const result = await larkServiceManager.addStore(store);
        res.json(formatResponse(true, 'ThÃªm cá»­a hÃ ng thÃ nh cÃ´ng', { store: result }));
    } catch (error) {
        console.error('âŒ Controller: addStore failed:', error);
        res.status(500).json(formatResponse(false, `Lá»—i khi thÃªm cá»­a hÃ ng: ${error.message}`, null, 'STORE_ADD_FAILED'));
    }
};

export const updateStore = async (req, res) => {
    try {
        const { id } = req.params;
        //const updatedData = { ...req.body, updatedAt: new Date().toISOString() };
        const updatedData = { ...req.body, updatedAt: TimezoneService.getCurrentVietnamDate().toISOString() };
        const result = await larkServiceManager.updateStore(id, updatedData);
        res.json(formatResponse(true, 'Cáº­p nháº­t cá»­a hÃ ng thÃ nh cÃ´ng', { store: result }));
    } catch (error) {
        console.error('âŒ Controller: updateStore failed:', error);
       ...
      === Káº¿t thÃºc storeController.js ===
  ğŸ“ middleware/
    ğŸ“„ auth.js
      === Ná»™i dung auth.js ===
const authenticateUser = (req, res, next) => {
    if (!req.session || !req.session.user) {
        return res.status(401).json({ error: 'Unauthorized' });
    }
    req.user = req.session.user;
    next();
};

const authorizeRoles = (...roles) => {
    return (req, res, next) => {
        if (!req.user || !roles.includes(req.user.role)) {
            return res.status(403).json({ error: 'Forbidden' });
        }
        next();
    };
};

export {
    authenticateUser,
    authorizeRoles
};

      === Káº¿t thÃºc auth.js ===
    ğŸ“„ validation.js
      === Ná»™i dung validation.js ===
// server/middleware/validation.js
import { formatResponse } from '../services/utils/response-formatter.js';
import { EmployeeValidator } from '../services/employees/index.js';
import { MasterDataValidator } from '../services/master-data/index.js';

class ValidationMiddleware {
    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u nhÃ¢n viÃªn má»›i
    static validateAddEmployee(req, res, next) {
    // âœ… Táº¡o employeeData giá»‘ng logic trong controller
    const { fullName, phoneNumber, gender, bankAccount, bankName, workHistoryData } = req.body;
    const hourlyRate = (workHistoryData && workHistoryData[0]?.hourlyRate) || 0;
    
    const employeeDataForValidation = {
        fullName,
        phoneNumber, 
        gender,
        hourlyRate: parseFloat(hourlyRate),
        bankAccount,
        bankName
    };

    // Validate employee data vá»›i data Ä‘Ã£ xá»­ lÃ½
    const employeeErrors = EmployeeValidator.validateEmployeeData(employeeDataForValidation);
    if (employeeErrors.length > 0) {
        return res.status(400).json(formatResponse(false, employeeErrors.join(', '), null, 'VALIDATION_ERROR'));
    }

    // Validate work history
    const workHistoryErrors = EmployeeValidator.validateWorkHistoryData(req.body.workHistoryData || []);
    if (workHistoryErrors.length > 0) {
        return res.status(400).json(formatResponse(false, workHistoryErrors.join(', '), null, 'VALIDATION_ERROR'));
    }
    
    next();
    }


    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u khi cáº­p nháº­t nhÃ¢n viÃªn (cÃ³ thá»ƒ khÃ¡c vá»›i khi thÃªm má»›i)
    static validateUpdateEmployee(req, res, next) {
        const errors = EmployeeValidator.validateEmployeeData(req.body);
        if (errors.length > 0) {
            return res.status(400).json(formatResponse(false, errors.join(', '), null, 'VALIDATION_ERROR'));
        }
        next();
    }
    
    // Middleware Ä‘á»ƒ validate dá»¯ liá»‡u cá»­a hÃ ng
    static validateStore(req, res, next) {
        const errors = MasterDataValidator.validateStoreData(req.body);
         if (errors...
      === Káº¿t thÃºc validation.js ===
  ğŸ“ routes/
    ğŸ“„ attendance.js
      === Ná»™i dung attendance.js ===
// server/routes/attendance.js
import express from 'express';
import { 
    getAttendanceLogs,
    addAttendanceLog,
    getEmployeeHours,
    getAttendanceStats,
    getEmployeeDetailedHours
} from '../controllers/attendanceController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

// âœ… CÃC ENDPOINT HIá»†N Táº I
router.get('/logs', authenticateUser, getAttendanceLogs);
router.post('/logs', authenticateUser, addAttendanceLog);
router.get('/employee-hours', authenticateUser, getEmployeeHours);

// âœ… CÃC ENDPOINT Má»šI
router.get('/stats', authenticateUser, getAttendanceStats);
router.get('/employee/:employeeId/detailed', authenticateUser, getEmployeeDetailedHours);

export default router;

      === Káº¿t thÃºc attendance.js ===
    ğŸ“„ auth.js
      === Ná»™i dung auth.js ===
import express from 'express';
import { login, logout, getProfile } from '../controllers/authController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.post('/login', login);
router.post('/logout', logout);
router.get('/profile', authenticateUser, getProfile);

export default router;

      === Káº¿t thÃºc auth.js ===
    ğŸ“„ dashboard.js
      === Ná»™i dung dashboard.js ===
import express from 'express';
import { getDashboardStats } from '../controllers/dashboardController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.get('/stats', authenticateUser, getDashboardStats);

export default router;

      === Káº¿t thÃºc dashboard.js ===
    ğŸ“„ employees.js
      === Ná»™i dung employees.js ===
// server/routes/employees.js
import express from 'express';
import { 
    getAllEmployees, 
    addEmployee, 
    updateEmployee, 
    deleteEmployee, 
    searchEmployees, 
    getEmployeeWorkHistory, 
    addWorkHistory,
    updateWorkHistory,
    deleteWorkHistory
} from '../controllers/employeeController.js';
import { authenticateUser, authorizeRoles } from '../middleware/auth.js';
import ValidationMiddleware from '../middleware/validation.js';

const router = express.Router();

// ==================== EMPLOYEE ROUTES ====================
// GET routes should come before parameterized routes
router.get('/search', authenticateUser, searchEmployees);
router.get('/', authenticateUser, getAllEmployees);

// Employee CRUD operations
router.post('/', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateAddEmployee, addEmployee);
router.put('/:id', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateUpdateEmployee, updateEmployee);
router.delete('/:id', authenticateUser, authorizeRoles('hr', 'admin'), deleteEmployee);

// ==================== WORK HISTORY ROUTES ====================
// Work history routes - Sá»¬A Äá»‚ TÆ¯Æ NG THÃCH Vá»šI CLIENT
router.get('/:employeeId/work-history', authenticateUser, getEmployeeWorkHistory);
router.post('/work-history', authenticateUser, authorizeRoles('hr', 'admin'), addWorkHistory);

// âœ… THÃŠM Má»šI: Routes cho sá»­a vÃ  xÃ³a work history
router.put('/work-history/:id', authenticateUser, authorizeRoles('hr', 'admin'), updateWorkHistory);
router.delete('/work-history/:id', authenticateUser, authorizeRoles('hr', 'admin'), deleteWorkHistory);

// ==================== ERROR HANDLING ====================
// Handle 404 for unmatched routes
router.use('*', (req, res) => {
    res.status(404).json({
        success: false,
        error: 'Route not found',
        path: req.originalUrl
    });
});

export default router;

      === Káº¿t thÃºc employees.js ===
    ğŸ“„ masterData.js
      === Ná»™i dung masterData.js ===
// server/routes/masterData.js
import express from 'express';
import { authenticateUser, authorizeRoles } from '../middleware/auth.js';
import { getStores, addStore, updateStore, deleteStore } from '../controllers/storeController.js';
import { getPositions, addPosition, updatePosition, deletePosition } from '../controllers/positionController.js';
import ValidationMiddleware from '../middleware/validation.js';

const router = express.Router();

// ==================== STORE ROUTES ====================
router.get('/stores', authenticateUser, getStores);
router.post('/stores', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateStore, addStore);
router.put('/stores/:id', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validateStore, updateStore);
router.delete('/stores/:id', authenticateUser, authorizeRoles('hr', 'admin'), deleteStore);

// ==================== POSITION ROUTES ====================
router.get('/positions', authenticateUser, getPositions);
router.post('/positions', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validatePosition, addPosition);
router.put('/positions/:id', authenticateUser, authorizeRoles('hr', 'admin'), ValidationMiddleware.validatePosition, updatePosition);
router.delete('/positions/:id', authenticateUser, authorizeRoles('hr', 'admin'), deletePosition);

export default router;

      === Káº¿t thÃºc masterData.js ===
    ğŸ“„ recruitment.js
      === Ná»™i dung recruitment.js ===
// server/routes/recruitment.js
import express from 'express';
import { 
    getRecruitmentRequests,
    getRecruitmentHoursSummary,
    getDetailedHoursForRequest,
    getDailyComparisonForRequest    
} from '../controllers/recruitmentController.js';
import { authenticateUser } from '../middleware/auth.js';

const router = express.Router();

router.get('/', authenticateUser, getRecruitmentRequests);
router.get('/hours-summary', authenticateUser, getRecruitmentHoursSummary);
router.get('/detailed-hours/:requestNo', authenticateUser, getDetailedHoursForRequest);
router.get('/daily-comparison/:requestNo', authenticateUser, getDailyComparisonForRequest);

export default router;

      === Káº¿t thÃºc recruitment.js ===
  ğŸ“„ server.js
    === Ná»™i dung server.js ===
// server/server.js
import dotenv from 'dotenv';

// Configure dotenv FIRST
dotenv.config();

// Import cÃ¡c modules AFTER Ä‘Ã£ config dotenv
import express from 'express';
import cors from 'cors';
import session from 'express-session';
import path from 'path';
import { fileURLToPath } from 'url';

// ES6 module equivalent of __dirname
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Import service manager AFTER dotenv config
import larkServiceManager from './services/lark-service-manager.js';

// Import routes
import authRoutes from './routes/auth.js';
import employeeRoutes from './routes/employees.js';
import attendanceRoutes from './routes/attendance.js';
import recruitmentRoutes from './routes/recruitment.js';
import masterDataRoutes from './routes/masterData.js';
import dashboardRoutes from './routes/dashboard.js';

const app = express();
const PORT = process.env.PORT || 8080;

// Middleware
// Trong mÃ´i trÆ°á»ng container, server vÃ  client sáº½ cÃ¹ng má»™t nguá»“n gá»‘c,
// nhÆ°ng cáº¥u hÃ¬nh CORS nÃ y váº«n tá»‘t cho mÃ´i trÆ°á»ng phÃ¡t triá»ƒn local.
app.use(cors({
    origin: 'http://localhost:3000',
    credentials: true
}));

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Session configuration
app.use(session({
    secret: process.env.SESSION_SECRET || 'your-secret-key',
    resave: false,
    saveUninitialized: false,
    cookie: { secure: false, maxAge: 24 * 60 * 60 * 1000 } // Trong production nÃªn set secure: true náº¿u dÃ¹ng HTTPS
}));

// API Routes - Táº¥t cáº£ cÃ¡c route API cá»§a báº¡n váº«n giá»¯ nguyÃªn
app.use('/api/auth', authRoutes);
app.use('/api/employees', employeeRoutes);
app.use('/api/attendance', attendanceRoutes);
app.use('/api/recruitment', recruitmentRoutes);
app.use('/api/master-data', masterDataRoutes);
app.use('/api/dashboard', dashboardRoutes);

// Health check endpoint
app.get('/api/health', (req, res) => {
    res.json({
        status: 'OK',
        timestamp: new Date().toISOString(),
      ...
    === Káº¿t thÃºc server.js ===
  ğŸ“ services/
    ğŸ“ attendance/
      ğŸ“„ attendance-service.js
        === Ná»™i dung attendance-service.js ===
// server/services/attendance/attendance-service.js
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';
import TimezoneService from '../core/timezone-service.js'; // âœ… THÃŠM: Import TimezoneService

/**
 * @class AttendanceService
 * @description Quáº£n lÃ½ táº¥t cáº£ cÃ¡c nghiá»‡p vá»¥ liÃªn quan Ä‘áº¿n cháº¥m cÃ´ng,
 * bao gá»“m láº¥y dá»¯ liá»‡u tá»« Lark Base, thÃªm báº£n ghi má»›i, vÃ  tÃ­nh toÃ¡n giá» lÃ m.
 */
class AttendanceService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_ATTENDANCE_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Attendance Service...');
    }

    // =================================================================
    //  PUBLIC API METHODS - CÃC HÃ€M CUNG Cáº¤P RA BÃŠN NGOÃ€I
    // =================================================================

    /** Láº¥y danh sÃ¡ch báº£n ghi cháº¥m cÃ´ng tá»« Lark Bitable, cÃ³ há»— trá»£ cache vÃ  bá»™ lá»c.
     * @param {object} [filters={}] - CÃ¡c bá»™ lá»c Ä‘á»ƒ truy váº¥n.
     * @param {string} [filters.employeeId] - Lá»c theo MÃ£ nhÃ¢n viÃªn.
     * @param {string} [filters.dateFrom] - Lá»c tá»« ngÃ y (YYYY-MM-DD).
     * @param {string} [filters.dateTo] - Lá»c Ä‘áº¿n ngÃ y (YYYY-MM-DD).
     * @returns {Promise<Array<object>>} - Máº£ng cÃ¡c báº£n ghi cháº¥m cÃ´ng Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i.
     */
    async getAttendanceLogs(filters = {}) {
        const cacheKey = `attendance_logs_${JSON.stringify(filters)}`;
        let logs = CacheService.get(cacheKey);
        
        if (logs) {
            console.log(`âœ… ATTENDANCE: Loaded ${logs.length} records from cache.`);
            return logs;
        }

        try {
            
            // XÃ¢y dá»±ng cÃ¡c tham sá»‘ cho API
            const params = {};
            if (filters.employeeId) {
                // Lark filter syntax: CurrentValue.[TÃªn cá»™t] = "GiÃ¡ trá»‹"
                params.filter = `Curre...
        === Káº¿t thÃºc attendance-service.js ===
      ğŸ“„ attendance-validator.js
        === Ná»™i dung attendance-validator.js ===
// Attendance validation service
class AttendanceValidator {
    static validateAttendanceData(attendanceData) {
        const errors = [];

        // Required fields validation
        if (!attendanceData.employeeId) {
            errors.push('Employee ID lÃ  báº¯t buá»™c');
        }

        if (!attendanceData.date) {
            errors.push('NgÃ y lÃ  báº¯t buá»™c');
        } else if (!this.isValidDate(attendanceData.date)) {
            errors.push('NgÃ y khÃ´ng há»£p lá»‡');
        }

        if (!attendanceData.timeIn) {
            errors.push('Thá»i gian vÃ o lÃ  báº¯t buá»™c');
        } else if (!this.isValidTime(attendanceData.timeIn)) {
            errors.push('Thá»i gian vÃ o khÃ´ng há»£p lá»‡');
        }

        if (!attendanceData.timeOut) {
            errors.push('Thá»i gian ra lÃ  báº¯t buá»™c');
        } else if (!this.isValidTime(attendanceData.timeOut)) {
            errors.push('Thá»i gian ra khÃ´ng há»£p lá»‡');
        }

        // Check if time out is after time in
        if (attendanceData.timeIn && attendanceData.timeOut) {
            if (!this.isTimeOutAfterTimeIn(attendanceData.timeIn, attendanceData.timeOut)) {
                errors.push('Thá»i gian ra pháº£i sau thá»i gian vÃ o');
            }
        }

        return errors;
    }

    static isValidDate(dateString) {
        const date = new Date(dateString);
        return date instanceof Date && !isNaN(date);
    }

    static isValidTime(timeString) {
        const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
        return timeRegex.test(timeString);
    }

    static isTimeOutAfterTimeIn(timeIn, timeOut) {
        const inTime = new Date(`1970-01-01T${timeIn}`);
        const outTime = new Date(`1970-01-01T${timeOut}`);
        return outTime > inTime;
    }
}

export default AttendanceValidator;

        === Káº¿t thÃºc attendance-validator.js ===
      ğŸ“„ index.js
        === Ná»™i dung index.js ===
// Attendance services exports
export { default as AttendanceService } from './attendance-service.js';
export { default as AttendanceValidator } from './attendance-validator.js';
        === Káº¿t thÃºc index.js ===
    ğŸ“ auth/
      ğŸ“„ auth-service.js
        === Ná»™i dung auth-service.js ===
// Authentication service
import BaseService from '../core/base-service.js';
import { users } from '../../config/database.js';

class AuthService extends BaseService {
    constructor() {
        super();
        this.activeSessions = new Map();
    }

    async validateCredentials(username, password) {
        const user = users[username];
        if (!user || user.password !== password) {
            throw new Error('Invalid credentials');
        }
        return user;
    }

    createSession(user) {
        const sessionData = {
            id: user.id,
            username: user.username,
            role: user.role,
            fullName: user.fullName,
            loginTime: new Date().toISOString()
        };
        
        this.activeSessions.set(user.id, sessionData);
        return sessionData;
    }

    validateSession(sessionId) {
        return this.activeSessions.get(sessionId);
    }

    destroySession(sessionId) {
        return this.activeSessions.delete(sessionId);
    }

    async login(credentials) {
        const { username, password } = credentials;
        
        const user = await this.validateCredentials(username, password);
        const sessionData = this.createSession(user);
        
        return {
            success: true,
            user: sessionData,
            message: 'Login successful'
        };
    }

    async logout(sessionId) {
        const destroyed = this.destroySession(sessionId);
        return {
            success: destroyed,
            message: destroyed ? 'Logout successful' : 'Session not found'
        };
    }

    getActiveUsers() {
        return Array.from(this.activeSessions.values());
    }
}

export default AuthService;

        === Káº¿t thÃºc auth-service.js ===
      ğŸ“„ index.js
        === Ná»™i dung index.js ===
// Auth services exports
export { default as AuthService } from './auth-service.js';
export { default as SessionService } from './session-service.js';

        === Káº¿t thÃºc index.js ===
      ğŸ“„ session-service.js
        === Ná»™i dung session-service.js ===
// Session management service
import BaseService from '../core/base-service.js';

class SessionService extends BaseService {
    constructor() {
        super();
        this.sessions = new Map();
        this.sessionTimeout = 24 * 60 * 60 * 1000; // 24 hours
    }

    createSession(user, req) {
        const sessionId = this.generateId('sess_');
        const sessionData = {
            id: sessionId,
            userId: user.id,
            user: user,
            createdAt: new Date().toISOString(),
            lastAccessed: new Date().toISOString(),
            ipAddress: req.ip || req.connection.remoteAddress,
            userAgent: req.get('User-Agent')
        };

        this.sessions.set(sessionId, sessionData);
        return sessionData;
    }

    getSession(sessionId) {
        const session = this.sessions.get(sessionId);
        if (!session) return null;

        // Check if session is expired
        const now = Date.now();
        const lastAccessed = new Date(session.lastAccessed).getTime();
        if (now - lastAccessed > this.sessionTimeout) {
            this.destroySession(sessionId);
            return null;
        }

        // Update last accessed
        session.lastAccessed = new Date().toISOString();
        this.sessions.set(sessionId, session);
        
        return session;
    }

    destroySession(sessionId) {
        return this.sessions.delete(sessionId);
    }

    cleanupExpiredSessions() {
        const now = Date.now();
        for (const [sessionId, session] of this.sessions.entries()) {
            const lastAccessed = new Date(session.lastAccessed).getTime();
            if (now - lastAccessed > this.sessionTimeout) {
                this.destroySession(sessionId);
            }
        }
    }

    getActiveSessions() {
        return Array.from(this.sessions.values());
    }

    getUserSessions(userId) {
        return Array.from(this.sessions.values()).filter(session => session.userId === userId);
    }
}

export d...
        === Káº¿t thÃºc session-service.js ===
    ğŸ“ core/
      ğŸ“„ base-service.js
        === Ná»™i dung base-service.js ===
// Abstract base class for all services
import { formatResponse } from '../utils/response-formatter.js';

export default class BaseService {
    constructor() {
        this.initialized = false;
        this.cache = new Map();
    }

    async init() {
        if (!this.initialized) {
            await this.initializeService();
            this.initialized = true;
        }
    }

    async initializeService() {
        // Override in subclasses
    }

    formatResponse(success, message, data = null, errorCode = null) {
        return formatResponse(success, message, data, errorCode);
    }

    validateRequired(data, fields) {
        const errors = [];
        fields.forEach(field => {
            if (!data[field]) {
                errors.push(`${field} lÃ  báº¯t buá»™c`);
            }
        });
        return errors;
    }

    generateId(prefix = '') {
        return `${prefix}${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    async handleError(error, operation) {
        console.error(`Error in ${operation}:`, error);
        throw error;
    }
}

        === Káº¿t thÃºc base-service.js ===
      ğŸ“„ cache-service.js
        === Ná»™i dung cache-service.js ===
// server/services/core/cache-service.js
class CacheService {
    constructor() {
        this.cache = new Map();
        this.ttl = new Map();
    }

    set(key, value, ttlMs = 300000) { // 5 minutes default
        this.cache.set(key, value);
        this.ttl.set(key, Date.now() + ttlMs);
    }

    get(key) {
        const expiry = this.ttl.get(key);
        if (expiry && Date.now() > expiry) {
            this.delete(key);
            return null;
        }
        return this.cache.get(key);
    }

    delete(key) {
        this.cache.delete(key);
        this.ttl.delete(key);
    }

    clear() {
        this.cache.clear();
        this.ttl.clear();
    }

    has(key) {
        const expiry = this.ttl.get(key);
        if (expiry && Date.now() > expiry) {
            this.delete(key);
            return false;
        }
        return this.cache.has(key);
    }

    size() {
        return this.cache.size;
    }

    cleanup() {
        const now = Date.now();
        for (const [key, expiry] of this.ttl.entries()) {
            if (now > expiry) {
                this.delete(key);
            }
        }
    }
}

export default new CacheService();

        === Káº¿t thÃºc cache-service.js ===
      ğŸ“„ index.js
        === Ná»™i dung index.js ===
// Core services exports
export { default as BaseService } from './base-service.js';
export { default as LarkClient } from './lark-client.js';
export { default as CacheService } from './cache-service.js';

        === Káº¿t thÃºc index.js ===
      ğŸ“„ lark-client.js
        === Ná»™i dung lark-client.js ===
// server/services/core/lark-client.js
import axios from 'axios';

class LarkClient {
    constructor() {
        // KhÃ´ng load env vars táº¡i constructor
        this.baseURL = 'https://open.larksuite.com/open-apis';
        this.tenantAccessToken = null;
        this.tokenExpiry = null;
    }

    // Getter methods Ä‘á»ƒ load env vars khi cáº§n
    get appId() {
        return process.env.LARK_APP_ID;
    }

    get appSecret() {
        return process.env.LARK_APP_SECRET;
    }

    async getTenantAccessToken() {
        
        if (!this.appId || !this.appSecret) {
            throw new Error('Lark credentials not configured properly');
        }
        
        if (this.tenantAccessToken && this.tokenExpiry > Date.now()) {
            return this.tenantAccessToken;
        }

        try {
            const payload = {
                app_id: this.appId,
                app_secret: this.appSecret
            };
            const response = await axios.post(`${this.baseURL}/auth/v3/tenant_access_token/internal`, payload);

            if (response.data.code === 0) {
                this.tenantAccessToken = response.data.tenant_access_token;
                this.tokenExpiry = Date.now() + (response.data.expire - 300) * 1000;
                return this.tenantAccessToken;
            } else {
                console.error('âŒ Lark auth error:', response.data);
                throw new Error(`Lark Auth Error: ${response.data.msg}`);
            }
        } catch (error) {
            console.error('âŒ Error getting tenant access token:', {
                message: error.message,
                response: error.response?.data,
                status: error.response?.status
            });
            throw error;
        }
    }

    async request(endpoint, options = {}) {
        
        const token = await this.getTenantAccessToken();
        
        const config = {
            ...options,
            headers: {
                'Authorization': `Bearer ${token}`,
   ...
        === Káº¿t thÃºc lark-client.js ===
      ğŸ“„ timezone-service.js
        === Ná»™i dung timezone-service.js ===
// server/services/core/timezone-service.js

/**
 * @file TimezoneService - Service táº­p trung xá»­ lÃ½ timezone cho toÃ n bá»™ á»©ng dá»¥ng
 * @description Chuáº©n hÃ³a viá»‡c xá»­ lÃ½ thá»i gian vá» GMT+7 (Vietnam timezone)
 * Ä‘á»ƒ Ä‘áº£m báº£o consistency vÃ  trÃ¡nh code trÃ¹ng láº·p
 */

class TimezoneService {
    // Constants
    static VIETNAM_OFFSET_MS = 7 * 60 * 60 * 1000; // GMT+7 offset in milliseconds
    static VIETNAM_TIMEZONE = 'Asia/Ho_Chi_Minh';
    
    // =================================================================
    // CORE CONVERSION METHODS - CÃC HÃ€M CHUYá»‚N Äá»”I CÆ  Báº¢N
    // =================================================================

    /**
     * Chuyá»ƒn Ä‘á»•i báº¥t ká»³ giÃ¡ trá»‹ thá»i gian nÃ o vá» Date object vá»›i GMT+7
     * @param {Date|string|number} dateValue - GiÃ¡ trá»‹ thá»i gian cáº§n chuyá»ƒn Ä‘á»•i
     * @returns {Date} Date object Ä‘Ã£ Ä‘Æ°á»£c Ä‘iá»u chá»‰nh vá» GMT+7
     */
    static toVietnamTime(dateValue) {
        if (!dateValue) {
            console.warn('âš ï¸ TimezoneService: dateValue is null/undefined');
            return new Date();
        }

        let date;
        
        try {
            // Handle different input types
            if (dateValue instanceof Date) {
                date = new Date(dateValue);
            } else if (typeof dateValue === 'number') {
                // Assume timestamp in milliseconds
                date = new Date(dateValue);
            } else if (typeof dateValue === 'string') {
                date = new Date(dateValue);
            } else {
                console.warn('âš ï¸ TimezoneService: Unknown dateValue type:', typeof dateValue);
                return new Date();
            }

            // Validate date
            if (isNaN(date.getTime())) {
                console.warn('âš ï¸ TimezoneService: Invalid date created from:', dateValue);
                return new Date();
            }

            // Apply Vietnam timezone offset
            return new Date(date.getTime() + this.VIETNAM_OFFSET_MS);
            
        } ...
        === Káº¿t thÃºc timezone-service.js ===
    ğŸ“ employees/
      ğŸ“„ employee-service.js
        === Ná»™i dung employee-service.js ===
// Employee management service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';
import WorkHistoryService from './work-history-service.js';


/**
 * @class EmployeeService
 * @description Quáº£n lÃ½ cÃ¡c nghiá»‡p vá»¥ liÃªn quan Ä‘áº¿n thÃ´ng tin nhÃ¢n viÃªn,
 * bao gá»“m CRUD (táº¡o, Ä‘á»c, cáº­p nháº­t, xÃ³a) vÃ  cÃ¡c chá»©c nÄƒng tÃ¬m kiáº¿m, kiá»ƒm tra.
 */
class EmployeeService extends BaseService {
    constructor() {
        super();
        this.tableName = 'employees';
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_EMPLOYEE_TABLE_ID;
        this.workHistoryService = new WorkHistoryService();
    }

    async initializeService() {
        // Initialize Lark Base connection
        console.log('Initializing Employee Service...');
        await this.workHistoryService.initializeService();
    }

    // =================================================================
    //  PUBLIC API METHODS - CÃC HÃ€M CUNG Cáº¤P RA BÃŠN NGOÃ€I
    // =================================================================


    /**
     * Láº¥y toÃ n bá»™ danh sÃ¡ch nhÃ¢n viÃªn tá»« Lark, cÃ³ há»— trá»£ cache.
     * @returns {Promise<Array<object>>} - Máº£ng cÃ¡c Ä‘á»‘i tÆ°á»£ng nhÃ¢n viÃªn.
     */
    async getAllEmployees() {
        try {

            const response = await LarkClient.getAllRecords(
                `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`
            );

            let employees = this.transformEmployeeData(response.data?.items || []);
            return employees;
        } catch (error) {
            console.error('âŒ EMPLOYEE: Error fetching employees from Lark:', error.message);
            throw error;
        }
    }


    /**
     * Láº¥y thÃ´ng tin má»™t nhÃ¢n viÃªn báº±ng record_id cá»§a Lark, cÃ³ há»— trá»£ cache.
     * @param {string} id - Record ID cá»§a nhÃ¢n viÃªn trong Lark.
     * @returns {Promise<object|null>} - Äá»‘i tÆ°á»£ng nhÃ¢n viÃªn hoáº·c null náº¿u khÃ´ng tÃ¬m tháº¥...
        === Káº¿t thÃºc employee-service.js ===
      ğŸ“„ employee-validator.js
        === Ná»™i dung employee-validator.js ===
// Employee validation service
class EmployeeValidator {
    static validateEmployeeData(employeeData) {
        const errors = [];

        // Required fields validation
        if (!employeeData.fullName || employeeData.fullName.trim().length < 2) {
            errors.push('Há» tÃªn pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±');
        }

        if (!employeeData.phoneNumber || !this.isValidPhoneNumber(employeeData.phoneNumber)) {
            errors.push('Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng há»£p lá»‡');
        }

        if (!employeeData.gender || !['Nam', 'Ná»¯'].includes(employeeData.gender)) {
            errors.push('Giá»›i tÃ­nh pháº£i lÃ  Nam hoáº·c Ná»¯');
        }

        if (!employeeData.bankAccount || employeeData.bankAccount.trim().length < 6) {
            errors.push('Sá»‘ tÃ i khoáº£n pháº£i cÃ³ Ã­t nháº¥t 6 kÃ½ tá»±');
        }

        if (!employeeData.bankName || employeeData.bankName.trim().length < 2) {
            errors.push('TÃªn ngÃ¢n hÃ ng lÃ  báº¯t buá»™c');
        }

        return errors;
    }

    static isValidPhoneNumber(phoneNumber) {
        const phoneRegex = /^[0-9]{10,11}$/;
        return phoneRegex.test(phoneNumber);
    }

    static validateWorkHistoryData(workHistoryData) {
        const errors = [];

        if (!Array.isArray(workHistoryData) || workHistoryData.length === 0) {
            errors.push('Pháº£i cÃ³ Ã­t nháº¥t má»™t work history entry');
        }

        const requestNos = workHistoryData.map(item => item.requestNo);
        const uniqueRequestNos = [...new Set(requestNos)];
        
        if (requestNos.length !== uniqueRequestNos.length) {
            errors.push('KhÃ´ng Ä‘Æ°á»£c trÃ¹ng láº·p Request No');
        }

        workHistoryData.forEach((item, index) => {
            if (!item.requestNo || item.requestNo.trim().length === 0) {
                errors.push(`Work history entry ${index + 1}: Request No lÃ  báº¯t buá»™c`);
            }
        });

        return errors;
    }
}

export default EmployeeValidator;

        === Káº¿t thÃºc employee-validator.js ===
      ğŸ“„ index.js
        === Ná»™i dung index.js ===
// Employee services exports
export { default as EmployeeService } from './employee-service.js';
export { default as WorkHistoryService } from './work-history-service.js';
export { default as EmployeeValidator } from './employee-validator.js';

        === Káº¿t thÃºc index.js ===
      ğŸ“„ work-history-service.js
        (File quÃ¡ lá»›n)
    ğŸ“„ index.js
      === Ná»™i dung index.js ===
// Main services export file
export * from './core/index.js';
export * from './auth/index.js';
export * from './employee/index.js';
export * from './attendance/index.js';
export * from './recruitment/index.js';
export * from './master-data/index.js';
export * from './utils/index.js';

// Export service factory for easy access
export { default as ServiceFactory } from './utils/service-factory.js';

      === Káº¿t thÃºc index.js ===
    ğŸ“„ lark-service-manager.js
      === Ná»™i dung lark-service-manager.js ===
// server/services/lark-service-manager.js
import { EmployeeService, WorkHistoryService } from './employees/index.js';
import { AttendanceService } from './attendance/index.js';
import { RecruitmentService } from './recruitment/index.js';
import { StoreService, PositionService } from './master-data/index.js';
import { AuthService, SessionService } from './auth/index.js';
import { validateLarkConfig } from '../config/lark-config.js';

class LarkServiceManager {
    constructor() {
        this.services = {};
        this.initialized = false;
    }

    async init() {
        if (this.initialized) return;

        try {
            console.log('ğŸš€ Initializing Lark Service Manager...');
            
            // Validate configuration first
            validateLarkConfig();
            
            // Initialize all services
            this.services.employee = new EmployeeService();
            this.services.workHistory = new WorkHistoryService();
            this.services.attendance = new AttendanceService();
            this.services.recruitment = new RecruitmentService();
            this.services.store = new StoreService();
            this.services.position = new PositionService();
            this.services.auth = new AuthService();
            this.services.session = new SessionService();

            // Initialize each service
            await Promise.all([
                this.services.employee.init(),
                this.services.workHistory.init(),
                this.services.attendance.init(),
                this.services.recruitment.init(),
                this.services.store.init(),
                this.services.position.init(),
                this.services.auth.init(),
                this.services.session.init()
            ]);

            this.initialized = true;
            console.log('âœ… All Lark services initialized successfully');
            
        } catch (error) {
            console.error('âŒ Lark Service Manager initialization failed...
      === Káº¿t thÃºc lark-service-manager.js ===
    ğŸ“ master-data/
      ğŸ“„ index.js
        === Ná»™i dung index.js ===
// Master data services exports
export { default as StoreService } from './store-service.js';
export { default as PositionService } from './position-service.js';
export { default as MasterDataValidator } from './master-data-validator.js';

        === Káº¿t thÃºc index.js ===
      ğŸ“„ master-data-validator.js
        === Ná»™i dung master-data-validator.js ===
// Master data validation service
class MasterDataValidator {
    static validateStoreData(storeData) {
        const errors = [];

        // Required fields validation
        if (!storeData.storeName || storeData.storeName.trim().length < 2) {
            errors.push('TÃªn cá»­a hÃ ng pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±');
        }

        if (!storeData.address || storeData.address.trim().length < 5) {
            errors.push('Äá»‹a chá»‰ pháº£i cÃ³ Ã­t nháº¥t 5 kÃ½ tá»±');
        }

        // Status validation
        if (storeData.status && !['active', 'inactive'].includes(storeData.status)) {
            errors.push('Tráº¡ng thÃ¡i pháº£i lÃ  active hoáº·c inactive');
        }

        return errors;
    }

    static validatePositionData(positionData) {
        const errors = [];

        // Required fields validation
        if (!positionData.positionName || positionData.positionName.trim().length < 2) {
            errors.push('TÃªn vá»‹ trÃ­ pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±');
        }

        // Description validation (optional but if provided must be reasonable)
        if (positionData.description && positionData.description.trim().length < 3) {
            errors.push('MÃ´ táº£ pháº£i cÃ³ Ã­t nháº¥t 3 kÃ½ tá»± náº¿u Ä‘Æ°á»£c cung cáº¥p');
        }

        // Status validation
        if (positionData.status && !['active', 'inactive'].includes(positionData.status)) {
            errors.push('Tráº¡ng thÃ¡i pháº£i lÃ  active hoáº·c inactive');
        }

        return errors;
    }

    static validateMasterDataBatch(dataArray, type) {
        const errors = [];
        const names = [];

        dataArray.forEach((item, index) => {
            // Validate individual item
            let itemErrors = [];
            if (type === 'store') {
                itemErrors = this.validateStoreData(item);
            } else if (type === 'position') {
                itemErrors = this.validatePositionData(item);
            }

            if (itemErrors.length > 0) {
                errors.push(`Item ${index + 1}: ${itemErrors.joi...
        === Káº¿t thÃºc master-data-validator.js ===
      ğŸ“„ position-service.js
        === Ná»™i dung position-service.js ===
// Position management service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class PositionService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_POSITION_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Position Service...');
    }

    async getAllPositions() {
        const cacheKey = 'positions_all';
        let positions = CacheService.get(cacheKey);
        
        if (!positions) {
            try {
                const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
                positions = this.transformPositionData(response.data?.items || []);
                CacheService.set(cacheKey, positions, 300000); // 5 minutes
            } catch (error) {
                console.error('Error fetching positions from Lark:', error);
                positions = this.getMockPositions();
            }
        }
        
        return positions;
    }

    async addPosition(positionData) {
        try {
            const transformedData = this.transformPositionForLark(positionData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('positions_all');
            
            return this.transformPositionData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'addPosition');
            throw error;
        }
    }

    async updatePosition(id, positionData) {
        try {
            const transformedData = this.transformPositionForLark(positionData);
            
            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}...
        === Káº¿t thÃºc position-service.js ===
      ğŸ“„ store-service.js
        === Ná»™i dung store-service.js ===
// Store management service
import BaseService from '../core/base-service.js';
import LarkClient from '../core/lark-client.js';
import CacheService from '../core/cache-service.js';

class StoreService extends BaseService {
    constructor() {
        super();
        this.baseId = process.env.LARK_BASE_ID;
        this.tableId = process.env.LARK_STORE_TABLE_ID;
    }

    async initializeService() {
        console.log('Initializing Store Service...');
    }

    async getAllStores() {
        const cacheKey = 'stores_all';
        let stores = CacheService.get(cacheKey);
        
        if (!stores) {
            try {
                const response = await LarkClient.get(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`);
                stores = this.transformStoreData(response.data?.items || []);
                CacheService.set(cacheKey, stores, 300000); // 5 minutes
            } catch (error) {
                console.error('Error fetching stores from Lark:', error);
                stores = this.getMockStores();
            }
        }
        
        return stores;
    }

    async addStore(storeData) {
        try {
            const transformedData = this.transformStoreForLark(storeData);
            
            const response = await LarkClient.post(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`, {
                fields: transformedData
            });

            // Clear cache
            CacheService.delete('stores_all');
            
            return this.transformStoreData([response.data])[0];
        } catch (error) {
            await this.handleError(error, 'addStore');
            throw error;
        }
    }

    async updateStore(id, storeData) {
        try {
            const transformedData = this.transformStoreForLark(storeData);
            
            const response = await LarkClient.put(`/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records/${id}`, {
                fields: transformedD...
        === Káº¿t thÃºc store-service.js ===
    ğŸ“ recruitment/
      ğŸ“„ index.js
        === Ná»™i dung index.js ===
// Recruitment services exports
export { default as RecruitmentService } from './recruitment-service.js';
export { default as RecruitmentValidator } from './recruitment-validator.js';

        === Káº¿t thÃºc index.js ===
      ğŸ“„ recruitment-service.js
        === Ná»™i dung recruitment-service.js ===
// //hr-management-system\server\services\recruitment\recruitment-service.js

// // Recruitment service
// import BaseService from '../core/base-service.js';
// import LarkClient from '../core/lark-client.js';
// import CacheService from '../core/cache-service.js';
// import larkServiceManager from '../lark-service-manager.js';
// import { larkConfig } from '../../config/lark-config.js';

// // **HÃ€M TIá»†N ÃCH Äá»ŠNH Dáº NG NGÃ€Y**
// const formatDate = (dateValue) => {
//     if (!dateValue) return null;
//     const date = new Date(dateValue);
//     if (isNaN(date.getTime())) return null;

//     const day = String(date.getDate()).padStart(2, '0');
//     const month = String(date.getMonth() + 1).padStart(2, '0');
//     const year = date.getFullYear();
//     return `${day}/${month}/${year}`;
// };

// class RecruitmentService extends BaseService {
//     constructor() {
//         super();
//         this.baseId = process.env.LARK_BASE_ID;
//         this.tableId = process.env.LARK_RECRUITMENT_TABLE_ID;
//         this.hoursSummaryTableId = process.env.LARK_HOURS_SUMMARY_TABLE_ID;
//     }

//     async initializeService() {
//         console.log('Initializing Recruitment Service...');
//     }


//     async getRecruitmentRequests(filters = {}) {
//         try {
            
//             const response = await LarkClient.getAllRecords(
//                 `/bitable/v1/apps/${this.baseId}/tables/${this.tableId}/records`
//             );

//             let requests = this.transformRecruitmentData(response.data?.items || []);

            
//             // âœ… Sá»¬A: Filter á»Ÿ application level - chá»‰ láº¥y chÃ­nh xÃ¡c "Approved" vÃ  "Under Review"
//             if (filters.status) {
//                 const statusArray = Array.isArray(filters.status) 
//                     ? filters.status 
//                     : filters.status.split(',').map(s => s.trim());
            
                
//                 requests = requests.filter(request => {
//                     ...
        === Káº¿t thÃºc recruitment-service.js ===
      ğŸ“„ recruitment-validator.js
        === Ná»™i dung recruitment-validator.js ===
// Recruitment validation service
class RecruitmentValidator {
    static validateRecruitmentData(requestData) {
        const errors = [];

        // Required fields validation
        if (!requestData.requestNo) {
            errors.push('Request No lÃ  báº¯t buá»™c');
        }

        if (!requestData.requester) {
            errors.push('Requester lÃ  báº¯t buá»™c');
        }

        if (!requestData.department) {
            errors.push('Department lÃ  báº¯t buá»™c');
        }

        if (!requestData.quantity || requestData.quantity <= 0) {
            errors.push('Quantity pháº£i lá»›n hÆ¡n 0');
        }

        if (!requestData.gender) {
            errors.push('Gender lÃ  báº¯t buá»™c');
        }

        if (!requestData.fromDate) {
            errors.push('From Date lÃ  báº¯t buá»™c');
        } else if (!this.isValidDate(requestData.fromDate)) {
            errors.push('From Date khÃ´ng há»£p lá»‡');
        }

        if (!requestData.toDate) {
            errors.push('To Date lÃ  báº¯t buá»™c');
        } else if (!this.isValidDate(requestData.toDate)) {
            errors.push('To Date khÃ´ng há»£p lá»‡');
        }

        // Check if toDate is after fromDate
        if (requestData.fromDate && requestData.toDate) {
            if (!this.isToDateAfterFromDate(requestData.fromDate, requestData.toDate)) {
                errors.push('To Date pháº£i sau From Date');
            }
        }

        return errors;
    }

    static isValidDate(dateString) {
        const date = new Date(dateString);
        return date instanceof Date && !isNaN(date);
    }

    static isToDateAfterFromDate(fromDate, toDate) {
        const from = new Date(fromDate);
        const to = new Date(toDate);
        return to >= from;
    }
}

export default RecruitmentValidator;

        === Káº¿t thÃºc recruitment-validator.js ===
    ğŸ“ utils/
      ğŸ“„ error-handler.js
        === Ná»™i dung error-handler.js ===
// Centralized error handling utilities
import ResponseFormatter from './response-formatter.js';

class ErrorHandler {
    static handleLarkError(error) {
        if (error.response?.data?.code) {
            const larkCode = error.response.data.code;
            const larkMessage = error.response.data.msg || 'Lark API Error';
            
            switch (larkCode) {
                case 99991663:
                    return ResponseFormatter.formatError('App access token invalid', 'LARK_AUTH_ERROR');
                case 99991664:
                    return ResponseFormatter.formatError('Tenant access token invalid', 'LARK_AUTH_ERROR');
                case 99991665:
                    return ResponseFormatter.formatError('User access token invalid', 'LARK_AUTH_ERROR');
                case 230002:
                    return ResponseFormatter.formatError('Base not found', 'LARK_BASE_NOT_FOUND');
                case 230003:
                    return ResponseFormatter.formatError('Table not found', 'LARK_TABLE_NOT_FOUND');
                case 230004:
                    return ResponseFormatter.formatError('Record not found', 'LARK_RECORD_NOT_FOUND');
                case 1254006:
                    return ResponseFormatter.formatError('Rate limit exceeded', 'LARK_RATE_LIMIT');
                default:
                    return ResponseFormatter.formatError(`Lark API Error: ${larkMessage}`, 'LARK_API_ERROR');
            }
        }
        
        return ResponseFormatter.formatError('Unknown Lark API error', 'LARK_UNKNOWN_ERROR');
    }

    static handleValidationError(errors) {
        const message = Array.isArray(errors) ? errors.join(', ') : errors;
        return ResponseFormatter.formatError(message, 'VALIDATION_ERROR');
    }

    static handleDatabaseError(error) {
        console.error('Database error:', error);
        
        if (error.code === 'ECONNREFUSED') {
            return ResponseFormatter.formatError('Database connection failed', 'D...
        === Káº¿t thÃºc error-handler.js ===
      ğŸ“„ index.js
        === Ná»™i dung index.js ===
// Utilities services exports
export { default as ResponseFormatter, formatResponse } from './response-formatter.js';
export { default as ServiceFactory } from './service-factory.js';
export { default as ErrorHandler } from './error-handler.js';

// Re-export commonly used functions
export {
    getEmployeeService,
    getWorkHistoryService,
    getAttendanceService,
    getRecruitmentService,
    getStoreService,
    getPositionService,
    getAuthService,
    getSessionService
} from './service-factory.js';

        === Káº¿t thÃºc index.js ===
      ğŸ“„ response-formatter.js
        === Ná»™i dung response-formatter.js ===
// Response formatting utilities
class ResponseFormatter {
    static formatResponse(success, message, data = null, errorCode = null) {
        const response = {
            success,
            message,
            timestamp: new Date().toISOString()
        };

        if (success && data) {
            response.data = data;
        }

        if (!success && errorCode) {
            response.errorCode = errorCode;
        }

        return response;
    }

    static formatSuccess(message, data = null) {
        return this.formatResponse(true, message, data);
    }

    static formatError(message, errorCode = null) {
        return this.formatResponse(false, message, null, errorCode);
    }

    static formatValidationError(errors) {
        return this.formatResponse(false, 'Validation failed', null, 'VALIDATION_ERROR');
    }

    static formatNotFound(resource) {
        return this.formatResponse(false, `${resource} not found`, null, 'NOT_FOUND');
    }

    static formatUnauthorized(message = 'Unauthorized access') {
        return this.formatResponse(false, message, null, 'UNAUTHORIZED');
    }

    static formatForbidden(message = 'Forbidden access') {
        return this.formatResponse(false, message, null, 'FORBIDDEN');
    }

    static formatServerError(message = 'Internal server error') {
        return this.formatResponse(false, message, null, 'SERVER_ERROR');
    }

    static formatPaginatedResponse(data, pagination) {
        return this.formatResponse(true, 'Success', {
            items: data,
            pagination: {
                page: pagination.page || 1,
                limit: pagination.limit || 10,
                total: pagination.total || 0,
                pages: Math.ceil((pagination.total || 0) / (pagination.limit || 10))
            }
        });
    }

    static formatBatchResponse(results) {
        const successCount = results.filter(r => r.success).length;
        const failureCount = results.length - successCount;

      ...
        === Káº¿t thÃºc response-formatter.js ===
      ğŸ“„ service-factory.js
        === Ná»™i dung service-factory.js ===
// Service factory for dependency injection
import { EmployeeService } from '../employee/index.js';
import { WorkHistoryService } from '../employee/index.js';
import { AttendanceService } from '../attendance/index.js';
import { RecruitmentService } from '../recruitment/index.js';
import { StoreService, PositionService } from '../master-data/index.js';
import { AuthService, SessionService } from '../auth/index.js';

class ServiceFactory {
    constructor() {
        this.services = new Map();
        this.singletons = new Map();
    }

    // Register a service class
    register(name, ServiceClass, singleton = true) {
        this.services.set(name, { ServiceClass, singleton });
    }

    // Get service instance
    get(name) {
        const serviceConfig = this.services.get(name);
        if (!serviceConfig) {
            throw new Error(`Service '${name}' not found`);
        }

        const { ServiceClass, singleton } = serviceConfig;

        if (singleton) {
            if (!this.singletons.has(name)) {
                this.singletons.set(name, new ServiceClass());
            }
            return this.singletons.get(name);
        }

        return new ServiceClass();
    }

    // Initialize all services
    async initialize() {
        for (const [name, config] of this.services.entries()) {
            const service = this.get(name);
            if (service.init && typeof service.init === 'function') {
                await service.init();
            }
        }
    }

    // Clear all singleton instances
    clear() {
        this.singletons.clear();
    }

    // Get all service names
    getServiceNames() {
        return Array.from(this.services.keys());
    }

    // Check if service exists
    has(name) {
        return this.services.has(name);
    }
}

// Create and configure the global service factory
const serviceFactory = new ServiceFactory();

// Register core services
serviceFactory.register('employee', EmployeeService, true);
serviceFactory.r...
        === Káº¿t thÃºc service-factory.js ===
ğŸ“ src/
  ğŸ“„ App.jsx
    === Ná»™i dung App.jsx ===
import React, { useEffect, useState } from 'react';
import { Routes, Route, Navigate, useLocation } from 'react-router-dom';
import { useAuth } from './hooks/useAuth';
import { useNotification } from './hooks/useNotification';

// Components - ThÃ nh pháº§n giao diá»‡n
import Layout from './components/layout/Layout';
import Loading from './components/common/Loading';
import ProtectedRoute from './components/auth/ProtectedRoute';

// Pages - CÃ¡c trang chÃ­nh
import LoginPage from './pages/LoginPage';
import EmployeeManagementPage from './pages/EmployeeManagementPage';
import AttendanceLogsPage from './pages/AttendanceLogsPage';
import HRDashboardPage from './pages/HRDashboardPage';

// Global styles - Styles toÃ n cá»¥c
import './styles/globals.css';

const App = () => {
  const [loading, setLoading] = useState(true);
  const [initialized, setInitialized] = useState(false);
  const { user, checkAuth, loading: authLoading } = useAuth();
  const { showNotification } = useNotification();
  const location = useLocation();

  useEffect(() => {

  const initializeApp = async () => {
    try {
      console.log('ğŸš€ Báº¯t Ä‘áº§u khá»Ÿi táº¡o á»©ng dá»¥ng React...');
      
      initializeGlobalUtilities();
      
      if (isProtectedPage()) {
        console.log('ğŸ” Äang kiá»ƒm tra xÃ¡c thá»±c...');
        const authUser = await checkAuth();
        if (!authUser && !isPublicPage()) {
          console.log('âŒ XÃ¡c thá»±c tháº¥t báº¡i cho trang Ä‘Æ°á»£c báº£o vá»‡');
          // âœ… Sá»¬A: Äáº·t initialized = true Ä‘á»ƒ redirect vá» login
          setInitialized(true);
          return;
        }
        console.log('âœ… HoÃ n thÃ nh kiá»ƒm tra xÃ¡c thá»±c');
      }
      
      setInitialized(true);
      console.log('âœ… Khá»Ÿi táº¡o á»©ng dá»¥ng React thÃ nh cÃ´ng');
      
    } catch (error) {
      console.error('âŒ Lá»—i khá»Ÿi táº¡o á»©ng dá»¥ng:', error);
      
      // âœ… Sá»¬A: LuÃ´n set initialized = true Ä‘á»ƒ cho phÃ©p render Routes
      setInitialized(true);
      
      // Chá»‰ hiá»‡n notification, khÃ´ng cháº·n á»©ng dá»¥ng
      if (error.name === 'Typ...
    === Káº¿t thÃºc App.jsx ===
  ğŸ“ components/
    ğŸ“ attendance/
      ğŸ“„ AttendanceFilters.jsx
        === Ná»™i dung AttendanceFilters.jsx ===
import React from 'react';

const AttendanceFilters = ({ 
  employees, 
  filters, 
  onFilterChange, 
  onClearFilters 
}) => {
  const handleFilterSubmit = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const newFilters = {
      employeeId: formData.get('employeeId'),
      dateFrom: formData.get('dateFrom'),
      dateTo: formData.get('dateTo')
    };
    
    // Remove empty filters
    Object.keys(newFilters).forEach(key => {
      if (!newFilters[key]) delete newFilters[key];
    });
    
    onFilterChange(newFilters);
  };

  return (
    <form onSubmit={handleFilterSubmit} id="filterForm">
      <div className="row">
        <div className="col-md-4">
          <label className="form-label">NhÃ¢n viÃªn</label>
          <select 
            className="form-select" 
            name="employeeId"
            defaultValue={filters.employeeId || ''}
          >
            <option value="">Táº¥t cáº£ nhÃ¢n viÃªn</option>
            {employees.map(employee => (
              <option key={employee.id} value={employee.employeeId}>
                {employee.employeeId} - {employee.fullName}
              </option>
            ))}
          </select>
        </div>
        
        <div className="col-md-3">
          <label className="form-label">Tá»« ngÃ y</label>
          <input 
            type="date" 
            className="form-control" 
            name="dateFrom"
            defaultValue={filters.dateFrom || ''}
          />
        </div>
        
        <div className="col-md-3">
          <label className="form-label">Äáº¿n ngÃ y</label>
          <input 
            type="date" 
            className="form-control" 
            name="dateTo"
            defaultValue={filters.dateTo || ''}
          />
        </div>
        
        <div className="col-md-2">
          <label className="form-label">&nbsp;</label>
          <div className="d-grid gap-2">
            <button type="submit" className="btn btn-primary">
             ...
        === Káº¿t thÃºc AttendanceFilters.jsx ===
      ğŸ“„ AttendanceLogs.jsx
        === Ná»™i dung AttendanceLogs.jsx ===
// src/components/attendance/AttendanceLogs.jsx
import React, { useState } from 'react';

const AttendanceLogs = ({ logs, employees }) => {
  const [sortField, setSortField] = useState('timestamp');
  const [sortDirection, setSortDirection] = useState('desc');
  const [positionFilter, setPositionFilter] = useState('');

  // âœ… THÃŠM: HÃ m sáº¯p xáº¿p logs
  const sortedLogs = [...logs].sort((a, b) => {
    let aValue = a[sortField];
    let bValue = b[sortField];
    
    if (sortField === 'timestamp') {
      aValue = new Date(aValue);
      bValue = new Date(bValue);
    }
    
    if (sortDirection === 'asc') {
      return aValue > bValue ? 1 : -1;
    } else {
      return aValue < bValue ? 1 : -1;
    }
  });

  // âœ… THÃŠM: Lá»c theo vá»‹ trÃ­
  const filteredLogs = positionFilter 
    ? sortedLogs.filter(log => log.position === positionFilter)
    : sortedLogs;

  // âœ… THÃŠM: Láº¥y danh sÃ¡ch vá»‹ trÃ­ unique
  const positions = [...new Set(logs.map(log => log.position))].filter(Boolean);

  // âœ… THÃŠM: HÃ m láº¥y tÃªn nhÃ¢n viÃªn tá»« mÃ£
  const getEmployeeName = (employeeId) => {
    const employee = employees?.find(emp => emp.employeeId === employeeId);
    return employee?.fullName || employeeId;
  };

  // âœ… THÃŠM: HÃ m format timestamp Unix
  const formatTimestamp = (timestamp) => {
    if (!timestamp) return 'N/A';
    const date = new Date(timestamp);
    return date.toLocaleString('vi-VN');
  };

  // âœ… THÃŠM: HÃ m láº¥y icon cho loáº¡i cháº¥m cÃ´ng
  const getTypeIcon = (type) => {
    return type === 'Checkin' 
      ? <i className="fas fa-sign-in-alt text-success"></i>
      : <i className="fas fa-sign-out-alt text-danger"></i>;
  };

  // âœ… THÃŠM: HÃ m láº¥y badge color cho vá»‹ trÃ­
  const getPositionBadgeClass = (position) => {
    switch (position) {
      case 'NhÃ¢n viÃªn Mascot': return 'bg-info text-dark';
      case 'NhÃ¢n viÃªn BÃ¡n hÃ ng': return 'bg-success';
      case 'NhÃ¢n viÃªn Thu ngÃ¢n': return 'bg-primary';
      case 'NhÃ¢n viÃªn Tiáº¿p Ä‘Ã³n': return 'bg-secondary';
      default: re...
        === Káº¿t thÃºc AttendanceLogs.jsx ===
      ğŸ“„ EmployeeHours.jsx
        === Ná»™i dung EmployeeHours.jsx ===
// import React, { useState, useEffect } from 'react';
// import { useAttendance } from '../../hooks/useAttendance';
// import { useNotification } from '../../hooks/useNotification';
// import Loading from '../common/Loading';
// import Alert from '../common/Alert';

// function EmployeeHours() {
//     const [employeeHours, setEmployeeHours] = useState([]);
//     const [filteredData, setFilteredData] = useState([]);
//     const [loading, setLoading] = useState(true);
//     const [error, setError] = useState(null);
//     const [stats, setStats] = useState(null);

//     // Bá»™ lá»c Ä‘Æ¡n giáº£n, khÃ´ng cÃ³ "Lá»—i" hay "Cáº£nh bÃ¡o"
//     const [filters, setFilters] = useState({
//         employeeId: '',
//         position: '',
//         dateFrom: '',
//         dateTo: ''
//     });

//     const { getEmployeeHours } = useAttendance();
//     const { showNotification } = useNotification();

//     useEffect(() => {
//         loadEmployeeHours();
//     }, []);

//     useEffect(() => {
//         applyFilters();
//     }, [employeeHours, filters]);

//     const loadEmployeeHours = async () => {
//         try {
//             setLoading(true);
//             setError(null);
//             const response = await getEmployeeHours();

//             if (response.success) {
//                 setEmployeeHours(response.data.employeeHours || []);
//                 setStats(response.data.summary || null);
//             } else {
//                 throw new Error(response.message || 'Failed to load employee hours');
//             }
//         } catch (err) {
//             setError(err.message);
//             showNotification('Lá»—i khi táº£i dá»¯ liá»‡u giá» cÃ´ng: ' + err.message, 'error');
//         } finally {
//             setLoading(false);
//         }
//     };

//     const applyFilters = () => {
//         let filtered = [...employeeHours];

//         // TÃ¬m kiáº¿m theo mÃ£ NV hoáº·c tÃªn
//         if (filters.employeeId.trim()) {
//             const searchTerm = filters.em...
        === Káº¿t thÃºc EmployeeHours.jsx ===
      ğŸ“„ LarkAttendanceEmbed.jsx
        === Ná»™i dung LarkAttendanceEmbed.jsx ===
import React from 'react';

// URL cá»§a Lark Base view báº¡n muá»‘n nhÃºng
const LARK_EMBED_URL = "https://atino-vietnam.sg.larksuite.com/base/Ey3EbVD9vacAHvs8cVvlHxkKg2r?table=tblU9YY1t4TwxXLh&view=vewpWpbNQv";

const LarkAttendanceEmbed = () => {
  return (
    // Container Ä‘áº£m báº£o iframe chiáº¿m háº¿t khÃ´ng gian Ä‘Æ°á»£c cáº¥p vÃ  cÃ³ chiá»u cao tá»‘i thiá»ƒu
    <div 
      className="h-full w-full" 
      style={{ minHeight: 'calc(100vh - 250px)' }} // Äiá»u chá»‰nh chiá»u cao Ä‘á»ƒ phÃ¹ há»£p layout
    >
      <iframe
        src={LARK_EMBED_URL}
        title="Báº£ng Cháº¥m CÃ´ng tá»« Lark Base"
        style={{
          width: '100%',
          height: '100%',
          border: 'none',
          borderRadius: '8px' // Bo gÃ³c cho iframe
        }}
        loading="lazy"
        allow="fullscreen"
      >
        TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ iframe.
      </iframe>
    </div>
  );
};

export default LarkAttendanceEmbed;

        === Káº¿t thÃºc LarkAttendanceEmbed.jsx ===
    ğŸ“ auth/
      ğŸ“„ LoginForm.jsx
      ğŸ“„ ProtectedRoute.jsx
        === Ná»™i dung ProtectedRoute.jsx ===
import React from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';
import Loading from '../common/Loading';

const ProtectedRoute = ({ children, requiredRoles = [] }) => {
  const { user, loading } = useAuth();
  const location = useLocation();

  if (loading) {
    return <Loading fullScreen text="Äang kiá»ƒm tra quyá»n truy cáº­p..." />;
  }

  if (!user) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  // Check role-based access
  if (requiredRoles.length > 0 && !requiredRoles.includes(user.role)) {
    return (
      <div className="container mt-5">
        <div className="alert alert-danger">
          <h4>KhÃ´ng cÃ³ quyá»n truy cáº­p</h4>
          <p>Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p vÃ o trang nÃ y.</p>
          <button 
            className="btn btn-primary" 
            onClick={() => window.history.back()}
          >
            Quay láº¡i
          </button>
        </div>
      </div>
    );
  }

  return children;
};

export default ProtectedRoute;

        === Káº¿t thÃºc ProtectedRoute.jsx ===
    ğŸ“ common/
      ğŸ“„ Alert.jsx
        === Ná»™i dung Alert.jsx ===
import React, { useState, useEffect } from 'react';

// HÃ m helper Ä‘á»ƒ láº¥y icon dá»±a trÃªn loáº¡i thÃ´ng bÃ¡o
const getIconByType = (type) => {
    switch (type) {
        case 'success': return 'fa-check-circle';
        case 'error': return 'fa-times-circle';
        case 'warning': return 'fa-exclamation-triangle';
        case 'info': return 'fa-info-circle';
        default: return 'fa-info-circle';
    }
};

const Alert = ({ notification, onClose }) => {
    // âœ… THÃŠM: Guard clause Ä‘á»ƒ trÃ¡nh lá»—i destructuring khi notification = undefined
    if (!notification) {
        console.warn('Alert component received undefined notification');
        return null;
    }

    // âœ… Sá»¬A: ThÃªm default values Ä‘á»ƒ trÃ¡nh crash
    const { 
        id = 'unknown', 
        message = 'ThÃ´ng bÃ¡o khÃ´ng xÃ¡c Ä‘á»‹nh', 
        type = 'info',
        duration 
    } = notification;

    const [isExiting, setIsExiting] = useState(false);

    useEffect(() => {
        // Tá»± Ä‘á»™ng Ä‘Ã³ng sau má»™t khoáº£ng thá»i gian náº¿u cÃ³
        if (duration) {
            const timer = setTimeout(() => {
                handleClose();
            }, duration);
            return () => clearTimeout(timer);
        }
    }, [duration]); // âœ… Sá»¬A: Sá»­ dá»¥ng duration Ä‘Ã£ destructured

    const handleClose = () => {
        setIsExiting(true);
        // Äá»£i animation fade-out hoÃ n thÃ nh rá»“i má»›i gá»¡ component khá»i state
        setTimeout(() => {
            // âœ… THÃŠM: Kiá»ƒm tra onClose tá»“n táº¡i trÆ°á»›c khi gá»i
            if (onClose) {
                onClose(id);
            }
        }, 400); // Pháº£i khá»›p vá»›i thá»i gian transition trong CSS
    };

    return (
        <div className={`alert-toast ${type} ${isExiting ? '' : 'show'}`}>
            <i className={`fas ${getIconByType(type)} alert-toast-icon`}></i>
            <div className="alert-toast-content">
                <div className="alert-toast-message">{message}</div>
            </div>
            <button className="alert-toast-close" onClick={handleClose}>
        ...
        === Káº¿t thÃºc Alert.jsx ===
      ğŸ“„ Loading.jsx
        === Ná»™i dung Loading.jsx ===
import React from 'react';

const Loading = ({ 
  size = 'medium', 
  text = 'Äang táº£i...', 
  overlay = false,
  fullScreen = false 
}) => {
  const getSizeClass = () => {
    switch (size) {
      case 'small': return 'spinner-border-sm';
      case 'large': return 'spinner-border spinner-border-lg';
      default: return 'spinner-border';
    }
  };

  const LoadingSpinner = () => (
    <div className="d-flex flex-column align-items-center justify-content-center p-3">
      <div className={`${getSizeClass()} text-primary`} role="status">
        <span className="visually-hidden">Loading...</span>
      </div>
      {text && (
        <div className="mt-2 text-muted small">
          {text}
        </div>
      )}
    </div>
  );

  if (fullScreen) {
    return (
      <div 
        className="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
        style={{ 
          backgroundColor: 'rgba(255, 255, 255, 0.9)', 
          zIndex: 9999 
        }}
      >
        <div className="text-center">
          <div className="spinner-border spinner-border-lg text-primary" role="status">
            <span className="visually-hidden">Loading...</span>
          </div>
          <div className="mt-3 h5 text-muted">{text}</div>
        </div>
      </div>
    );
  }

  if (overlay) {
    return (
      <div 
        className="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
        style={{ 
          backgroundColor: 'rgba(255, 255, 255, 0.8)', 
          zIndex: 1000 
        }}
      >
        <LoadingSpinner />
      </div>
    );
  }

  return <LoadingSpinner />;
};

// Loading wrapper component for conditional loading states
export const LoadingWrapper = ({ loading, children, ...loadingProps }) => {
  if (loading) {
    return <Loading {...loadingProps} />;
  }
  return children;
};

// Inline loading component for buttons
export const ButtonLoading = ({ loading, children, disabled,...
        === Káº¿t thÃºc Loading.jsx ===
      ğŸ“„ Modal.jsx
        === Ná»™i dung Modal.jsx ===
// src/components/common/Modal.jsx
import React from 'react';

const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
  if (!isOpen) return null;

  const handleBackdropClick = (e) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <div 
      className="modal fade show d-block" 
      style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}
      onClick={handleBackdropClick}
    >
      <div className={`modal-dialog modal-${size} modal-dialog-centered`}>
        <div className="modal-content">
          <div className="modal-header">
            <h5 className="modal-title">{title}</h5>
            <button 
              type="button" 
              className="btn-close" 
              onClick={onClose}
            ></button>
          </div>
          <div className="modal-body">
            {children}
          </div>
        </div>
      </div>
    </div>
  );
};

export default Modal;

        === Káº¿t thÃºc Modal.jsx ===
      ğŸ“„ Table.jsx
    ğŸ“ dashboard/
      ğŸ“„ Dashboard.jsx
        === Ná»™i dung Dashboard.jsx ===
// // src/components/dashboard/Dashboard.jsx
// import React, { useState, useEffect } from 'react';
// import { useAuth } from '../../hooks/useAuth';
// import { ApiClient } from '../../services/api';
// import Loading from '../common/Loading';
// import { useNotification } from '../../hooks/useNotification';

// const Dashboard = () => {
//   const [stats, setStats] = useState({});
//   const [loading, setLoading] = useState(true);
//   const { user } = useAuth();
//   const { showNotification } = useNotification();

//   useEffect(() => {
//     loadStats();
    
//     // Auto refresh every 5 minutes
//     const interval = setInterval(loadStats, 5 * 60 * 1000);
//     return () => clearInterval(interval);
//   }, []);

//   const loadStats = async () => {
//     try {
//       console.log('ğŸ” Dashboard: Loading stats...');
//       const response = await ApiClient.get('/api/employees/stats');
      
//       console.log('ğŸ“¨ Dashboard: Raw response:', response);
//       console.log('âœ… Dashboard: Response success:', response.success);
//       console.log('ğŸ“Š Dashboard: Response data:', response.data);
      
//       // âœ… FIX: Sá»­ dá»¥ng response.data thay vÃ¬ response
//       if (response.success && response.data) {
//         console.log('âœ… Dashboard: Setting stats to:', response.data);
//         setStats(response.data);
//       } else {
//         console.warn('âš ï¸ Dashboard: API returned success: false');
//         showNotification('KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u thá»‘ng kÃª', 'warning');
//       }
      
//     } catch (error) {
//       console.error('âŒ Dashboard: Error loading stats:', error);
//       showNotification('Lá»—i khi táº£i thá»‘ng kÃª dashboard', 'error');
//     } finally {
//       setLoading(false);
//     }
//   };

//   const handleRefresh = async () => {
//     setLoading(true);
//     await loadStats();
//     showNotification('ÄÃ£ cáº­p nháº­t dá»¯ liá»‡u dashboard', 'success');
//   };

//   // âœ… DEBUG: Log current stats state
//   console.log('ğŸ¯ Dashboard render ...
        === Káº¿t thÃºc Dashboard.jsx ===
      ğŸ“„ HRDashboard.jsx
      ğŸ“„ StatsCard.jsx
    ğŸ“ employee/
      ğŸ“„ AddWorkHistoryModal.jsx
        === Ná»™i dung AddWorkHistoryModal.jsx ===
import React, { useState } from 'react';

// Import cÃ¡c thÃ nh pháº§n vÃ  services cáº§n thiáº¿t
import Modal from '../common/Modal.jsx';
import RecruitmentModal from './RecruitmentModal.jsx';
import { ButtonLoading } from '../common/Loading.jsx';
import { useNotification } from '../../hooks/useNotification';
import { addWorkHistory } from '../../services/employee.js';

/**
 * Modal Ä‘á»ƒ thÃªm má»™t báº£n ghi Lá»‹ch sá»­ cÃ´ng viá»‡c cho nhÃ¢n viÃªn.
 * NÃ³ cho phÃ©p ngÆ°á»i dÃ¹ng chá»n má»™t "Äá» xuáº¥t tuyá»ƒn dá»¥ng" Ä‘Ã£ cÃ³ sáºµn.
 * Logic Ä‘Æ°á»£c Ä‘iá»u chá»‰nh Ä‘á»ƒ luÃ´n lÃ m viá»‡c vá»›i má»™t máº£ng cÃ¡c Ä‘á» xuáº¥t,
 * nhÆ°ng RecruitmentModal Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ chá»‰ cho phÃ©p chá»n má»™t.
 *
 * @param {object} props
 * @param {boolean} props.isOpen - Cá» Ä‘á»ƒ Ä‘iá»u khiá»ƒn viá»‡c hiá»ƒn thá»‹ modal.
 * @param {Function} props.onClose - HÃ m Ä‘á»ƒ Ä‘Ã³ng modal.
 * @param {object} props.employee - Äá»‘i tÆ°á»£ng nhÃ¢n viÃªn Ä‘ang Ä‘Æ°á»£c thÃªm lá»‹ch sá»­.
 * @param {Function} props.onSave - HÃ m callback Ä‘Æ°á»£c gá»i sau khi lÆ°u thÃ nh cÃ´ng.
 */
const AddWorkHistoryModal = ({ isOpen, onClose, employee, onSave }) => {
  // Náº¿u khÃ´ng cÃ³ thÃ´ng tin nhÃ¢n viÃªn, khÃ´ng render gÃ¬ cáº£ Ä‘á»ƒ trÃ¡nh lá»—i.
  if (!employee) return null;

  // State quáº£n lÃ½ Ä‘á» xuáº¥t dÆ°á»›i dáº¡ng Máº¢NG Ä‘á»ƒ Ä‘á»“ng nháº¥t logic.
  const [selectedRecruitments, setSelectedRecruitments] = useState([]);
  const [isRecruitmentModalOpen, setIsRecruitmentModalOpen] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  
  // âœ… THÃŠM: State cho cÃ¡c trÆ°á»ng má»›i
  const [workHistoryData, setWorkHistoryData] = useState({
    fromDate: '',
    toDate: '',
    hourlyRate: ''
  });
  
  const { showNotification } = useNotification();

  /**
   * Xá»­ lÃ½ khi ngÆ°á»i dÃ¹ng chá»n má»™t Ä‘á» xuáº¥t tá»« RecruitmentModal.
   * DÃ¹ RecruitmentModal cÃ³ singleSelect=true, nÃ³ váº«n Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ tráº£ vá» má»™t máº£ng.
   * @param {Array<object>} recruitmentObject - Máº£ng chá»©a Ä‘á» xuáº¥t Ä‘Ã£ chá»n.
   */
  const handleRecruitmentSelect = (recruitmentObject) => {
    // LuÃ´n nháº­n vá» má»™t máº£ng, ká»ƒ cáº£ khi chá»‰ cÃ³ má»™t lá»±a chá»n.
    setSelectedRecruitments(rec...
        === Káº¿t thÃºc AddWorkHistoryModal.jsx ===
      ğŸ“„ EmployeeAddForm.jsx
        === Ná»™i dung EmployeeAddForm.jsx ===
// src/components/employee/EmployeeAddForm.jsx

import React, { useState, useRef, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useNotification } from '../../hooks/useNotification';
import RecruitmentModal from './RecruitmentModal';

const EmployeeAddForm = ({ onSave, isLoading: externalLoading }) => {
  const navigate = useNavigate();
  const { showNotification } = useNotification();
  const fullNameInputRef = useRef(null);

  const [isSubmitting, setIsSubmitting] = useState(false);
  const [selectedRecruitment, setSelectedRecruitment] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  const initialFormData = {
    fullName: '',
    phoneNumber: '',
    gender: 'Nam',
    bankAccount: '',
    bankName: '',
  };

  const initialWorkHistoryData = {
    fromDate: '',
    toDate: '',
    hourlyRate: ''
  };

  const [formData, setFormData] = useState(initialFormData);
  const [workHistoryData, setWorkHistoryData] = useState(initialWorkHistoryData);

  const handleChange = e => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleWorkHistoryChange = e => {
    const { name, value } = e.target;
    setWorkHistoryData(prev => ({ ...prev, [name]: value }));
  };

  const resetForm = () => {
    setFormData(initialFormData);
    setWorkHistoryData(initialWorkHistoryData);
    setSelectedRecruitment(null);
    fullNameInputRef.current?.focus();
  };

  const handleSelectRecruitment = request => {
    setSelectedRecruitment(request);
    setIsModalOpen(false);
  };

  const handleRemoveRecruitment = () => {
    setSelectedRecruitment(null);
    setWorkHistoryData(initialWorkHistoryData);
  };

  const validateWorkHistory = () => {
    const errors = [];
    if (!workHistoryData.fromDate) errors.push('Tá»« ngÃ y lÃ  báº¯t buá»™c');
    if (!workHistoryData.toDate) errors.push('Äáº¿n ngÃ y lÃ  báº¯t buá»™c');

    if (workHistoryData.fromDate && workHistoryData.toDate) ...
        === Káº¿t thÃºc EmployeeAddForm.jsx ===
      ğŸ“„ EmployeeEditModal.jsx
        === Ná»™i dung EmployeeEditModal.jsx ===
import React, { useState, useEffect } from 'react';
import { useNotification } from '../../hooks/useNotification';
import Modal from '../common/Modal.jsx';
import { ButtonLoading } from '../common/Loading.jsx';

const EmployeeEditModal = ({ isOpen, onClose, onSave, employee }) => {
    const [formData, setFormData] = useState({
    fullName: '',
    phoneNumber: '',
    gender: 'Nam',
    bankAccount: '',
    bankName: '',
    status: 'active',
  });
  //const [formData, setFormData] = useState({});
  const [loading, setLoading] = useState(false);
  const { showNotification } = useNotification();

  // Khi modal má»Ÿ hoáº·c nhÃ¢n viÃªn Ä‘Æ°á»£c chá»n thay Ä‘á»•i, cáº­p nháº­t state cá»§a form
  useEffect(() => {
    if (employee) {
      setFormData({
        fullName: employee.fullName || '',
        phoneNumber: employee.phoneNumber || '',
        gender: employee.gender || 'Nam',
        bankAccount: employee.bankAccount || '',
        bankName: employee.bankName || '',
        status: employee.status || 'active',
      });
    }
  }, [employee]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      // Gá»i hÃ m onSave Ä‘Æ°á»£c truyá»n tá»« EmployeeManagementPage. HÃ m nÃ y sáº½ gá»i hook useEmployees Ä‘á»ƒ thá»±c sá»± cáº­p nháº­t dá»¯ liá»‡u.
      const success = await onSave(formData);
      // if (success) {
      //   // Component cha (EmployeeManagementPage) sáº½ tá»± xá»­ lÃ½ viá»‡c Ä‘Ã³ng modal.
      // } else {
      //   // Náº¿u onSave tráº£ vá» false, hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i chung.
      //   showNotification('Cáº­p nháº­t tháº¥t báº¡i. Vui lÃ²ng thá»­ láº¡i.', 'error');
      // }
    } catch (error) {
      console.error('Lá»—i khi submit form sá»­a nhÃ¢n viÃªn:', error);
      showNotification(error.message || 'Lá»—i há»‡ thá»‘ng khi cáº­p nháº­t.', 'error');
    } finally {
      setLoading(false);
    }
  };

  if (!isOpen || !employee) return null;

  return ...
        === Káº¿t thÃºc EmployeeEditModal.jsx ===
      ğŸ“„ EmployeeForm.jsx
        === Ná»™i dung EmployeeForm.jsx ===
// src/components/employee/EmployeeForm.jsx

import React, { useState, useEffect } from 'react';

const EmployeeForm = ({ initialData, onSubmit, onCancel, isLoading }) => {
  const [formData, setFormData] = useState(initialData);

  useEffect(() => {
    setFormData(initialData);
  }, [initialData]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    onSubmit(formData);
  };

  return (
    <form onSubmit={handleSubmit}>
      <div className="row">
        <div className="col-md-6 mb-3">
          <label className="form-label">Há» tÃªn</label>
          <input name="fullName" value={formData.fullName} onChange={handleChange} className="form-control" required />
        </div>
        <div className="col-md-6 mb-3">
          <label className="form-label">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
          <input name="phoneNumber" value={formData.phoneNumber} onChange={handleChange} className="form-control" required />
        </div>
      </div>
      <div className="row">
        <div className="col-md-6 mb-3">
          <label className="form-label">Giá»›i tÃ­nh</label>
          <select name="gender" value={formData.gender} onChange={handleChange} className="form-select">
            <option value="Nam">Nam</option>
            <option value="Ná»¯">Ná»¯</option>
          </select>
        </div>
        <div className="col-md-6 mb-3">
          <label className="form-label">LÆ°Æ¡ng/giá»</label>
          <input type="number" name="hourlyRate" value={formData.hourlyRate} onChange={handleChange} className="form-control" required />
        </div>
      </div>
      <div className="row">
        <div className="col-md-6 mb-3">
          <label className="form-label">Sá»‘ tÃ i khoáº£n</label>
          <input name="bankAccount" value={formData.bankAccount} onChange={handleChange} className="form-control" />
        </div>
        <div className="col-md-6 mb-3">...
        === Káº¿t thÃºc EmployeeForm.jsx ===
      ğŸ“„ EmployeeList.jsx
        === Ná»™i dung EmployeeList.jsx ===
import React from 'react';
import EmployeeTable from './EmployeeTable';

const EmployeeList = ({ 
  employees, 
  onEdit, 
  onDelete, 
  onAddWorkHistory, 
  onManageWorkHistory // âœ… THAY Äá»”I: Äá»•i tÃªn tá»« onViewWorkHistory thÃ nh onManageWorkHistory
}) => {
  return (
    <div className="employee-list">
      <div className="mb-3">
        <small className="text-muted">
          Hiá»ƒn thá»‹ {employees.length} káº¿t quáº£
        </small>
      </div>
      <EmployeeTable
        employees={employees}
        onEdit={onEdit}
        onDelete={onDelete}
        onAddWorkHistory={onAddWorkHistory}
        onManageWorkHistory={onManageWorkHistory} // âœ… THAY Äá»”I: Truyá»n prop má»›i xuá»‘ng EmployeeTable
      />
    </div>
  );
};

export default EmployeeList;

        === Káº¿t thÃºc EmployeeList.jsx ===
      ğŸ“„ EmployeeTable.jsx
        === Ná»™i dung EmployeeTable.jsx ===
import React from 'react';

const EmployeeTable = ({ 
  employees, 
  onEdit, 
  onDelete, 
  onAddWorkHistory, 
  onManageWorkHistory
}) => {

  // âœ… Giá»¯ láº¡i pháº§n hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ¢n thiá»‡n khi khÃ´ng cÃ³ dá»¯ liá»‡u tá»« code cá»§a báº¡n.
  if (!employees || employees.length === 0) {
    return (
      <div className="text-center py-5">
        <p className="text-muted">KhÃ´ng cÃ³ dá»¯ liá»‡u nhÃ¢n viÃªn Ä‘á»ƒ hiá»ƒn thá»‹.</p>
        <p className="text-muted small">HÃ£y thá»­ thay Ä‘á»•i bá»™ lá»c hoáº·c thÃªm nhÃ¢n viÃªn má»›i.</p>
      </div>
    );
  }

  return (
    <div className="table-responsive">
      <table className="table table-hover table-striped align-middle">
        <thead className="table-dark">
          <tr>
            <th>MÃ£ NV</th>
            <th>Há» tÃªn</th>
            <th>Sá»‘ ÄT</th>
            <th>Giá»›i tÃ­nh</th>
            <th>TÃ i khoáº£n</th>
            <th>NgÃ¢n hÃ ng</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th className="text-center" style={{ minWidth: '180px' }}>Thao tÃ¡c</th> {/* âœ… TÄ‚NG chiá»u rá»™ng cho thÃªm nÃºt */}
          </tr>
        </thead>
        <tbody>
          {employees.map((employee) => (
            <tr key={employee.id}>
              <td>{employee.employeeId || 'N/A'}</td>
              <td>{employee.fullName || 'N/A'}</td>
              <td>{employee.phoneNumber || 'N/A'}</td>
              <td>{employee.gender || 'N/A'}</td>
              <td>{employee.bankAccount || 'N/A'}</td>
              <td>{employee.bankName || 'N/A'}</td>
              <td>
                <span className={`badge ${employee.status === 'active' ? 'bg-success' : 'bg-secondary'}`}>
                  {employee.status === 'active' ? 'Hoáº¡t Ä‘á»™ng' : 'NgÆ°ng'}
                </span>
              </td>
              <td className="text-center">
                <div className="btn-group" role="group">
                  {/* âœ… GIá»® Láº I: NÃºt ThÃªm Work History */}
                  {onAddWorkHistory && (
                    <button
                      className="btn btn-sm btn-succe...
        === Káº¿t thÃºc EmployeeTable.jsx ===
      ğŸ“„ RecruitmentModal.jsx
        === Ná»™i dung RecruitmentModal.jsx ===
import React, { useState, useEffect } from 'react';
import { getApprovedRecruitmentRequests } from '../../services/employee.js';
import { useNotification } from '../../hooks/useNotification';
import Loading from '../common/Loading';

const RecruitmentModal = ({ isOpen, onClose, onRecruitmentSelected, selectedRecruitment = null }) => {
  const [recruitmentRequests, setRecruitmentRequests] = useState([]);
  const [loading, setLoading] = useState(false);
  const [selectedItem, setSelectedItem] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const { showNotification } = useNotification();

  useEffect(() => {
    if (isOpen) {
      loadRecruitmentRequests();
      setSelectedItem(selectedRecruitment);
    }
  }, [isOpen, selectedRecruitment]);

  const loadRecruitmentRequests = async () => {
    try {
      setLoading(true);
      const data = await getApprovedRecruitmentRequests();
      setRecruitmentRequests(data || []);
    } catch (err) {
      showNotification('Lá»—i khi táº£i dá»¯ liá»‡u tuyá»ƒn dá»¥ng.', 'warning');
      setRecruitmentRequests(getMockData());
    } finally {
      setLoading(false);
    }
  };

  const getMockData = () => [
    {
      id: '1',
      requestNo: '202507140017',
      requester: '236LH.Nguyá»…n Huy ThÃ nh',
      status: 'Äang tuyá»ƒn dá»¥ng',
      department: '116 Cáº§u Giáº¥y',
      quantity: '2',
      gender: 'Nam/Ná»¯',
      fromDate: '2025-07-14',
      toDate: '2025-08-14',
      position: 'NhÃ¢n viÃªn bÃ¡n hÃ ng'
    },
    {
      id: '2',
      requestNo: '202507140018',
      requester: '225VVN.Nguyá»…n Trá»ng HoÃ ng An',
      status: 'Äang tuyá»ƒn dá»¥ng',
      department: 'TrÃ¢m Trá»—i',
      quantity: '1',
      gender: 'Ná»¯',
      fromDate: '2025-07-14',
      toDate: '2025-08-14',
      position: 'Thu ngÃ¢n'
    }
  ];

  const filteredData = recruitmentRequests.filter(item =>
    item.requestNo?.toLowerCase().includes(searchTerm.toLowerCase()) ||
    item.department?.toLowerCase().includes(searchTerm.toLowerCase()) ||
    ...
        === Káº¿t thÃºc RecruitmentModal.jsx ===
      ğŸ“„ WorkHistoryModal.jsx
        === Ná»™i dung WorkHistoryModal.jsx ===
import React, { useState, useEffect } from 'react';
import { getWorkHistory, addWorkHistory, updateWorkHistory, deleteWorkHistory } from '../../services/employee.js';
import { useNotification } from '../../hooks/useNotification';
import Modal from '../common/Modal.jsx';
import Loading from '../common/Loading.jsx';
import RecruitmentModal from './RecruitmentModal.jsx';
import { ButtonLoading } from '../common/Loading.jsx';

const WorkHistoryModal = ({ isOpen, onClose, employeeId, employeeName, workHistory,onDataChanged  }) => {
  // ===== STATE MANAGEMENT =====
  const [workHistoryData, setWorkHistoryData] = useState([]);
  const [loading, setLoading] = useState(false);
  const [mode, setMode] = useState('view'); // 'view' | 'add' | 'edit'
  const [selectedWorkHistory, setSelectedWorkHistory] = useState(null);
  const [isRecruitmentModalOpen, setIsRecruitmentModalOpen] = useState(false);
  const [selectedRecruitment, setSelectedRecruitment] = useState(null);
  const [saving, setSaving] = useState(false);
  
  // Form data cho add/edit
  const [formData, setFormData] = useState({
    fromDate: '',
    toDate: '',
    hourlyRate: ''
  });

  const { showNotification } = useNotification();

  // ===== EFFECTS =====
  useEffect(() => {
    if (isOpen && employeeId && !workHistory) {
      fetchWorkHistory();
    } else if (workHistory) {
      setWorkHistoryData(workHistory);
    }
    // Reset vá» view mode khi má»Ÿ modal
    setMode('view');
    resetForm();
  }, [isOpen, employeeId, workHistory]);

  // ===== DATA FETCHING =====
  const fetchWorkHistory = async () => {
    setLoading(true);
    try {
      const response = await getWorkHistory(employeeId);
      setWorkHistoryData(response || []);
    } catch (error) {
      console.error('Lá»—i khi táº£i lá»‹ch sá»­ cÃ´ng viá»‡c:', error);
      showNotification(error.message || 'Lá»—i káº¿t ná»‘i Ä‘áº¿n server', 'error');
    } finally {
      setLoading(false);
    }
  };

  // ===== FORM HANDLING =====
  const resetForm = () => {
    se...
        === Káº¿t thÃºc WorkHistoryModal.jsx ===
    ğŸ“ layout/
      ğŸ“„ Layout.jsx
        === Ná»™i dung Layout.jsx ===
import React, { useEffect } from 'react';
import { Outlet, useLocation } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';
import ResponsiveNavigation from './ResponsiveNavigation';

const Layout = () => {
  const { user } = useAuth();
  const location = useLocation();

  useEffect(() => {
    // Initialize tooltips when location changes
    if (typeof window !== 'undefined' && window.bootstrap) {
      const tooltipTriggerList = [].slice.call(
        document.querySelectorAll('[data-bs-toggle="tooltip"]')
      );
      tooltipTriggerList.map(tooltipTriggerEl => {
        return new window.bootstrap.Tooltip(tooltipTriggerEl);
      });
    }
  }, [location]);

  if (!user) {
    return (
      <div className="d-flex justify-content-center align-items-center min-vh-100">
        <div className="spinner-border" role="status">
          <span className="visually-hidden">Loading...</span>
        </div>
      </div>
    );
  }

  return (
    <div className="d-flex">
      <ResponsiveNavigation />
      
      {/* Main content */}
      <div className="flex-grow-1">
        <main className="container-fluid py-4">
          <Outlet />
        </main>
      </div>

      {/* âœ… BÆ¯á»šC 2: XÃ³a bá» Alert Container khá»i Ä‘Ã¢y */}
      {/* Div Ä‘Ã£ Ä‘Æ°á»£c di chuyá»ƒn ra App.jsx */}
    </div>
  );
};

export default Layout;

        === Káº¿t thÃºc Layout.jsx ===
      ğŸ“„ ResponsiveNavigation.jsx
        === Ná»™i dung ResponsiveNavigation.jsx ===
import React, { useState, useEffect } from 'react';
import { useLocation, Link } from 'react-router-dom'; // âœ… THÃŠM Link
import { useAuth } from '../../hooks/useAuth';
import { useNotification } from '../../hooks/useNotification';

const ResponsiveNavigation = () => {
  const [isMobile, setIsMobile] = useState(false);
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [dropdownOpen, setDropdownOpen] = useState(false);
  
  const { user, logout } = useAuth();
  const { showNotification } = useNotification();
  const location = useLocation();

  // Detect mobile screen
  useEffect(() => {
    const checkScreenSize = () => {
      setIsMobile(window.innerWidth < 768);
    };
    
    checkScreenSize();
    window.addEventListener('resize', checkScreenSize);
    return () => window.removeEventListener('resize', checkScreenSize);
  }, []);

  // âœ… Sá»¬A: Menu items configuration - THÃŠM 'sales' vÃ o attendance-logs
  const menuItems = [
    {
      path: '/employee-management',
      icon: 'fas fa-users-cog',
      label: 'Quáº£n lÃ½ nhÃ¢n viÃªn',
      roles: ['admin', 'hr']
    },
    {
      path: '/hr-dashboard',
      icon: 'fas fa-chart-bar',
      label: 'HR Dashboard',
      roles: ['admin', 'hr']
    },
    {
      path: '/attendance-logs',
      icon: 'fas fa-clock',
      label: 'Báº£n ghi cháº¥m cÃ´ng',
      roles: ['admin', 'hr', 'sales', 'sales_manager', 'finance_manager', 'director'] // âœ… THÃŠM 'sales'
    }
  ];

  const filteredMenuItems = menuItems.filter(item => 
    item.roles.includes(user?.role)
  );

  const isActiveRoute = (path) => {
    return location.pathname === path || location.pathname.startsWith(path + '/');
  };

  const handleLogout = async () => {
    try {
      await logout();
      showNotification('ÄÄƒng xuáº¥t thÃ nh cÃ´ng!', 'success');
    } catch (error) {
      console.error('Logout error:', error);
      showNotification('Lá»—i khi Ä‘Äƒng xuáº¥t', 'error');
    }
  };

  // Desktop Navigation (Always visible sidebar)
  const DesktopNavig...
        === Káº¿t thÃºc ResponsiveNavigation.jsx ===
    ğŸ“ masterdata/
      ğŸ“„ PositionManager.jsx
        === Ná»™i dung PositionManager.jsx ===
import React, { useState, useEffect } from 'react';
import { ApiClient } from '../../services/api';
import { useNotification } from '../../hooks/useNotification';
import Loading from '../common/Loading';

const PositionManager = () => {
  const [positions, setPositions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [formData, setFormData] = useState({
    positionName: '',
    description: ''
  });
  const [editingPosition, setEditingPosition] = useState(null);
  const { showNotification } = useNotification();

  useEffect(() => {
    loadPositions();
  }, []);

  const loadPositions = async () => {
    try {
      setLoading(true);
      const data = await ApiClient.get('/api/employees/positions');
      setPositions(data);
    } catch (error) {
      console.error('Error loading positions:', error);
      showNotification('Lá»—i khi táº£i danh sÃ¡ch vá»‹ trÃ­', 'error');
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!formData.positionName.trim()) {
      showNotification('Vui lÃ²ng nháº­p tÃªn vá»‹ trÃ­!', 'error');
      return;
    }

    try {
      if (editingPosition) {
        await ApiClient.put(`/api/employees/positions/${editingPosition.id}`, formData);
        showNotification('Cáº­p nháº­t vá»‹ trÃ­ thÃ nh cÃ´ng', 'success');
      } else {
        await ApiClient.post('/api/employees/positions', formData);
        showNotification('ThÃªm vá»‹ trÃ­ thÃ nh cÃ´ng', 'success');
      }
      
      setFormData({ positionName: '', description: '' });
      setEditingPosition(null);
      await loadPositions();
    } catch (error) {
      console.error('Error saving position:', error);
      showNotification('Lá»—i khi lÆ°u vá»‹ trÃ­', 'error');
    }
  };

  const handleEdit = (position) => {
    setEditingPosition(position);
    setForm...
        === Káº¿t thÃºc PositionManager.jsx ===
      ğŸ“„ StoreManager.jsx
        === Ná»™i dung StoreManager.jsx ===
import React, { useState, useEffect } from 'react';
import { ApiClient } from '../../services/api';
import { useNotification } from '../../hooks/useNotification';
import Loading from '../common/Loading';

const StoreManager = () => {
  const [stores, setStores] = useState([]);
  const [loading, setLoading] = useState(true);
  const [formData, setFormData] = useState({
    storeName: '',
    address: ''
  });
  const [editingStore, setEditingStore] = useState(null);
  const { showNotification } = useNotification();

  useEffect(() => {
    loadStores();
  }, []);

  const loadStores = async () => {
    try {
      setLoading(true);
      const data = await ApiClient.get('/api/employees/stores');
      setStores(data);
    } catch (error) {
      console.error('Error loading stores:', error);
      showNotification('Lá»—i khi táº£i danh sÃ¡ch cá»­a hÃ ng', 'error');
    } finally {
      setLoading(false);
    }
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!formData.storeName.trim() || !formData.address.trim()) {
      showNotification('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!', 'error');
      return;
    }

    try {
      if (editingStore) {
        await ApiClient.put(`/api/employees/stores/${editingStore.id}`, formData);
        showNotification('Cáº­p nháº­t cá»­a hÃ ng thÃ nh cÃ´ng', 'success');
      } else {
        await ApiClient.post('/api/employees/stores', formData);
        showNotification('ThÃªm cá»­a hÃ ng thÃ nh cÃ´ng', 'success');
      }
      
      setFormData({ storeName: '', address: '' });
      setEditingStore(null);
      await loadStores();
    } catch (error) {
      console.error('Error saving store:', error);
      showNotification('Lá»—i khi lÆ°u cá»­a hÃ ng', 'error');
    }
  };

  const handleEdit = (store) => {
    setEditingStore(store);
    setFormData({
      storeName: store.store...
        === Káº¿t thÃºc StoreManager.jsx ===
  ğŸ“ contexts/
    ğŸ“„ AppContext.jsx
    ğŸ“„ AuthContext.jsx
      === Ná»™i dung AuthContext.jsx ===
import React, { createContext, useContext, useState, useEffect } from 'react';
import { ApiClient } from '../services/api.js';

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [initialized, setInitialized] = useState(false);

  useEffect(() => {
    initializeAuth();
  }, []);

  const initializeAuth = async () => {
    try {
      setLoading(true);
      // âœ… Sá»¬A: Thay tháº¿ checkAuth() báº±ng viá»‡c gá»i trá»±c tiáº¿p getProfile tá»« ApiClient
      const response = await ApiClient.get('/api/auth/profile');
      if (response.success && response.data.user) {
        setUser(response.data.user);
      } else {
        setUser(null);
      }
    } catch (error) {
      console.warn('Auth initialization: Not logged in.');
      setUser(null);
    } finally {
      setInitialized(true);
      setLoading(false);
    }
  };

  // HÃ m checkAuth cÅ© cÃ³ thá»ƒ xÃ³a hoáº·c giá»¯ láº¡i náº¿u cáº§n
  const checkAuth = async () => {
    try {
      const response = await ApiClient.get('/api/auth/profile');
      return response.success ? response.data.user : null;
    } catch (error) {
      return null;
    }
  };

  const login = async (credentials) => {
    try {
      setLoading(true);
      const response = await ApiClient.post('/api/auth/login', credentials);
      
      // âœ… Sá»¬A LOGIC KIá»‚M TRA Táº I ÄÃ‚Y
      // Kiá»ƒm tra `response.data.user` thay vÃ¬ `response.user`
      if (response.success && response.data && response.data.user) {
        setUser(response.data.user);
        return response.data; // Tráº£ vá» `response.data` Ä‘á»ƒ LoginPage cÃ³ thá»ƒ sá»­ dá»¥ng
      } else {
        // NÃ©m lá»—i vá»›i thÃ´ng Ä‘iá»‡p tá»« server náº¿u cÃ³
        throw new Error(response.message || 'Login failed: Invalid response structure');
      }
    } catch (error) {
      console.error('Login error:', error);
      // Äáº£m báº£o nÃ©m láº¡i lá»—i Ä‘á»ƒ component gá»i cÃ³ thá»ƒ báº¯t Ä‘Æ°á»£c
      throw error;
    } fin...
      === Káº¿t thÃºc AuthContext.jsx ===
    ğŸ“„ NotificationContext.jsx
      === Ná»™i dung NotificationContext.jsx ===
import React, { createContext, useState, useCallback, useContext } from 'react';
import ReactDOM from 'react-dom';
import Alert from '../components/common/Alert';
import '../styles/notifications.css';

// FIX: ThÃªm "export" vÃ o Ä‘Ã¢y. ÄÃ¢y lÃ  thay Ä‘á»•i quan trá»ng nháº¥t.
export const NotificationContext = createContext(null);

export const NotificationProvider = ({ children }) => {
    const [notifications, setNotifications] = useState([]);

    const showNotification = useCallback((message, type = 'info', duration = 5000) => {
        const newNotification = {
            id: Date.now() + Math.random(),
            message,
            type,
            duration,
        };
        // ThÃªm thÃ´ng bÃ¡o má»›i vÃ o Ä‘áº§u danh sÃ¡ch Ä‘á»ƒ hiá»‡n trÃªn cÃ¹ng
        setNotifications(prev => [newNotification, ...prev]);
    }, []);

    const removeNotification = useCallback((id) => {
        setNotifications(prev => prev.filter(n => n.id !== id));
    }, []);

    // GiÃ¡ trá»‹ mÃ  Context sáº½ cung cáº¥p cho cÃ¡c component con
    const value = {
        showNotification,
    };
    
    // Logic render thÃ´ng bÃ¡o qua Portal
    const alertContainer = document.getElementById('alert-container');
    if (!alertContainer) {
        console.error('Lá»–I NGHIÃŠM TRá»ŒNG: KhÃ´ng tÃ¬m tháº¥y tháº» <div id="alert-container"> trong DOM. ThÃ´ng bÃ¡o sáº½ khÃ´ng hiá»ƒn thá»‹.');
        // Váº«n render children Ä‘á»ƒ á»©ng dá»¥ng khÃ´ng bá»‹ sáº­p
        return (
             <NotificationContext.Provider value={value}>
                {children}
            </NotificationContext.Provider>
        );
    }

    return (
        <NotificationContext.Provider value={value}>
            {children}
            {/* Render cÃ¡c Alert vÃ o portal */}
            {ReactDOM.createPortal(
                <div className="notification-container">
                    {notifications.map((notification) => (
                        <Alert
                            key={notification.id}
                            notification={notification}
                 ...
      === Káº¿t thÃºc NotificationContext.jsx ===
  ğŸ“ hooks/
    ğŸ“„ useApi.js
      === Ná»™i dung useApi.js ===
import { useState, useEffect } from 'react';
import { ApiClient } from '../services/api.js';

export const useApi = (url, options = {}) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    if (!url) return;
    
    const fetchData = async () => {
      try {
        setLoading(true);
        setError(null);
        
        const response = await ApiClient.get(url, options);
        
        if (response.success && response.data) {
          setData(response.data);
        } else {
          setData(response.data || []);
        }
      } catch (err) {
        console.error('useApi error:', err);
        setError(err);
        setData([]);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [url]);

  return { data, loading, error };
};

      === Káº¿t thÃºc useApi.js ===
    ğŸ“„ useAttendance.js
      === Ná»™i dung useAttendance.js ===
// src/hooks/useAttendance.js
import { useState, useCallback } from 'react';
import { useNotification } from './useNotification';
import api from '../services/api';

export function useAttendance() {
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState(null);
    const { showNotification } = useNotification();

    // âœ… Cáº¬P NHáº¬T: Láº¥y logs cháº¥m cÃ´ng vá»›i filters nÃ¢ng cao
    const getAttendanceLogs = useCallback(async (filters = {}) => {
        try {
            setLoading(true);
            setError(null);
            
            console.log('ğŸ”„ useAttendance: Getting attendance logs with filters:', filters);
            
            const response = await api.get('/attendance/logs', {
                params: filters
            });
            
            console.log('âœ… useAttendance: Attendance logs loaded:', response.data.data?.length || 0, 'records');
            
            return {
                success: true,
                data: response.data.data || [],
                message: response.data.message
            };
            
        } catch (error) {
            console.error('âŒ useAttendance: Error getting attendance logs:', error);
            const errorMessage = error.response?.data?.message || 'Lá»—i khi táº£i logs cháº¥m cÃ´ng';
            setError(errorMessage);
            
            return {
                success: false,
                data: [],
                message: errorMessage
            };
        } finally {
            setLoading(false);
        }
    }, []);

    // âœ… Cáº¬P NHáº¬T: Láº¥y tá»•ng giá» cÃ´ng vá»›i format má»›i  
    const getEmployeeHours = useCallback(async () => {
        try {
            setLoading(true);
            setError(null);
            
            console.log('ğŸ“Š useAttendance: Getting employee hours...');
            
            const response = await api.get('/api/attendance/employee-hours');
            
            console.log('ğŸ” useAttendance RAW RESPONSE:', response);
       ...
      === Káº¿t thÃºc useAttendance.js ===
    ğŸ“„ useAuth.js
      === Ná»™i dung useAuth.js ===
import { useContext } from 'react';
import AuthContext from '../contexts/AuthContext';

export const useAuth = () => {
  const context = useContext(AuthContext);
  
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  
  return context;
};

export default useAuth;

      === Káº¿t thÃºc useAuth.js ===
    ğŸ“„ useEmployees.js
      === Ná»™i dung useEmployees.js ===
// src/hooks/useEmployees.js

import { useState, useEffect, useCallback } from 'react';
import { 
  getEmployees, 
  addEmployee, 
  updateEmployee, 
  deleteEmployee 
} from '../services/employee.js';
import { useNotification } from './useNotification.js';

/**
 * Hook tÃ¹y chá»‰nh Ä‘á»ƒ quáº£n lÃ½ dá»¯ liá»‡u vÃ  logic cá»§a NhÃ¢n viÃªn.
 * @returns {object} Tráº¡ng thÃ¡i vÃ  cÃ¡c hÃ m xá»­ lÃ½.
 */
export const useEmployees = () => {
  const [employees, setEmployees] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const { showNotification } = useNotification();

  const fetchEmployees = useCallback(async () => {
    console.log('HOOK: Báº¯t Ä‘áº§u táº£i danh sÃ¡ch nhÃ¢n viÃªn...');
    setLoading(true);
    setError(null);
    try {
      const response = await getEmployees();
      if (response.success) {
        setEmployees(response.data || []);
        console.log('HOOK: Táº£i danh sÃ¡ch nhÃ¢n viÃªn thÃ nh cÃ´ng.');
      } else {
        // Xá»­ lÃ½ trÆ°á»ng há»£p server tráº£ vá» success: false nhÆ°ng khÃ´ng pháº£i lá»—i HTTP
        throw new Error(response.message || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh tá»« server.');
      }
    } catch (err) {
      // Báº¯t lá»—i Ä‘Æ°á»£c nÃ©m tá»« service (do lá»—i máº¡ng, 500, hoáº·c success: false)
      const errorMessage = err.message || 'KhÃ´ng thá»ƒ táº£i danh sÃ¡ch nhÃ¢n viÃªn.';
      console.error('HOOK: Lá»—i khi táº£i danh sÃ¡ch nhÃ¢n viÃªn:', errorMessage);

      const userMessage = `KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u. Lá»—i: ${errorMessage}. Vui lÃ²ng liÃªn há»‡ phÃ²ng CNTT Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£.`;
      
      setError(userMessage);
      showNotification(userMessage, 'error');
      
      // Äáº£m báº£o danh sÃ¡ch nhÃ¢n viÃªn lÃ  máº£ng rá»—ng khi cÃ³ lá»—i Ä‘á»ƒ trÃ¡nh crash UI
      setEmployees([]); 
    } finally {
      setLoading(false);
    }
  }, [showNotification]);

  // Tá»± Ä‘á»™ng gá»i fetchEmployees khi component Ä‘Æ°á»£c mount
  useEffect(() => {
    fetchEmployees();
  }, [fetchEmployees]);

  // HÃ m thÃªm nhÃ¢n viÃªn má»›i
  const handleAddEmployee = async (employeeData) => {
    try {
     ...
      === Káº¿t thÃºc useEmployees.js ===
    ğŸ“„ useNotification.js
      === Ná»™i dung useNotification.js ===
import { useContext } from 'react';
import { NotificationContext } from '../contexts/NotificationContext';

export const useNotification = () => {
  const context = useContext(NotificationContext);
  if (!context) {
    throw new Error('useNotification must be used within a NotificationProvider');
  }
  return context;
};

      === Káº¿t thÃºc useNotification.js ===
  ğŸ“„ main.jsx
    === Ná»™i dung main.jsx ===
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import App from './App.jsx';
import { AuthProvider } from './contexts/AuthContext.jsx';
import { NotificationProvider } from './contexts/NotificationContext.jsx';

// Import Bootstrap CSS vÃ  FontAwesome
import 'bootstrap/dist/css/bootstrap.min.css';
import 'bootstrap/dist/js/bootstrap.bundle.min.js';
import '@fortawesome/fontawesome-free/css/all.min.css';
import './styles/globals.css';

// Global error handler
window.addEventListener('error', (e) => {
  console.error('Global error:', e.error);
  console.error('Error details:', {
    message: e.message,
    filename: e.filename,
    lineno: e.lineno,
    colno: e.colno
  });
});

// Global unhandled promise rejection handler
window.addEventListener('unhandledrejection', (e) => {
  console.error('Unhandled promise rejection:', e.reason);
  console.error('Promise:', e.promise);
});

// Initialize tooltips when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  if (typeof window.bootstrap !== 'undefined') {
    const tooltipTriggerList = [].slice.call(
      document.querySelectorAll('[data-bs-toggle="tooltip"]')
    );
    tooltipTriggerList.map(tooltipTriggerEl => {
      return new window.bootstrap.Tooltip(tooltipTriggerEl);
    });
  }
});

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <NotificationProvider>
          <App />
        </NotificationProvider>
      </AuthProvider>
    </BrowserRouter>
  </React.StrictMode>
);

    === Káº¿t thÃºc main.jsx ===
  ğŸ“ pages/
    ğŸ“„ AttendanceLogsPage.jsx
      === Ná»™i dung AttendanceLogsPage.jsx ===
import { formatDateTimeForCSV, formatTimeForCSV } from '../utils/dateUtils';
import React, { useState, useEffect } from 'react';
import { ApiClient } from '../services/api';
import { useNotification } from '../hooks/useNotification';
import Loading from '../components/common/Loading';


const LARK_LOGS_URL = "https://atino-vietnam.sg.larksuite.com/base/Ey3EbVD9vacAHvs8cVvlHxkKg2r?table=tblU9YY1t4TwxXLh&view=vewpWpbNQv";
const LARK_HOURS_URL = "https://atino-vietnam.sg.larksuite.com/base/Ey3EbVD9vacAHvs8cVvlHxkKg2r?table=tblV2dGhT2O7w30b&view=vewDULr7HU";

const AttendanceLogsPage = () => {
  const [logs, setLogs] = useState([]);
  const [employees, setEmployees] = useState([]);
  const [stores, setStores] = useState([]);
  const [recruitmentRequests, setRecruitmentRequests] = useState([]);
  const [recruitmentHours, setRecruitmentHours] = useState([]);
  const [loading, setLoading] = useState(true);
  const [activeTab, setActiveTab] = useState('logs');
  const [loadingRecruitment, setLoadingRecruitment] = useState(false);
  const { showNotification } = useNotification();
  
  // ==================================================================
  // BÆ¯á»šC 1 (Sá»¬A Äá»”I): ThÃªm state Ä‘á»ƒ quáº£n lÃ½ giÃ¡ trá»‹ tÃ¬m kiáº¿m
  // ==================================================================
  const [searchQuery, setSearchQuery] = useState('');


  useEffect(() => {
    loadInitialData();
  }, []);

  useEffect(() => {
    if (activeTab === 'recruitment') {
      console.log('ğŸ“Š Tab recruitment Ä‘Æ°á»£c chá»n, Ä‘ang refresh data...');
      loadRecruitmentHours(true);
    }
  }, [activeTab]);

  const loadInitialData = async () => {
    try {
      setLoading(true);
      await Promise.all([
        loadEmployees(),
        loadAttendanceLogs(),
        loadStores(),
        loadRecruitmentRequests(),
        loadRecruitmentHours(true)
      ]);
    } catch (error) {
      console.error('Error loading initial data:', error);
      showNotification('Lá»—i khi táº£i dá»¯ liá»‡u cháº¥m cÃ´ng', 'error')...
      === Káº¿t thÃºc AttendanceLogsPage.jsx ===
    ğŸ“„ EmployeeManagementPage.jsx
      === Ná»™i dung EmployeeManagementPage.jsx ===
import React, { useState, useMemo } from 'react';
import { useEmployees } from '../hooks/useEmployees';

// Import cÃ¡c components con
import EmployeeList from '../components/employee/EmployeeList.jsx';
import EmployeeAddForm from '../components/employee/EmployeeAddForm.jsx';
import EmployeeEditModal from '../components/employee/EmployeeEditModal.jsx';
// âœ… THÃŠM: Import cÃ¡c modal cho Work History
import AddWorkHistoryModal from '../components/employee/AddWorkHistoryModal.jsx';
import WorkHistoryModal from '../components/employee/WorkHistoryModal.jsx';
import Loading from '../components/common/Loading.jsx';
import Alert from '../components/common/Alert.jsx';

const EmployeeManagementPage = () => {
  const {
    employees,
    loading,
    error,
    addEmployee,
    updateEmployee,
    deleteEmployee,
    refreshEmployees,
  } = useEmployees();

  // State cho modal chá»‰nh sá»­a
  const [isEditModalOpen, setIsEditModalOpen] = useState(false);
  const [selectedEmployee, setSelectedEmployee] = useState(null);

  // âœ… Cáº¬P NHáº¬T: State cho cÃ¡c modal Work History
  const [isAddWorkHistoryModalOpen, setAddWorkHistoryModalOpen] = useState(false);
  const [isManageWorkHistoryModalOpen, setManageWorkHistoryModalOpen] = useState(false); // âœ… THAY Äá»”I: Äá»•i tÃªn tá»« isViewWorkHistoryModalOpen
  const [employeeForHistory, setEmployeeForHistory] = useState(null);
  
  // State cho tÃ¬m kiáº¿m vÃ  bá»™ lá»c
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState('');

  const filteredEmployees = useMemo(() => {
    // ... (Giá»¯ nguyÃªn logic lá»c)
    let filtered = employees;
    if (searchTerm) {
      const lowerCaseSearchTerm = searchTerm.toLowerCase();
      filtered = filtered.filter(
        (employee) =>
          employee.fullName.toLowerCase().includes(lowerCaseSearchTerm) ||
          employee.employeeId.toLowerCase().includes(lowerCaseSearchTerm) ||
          (employee.phoneNumber && employee.phoneNumber.includes(searchTerm))
      );
    }...
      === Káº¿t thÃºc EmployeeManagementPage.jsx ===
    ğŸ“„ HRDashboardPage.jsx
      === Ná»™i dung HRDashboardPage.jsx ===
import React, { useState, useEffect } from 'react';
import { useAuth } from '../hooks/useAuth';
import { ApiClient } from '../services/api';
import { useNotification } from '../hooks/useNotification';
import Loading from '../components/common/Loading';

const HRDashboardPage = () => {
  const [stats, setStats] = useState({
    totalEmployees: 0,
    activeEmployees: 0,
    inactiveEmployees: 0,
    totalAttendanceLogs: 0,
    todayLogs: 0,
  });
  const [loading, setLoading] = useState(true);
  const { user } = useAuth();
  const { showNotification } = useNotification();

  useEffect(() => {
    checkPermissions();
    loadStats();
    // eslint-disable-next-line
  }, []);

  const checkPermissions = () => {
    if (!user || (user.role !== 'hr' && user.role !== 'admin')) {
      showNotification('Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p trang nÃ y', 'error');
      window.location.href = '/dashboard';
    }
  };

  // **LÆ°u Ã½ QUAN TRá»ŒNG: Pháº£i dÃ¹ng Ä‘Ãºng endpoint `/api/dashboard/stats`**
  const loadStats = async () => {
    setLoading(true);
    try {
      console.log('ğŸ” HRDashboard: Loading stats...');
      // Äá»”I endpoint
      const response = await ApiClient.get('/api/dashboard/stats');
      console.log('ğŸ“¨ HRDashboard: Raw response:', response);

      if (response.success && response.data) {
        // Gá»™p stats employee vÃ  attendance
        const employee = response.data.employee || {};
        const attendance = response.data.attendance || {};

        const statsObj = {
          totalEmployees: employee.totalEmployees || 0,
          activeEmployees: employee.activeEmployees || 0,
          inactiveEmployees:
            (employee.totalEmployees || 0) - (employee.activeEmployees || 0),
          totalAttendanceLogs: attendance.totalAttendanceLogs || 0,
          todayLogs: attendance.todayLogs || 0,
        };

        console.log('âœ… HRDashboard: Setting stats to:', statsObj);
        setStats(statsObj);
      } else {
        showNotification(
          response.mess...
      === Káº¿t thÃºc HRDashboardPage.jsx ===
    ğŸ“„ LoginPage.jsx
      === Ná»™i dung LoginPage.jsx ===
import React, { useState, useEffect } from 'react';
import { Navigate, useNavigate } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import { useNotification } from '../hooks/useNotification';
import Loading from '../components/common/Loading';

const LoginPage = () => {
  const [credentials, setCredentials] = useState({
    username: '',
    password: ''
  });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [errors, setErrors] = useState({});
  
  // âœ… THÃŠM: State Ä‘á»ƒ Ä‘Ã¡nh dáº¥u khi Ä‘ang thá»±c hiá»‡n quick access
  const [isQuickAccess, setIsQuickAccess] = useState(false);
  
  const { user, login, loading } = useAuth();
  const { showNotification } = useNotification();
  const navigate = useNavigate();

  useEffect(() => {
    // Clear any existing alerts
    const alertContainer = document.getElementById('alert-container');
    if (alertContainer) {
      alertContainer.innerHTML = '';
    }
  }, []);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setCredentials(prev => ({
      ...prev,
      [name]: value
    }));
    
    // Clear error when user starts typing
    if (errors[name]) {
      setErrors(prev => ({
        ...prev,
        [name]: ''
      }));
    }
  };

  const validateForm = () => {
    const newErrors = {};
    
    if (!credentials.username.trim()) {
      newErrors.username = 'Vui lÃ²ng nháº­p tÃªn Ä‘Äƒng nháº­p';
    }
    
    if (!credentials.password.trim()) {
      newErrors.password = 'Vui lÃ²ng nháº­p máº­t kháº©u';
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
      showNotification('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!', 'error');
      return;
    }

    setIsSubmitting(true);
    
    try {
      const response = await login(credentials);
      
      console.log('âœ… Regular login response:', response);
      console.log('ğŸ‘¤ User role:', response?.da...
      === Káº¿t thÃºc LoginPage.jsx ===
  ğŸ“ services/
    ğŸ“„ api.js
      === Ná»™i dung api.js ===
// API helper functions - converted from vanilla JS
export class ApiClient {
  static async request(url, options = {}) {
    try {
      const response = await fetch(url, {
        headers: {
          'Content-Type': 'application/json',
          ...options.headers
        },
        credentials: 'include',
        ...options
      });

      // âœ… THÃŠM: Log request details Ä‘á»ƒ debug
      console.log('API Request:', {
        url,
        method: options.method || 'GET',
        body: options.body,
        status: response.status,
        statusText: response.statusText
      });

      if (!response.ok) {
        let errorData;
        try {
          errorData = await response.json();
          // âœ… THÃŠM: Log full error response
          console.error('Server error response:', errorData);
        } catch (parseError) {
          console.error('Could not parse error response:', parseError);
          errorData = { error: `HTTP ${response.status}: ${response.statusText}` };
        }
        
        // âœ… Sá»¬A: Tráº£ vá» object chá»©a Ä‘áº§y Ä‘á»§ thÃ´ng tin lá»—i
        throw new Error(JSON.stringify({
          status: response.status,
          message: errorData.message || errorData.error || 'Request failed',
          details: errorData
        }));
      }

      const data = await response.json();
      console.log('API Response:', data);
      return data;
    } catch (error) {
      console.error('API request error:', error);
      throw error;
    }
  }

  static async get(url, params = {}) {
    const queryString = new URLSearchParams(params).toString();
    const fullUrl = queryString ? `${url}?${queryString}` : url;
    return this.request(fullUrl);
  }

  static async post(url, data) {
    return this.request(url, {
      method: 'POST',
      body: JSON.stringify(data)
    });
  }

  static async put(url, data) {
    return this.request(url, {
      method: 'PUT',
      body: JSON.stringify(data)
    });
  }

  static async delete(url) {
    return this.request(ur...
      === Káº¿t thÃºc api.js ===
    ğŸ“„ auth.js
    ğŸ“„ employee.js
      === Ná»™i dung employee.js ===
// src/services/employee.js

import { ApiClient } from './api.js';

const handleError = (error, context) => {
    const message = error.response?.data?.message || error.message || `Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh khi ${context}.`;
    console.error(`âŒ Lá»—i Service API (${context}):`, message);
    throw new Error(message);
};

export const getEmployees = async () => {
    try {
        console.log('ğŸ“¡ SERVICE (FE): Gá»i API láº¥y danh sÃ¡ch nhÃ¢n viÃªn...');
        const response = await ApiClient.get('/api/employees');
        
        // âœ… Sá»¬A: Debug chi tiáº¿t response structure
        console.log('ğŸ” EMPLOYEE SERVICE: Raw axios response:', response);
        console.log('ğŸ” EMPLOYEE SERVICE: Response data type:', typeof response.data);
        console.log('ğŸ” EMPLOYEE SERVICE: Response data keys:', response.data ? Object.keys(response.data) : 'NULL');
        console.log('ğŸ” EMPLOYEE SERVICE: Response data:', response.data);
        
        if (!response.data) {
            throw new Error('Server khÃ´ng tráº£ vá» dá»¯ liá»‡u');
        }
        
        // âœ… Sá»¬A: Xá»­ lÃ½ cáº£ 2 trÆ°á»ng há»£p response structure
        
        // TrÆ°á»ng há»£p 1: Standard structure {success, data, message}
        if (typeof response.data.success !== 'undefined') {
            console.log('âœ… EMPLOYEE SERVICE: Found standard structure');
            console.log('  - success:', response.data.success);
            console.log('  - message:', response.data.message);
            console.log('  - data type:', Array.isArray(response.data.data) ? 'array' : typeof response.data.data);
            console.log('  - data length:', response.data.data?.length);
            
            if (!response.data.success) {
                throw new Error(response.data.message || 'Server tráº£ vá» lá»—i');
            }
            
            return response.data; // Tráº£ vá» {success: true, data: [...], message: "..."}
        }
        
        // TrÆ°á»ng há»£p 2: Backend tráº£ vá» array trá»±c tiáº¿p
        if (Array.isArray(response.data)) {
        ...
      === Káº¿t thÃºc employee.js ===
  ğŸ“ styles/
    ğŸ“„ components.css
    ğŸ“„ globals.css
      === Ná»™i dung globals.css ===
/* Global styles for React app */
.loading {
  position: relative;
}

.loading::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.min-vh-100 {
  min-height: 100vh;
}

/* Alert container */
#alert-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1055;
  min-width: 300px;
}

/* Table enhancements */
.table-hover tbody tr:hover {
  background-color: rgba(0, 0, 0, 0.075);
}

/* Button groups */
.btn-group .btn {
  margin-right: 2px;
}

.btn-group .btn:last-child {
  margin-right: 0;
}

/* Form enhancements */
.is-invalid {
  border-color: #dc3545;
}

.is-valid {
  border-color: #198754;
}

/* Modal enhancements */
.modal-backdrop {
  backdrop-filter: blur(2px);
}

/* Work history entries */
.work-history-entry {
  background: #f8f9fa;
  border-left: 4px solid #007bff;
}

/* Recruitment table */
.recruitment-row.table-primary {
  background-color: rgba(13, 110, 253, 0.1) !important;
}

/* Loading spinner */
.spinner-border-sm {
  width: 1rem;
  height: 1rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .btn-group {
    flex-direction: column;
  }
  
  .btn-group .btn {
    margin-right: 0;
    margin-bottom: 2px;
  }
  
  .table-responsive {
    font-size: 0.875rem;
  }
}

      === Káº¿t thÃºc globals.css ===
    ğŸ“„ notifications.css
      === Ná»™i dung notifications.css ===
/* CSS cho há»‡ thá»‘ng thÃ´ng bÃ¡o "toast" */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 380px;
}

.alert-toast {
    padding: 16px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: flex-start; /* Canh lá» trÃªn cho icon vÃ  text */
    color: #fff;
    opacity: 0;
    transform: translateX(110%);
    transition: all 0.4s cubic-bezier(0.21, 1.02, 0.73, 1);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    font-size: 15px;
}

.alert-toast.show {
    opacity: 1;
    transform: translateX(0);
}

.alert-toast-icon {
    margin-right: 12px;
    font-size: 20px;
    flex-shrink: 0;
    line-height: 1.4;
}

.alert-toast-content {
    flex-grow: 1;
}

.alert-toast-message {
    font-weight: 500;
    line-height: 1.4;
}

.alert-toast-close {
    margin-left: 16px;
    background: none;
    border: none;
    color: inherit;
    font-size: 22px;
    cursor: pointer;
    opacity: 0.7;
    padding: 0;
    line-height: 1;
}

.alert-toast-close:hover {
    opacity: 1;
}

/* CÃ¡c loáº¡i thÃ´ng bÃ¡o */
.alert-toast.success { background-color: #28a745; }
.alert-toast.error { background-color: #dc3545; }
.alert-toast.warning { background-color: #ffc107; color: #212529; }
.alert-toast.info { background-color: #0d6efd; }

      === Káº¿t thÃºc notifications.css ===
  ğŸ“ utils/
    ğŸ“„ dateUtils.js
      === Ná»™i dung dateUtils.js ===
// src/utils/dateUtils.js

export const convertExcelSerialToDate = (serialNumber) => {
    if (!serialNumber || typeof serialNumber !== 'number') return null;
    try {
        const excelEpoch = new Date(Date.UTC(1899, 11, 30, 0, 0, 0, 0));
        const msPerDay = 24 * 60 * 60 * 1000;
        const msOffset = serialNumber * msPerDay;
        return new Date(excelEpoch.getTime() + msOffset);
    } catch (error) {
        console.error('Error converting Excel serial number:', error);
        return null;
    }
};

export const formatDateTimeForCSV = (serialNumber) => {
    const date = convertExcelSerialToDate(serialNumber);
    if (!date) return 'Invalid Date';
    const y = date.getUTCFullYear(), m = String(date.getUTCMonth()+1).padStart(2,'0');
    const d = String(date.getUTCDate()).padStart(2,'0');
    const h = String(date.getUTCHours()).padStart(2,'0');
    const mi = String(date.getUTCMinutes()).padStart(2,'0');
    const s = String(date.getUTCSeconds()).padStart(2,'0');
    return `${y}-${m}-${d} ${h}:${mi}:${s}`;
};

export const formatTimeForCSV = (serialNumber) => {
    const date = convertExcelSerialToDate(serialNumber);
    if (!date) return 'Invalid Time';
    const h = String(date.getUTCHours()).padStart(2,'0');
    const mi = String(date.getUTCMinutes()).padStart(2,'0');
    const s = String(date.getUTCSeconds()).padStart(2,'0');
    return `${h}:${mi}:${s}`;
};

      === Káº¿t thÃºc dateUtils.js ===
ğŸ“„ vite.config.js
  === Ná»™i dung vite.config.js ===
// vite.config.js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    host: '0.0.0.0',
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
      }
    }
  }
})

  === Káº¿t thÃºc vite.config.js ===